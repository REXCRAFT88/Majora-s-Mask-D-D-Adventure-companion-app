var hf=h=>{throw TypeError(h)};var Fc=(h,e,t)=>e.has(h)||hf("Cannot "+t);var it=(h,e,t)=>(Fc(h,e,"read from private field"),t?t.call(h):e.get(h)),Hn=(h,e,t)=>e.has(h)?hf("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(h):e.set(h,t),en=(h,e,t,i)=>(Fc(h,e,"write to private field"),i?i.call(h,t):e.set(h,t),t),Gn=(h,e,t)=>(Fc(h,e,"access private method"),t);var uf=(h,e,t,i)=>({set _(r){en(h,e,r,t)},get _(){return it(h,e,i)}});(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const a of r)if(a.type==="childList")for(const o of a.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function t(r){const a={};return r.integrity&&(a.integrity=r.integrity),r.referrerPolicy&&(a.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?a.credentials="include":r.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(r){if(r.ep)return;r.ep=!0;const a=t(r);fetch(r.href,a)}})();function ud(h){return h&&h.__esModule&&Object.prototype.hasOwnProperty.call(h,"default")?h.default:h}var Oc={exports:{}},Br={},qc={exports:{}},je={};var ff;function Vg(){if(ff)return je;ff=1;var h=Symbol.for("react.element"),e=Symbol.for("react.portal"),t=Symbol.for("react.fragment"),i=Symbol.for("react.strict_mode"),r=Symbol.for("react.profiler"),a=Symbol.for("react.provider"),o=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),d=Symbol.for("react.suspense"),f=Symbol.for("react.memo"),p=Symbol.for("react.lazy"),g=Symbol.iterator;function w(j){return j===null||typeof j!="object"?null:(j=g&&j[g]||j["@@iterator"],typeof j=="function"?j:null)}var x={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},k=Object.assign,v={};function A(j,$,se){this.props=j,this.context=$,this.refs=v,this.updater=se||x}A.prototype.isReactComponent={},A.prototype.setState=function(j,$){if(typeof j!="object"&&typeof j!="function"&&j!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,j,$,"setState")},A.prototype.forceUpdate=function(j){this.updater.enqueueForceUpdate(this,j,"forceUpdate")};function C(){}C.prototype=A.prototype;function T(j,$,se){this.props=j,this.context=$,this.refs=v,this.updater=se||x}var R=T.prototype=new C;R.constructor=T,k(R,A.prototype),R.isPureReactComponent=!0;var E=Array.isArray,_=Object.prototype.hasOwnProperty,M={current:null},N={key:!0,ref:!0,__self:!0,__source:!0};function I(j,$,se){var ue,te={},xe=null,ye=null;if($!=null)for(ue in $.ref!==void 0&&(ye=$.ref),$.key!==void 0&&(xe=""+$.key),$)_.call($,ue)&&!N.hasOwnProperty(ue)&&(te[ue]=$[ue]);var _e=arguments.length-2;if(_e===1)te.children=se;else if(1<_e){for(var J=Array(_e),me=0;me<_e;me++)J[me]=arguments[me+2];te.children=J}if(j&&j.defaultProps)for(ue in _e=j.defaultProps,_e)te[ue]===void 0&&(te[ue]=_e[ue]);return{$$typeof:h,type:j,key:xe,ref:ye,props:te,_owner:M.current}}function G(j,$){return{$$typeof:h,type:j.type,key:$,ref:j.ref,props:j.props,_owner:j._owner}}function F(j){return typeof j=="object"&&j!==null&&j.$$typeof===h}function B(j){var $={"=":"=0",":":"=2"};return"$"+j.replace(/[=:]/g,function(se){return $[se]})}var X=/\/+/g;function oe(j,$){return typeof j=="object"&&j!==null&&j.key!=null?B(""+j.key):$.toString(36)}function le(j,$,se,ue,te){var xe=typeof j;(xe==="undefined"||xe==="boolean")&&(j=null);var ye=!1;if(j===null)ye=!0;else switch(xe){case"string":case"number":ye=!0;break;case"object":switch(j.$$typeof){case h:case e:ye=!0}}if(ye)return ye=j,te=te(ye),j=ue===""?"."+oe(ye,0):ue,E(te)?(se="",j!=null&&(se=j.replace(X,"$&/")+"/"),le(te,$,se,"",function(me){return me})):te!=null&&(F(te)&&(te=G(te,se+(!te.key||ye&&ye.key===te.key?"":(""+te.key).replace(X,"$&/")+"/")+j)),$.push(te)),1;if(ye=0,ue=ue===""?".":ue+":",E(j))for(var _e=0;_e<j.length;_e++){xe=j[_e];var J=ue+oe(xe,_e);ye+=le(xe,$,se,J,te)}else if(J=w(j),typeof J=="function")for(j=J.call(j),_e=0;!(xe=j.next()).done;)xe=xe.value,J=ue+oe(xe,_e++),ye+=le(xe,$,se,J,te);else if(xe==="object")throw $=String(j),Error("Objects are not valid as a React child (found: "+($==="[object Object]"?"object with keys {"+Object.keys(j).join(", ")+"}":$)+"). If you meant to render a collection of children, use an array instead.");return ye}function z(j,$,se){if(j==null)return j;var ue=[],te=0;return le(j,ue,"","",function(xe){return $.call(se,xe,te++)}),ue}function K(j){if(j._status===-1){var $=j._result;$=$(),$.then(function(se){(j._status===0||j._status===-1)&&(j._status=1,j._result=se)},function(se){(j._status===0||j._status===-1)&&(j._status=2,j._result=se)}),j._status===-1&&(j._status=0,j._result=$)}if(j._status===1)return j._result.default;throw j._result}var Q={current:null},V={transition:null},ce={ReactCurrentDispatcher:Q,ReactCurrentBatchConfig:V,ReactCurrentOwner:M};function re(){throw Error("act(...) is not supported in production builds of React.")}return je.Children={map:z,forEach:function(j,$,se){z(j,function(){$.apply(this,arguments)},se)},count:function(j){var $=0;return z(j,function(){$++}),$},toArray:function(j){return z(j,function($){return $})||[]},only:function(j){if(!F(j))throw Error("React.Children.only expected to receive a single React element child.");return j}},je.Component=A,je.Fragment=t,je.Profiler=r,je.PureComponent=T,je.StrictMode=i,je.Suspense=d,je.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=ce,je.act=re,je.cloneElement=function(j,$,se){if(j==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+j+".");var ue=k({},j.props),te=j.key,xe=j.ref,ye=j._owner;if($!=null){if($.ref!==void 0&&(xe=$.ref,ye=M.current),$.key!==void 0&&(te=""+$.key),j.type&&j.type.defaultProps)var _e=j.type.defaultProps;for(J in $)_.call($,J)&&!N.hasOwnProperty(J)&&(ue[J]=$[J]===void 0&&_e!==void 0?_e[J]:$[J])}var J=arguments.length-2;if(J===1)ue.children=se;else if(1<J){_e=Array(J);for(var me=0;me<J;me++)_e[me]=arguments[me+2];ue.children=_e}return{$$typeof:h,type:j.type,key:te,ref:xe,props:ue,_owner:ye}},je.createContext=function(j){return j={$$typeof:o,_currentValue:j,_currentValue2:j,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},j.Provider={$$typeof:a,_context:j},j.Consumer=j},je.createElement=I,je.createFactory=function(j){var $=I.bind(null,j);return $.type=j,$},je.createRef=function(){return{current:null}},je.forwardRef=function(j){return{$$typeof:c,render:j}},je.isValidElement=F,je.lazy=function(j){return{$$typeof:p,_payload:{_status:-1,_result:j},_init:K}},je.memo=function(j,$){return{$$typeof:f,type:j,compare:$===void 0?null:$}},je.startTransition=function(j){var $=V.transition;V.transition={};try{j()}finally{V.transition=$}},je.unstable_act=re,je.useCallback=function(j,$){return Q.current.useCallback(j,$)},je.useContext=function(j){return Q.current.useContext(j)},je.useDebugValue=function(){},je.useDeferredValue=function(j){return Q.current.useDeferredValue(j)},je.useEffect=function(j,$){return Q.current.useEffect(j,$)},je.useId=function(){return Q.current.useId()},je.useImperativeHandle=function(j,$,se){return Q.current.useImperativeHandle(j,$,se)},je.useInsertionEffect=function(j,$){return Q.current.useInsertionEffect(j,$)},je.useLayoutEffect=function(j,$){return Q.current.useLayoutEffect(j,$)},je.useMemo=function(j,$){return Q.current.useMemo(j,$)},je.useReducer=function(j,$,se){return Q.current.useReducer(j,$,se)},je.useRef=function(j){return Q.current.useRef(j)},je.useState=function(j){return Q.current.useState(j)},je.useSyncExternalStore=function(j,$,se){return Q.current.useSyncExternalStore(j,$,se)},je.useTransition=function(){return Q.current.useTransition()},je.version="18.3.1",je}var pf;function fd(){return pf||(pf=1,qc.exports=Vg()),qc.exports}var mf;function Kg(){if(mf)return Br;mf=1;var h=fd(),e=Symbol.for("react.element"),t=Symbol.for("react.fragment"),i=Object.prototype.hasOwnProperty,r=h.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,a={key:!0,ref:!0,__self:!0,__source:!0};function o(c,d,f){var p,g={},w=null,x=null;f!==void 0&&(w=""+f),d.key!==void 0&&(w=""+d.key),d.ref!==void 0&&(x=d.ref);for(p in d)i.call(d,p)&&!a.hasOwnProperty(p)&&(g[p]=d[p]);if(c&&c.defaultProps)for(p in d=c.defaultProps,d)g[p]===void 0&&(g[p]=d[p]);return{$$typeof:e,type:c,key:w,ref:x,props:g,_owner:r.current}}return Br.Fragment=t,Br.jsx=o,Br.jsxs=o,Br}var gf;function Yg(){return gf||(gf=1,Oc.exports=Kg()),Oc.exports}var m=Yg(),L=fd();const Xg=ud(L);var Ao={},Bc={exports:{}},tn={},Wc={exports:{}},Hc={};var yf;function Qg(){return yf||(yf=1,(function(h){function e(V,ce){var re=V.length;V.push(ce);e:for(;0<re;){var j=re-1>>>1,$=V[j];if(0<r($,ce))V[j]=ce,V[re]=$,re=j;else break e}}function t(V){return V.length===0?null:V[0]}function i(V){if(V.length===0)return null;var ce=V[0],re=V.pop();if(re!==ce){V[0]=re;e:for(var j=0,$=V.length,se=$>>>1;j<se;){var ue=2*(j+1)-1,te=V[ue],xe=ue+1,ye=V[xe];if(0>r(te,re))xe<$&&0>r(ye,te)?(V[j]=ye,V[xe]=re,j=xe):(V[j]=te,V[ue]=re,j=ue);else if(xe<$&&0>r(ye,re))V[j]=ye,V[xe]=re,j=xe;else break e}}return ce}function r(V,ce){var re=V.sortIndex-ce.sortIndex;return re!==0?re:V.id-ce.id}if(typeof performance=="object"&&typeof performance.now=="function"){var a=performance;h.unstable_now=function(){return a.now()}}else{var o=Date,c=o.now();h.unstable_now=function(){return o.now()-c}}var d=[],f=[],p=1,g=null,w=3,x=!1,k=!1,v=!1,A=typeof setTimeout=="function"?setTimeout:null,C=typeof clearTimeout=="function"?clearTimeout:null,T=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function R(V){for(var ce=t(f);ce!==null;){if(ce.callback===null)i(f);else if(ce.startTime<=V)i(f),ce.sortIndex=ce.expirationTime,e(d,ce);else break;ce=t(f)}}function E(V){if(v=!1,R(V),!k)if(t(d)!==null)k=!0,K(_);else{var ce=t(f);ce!==null&&Q(E,ce.startTime-V)}}function _(V,ce){k=!1,v&&(v=!1,C(I),I=-1),x=!0;var re=w;try{for(R(ce),g=t(d);g!==null&&(!(g.expirationTime>ce)||V&&!B());){var j=g.callback;if(typeof j=="function"){g.callback=null,w=g.priorityLevel;var $=j(g.expirationTime<=ce);ce=h.unstable_now(),typeof $=="function"?g.callback=$:g===t(d)&&i(d),R(ce)}else i(d);g=t(d)}if(g!==null)var se=!0;else{var ue=t(f);ue!==null&&Q(E,ue.startTime-ce),se=!1}return se}finally{g=null,w=re,x=!1}}var M=!1,N=null,I=-1,G=5,F=-1;function B(){return!(h.unstable_now()-F<G)}function X(){if(N!==null){var V=h.unstable_now();F=V;var ce=!0;try{ce=N(!0,V)}finally{ce?oe():(M=!1,N=null)}}else M=!1}var oe;if(typeof T=="function")oe=function(){T(X)};else if(typeof MessageChannel<"u"){var le=new MessageChannel,z=le.port2;le.port1.onmessage=X,oe=function(){z.postMessage(null)}}else oe=function(){A(X,0)};function K(V){N=V,M||(M=!0,oe())}function Q(V,ce){I=A(function(){V(h.unstable_now())},ce)}h.unstable_IdlePriority=5,h.unstable_ImmediatePriority=1,h.unstable_LowPriority=4,h.unstable_NormalPriority=3,h.unstable_Profiling=null,h.unstable_UserBlockingPriority=2,h.unstable_cancelCallback=function(V){V.callback=null},h.unstable_continueExecution=function(){k||x||(k=!0,K(_))},h.unstable_forceFrameRate=function(V){0>V||125<V?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):G=0<V?Math.floor(1e3/V):5},h.unstable_getCurrentPriorityLevel=function(){return w},h.unstable_getFirstCallbackNode=function(){return t(d)},h.unstable_next=function(V){switch(w){case 1:case 2:case 3:var ce=3;break;default:ce=w}var re=w;w=ce;try{return V()}finally{w=re}},h.unstable_pauseExecution=function(){},h.unstable_requestPaint=function(){},h.unstable_runWithPriority=function(V,ce){switch(V){case 1:case 2:case 3:case 4:case 5:break;default:V=3}var re=w;w=V;try{return ce()}finally{w=re}},h.unstable_scheduleCallback=function(V,ce,re){var j=h.unstable_now();switch(typeof re=="object"&&re!==null?(re=re.delay,re=typeof re=="number"&&0<re?j+re:j):re=j,V){case 1:var $=-1;break;case 2:$=250;break;case 5:$=1073741823;break;case 4:$=1e4;break;default:$=5e3}return $=re+$,V={id:p++,callback:ce,priorityLevel:V,startTime:re,expirationTime:$,sortIndex:-1},re>j?(V.sortIndex=re,e(f,V),t(d)===null&&V===t(f)&&(v?(C(I),I=-1):v=!0,Q(E,re-j))):(V.sortIndex=$,e(d,V),k||x||(k=!0,K(_))),V},h.unstable_shouldYield=B,h.unstable_wrapCallback=function(V){var ce=w;return function(){var re=w;w=ce;try{return V.apply(this,arguments)}finally{w=re}}}})(Hc)),Hc}var wf;function Jg(){return wf||(wf=1,Wc.exports=Qg()),Wc.exports}var bf;function Zg(){if(bf)return tn;bf=1;var h=fd(),e=Jg();function t(n){for(var s="https://reactjs.org/docs/error-decoder.html?invariant="+n,l=1;l<arguments.length;l++)s+="&args[]="+encodeURIComponent(arguments[l]);return"Minified React error #"+n+"; visit "+s+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var i=new Set,r={};function a(n,s){o(n,s),o(n+"Capture",s)}function o(n,s){for(r[n]=s,n=0;n<s.length;n++)i.add(s[n])}var c=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),d=Object.prototype.hasOwnProperty,f=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,p={},g={};function w(n){return d.call(g,n)?!0:d.call(p,n)?!1:f.test(n)?g[n]=!0:(p[n]=!0,!1)}function x(n,s,l,u){if(l!==null&&l.type===0)return!1;switch(typeof s){case"function":case"symbol":return!0;case"boolean":return u?!1:l!==null?!l.acceptsBooleans:(n=n.toLowerCase().slice(0,5),n!=="data-"&&n!=="aria-");default:return!1}}function k(n,s,l,u){if(s===null||typeof s>"u"||x(n,s,l,u))return!0;if(u)return!1;if(l!==null)switch(l.type){case 3:return!s;case 4:return s===!1;case 5:return isNaN(s);case 6:return isNaN(s)||1>s}return!1}function v(n,s,l,u,y,b,S){this.acceptsBooleans=s===2||s===3||s===4,this.attributeName=u,this.attributeNamespace=y,this.mustUseProperty=l,this.propertyName=n,this.type=s,this.sanitizeURL=b,this.removeEmptyString=S}var A={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(n){A[n]=new v(n,0,!1,n,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(n){var s=n[0];A[s]=new v(s,1,!1,n[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(n){A[n]=new v(n,2,!1,n.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(n){A[n]=new v(n,2,!1,n,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(n){A[n]=new v(n,3,!1,n.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(n){A[n]=new v(n,3,!0,n,null,!1,!1)}),["capture","download"].forEach(function(n){A[n]=new v(n,4,!1,n,null,!1,!1)}),["cols","rows","size","span"].forEach(function(n){A[n]=new v(n,6,!1,n,null,!1,!1)}),["rowSpan","start"].forEach(function(n){A[n]=new v(n,5,!1,n.toLowerCase(),null,!1,!1)});var C=/[\-:]([a-z])/g;function T(n){return n[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(n){var s=n.replace(C,T);A[s]=new v(s,1,!1,n,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(n){var s=n.replace(C,T);A[s]=new v(s,1,!1,n,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(n){var s=n.replace(C,T);A[s]=new v(s,1,!1,n,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(n){A[n]=new v(n,1,!1,n.toLowerCase(),null,!1,!1)}),A.xlinkHref=new v("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(n){A[n]=new v(n,1,!1,n.toLowerCase(),null,!0,!0)});function R(n,s,l,u){var y=A.hasOwnProperty(s)?A[s]:null;(y!==null?y.type!==0:u||!(2<s.length)||s[0]!=="o"&&s[0]!=="O"||s[1]!=="n"&&s[1]!=="N")&&(k(s,l,y,u)&&(l=null),u||y===null?w(s)&&(l===null?n.removeAttribute(s):n.setAttribute(s,""+l)):y.mustUseProperty?n[y.propertyName]=l===null?y.type===3?!1:"":l:(s=y.attributeName,u=y.attributeNamespace,l===null?n.removeAttribute(s):(y=y.type,l=y===3||y===4&&l===!0?"":""+l,u?n.setAttributeNS(u,s,l):n.setAttribute(s,l))))}var E=h.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,_=Symbol.for("react.element"),M=Symbol.for("react.portal"),N=Symbol.for("react.fragment"),I=Symbol.for("react.strict_mode"),G=Symbol.for("react.profiler"),F=Symbol.for("react.provider"),B=Symbol.for("react.context"),X=Symbol.for("react.forward_ref"),oe=Symbol.for("react.suspense"),le=Symbol.for("react.suspense_list"),z=Symbol.for("react.memo"),K=Symbol.for("react.lazy"),Q=Symbol.for("react.offscreen"),V=Symbol.iterator;function ce(n){return n===null||typeof n!="object"?null:(n=V&&n[V]||n["@@iterator"],typeof n=="function"?n:null)}var re=Object.assign,j;function $(n){if(j===void 0)try{throw Error()}catch(l){var s=l.stack.trim().match(/\n( *(at )?)/);j=s&&s[1]||""}return`
`+j+n}var se=!1;function ue(n,s){if(!n||se)return"";se=!0;var l=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(s)if(s=function(){throw Error()},Object.defineProperty(s.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(s,[])}catch(U){var u=U}Reflect.construct(n,[],s)}else{try{s.call()}catch(U){u=U}n.call(s.prototype)}else{try{throw Error()}catch(U){u=U}n()}}catch(U){if(U&&u&&typeof U.stack=="string"){for(var y=U.stack.split(`
`),b=u.stack.split(`
`),S=y.length-1,P=b.length-1;1<=S&&0<=P&&y[S]!==b[P];)P--;for(;1<=S&&0<=P;S--,P--)if(y[S]!==b[P]){if(S!==1||P!==1)do if(S--,P--,0>P||y[S]!==b[P]){var D=`
`+y[S].replace(" at new "," at ");return n.displayName&&D.includes("<anonymous>")&&(D=D.replace("<anonymous>",n.displayName)),D}while(1<=S&&0<=P);break}}}finally{se=!1,Error.prepareStackTrace=l}return(n=n?n.displayName||n.name:"")?$(n):""}function te(n){switch(n.tag){case 5:return $(n.type);case 16:return $("Lazy");case 13:return $("Suspense");case 19:return $("SuspenseList");case 0:case 2:case 15:return n=ue(n.type,!1),n;case 11:return n=ue(n.type.render,!1),n;case 1:return n=ue(n.type,!0),n;default:return""}}function xe(n){if(n==null)return null;if(typeof n=="function")return n.displayName||n.name||null;if(typeof n=="string")return n;switch(n){case N:return"Fragment";case M:return"Portal";case G:return"Profiler";case I:return"StrictMode";case oe:return"Suspense";case le:return"SuspenseList"}if(typeof n=="object")switch(n.$$typeof){case B:return(n.displayName||"Context")+".Consumer";case F:return(n._context.displayName||"Context")+".Provider";case X:var s=n.render;return n=n.displayName,n||(n=s.displayName||s.name||"",n=n!==""?"ForwardRef("+n+")":"ForwardRef"),n;case z:return s=n.displayName||null,s!==null?s:xe(n.type)||"Memo";case K:s=n._payload,n=n._init;try{return xe(n(s))}catch{}}return null}function ye(n){var s=n.type;switch(n.tag){case 24:return"Cache";case 9:return(s.displayName||"Context")+".Consumer";case 10:return(s._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return n=s.render,n=n.displayName||n.name||"",s.displayName||(n!==""?"ForwardRef("+n+")":"ForwardRef");case 7:return"Fragment";case 5:return s;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return xe(s);case 8:return s===I?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof s=="function")return s.displayName||s.name||null;if(typeof s=="string")return s}return null}function _e(n){switch(typeof n){case"boolean":case"number":case"string":case"undefined":return n;case"object":return n;default:return""}}function J(n){var s=n.type;return(n=n.nodeName)&&n.toLowerCase()==="input"&&(s==="checkbox"||s==="radio")}function me(n){var s=J(n)?"checked":"value",l=Object.getOwnPropertyDescriptor(n.constructor.prototype,s),u=""+n[s];if(!n.hasOwnProperty(s)&&typeof l<"u"&&typeof l.get=="function"&&typeof l.set=="function"){var y=l.get,b=l.set;return Object.defineProperty(n,s,{configurable:!0,get:function(){return y.call(this)},set:function(S){u=""+S,b.call(this,S)}}),Object.defineProperty(n,s,{enumerable:l.enumerable}),{getValue:function(){return u},setValue:function(S){u=""+S},stopTracking:function(){n._valueTracker=null,delete n[s]}}}}function Ve(n){n._valueTracker||(n._valueTracker=me(n))}function ft(n){if(!n)return!1;var s=n._valueTracker;if(!s)return!0;var l=s.getValue(),u="";return n&&(u=J(n)?n.checked?"true":"false":n.value),n=u,n!==l?(s.setValue(n),!0):!1}function ee(n){if(n=n||(typeof document<"u"?document:void 0),typeof n>"u")return null;try{return n.activeElement||n.body}catch{return n.body}}function fe(n,s){var l=s.checked;return re({},s,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:l??n._wrapperState.initialChecked})}function pe(n,s){var l=s.defaultValue==null?"":s.defaultValue,u=s.checked!=null?s.checked:s.defaultChecked;l=_e(s.value!=null?s.value:l),n._wrapperState={initialChecked:u,initialValue:l,controlled:s.type==="checkbox"||s.type==="radio"?s.checked!=null:s.value!=null}}function Ce(n,s){s=s.checked,s!=null&&R(n,"checked",s,!1)}function De(n,s){Ce(n,s);var l=_e(s.value),u=s.type;if(l!=null)u==="number"?(l===0&&n.value===""||n.value!=l)&&(n.value=""+l):n.value!==""+l&&(n.value=""+l);else if(u==="submit"||u==="reset"){n.removeAttribute("value");return}s.hasOwnProperty("value")?Ke(n,s.type,l):s.hasOwnProperty("defaultValue")&&Ke(n,s.type,_e(s.defaultValue)),s.checked==null&&s.defaultChecked!=null&&(n.defaultChecked=!!s.defaultChecked)}function Je(n,s,l){if(s.hasOwnProperty("value")||s.hasOwnProperty("defaultValue")){var u=s.type;if(!(u!=="submit"&&u!=="reset"||s.value!==void 0&&s.value!==null))return;s=""+n._wrapperState.initialValue,l||s===n.value||(n.value=s),n.defaultValue=s}l=n.name,l!==""&&(n.name=""),n.defaultChecked=!!n._wrapperState.initialChecked,l!==""&&(n.name=l)}function Ke(n,s,l){(s!=="number"||ee(n.ownerDocument)!==n)&&(l==null?n.defaultValue=""+n._wrapperState.initialValue:n.defaultValue!==""+l&&(n.defaultValue=""+l))}var vt=Array.isArray;function Xe(n,s,l,u){if(n=n.options,s){s={};for(var y=0;y<l.length;y++)s["$"+l[y]]=!0;for(l=0;l<n.length;l++)y=s.hasOwnProperty("$"+n[l].value),n[l].selected!==y&&(n[l].selected=y),y&&u&&(n[l].defaultSelected=!0)}else{for(l=""+_e(l),s=null,y=0;y<n.length;y++){if(n[y].value===l){n[y].selected=!0,u&&(n[y].defaultSelected=!0);return}s!==null||n[y].disabled||(s=n[y])}s!==null&&(s.selected=!0)}}function rt(n,s){if(s.dangerouslySetInnerHTML!=null)throw Error(t(91));return re({},s,{value:void 0,defaultValue:void 0,children:""+n._wrapperState.initialValue})}function $t(n,s){var l=s.value;if(l==null){if(l=s.children,s=s.defaultValue,l!=null){if(s!=null)throw Error(t(92));if(vt(l)){if(1<l.length)throw Error(t(93));l=l[0]}s=l}s==null&&(s=""),l=s}n._wrapperState={initialValue:_e(l)}}function gt(n,s){var l=_e(s.value),u=_e(s.defaultValue);l!=null&&(l=""+l,l!==n.value&&(n.value=l),s.defaultValue==null&&n.defaultValue!==l&&(n.defaultValue=l)),u!=null&&(n.defaultValue=""+u)}function pt(n){var s=n.textContent;s===n._wrapperState.initialValue&&s!==""&&s!==null&&(n.value=s)}function Xn(n){switch(n){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Vt(n,s){return n==null||n==="http://www.w3.org/1999/xhtml"?Xn(s):n==="http://www.w3.org/2000/svg"&&s==="foreignObject"?"http://www.w3.org/1999/xhtml":n}var on,Ge=(function(n){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(s,l,u,y){MSApp.execUnsafeLocalFunction(function(){return n(s,l,u,y)})}:n})(function(n,s){if(n.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in n)n.innerHTML=s;else{for(on=on||document.createElement("div"),on.innerHTML="<svg>"+s.valueOf().toString()+"</svg>",s=on.firstChild;n.firstChild;)n.removeChild(n.firstChild);for(;s.firstChild;)n.appendChild(s.firstChild)}});function Tn(n,s){if(s){var l=n.firstChild;if(l&&l===n.lastChild&&l.nodeType===3){l.nodeValue=s;return}}n.textContent=s}var Qn={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Jo=["Webkit","ms","Moz","O"];Object.keys(Qn).forEach(function(n){Jo.forEach(function(s){s=s+n.charAt(0).toUpperCase()+n.substring(1),Qn[s]=Qn[n]})});function ha(n,s,l){return s==null||typeof s=="boolean"||s===""?"":l||typeof s!="number"||s===0||Qn.hasOwnProperty(n)&&Qn[n]?(""+s).trim():s+"px"}function ua(n,s){n=n.style;for(var l in s)if(s.hasOwnProperty(l)){var u=l.indexOf("--")===0,y=ha(l,s[l],u);l==="float"&&(l="cssFloat"),u?n.setProperty(l,y):n[l]=y}}var Zo=re({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ir(n,s){if(s){if(Zo[n]&&(s.children!=null||s.dangerouslySetInnerHTML!=null))throw Error(t(137,n));if(s.dangerouslySetInnerHTML!=null){if(s.children!=null)throw Error(t(60));if(typeof s.dangerouslySetInnerHTML!="object"||!("__html"in s.dangerouslySetInnerHTML))throw Error(t(61))}if(s.style!=null&&typeof s.style!="object")throw Error(t(62))}}function sr(n,s){if(n.indexOf("-")===-1)return typeof s.is=="string";switch(n){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var ms=null;function rr(n){return n=n.target||n.srcElement||window,n.correspondingUseElement&&(n=n.correspondingUseElement),n.nodeType===3?n.parentNode:n}var ar=null,hi=null,ui=null;function Wi(n){if(n=Cr(n)){if(typeof ar!="function")throw Error(t(280));var s=n.stateNode;s&&(s=Oa(s),ar(n.stateNode,n.type,s))}}function fa(n){hi?ui?ui.push(n):ui=[n]:hi=n}function pa(){if(hi){var n=hi,s=ui;if(ui=hi=null,Wi(n),s)for(n=0;n<s.length;n++)Wi(s[n])}}function ma(n,s){return n(s)}function ga(){}var fi=!1;function ya(n,s,l){if(fi)return n(s,l);fi=!0;try{return ma(n,s,l)}finally{fi=!1,(hi!==null||ui!==null)&&(ga(),pa())}}function Hi(n,s){var l=n.stateNode;if(l===null)return null;var u=Oa(l);if(u===null)return null;l=u[s];e:switch(s){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(u=!u.disabled)||(n=n.type,u=!(n==="button"||n==="input"||n==="select"||n==="textarea")),n=!u;break e;default:n=!1}if(n)return null;if(l&&typeof l!="function")throw Error(t(231,s,typeof l));return l}var Gi=!1;if(c)try{var pi={};Object.defineProperty(pi,"passive",{get:function(){Gi=!0}}),window.addEventListener("test",pi,pi),window.removeEventListener("test",pi,pi)}catch{Gi=!1}function Od(n,s,l,u,y,b,S,P,D){var U=Array.prototype.slice.call(arguments,3);try{s.apply(l,U)}catch(ie){this.onError(ie)}}var mi=!1,gs=null,Z=!1,he=null,Fe={onError:function(n){mi=!0,gs=n}};function qe(n,s,l,u,y,b,S,P,D){mi=!1,gs=null,Od.apply(Fe,arguments)}function Ze(n,s,l,u,y,b,S,P,D){if(qe.apply(this,arguments),mi){if(mi){var U=gs;mi=!1,gs=null}else throw Error(t(198));Z||(Z=!0,he=U)}}function ln(n){var s=n,l=n;if(n.alternate)for(;s.return;)s=s.return;else{n=s;do s=n,(s.flags&4098)!==0&&(l=s.return),n=s.return;while(n)}return s.tag===3?l:null}function gi(n){if(n.tag===13){var s=n.memoizedState;if(s===null&&(n=n.alternate,n!==null&&(s=n.memoizedState)),s!==null)return s.dehydrated}return null}function zi(n){if(ln(n)!==n)throw Error(t(188))}function ys(n){var s=n.alternate;if(!s){if(s=ln(n),s===null)throw Error(t(188));return s!==n?null:n}for(var l=n,u=s;;){var y=l.return;if(y===null)break;var b=y.alternate;if(b===null){if(u=y.return,u!==null){l=u;continue}break}if(y.child===b.child){for(b=y.child;b;){if(b===l)return zi(y),n;if(b===u)return zi(y),s;b=b.sibling}throw Error(t(188))}if(l.return!==u.return)l=y,u=b;else{for(var S=!1,P=y.child;P;){if(P===l){S=!0,l=y,u=b;break}if(P===u){S=!0,u=y,l=b;break}P=P.sibling}if(!S){for(P=b.child;P;){if(P===l){S=!0,l=b,u=y;break}if(P===u){S=!0,u=b,l=y;break}P=P.sibling}if(!S)throw Error(t(189))}}if(l.alternate!==u)throw Error(t(190))}if(l.tag!==3)throw Error(t(188));return l.stateNode.current===l?n:s}function el(n){return n=ys(n),n!==null?Kt(n):null}function Kt(n){if(n.tag===5||n.tag===6)return n;for(n=n.child;n!==null;){var s=Kt(n);if(s!==null)return s;n=n.sibling}return null}var jn=e.unstable_scheduleCallback,yi=e.unstable_cancelCallback,tl=e.unstable_shouldYield,nl=e.unstable_requestPaint,at=e.unstable_now,il=e.unstable_getCurrentPriorityLevel,ws=e.unstable_ImmediatePriority,qd=e.unstable_UserBlockingPriority,wa=e.unstable_NormalPriority,om=e.unstable_LowPriority,Bd=e.unstable_IdlePriority,ba=null,Fn=null;function lm(n){if(Fn&&typeof Fn.onCommitFiberRoot=="function")try{Fn.onCommitFiberRoot(ba,n,void 0,(n.current.flags&128)===128)}catch{}}var En=Math.clz32?Math.clz32:hm,cm=Math.log,dm=Math.LN2;function hm(n){return n>>>=0,n===0?32:31-(cm(n)/dm|0)|0}var va=64,xa=4194304;function or(n){switch(n&-n){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return n&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return n&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return n}}function ka(n,s){var l=n.pendingLanes;if(l===0)return 0;var u=0,y=n.suspendedLanes,b=n.pingedLanes,S=l&268435455;if(S!==0){var P=S&~y;P!==0?u=or(P):(b&=S,b!==0&&(u=or(b)))}else S=l&~y,S!==0?u=or(S):b!==0&&(u=or(b));if(u===0)return 0;if(s!==0&&s!==u&&(s&y)===0&&(y=u&-u,b=s&-s,y>=b||y===16&&(b&4194240)!==0))return s;if((u&4)!==0&&(u|=l&16),s=n.entangledLanes,s!==0)for(n=n.entanglements,s&=u;0<s;)l=31-En(s),y=1<<l,u|=n[l],s&=~y;return u}function um(n,s){switch(n){case 1:case 2:case 4:return s+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return s+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function fm(n,s){for(var l=n.suspendedLanes,u=n.pingedLanes,y=n.expirationTimes,b=n.pendingLanes;0<b;){var S=31-En(b),P=1<<S,D=y[S];D===-1?((P&l)===0||(P&u)!==0)&&(y[S]=um(P,s)):D<=s&&(n.expiredLanes|=P),b&=~P}}function sl(n){return n=n.pendingLanes&-1073741825,n!==0?n:n&1073741824?1073741824:0}function Wd(){var n=va;return va<<=1,(va&4194240)===0&&(va=64),n}function rl(n){for(var s=[],l=0;31>l;l++)s.push(n);return s}function lr(n,s,l){n.pendingLanes|=s,s!==536870912&&(n.suspendedLanes=0,n.pingedLanes=0),n=n.eventTimes,s=31-En(s),n[s]=l}function pm(n,s){var l=n.pendingLanes&~s;n.pendingLanes=s,n.suspendedLanes=0,n.pingedLanes=0,n.expiredLanes&=s,n.mutableReadLanes&=s,n.entangledLanes&=s,s=n.entanglements;var u=n.eventTimes;for(n=n.expirationTimes;0<l;){var y=31-En(l),b=1<<y;s[y]=0,u[y]=-1,n[y]=-1,l&=~b}}function al(n,s){var l=n.entangledLanes|=s;for(n=n.entanglements;l;){var u=31-En(l),y=1<<u;y&s|n[u]&s&&(n[u]|=s),l&=~y}}var Ue=0;function Hd(n){return n&=-n,1<n?4<n?(n&268435455)!==0?16:536870912:4:1}var Gd,ol,zd,Ud,$d,ll=!1,Sa=[],wi=null,bi=null,vi=null,cr=new Map,dr=new Map,xi=[],mm="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Vd(n,s){switch(n){case"focusin":case"focusout":wi=null;break;case"dragenter":case"dragleave":bi=null;break;case"mouseover":case"mouseout":vi=null;break;case"pointerover":case"pointerout":cr.delete(s.pointerId);break;case"gotpointercapture":case"lostpointercapture":dr.delete(s.pointerId)}}function hr(n,s,l,u,y,b){return n===null||n.nativeEvent!==b?(n={blockedOn:s,domEventName:l,eventSystemFlags:u,nativeEvent:b,targetContainers:[y]},s!==null&&(s=Cr(s),s!==null&&ol(s)),n):(n.eventSystemFlags|=u,s=n.targetContainers,y!==null&&s.indexOf(y)===-1&&s.push(y),n)}function gm(n,s,l,u,y){switch(s){case"focusin":return wi=hr(wi,n,s,l,u,y),!0;case"dragenter":return bi=hr(bi,n,s,l,u,y),!0;case"mouseover":return vi=hr(vi,n,s,l,u,y),!0;case"pointerover":var b=y.pointerId;return cr.set(b,hr(cr.get(b)||null,n,s,l,u,y)),!0;case"gotpointercapture":return b=y.pointerId,dr.set(b,hr(dr.get(b)||null,n,s,l,u,y)),!0}return!1}function Kd(n){var s=Ui(n.target);if(s!==null){var l=ln(s);if(l!==null){if(s=l.tag,s===13){if(s=gi(l),s!==null){n.blockedOn=s,$d(n.priority,function(){zd(l)});return}}else if(s===3&&l.stateNode.current.memoizedState.isDehydrated){n.blockedOn=l.tag===3?l.stateNode.containerInfo:null;return}}}n.blockedOn=null}function Aa(n){if(n.blockedOn!==null)return!1;for(var s=n.targetContainers;0<s.length;){var l=dl(n.domEventName,n.eventSystemFlags,s[0],n.nativeEvent);if(l===null){l=n.nativeEvent;var u=new l.constructor(l.type,l);ms=u,l.target.dispatchEvent(u),ms=null}else return s=Cr(l),s!==null&&ol(s),n.blockedOn=l,!1;s.shift()}return!0}function Yd(n,s,l){Aa(n)&&l.delete(s)}function ym(){ll=!1,wi!==null&&Aa(wi)&&(wi=null),bi!==null&&Aa(bi)&&(bi=null),vi!==null&&Aa(vi)&&(vi=null),cr.forEach(Yd),dr.forEach(Yd)}function ur(n,s){n.blockedOn===s&&(n.blockedOn=null,ll||(ll=!0,e.unstable_scheduleCallback(e.unstable_NormalPriority,ym)))}function fr(n){function s(y){return ur(y,n)}if(0<Sa.length){ur(Sa[0],n);for(var l=1;l<Sa.length;l++){var u=Sa[l];u.blockedOn===n&&(u.blockedOn=null)}}for(wi!==null&&ur(wi,n),bi!==null&&ur(bi,n),vi!==null&&ur(vi,n),cr.forEach(s),dr.forEach(s),l=0;l<xi.length;l++)u=xi[l],u.blockedOn===n&&(u.blockedOn=null);for(;0<xi.length&&(l=xi[0],l.blockedOn===null);)Kd(l),l.blockedOn===null&&xi.shift()}var bs=E.ReactCurrentBatchConfig,Ca=!0;function wm(n,s,l,u){var y=Ue,b=bs.transition;bs.transition=null;try{Ue=1,cl(n,s,l,u)}finally{Ue=y,bs.transition=b}}function bm(n,s,l,u){var y=Ue,b=bs.transition;bs.transition=null;try{Ue=4,cl(n,s,l,u)}finally{Ue=y,bs.transition=b}}function cl(n,s,l,u){if(Ca){var y=dl(n,s,l,u);if(y===null)El(n,s,u,Ta,l),Vd(n,u);else if(gm(y,n,s,l,u))u.stopPropagation();else if(Vd(n,u),s&4&&-1<mm.indexOf(n)){for(;y!==null;){var b=Cr(y);if(b!==null&&Gd(b),b=dl(n,s,l,u),b===null&&El(n,s,u,Ta,l),b===y)break;y=b}y!==null&&u.stopPropagation()}else El(n,s,u,null,l)}}var Ta=null;function dl(n,s,l,u){if(Ta=null,n=rr(u),n=Ui(n),n!==null)if(s=ln(n),s===null)n=null;else if(l=s.tag,l===13){if(n=gi(s),n!==null)return n;n=null}else if(l===3){if(s.stateNode.current.memoizedState.isDehydrated)return s.tag===3?s.stateNode.containerInfo:null;n=null}else s!==n&&(n=null);return Ta=n,null}function Xd(n){switch(n){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(il()){case ws:return 1;case qd:return 4;case wa:case om:return 16;case Bd:return 536870912;default:return 16}default:return 16}}var ki=null,hl=null,Ea=null;function Qd(){if(Ea)return Ea;var n,s=hl,l=s.length,u,y="value"in ki?ki.value:ki.textContent,b=y.length;for(n=0;n<l&&s[n]===y[n];n++);var S=l-n;for(u=1;u<=S&&s[l-u]===y[b-u];u++);return Ea=y.slice(n,1<u?1-u:void 0)}function Ra(n){var s=n.keyCode;return"charCode"in n?(n=n.charCode,n===0&&s===13&&(n=13)):n=s,n===10&&(n=13),32<=n||n===13?n:0}function _a(){return!0}function Jd(){return!1}function cn(n){function s(l,u,y,b,S){this._reactName=l,this._targetInst=y,this.type=u,this.nativeEvent=b,this.target=S,this.currentTarget=null;for(var P in n)n.hasOwnProperty(P)&&(l=n[P],this[P]=l?l(b):b[P]);return this.isDefaultPrevented=(b.defaultPrevented!=null?b.defaultPrevented:b.returnValue===!1)?_a:Jd,this.isPropagationStopped=Jd,this}return re(s.prototype,{preventDefault:function(){this.defaultPrevented=!0;var l=this.nativeEvent;l&&(l.preventDefault?l.preventDefault():typeof l.returnValue!="unknown"&&(l.returnValue=!1),this.isDefaultPrevented=_a)},stopPropagation:function(){var l=this.nativeEvent;l&&(l.stopPropagation?l.stopPropagation():typeof l.cancelBubble!="unknown"&&(l.cancelBubble=!0),this.isPropagationStopped=_a)},persist:function(){},isPersistent:_a}),s}var vs={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(n){return n.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},ul=cn(vs),pr=re({},vs,{view:0,detail:0}),vm=cn(pr),fl,pl,mr,Na=re({},pr,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:gl,button:0,buttons:0,relatedTarget:function(n){return n.relatedTarget===void 0?n.fromElement===n.srcElement?n.toElement:n.fromElement:n.relatedTarget},movementX:function(n){return"movementX"in n?n.movementX:(n!==mr&&(mr&&n.type==="mousemove"?(fl=n.screenX-mr.screenX,pl=n.screenY-mr.screenY):pl=fl=0,mr=n),fl)},movementY:function(n){return"movementY"in n?n.movementY:pl}}),Zd=cn(Na),xm=re({},Na,{dataTransfer:0}),km=cn(xm),Sm=re({},pr,{relatedTarget:0}),ml=cn(Sm),Am=re({},vs,{animationName:0,elapsedTime:0,pseudoElement:0}),Cm=cn(Am),Tm=re({},vs,{clipboardData:function(n){return"clipboardData"in n?n.clipboardData:window.clipboardData}}),Em=cn(Tm),Rm=re({},vs,{data:0}),eh=cn(Rm),_m={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Nm={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Pm={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Mm(n){var s=this.nativeEvent;return s.getModifierState?s.getModifierState(n):(n=Pm[n])?!!s[n]:!1}function gl(){return Mm}var Im=re({},pr,{key:function(n){if(n.key){var s=_m[n.key]||n.key;if(s!=="Unidentified")return s}return n.type==="keypress"?(n=Ra(n),n===13?"Enter":String.fromCharCode(n)):n.type==="keydown"||n.type==="keyup"?Nm[n.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:gl,charCode:function(n){return n.type==="keypress"?Ra(n):0},keyCode:function(n){return n.type==="keydown"||n.type==="keyup"?n.keyCode:0},which:function(n){return n.type==="keypress"?Ra(n):n.type==="keydown"||n.type==="keyup"?n.keyCode:0}}),Dm=cn(Im),Lm=re({},Na,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),th=cn(Lm),jm=re({},pr,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:gl}),Fm=cn(jm),Om=re({},vs,{propertyName:0,elapsedTime:0,pseudoElement:0}),qm=cn(Om),Bm=re({},Na,{deltaX:function(n){return"deltaX"in n?n.deltaX:"wheelDeltaX"in n?-n.wheelDeltaX:0},deltaY:function(n){return"deltaY"in n?n.deltaY:"wheelDeltaY"in n?-n.wheelDeltaY:"wheelDelta"in n?-n.wheelDelta:0},deltaZ:0,deltaMode:0}),Wm=cn(Bm),Hm=[9,13,27,32],yl=c&&"CompositionEvent"in window,gr=null;c&&"documentMode"in document&&(gr=document.documentMode);var Gm=c&&"TextEvent"in window&&!gr,nh=c&&(!yl||gr&&8<gr&&11>=gr),ih=" ",sh=!1;function rh(n,s){switch(n){case"keyup":return Hm.indexOf(s.keyCode)!==-1;case"keydown":return s.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function ah(n){return n=n.detail,typeof n=="object"&&"data"in n?n.data:null}var xs=!1;function zm(n,s){switch(n){case"compositionend":return ah(s);case"keypress":return s.which!==32?null:(sh=!0,ih);case"textInput":return n=s.data,n===ih&&sh?null:n;default:return null}}function Um(n,s){if(xs)return n==="compositionend"||!yl&&rh(n,s)?(n=Qd(),Ea=hl=ki=null,xs=!1,n):null;switch(n){case"paste":return null;case"keypress":if(!(s.ctrlKey||s.altKey||s.metaKey)||s.ctrlKey&&s.altKey){if(s.char&&1<s.char.length)return s.char;if(s.which)return String.fromCharCode(s.which)}return null;case"compositionend":return nh&&s.locale!=="ko"?null:s.data;default:return null}}var $m={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function oh(n){var s=n&&n.nodeName&&n.nodeName.toLowerCase();return s==="input"?!!$m[n.type]:s==="textarea"}function lh(n,s,l,u){fa(u),s=La(s,"onChange"),0<s.length&&(l=new ul("onChange","change",null,l,u),n.push({event:l,listeners:s}))}var yr=null,wr=null;function Vm(n){Th(n,0)}function Pa(n){var s=Ts(n);if(ft(s))return n}function Km(n,s){if(n==="change")return s}var ch=!1;if(c){var wl;if(c){var bl="oninput"in document;if(!bl){var dh=document.createElement("div");dh.setAttribute("oninput","return;"),bl=typeof dh.oninput=="function"}wl=bl}else wl=!1;ch=wl&&(!document.documentMode||9<document.documentMode)}function hh(){yr&&(yr.detachEvent("onpropertychange",uh),wr=yr=null)}function uh(n){if(n.propertyName==="value"&&Pa(wr)){var s=[];lh(s,wr,n,rr(n)),ya(Vm,s)}}function Ym(n,s,l){n==="focusin"?(hh(),yr=s,wr=l,yr.attachEvent("onpropertychange",uh)):n==="focusout"&&hh()}function Xm(n){if(n==="selectionchange"||n==="keyup"||n==="keydown")return Pa(wr)}function Qm(n,s){if(n==="click")return Pa(s)}function Jm(n,s){if(n==="input"||n==="change")return Pa(s)}function Zm(n,s){return n===s&&(n!==0||1/n===1/s)||n!==n&&s!==s}var Rn=typeof Object.is=="function"?Object.is:Zm;function br(n,s){if(Rn(n,s))return!0;if(typeof n!="object"||n===null||typeof s!="object"||s===null)return!1;var l=Object.keys(n),u=Object.keys(s);if(l.length!==u.length)return!1;for(u=0;u<l.length;u++){var y=l[u];if(!d.call(s,y)||!Rn(n[y],s[y]))return!1}return!0}function fh(n){for(;n&&n.firstChild;)n=n.firstChild;return n}function ph(n,s){var l=fh(n);n=0;for(var u;l;){if(l.nodeType===3){if(u=n+l.textContent.length,n<=s&&u>=s)return{node:l,offset:s-n};n=u}e:{for(;l;){if(l.nextSibling){l=l.nextSibling;break e}l=l.parentNode}l=void 0}l=fh(l)}}function mh(n,s){return n&&s?n===s?!0:n&&n.nodeType===3?!1:s&&s.nodeType===3?mh(n,s.parentNode):"contains"in n?n.contains(s):n.compareDocumentPosition?!!(n.compareDocumentPosition(s)&16):!1:!1}function gh(){for(var n=window,s=ee();s instanceof n.HTMLIFrameElement;){try{var l=typeof s.contentWindow.location.href=="string"}catch{l=!1}if(l)n=s.contentWindow;else break;s=ee(n.document)}return s}function vl(n){var s=n&&n.nodeName&&n.nodeName.toLowerCase();return s&&(s==="input"&&(n.type==="text"||n.type==="search"||n.type==="tel"||n.type==="url"||n.type==="password")||s==="textarea"||n.contentEditable==="true")}function eg(n){var s=gh(),l=n.focusedElem,u=n.selectionRange;if(s!==l&&l&&l.ownerDocument&&mh(l.ownerDocument.documentElement,l)){if(u!==null&&vl(l)){if(s=u.start,n=u.end,n===void 0&&(n=s),"selectionStart"in l)l.selectionStart=s,l.selectionEnd=Math.min(n,l.value.length);else if(n=(s=l.ownerDocument||document)&&s.defaultView||window,n.getSelection){n=n.getSelection();var y=l.textContent.length,b=Math.min(u.start,y);u=u.end===void 0?b:Math.min(u.end,y),!n.extend&&b>u&&(y=u,u=b,b=y),y=ph(l,b);var S=ph(l,u);y&&S&&(n.rangeCount!==1||n.anchorNode!==y.node||n.anchorOffset!==y.offset||n.focusNode!==S.node||n.focusOffset!==S.offset)&&(s=s.createRange(),s.setStart(y.node,y.offset),n.removeAllRanges(),b>u?(n.addRange(s),n.extend(S.node,S.offset)):(s.setEnd(S.node,S.offset),n.addRange(s)))}}for(s=[],n=l;n=n.parentNode;)n.nodeType===1&&s.push({element:n,left:n.scrollLeft,top:n.scrollTop});for(typeof l.focus=="function"&&l.focus(),l=0;l<s.length;l++)n=s[l],n.element.scrollLeft=n.left,n.element.scrollTop=n.top}}var tg=c&&"documentMode"in document&&11>=document.documentMode,ks=null,xl=null,vr=null,kl=!1;function yh(n,s,l){var u=l.window===l?l.document:l.nodeType===9?l:l.ownerDocument;kl||ks==null||ks!==ee(u)||(u=ks,"selectionStart"in u&&vl(u)?u={start:u.selectionStart,end:u.selectionEnd}:(u=(u.ownerDocument&&u.ownerDocument.defaultView||window).getSelection(),u={anchorNode:u.anchorNode,anchorOffset:u.anchorOffset,focusNode:u.focusNode,focusOffset:u.focusOffset}),vr&&br(vr,u)||(vr=u,u=La(xl,"onSelect"),0<u.length&&(s=new ul("onSelect","select",null,s,l),n.push({event:s,listeners:u}),s.target=ks)))}function Ma(n,s){var l={};return l[n.toLowerCase()]=s.toLowerCase(),l["Webkit"+n]="webkit"+s,l["Moz"+n]="moz"+s,l}var Ss={animationend:Ma("Animation","AnimationEnd"),animationiteration:Ma("Animation","AnimationIteration"),animationstart:Ma("Animation","AnimationStart"),transitionend:Ma("Transition","TransitionEnd")},Sl={},wh={};c&&(wh=document.createElement("div").style,"AnimationEvent"in window||(delete Ss.animationend.animation,delete Ss.animationiteration.animation,delete Ss.animationstart.animation),"TransitionEvent"in window||delete Ss.transitionend.transition);function Ia(n){if(Sl[n])return Sl[n];if(!Ss[n])return n;var s=Ss[n],l;for(l in s)if(s.hasOwnProperty(l)&&l in wh)return Sl[n]=s[l];return n}var bh=Ia("animationend"),vh=Ia("animationiteration"),xh=Ia("animationstart"),kh=Ia("transitionend"),Sh=new Map,Ah="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Si(n,s){Sh.set(n,s),a(s,[n])}for(var Al=0;Al<Ah.length;Al++){var Cl=Ah[Al],ng=Cl.toLowerCase(),ig=Cl[0].toUpperCase()+Cl.slice(1);Si(ng,"on"+ig)}Si(bh,"onAnimationEnd"),Si(vh,"onAnimationIteration"),Si(xh,"onAnimationStart"),Si("dblclick","onDoubleClick"),Si("focusin","onFocus"),Si("focusout","onBlur"),Si(kh,"onTransitionEnd"),o("onMouseEnter",["mouseout","mouseover"]),o("onMouseLeave",["mouseout","mouseover"]),o("onPointerEnter",["pointerout","pointerover"]),o("onPointerLeave",["pointerout","pointerover"]),a("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),a("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),a("onBeforeInput",["compositionend","keypress","textInput","paste"]),a("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),a("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),a("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var xr="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),sg=new Set("cancel close invalid load scroll toggle".split(" ").concat(xr));function Ch(n,s,l){var u=n.type||"unknown-event";n.currentTarget=l,Ze(u,s,void 0,n),n.currentTarget=null}function Th(n,s){s=(s&4)!==0;for(var l=0;l<n.length;l++){var u=n[l],y=u.event;u=u.listeners;e:{var b=void 0;if(s)for(var S=u.length-1;0<=S;S--){var P=u[S],D=P.instance,U=P.currentTarget;if(P=P.listener,D!==b&&y.isPropagationStopped())break e;Ch(y,P,U),b=D}else for(S=0;S<u.length;S++){if(P=u[S],D=P.instance,U=P.currentTarget,P=P.listener,D!==b&&y.isPropagationStopped())break e;Ch(y,P,U),b=D}}}if(Z)throw n=he,Z=!1,he=null,n}function et(n,s){var l=s[Il];l===void 0&&(l=s[Il]=new Set);var u=n+"__bubble";l.has(u)||(Eh(s,n,2,!1),l.add(u))}function Tl(n,s,l){var u=0;s&&(u|=4),Eh(l,n,u,s)}var Da="_reactListening"+Math.random().toString(36).slice(2);function kr(n){if(!n[Da]){n[Da]=!0,i.forEach(function(l){l!=="selectionchange"&&(sg.has(l)||Tl(l,!1,n),Tl(l,!0,n))});var s=n.nodeType===9?n:n.ownerDocument;s===null||s[Da]||(s[Da]=!0,Tl("selectionchange",!1,s))}}function Eh(n,s,l,u){switch(Xd(s)){case 1:var y=wm;break;case 4:y=bm;break;default:y=cl}l=y.bind(null,s,l,n),y=void 0,!Gi||s!=="touchstart"&&s!=="touchmove"&&s!=="wheel"||(y=!0),u?y!==void 0?n.addEventListener(s,l,{capture:!0,passive:y}):n.addEventListener(s,l,!0):y!==void 0?n.addEventListener(s,l,{passive:y}):n.addEventListener(s,l,!1)}function El(n,s,l,u,y){var b=u;if((s&1)===0&&(s&2)===0&&u!==null)e:for(;;){if(u===null)return;var S=u.tag;if(S===3||S===4){var P=u.stateNode.containerInfo;if(P===y||P.nodeType===8&&P.parentNode===y)break;if(S===4)for(S=u.return;S!==null;){var D=S.tag;if((D===3||D===4)&&(D=S.stateNode.containerInfo,D===y||D.nodeType===8&&D.parentNode===y))return;S=S.return}for(;P!==null;){if(S=Ui(P),S===null)return;if(D=S.tag,D===5||D===6){u=b=S;continue e}P=P.parentNode}}u=u.return}ya(function(){var U=b,ie=rr(l),ae=[];e:{var ne=Sh.get(n);if(ne!==void 0){var ge=ul,ke=n;switch(n){case"keypress":if(Ra(l)===0)break e;case"keydown":case"keyup":ge=Dm;break;case"focusin":ke="focus",ge=ml;break;case"focusout":ke="blur",ge=ml;break;case"beforeblur":case"afterblur":ge=ml;break;case"click":if(l.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":ge=Zd;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":ge=km;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":ge=Fm;break;case bh:case vh:case xh:ge=Cm;break;case kh:ge=qm;break;case"scroll":ge=vm;break;case"wheel":ge=Wm;break;case"copy":case"cut":case"paste":ge=Em;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":ge=th}var Se=(s&4)!==0,yt=!Se&&n==="scroll",W=Se?ne!==null?ne+"Capture":null:ne;Se=[];for(var O=U,H;O!==null;){H=O;var de=H.stateNode;if(H.tag===5&&de!==null&&(H=de,W!==null&&(de=Hi(O,W),de!=null&&Se.push(Sr(O,de,H)))),yt)break;O=O.return}0<Se.length&&(ne=new ge(ne,ke,null,l,ie),ae.push({event:ne,listeners:Se}))}}if((s&7)===0){e:{if(ne=n==="mouseover"||n==="pointerover",ge=n==="mouseout"||n==="pointerout",ne&&l!==ms&&(ke=l.relatedTarget||l.fromElement)&&(Ui(ke)||ke[Jn]))break e;if((ge||ne)&&(ne=ie.window===ie?ie:(ne=ie.ownerDocument)?ne.defaultView||ne.parentWindow:window,ge?(ke=l.relatedTarget||l.toElement,ge=U,ke=ke?Ui(ke):null,ke!==null&&(yt=ln(ke),ke!==yt||ke.tag!==5&&ke.tag!==6)&&(ke=null)):(ge=null,ke=U),ge!==ke)){if(Se=Zd,de="onMouseLeave",W="onMouseEnter",O="mouse",(n==="pointerout"||n==="pointerover")&&(Se=th,de="onPointerLeave",W="onPointerEnter",O="pointer"),yt=ge==null?ne:Ts(ge),H=ke==null?ne:Ts(ke),ne=new Se(de,O+"leave",ge,l,ie),ne.target=yt,ne.relatedTarget=H,de=null,Ui(ie)===U&&(Se=new Se(W,O+"enter",ke,l,ie),Se.target=H,Se.relatedTarget=yt,de=Se),yt=de,ge&&ke)t:{for(Se=ge,W=ke,O=0,H=Se;H;H=As(H))O++;for(H=0,de=W;de;de=As(de))H++;for(;0<O-H;)Se=As(Se),O--;for(;0<H-O;)W=As(W),H--;for(;O--;){if(Se===W||W!==null&&Se===W.alternate)break t;Se=As(Se),W=As(W)}Se=null}else Se=null;ge!==null&&Rh(ae,ne,ge,Se,!1),ke!==null&&yt!==null&&Rh(ae,yt,ke,Se,!0)}}e:{if(ne=U?Ts(U):window,ge=ne.nodeName&&ne.nodeName.toLowerCase(),ge==="select"||ge==="input"&&ne.type==="file")var Ae=Km;else if(oh(ne))if(ch)Ae=Jm;else{Ae=Xm;var Ee=Ym}else(ge=ne.nodeName)&&ge.toLowerCase()==="input"&&(ne.type==="checkbox"||ne.type==="radio")&&(Ae=Qm);if(Ae&&(Ae=Ae(n,U))){lh(ae,Ae,l,ie);break e}Ee&&Ee(n,ne,U),n==="focusout"&&(Ee=ne._wrapperState)&&Ee.controlled&&ne.type==="number"&&Ke(ne,"number",ne.value)}switch(Ee=U?Ts(U):window,n){case"focusin":(oh(Ee)||Ee.contentEditable==="true")&&(ks=Ee,xl=U,vr=null);break;case"focusout":vr=xl=ks=null;break;case"mousedown":kl=!0;break;case"contextmenu":case"mouseup":case"dragend":kl=!1,yh(ae,l,ie);break;case"selectionchange":if(tg)break;case"keydown":case"keyup":yh(ae,l,ie)}var Re;if(yl)e:{switch(n){case"compositionstart":var Pe="onCompositionStart";break e;case"compositionend":Pe="onCompositionEnd";break e;case"compositionupdate":Pe="onCompositionUpdate";break e}Pe=void 0}else xs?rh(n,l)&&(Pe="onCompositionEnd"):n==="keydown"&&l.keyCode===229&&(Pe="onCompositionStart");Pe&&(nh&&l.locale!=="ko"&&(xs||Pe!=="onCompositionStart"?Pe==="onCompositionEnd"&&xs&&(Re=Qd()):(ki=ie,hl="value"in ki?ki.value:ki.textContent,xs=!0)),Ee=La(U,Pe),0<Ee.length&&(Pe=new eh(Pe,n,null,l,ie),ae.push({event:Pe,listeners:Ee}),Re?Pe.data=Re:(Re=ah(l),Re!==null&&(Pe.data=Re)))),(Re=Gm?zm(n,l):Um(n,l))&&(U=La(U,"onBeforeInput"),0<U.length&&(ie=new eh("onBeforeInput","beforeinput",null,l,ie),ae.push({event:ie,listeners:U}),ie.data=Re))}Th(ae,s)})}function Sr(n,s,l){return{instance:n,listener:s,currentTarget:l}}function La(n,s){for(var l=s+"Capture",u=[];n!==null;){var y=n,b=y.stateNode;y.tag===5&&b!==null&&(y=b,b=Hi(n,l),b!=null&&u.unshift(Sr(n,b,y)),b=Hi(n,s),b!=null&&u.push(Sr(n,b,y))),n=n.return}return u}function As(n){if(n===null)return null;do n=n.return;while(n&&n.tag!==5);return n||null}function Rh(n,s,l,u,y){for(var b=s._reactName,S=[];l!==null&&l!==u;){var P=l,D=P.alternate,U=P.stateNode;if(D!==null&&D===u)break;P.tag===5&&U!==null&&(P=U,y?(D=Hi(l,b),D!=null&&S.unshift(Sr(l,D,P))):y||(D=Hi(l,b),D!=null&&S.push(Sr(l,D,P)))),l=l.return}S.length!==0&&n.push({event:s,listeners:S})}var rg=/\r\n?/g,ag=/\u0000|\uFFFD/g;function _h(n){return(typeof n=="string"?n:""+n).replace(rg,`
`).replace(ag,"")}function ja(n,s,l){if(s=_h(s),_h(n)!==s&&l)throw Error(t(425))}function Fa(){}var Rl=null,_l=null;function Nl(n,s){return n==="textarea"||n==="noscript"||typeof s.children=="string"||typeof s.children=="number"||typeof s.dangerouslySetInnerHTML=="object"&&s.dangerouslySetInnerHTML!==null&&s.dangerouslySetInnerHTML.__html!=null}var Pl=typeof setTimeout=="function"?setTimeout:void 0,og=typeof clearTimeout=="function"?clearTimeout:void 0,Nh=typeof Promise=="function"?Promise:void 0,lg=typeof queueMicrotask=="function"?queueMicrotask:typeof Nh<"u"?function(n){return Nh.resolve(null).then(n).catch(cg)}:Pl;function cg(n){setTimeout(function(){throw n})}function Ml(n,s){var l=s,u=0;do{var y=l.nextSibling;if(n.removeChild(l),y&&y.nodeType===8)if(l=y.data,l==="/$"){if(u===0){n.removeChild(y),fr(s);return}u--}else l!=="$"&&l!=="$?"&&l!=="$!"||u++;l=y}while(l);fr(s)}function Ai(n){for(;n!=null;n=n.nextSibling){var s=n.nodeType;if(s===1||s===3)break;if(s===8){if(s=n.data,s==="$"||s==="$!"||s==="$?")break;if(s==="/$")return null}}return n}function Ph(n){n=n.previousSibling;for(var s=0;n;){if(n.nodeType===8){var l=n.data;if(l==="$"||l==="$!"||l==="$?"){if(s===0)return n;s--}else l==="/$"&&s++}n=n.previousSibling}return null}var Cs=Math.random().toString(36).slice(2),On="__reactFiber$"+Cs,Ar="__reactProps$"+Cs,Jn="__reactContainer$"+Cs,Il="__reactEvents$"+Cs,dg="__reactListeners$"+Cs,hg="__reactHandles$"+Cs;function Ui(n){var s=n[On];if(s)return s;for(var l=n.parentNode;l;){if(s=l[Jn]||l[On]){if(l=s.alternate,s.child!==null||l!==null&&l.child!==null)for(n=Ph(n);n!==null;){if(l=n[On])return l;n=Ph(n)}return s}n=l,l=n.parentNode}return null}function Cr(n){return n=n[On]||n[Jn],!n||n.tag!==5&&n.tag!==6&&n.tag!==13&&n.tag!==3?null:n}function Ts(n){if(n.tag===5||n.tag===6)return n.stateNode;throw Error(t(33))}function Oa(n){return n[Ar]||null}var Dl=[],Es=-1;function Ci(n){return{current:n}}function tt(n){0>Es||(n.current=Dl[Es],Dl[Es]=null,Es--)}function Qe(n,s){Es++,Dl[Es]=n.current,n.current=s}var Ti={},Ft=Ci(Ti),Yt=Ci(!1),$i=Ti;function Rs(n,s){var l=n.type.contextTypes;if(!l)return Ti;var u=n.stateNode;if(u&&u.__reactInternalMemoizedUnmaskedChildContext===s)return u.__reactInternalMemoizedMaskedChildContext;var y={},b;for(b in l)y[b]=s[b];return u&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=s,n.__reactInternalMemoizedMaskedChildContext=y),y}function Xt(n){return n=n.childContextTypes,n!=null}function qa(){tt(Yt),tt(Ft)}function Mh(n,s,l){if(Ft.current!==Ti)throw Error(t(168));Qe(Ft,s),Qe(Yt,l)}function Ih(n,s,l){var u=n.stateNode;if(s=s.childContextTypes,typeof u.getChildContext!="function")return l;u=u.getChildContext();for(var y in u)if(!(y in s))throw Error(t(108,ye(n)||"Unknown",y));return re({},l,u)}function Ba(n){return n=(n=n.stateNode)&&n.__reactInternalMemoizedMergedChildContext||Ti,$i=Ft.current,Qe(Ft,n),Qe(Yt,Yt.current),!0}function Dh(n,s,l){var u=n.stateNode;if(!u)throw Error(t(169));l?(n=Ih(n,s,$i),u.__reactInternalMemoizedMergedChildContext=n,tt(Yt),tt(Ft),Qe(Ft,n)):tt(Yt),Qe(Yt,l)}var Zn=null,Wa=!1,Ll=!1;function Lh(n){Zn===null?Zn=[n]:Zn.push(n)}function ug(n){Wa=!0,Lh(n)}function Ei(){if(!Ll&&Zn!==null){Ll=!0;var n=0,s=Ue;try{var l=Zn;for(Ue=1;n<l.length;n++){var u=l[n];do u=u(!0);while(u!==null)}Zn=null,Wa=!1}catch(y){throw Zn!==null&&(Zn=Zn.slice(n+1)),jn(ws,Ei),y}finally{Ue=s,Ll=!1}}return null}var _s=[],Ns=0,Ha=null,Ga=0,yn=[],wn=0,Vi=null,ei=1,ti="";function Ki(n,s){_s[Ns++]=Ga,_s[Ns++]=Ha,Ha=n,Ga=s}function jh(n,s,l){yn[wn++]=ei,yn[wn++]=ti,yn[wn++]=Vi,Vi=n;var u=ei;n=ti;var y=32-En(u)-1;u&=~(1<<y),l+=1;var b=32-En(s)+y;if(30<b){var S=y-y%5;b=(u&(1<<S)-1).toString(32),u>>=S,y-=S,ei=1<<32-En(s)+y|l<<y|u,ti=b+n}else ei=1<<b|l<<y|u,ti=n}function jl(n){n.return!==null&&(Ki(n,1),jh(n,1,0))}function Fl(n){for(;n===Ha;)Ha=_s[--Ns],_s[Ns]=null,Ga=_s[--Ns],_s[Ns]=null;for(;n===Vi;)Vi=yn[--wn],yn[wn]=null,ti=yn[--wn],yn[wn]=null,ei=yn[--wn],yn[wn]=null}var dn=null,hn=null,nt=!1,_n=null;function Fh(n,s){var l=kn(5,null,null,0);l.elementType="DELETED",l.stateNode=s,l.return=n,s=n.deletions,s===null?(n.deletions=[l],n.flags|=16):s.push(l)}function Oh(n,s){switch(n.tag){case 5:var l=n.type;return s=s.nodeType!==1||l.toLowerCase()!==s.nodeName.toLowerCase()?null:s,s!==null?(n.stateNode=s,dn=n,hn=Ai(s.firstChild),!0):!1;case 6:return s=n.pendingProps===""||s.nodeType!==3?null:s,s!==null?(n.stateNode=s,dn=n,hn=null,!0):!1;case 13:return s=s.nodeType!==8?null:s,s!==null?(l=Vi!==null?{id:ei,overflow:ti}:null,n.memoizedState={dehydrated:s,treeContext:l,retryLane:1073741824},l=kn(18,null,null,0),l.stateNode=s,l.return=n,n.child=l,dn=n,hn=null,!0):!1;default:return!1}}function Ol(n){return(n.mode&1)!==0&&(n.flags&128)===0}function ql(n){if(nt){var s=hn;if(s){var l=s;if(!Oh(n,s)){if(Ol(n))throw Error(t(418));s=Ai(l.nextSibling);var u=dn;s&&Oh(n,s)?Fh(u,l):(n.flags=n.flags&-4097|2,nt=!1,dn=n)}}else{if(Ol(n))throw Error(t(418));n.flags=n.flags&-4097|2,nt=!1,dn=n}}}function qh(n){for(n=n.return;n!==null&&n.tag!==5&&n.tag!==3&&n.tag!==13;)n=n.return;dn=n}function za(n){if(n!==dn)return!1;if(!nt)return qh(n),nt=!0,!1;var s;if((s=n.tag!==3)&&!(s=n.tag!==5)&&(s=n.type,s=s!=="head"&&s!=="body"&&!Nl(n.type,n.memoizedProps)),s&&(s=hn)){if(Ol(n))throw Bh(),Error(t(418));for(;s;)Fh(n,s),s=Ai(s.nextSibling)}if(qh(n),n.tag===13){if(n=n.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error(t(317));e:{for(n=n.nextSibling,s=0;n;){if(n.nodeType===8){var l=n.data;if(l==="/$"){if(s===0){hn=Ai(n.nextSibling);break e}s--}else l!=="$"&&l!=="$!"&&l!=="$?"||s++}n=n.nextSibling}hn=null}}else hn=dn?Ai(n.stateNode.nextSibling):null;return!0}function Bh(){for(var n=hn;n;)n=Ai(n.nextSibling)}function Ps(){hn=dn=null,nt=!1}function Bl(n){_n===null?_n=[n]:_n.push(n)}var fg=E.ReactCurrentBatchConfig;function Tr(n,s,l){if(n=l.ref,n!==null&&typeof n!="function"&&typeof n!="object"){if(l._owner){if(l=l._owner,l){if(l.tag!==1)throw Error(t(309));var u=l.stateNode}if(!u)throw Error(t(147,n));var y=u,b=""+n;return s!==null&&s.ref!==null&&typeof s.ref=="function"&&s.ref._stringRef===b?s.ref:(s=function(S){var P=y.refs;S===null?delete P[b]:P[b]=S},s._stringRef=b,s)}if(typeof n!="string")throw Error(t(284));if(!l._owner)throw Error(t(290,n))}return n}function Ua(n,s){throw n=Object.prototype.toString.call(s),Error(t(31,n==="[object Object]"?"object with keys {"+Object.keys(s).join(", ")+"}":n))}function Wh(n){var s=n._init;return s(n._payload)}function Hh(n){function s(W,O){if(n){var H=W.deletions;H===null?(W.deletions=[O],W.flags|=16):H.push(O)}}function l(W,O){if(!n)return null;for(;O!==null;)s(W,O),O=O.sibling;return null}function u(W,O){for(W=new Map;O!==null;)O.key!==null?W.set(O.key,O):W.set(O.index,O),O=O.sibling;return W}function y(W,O){return W=Li(W,O),W.index=0,W.sibling=null,W}function b(W,O,H){return W.index=H,n?(H=W.alternate,H!==null?(H=H.index,H<O?(W.flags|=2,O):H):(W.flags|=2,O)):(W.flags|=1048576,O)}function S(W){return n&&W.alternate===null&&(W.flags|=2),W}function P(W,O,H,de){return O===null||O.tag!==6?(O=Pc(H,W.mode,de),O.return=W,O):(O=y(O,H),O.return=W,O)}function D(W,O,H,de){var Ae=H.type;return Ae===N?ie(W,O,H.props.children,de,H.key):O!==null&&(O.elementType===Ae||typeof Ae=="object"&&Ae!==null&&Ae.$$typeof===K&&Wh(Ae)===O.type)?(de=y(O,H.props),de.ref=Tr(W,O,H),de.return=W,de):(de=go(H.type,H.key,H.props,null,W.mode,de),de.ref=Tr(W,O,H),de.return=W,de)}function U(W,O,H,de){return O===null||O.tag!==4||O.stateNode.containerInfo!==H.containerInfo||O.stateNode.implementation!==H.implementation?(O=Mc(H,W.mode,de),O.return=W,O):(O=y(O,H.children||[]),O.return=W,O)}function ie(W,O,H,de,Ae){return O===null||O.tag!==7?(O=ns(H,W.mode,de,Ae),O.return=W,O):(O=y(O,H),O.return=W,O)}function ae(W,O,H){if(typeof O=="string"&&O!==""||typeof O=="number")return O=Pc(""+O,W.mode,H),O.return=W,O;if(typeof O=="object"&&O!==null){switch(O.$$typeof){case _:return H=go(O.type,O.key,O.props,null,W.mode,H),H.ref=Tr(W,null,O),H.return=W,H;case M:return O=Mc(O,W.mode,H),O.return=W,O;case K:var de=O._init;return ae(W,de(O._payload),H)}if(vt(O)||ce(O))return O=ns(O,W.mode,H,null),O.return=W,O;Ua(W,O)}return null}function ne(W,O,H,de){var Ae=O!==null?O.key:null;if(typeof H=="string"&&H!==""||typeof H=="number")return Ae!==null?null:P(W,O,""+H,de);if(typeof H=="object"&&H!==null){switch(H.$$typeof){case _:return H.key===Ae?D(W,O,H,de):null;case M:return H.key===Ae?U(W,O,H,de):null;case K:return Ae=H._init,ne(W,O,Ae(H._payload),de)}if(vt(H)||ce(H))return Ae!==null?null:ie(W,O,H,de,null);Ua(W,H)}return null}function ge(W,O,H,de,Ae){if(typeof de=="string"&&de!==""||typeof de=="number")return W=W.get(H)||null,P(O,W,""+de,Ae);if(typeof de=="object"&&de!==null){switch(de.$$typeof){case _:return W=W.get(de.key===null?H:de.key)||null,D(O,W,de,Ae);case M:return W=W.get(de.key===null?H:de.key)||null,U(O,W,de,Ae);case K:var Ee=de._init;return ge(W,O,H,Ee(de._payload),Ae)}if(vt(de)||ce(de))return W=W.get(H)||null,ie(O,W,de,Ae,null);Ua(O,de)}return null}function ke(W,O,H,de){for(var Ae=null,Ee=null,Re=O,Pe=O=0,Rt=null;Re!==null&&Pe<H.length;Pe++){Re.index>Pe?(Rt=Re,Re=null):Rt=Re.sibling;var He=ne(W,Re,H[Pe],de);if(He===null){Re===null&&(Re=Rt);break}n&&Re&&He.alternate===null&&s(W,Re),O=b(He,O,Pe),Ee===null?Ae=He:Ee.sibling=He,Ee=He,Re=Rt}if(Pe===H.length)return l(W,Re),nt&&Ki(W,Pe),Ae;if(Re===null){for(;Pe<H.length;Pe++)Re=ae(W,H[Pe],de),Re!==null&&(O=b(Re,O,Pe),Ee===null?Ae=Re:Ee.sibling=Re,Ee=Re);return nt&&Ki(W,Pe),Ae}for(Re=u(W,Re);Pe<H.length;Pe++)Rt=ge(Re,W,Pe,H[Pe],de),Rt!==null&&(n&&Rt.alternate!==null&&Re.delete(Rt.key===null?Pe:Rt.key),O=b(Rt,O,Pe),Ee===null?Ae=Rt:Ee.sibling=Rt,Ee=Rt);return n&&Re.forEach(function(ji){return s(W,ji)}),nt&&Ki(W,Pe),Ae}function Se(W,O,H,de){var Ae=ce(H);if(typeof Ae!="function")throw Error(t(150));if(H=Ae.call(H),H==null)throw Error(t(151));for(var Ee=Ae=null,Re=O,Pe=O=0,Rt=null,He=H.next();Re!==null&&!He.done;Pe++,He=H.next()){Re.index>Pe?(Rt=Re,Re=null):Rt=Re.sibling;var ji=ne(W,Re,He.value,de);if(ji===null){Re===null&&(Re=Rt);break}n&&Re&&ji.alternate===null&&s(W,Re),O=b(ji,O,Pe),Ee===null?Ae=ji:Ee.sibling=ji,Ee=ji,Re=Rt}if(He.done)return l(W,Re),nt&&Ki(W,Pe),Ae;if(Re===null){for(;!He.done;Pe++,He=H.next())He=ae(W,He.value,de),He!==null&&(O=b(He,O,Pe),Ee===null?Ae=He:Ee.sibling=He,Ee=He);return nt&&Ki(W,Pe),Ae}for(Re=u(W,Re);!He.done;Pe++,He=H.next())He=ge(Re,W,Pe,He.value,de),He!==null&&(n&&He.alternate!==null&&Re.delete(He.key===null?Pe:He.key),O=b(He,O,Pe),Ee===null?Ae=He:Ee.sibling=He,Ee=He);return n&&Re.forEach(function($g){return s(W,$g)}),nt&&Ki(W,Pe),Ae}function yt(W,O,H,de){if(typeof H=="object"&&H!==null&&H.type===N&&H.key===null&&(H=H.props.children),typeof H=="object"&&H!==null){switch(H.$$typeof){case _:e:{for(var Ae=H.key,Ee=O;Ee!==null;){if(Ee.key===Ae){if(Ae=H.type,Ae===N){if(Ee.tag===7){l(W,Ee.sibling),O=y(Ee,H.props.children),O.return=W,W=O;break e}}else if(Ee.elementType===Ae||typeof Ae=="object"&&Ae!==null&&Ae.$$typeof===K&&Wh(Ae)===Ee.type){l(W,Ee.sibling),O=y(Ee,H.props),O.ref=Tr(W,Ee,H),O.return=W,W=O;break e}l(W,Ee);break}else s(W,Ee);Ee=Ee.sibling}H.type===N?(O=ns(H.props.children,W.mode,de,H.key),O.return=W,W=O):(de=go(H.type,H.key,H.props,null,W.mode,de),de.ref=Tr(W,O,H),de.return=W,W=de)}return S(W);case M:e:{for(Ee=H.key;O!==null;){if(O.key===Ee)if(O.tag===4&&O.stateNode.containerInfo===H.containerInfo&&O.stateNode.implementation===H.implementation){l(W,O.sibling),O=y(O,H.children||[]),O.return=W,W=O;break e}else{l(W,O);break}else s(W,O);O=O.sibling}O=Mc(H,W.mode,de),O.return=W,W=O}return S(W);case K:return Ee=H._init,yt(W,O,Ee(H._payload),de)}if(vt(H))return ke(W,O,H,de);if(ce(H))return Se(W,O,H,de);Ua(W,H)}return typeof H=="string"&&H!==""||typeof H=="number"?(H=""+H,O!==null&&O.tag===6?(l(W,O.sibling),O=y(O,H),O.return=W,W=O):(l(W,O),O=Pc(H,W.mode,de),O.return=W,W=O),S(W)):l(W,O)}return yt}var Ms=Hh(!0),Gh=Hh(!1),$a=Ci(null),Va=null,Is=null,Wl=null;function Hl(){Wl=Is=Va=null}function Gl(n){var s=$a.current;tt($a),n._currentValue=s}function zl(n,s,l){for(;n!==null;){var u=n.alternate;if((n.childLanes&s)!==s?(n.childLanes|=s,u!==null&&(u.childLanes|=s)):u!==null&&(u.childLanes&s)!==s&&(u.childLanes|=s),n===l)break;n=n.return}}function Ds(n,s){Va=n,Wl=Is=null,n=n.dependencies,n!==null&&n.firstContext!==null&&((n.lanes&s)!==0&&(Qt=!0),n.firstContext=null)}function bn(n){var s=n._currentValue;if(Wl!==n)if(n={context:n,memoizedValue:s,next:null},Is===null){if(Va===null)throw Error(t(308));Is=n,Va.dependencies={lanes:0,firstContext:n}}else Is=Is.next=n;return s}var Yi=null;function Ul(n){Yi===null?Yi=[n]:Yi.push(n)}function zh(n,s,l,u){var y=s.interleaved;return y===null?(l.next=l,Ul(s)):(l.next=y.next,y.next=l),s.interleaved=l,ni(n,u)}function ni(n,s){n.lanes|=s;var l=n.alternate;for(l!==null&&(l.lanes|=s),l=n,n=n.return;n!==null;)n.childLanes|=s,l=n.alternate,l!==null&&(l.childLanes|=s),l=n,n=n.return;return l.tag===3?l.stateNode:null}var Ri=!1;function $l(n){n.updateQueue={baseState:n.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Uh(n,s){n=n.updateQueue,s.updateQueue===n&&(s.updateQueue={baseState:n.baseState,firstBaseUpdate:n.firstBaseUpdate,lastBaseUpdate:n.lastBaseUpdate,shared:n.shared,effects:n.effects})}function ii(n,s){return{eventTime:n,lane:s,tag:0,payload:null,callback:null,next:null}}function _i(n,s,l){var u=n.updateQueue;if(u===null)return null;if(u=u.shared,(We&2)!==0){var y=u.pending;return y===null?s.next=s:(s.next=y.next,y.next=s),u.pending=s,ni(n,l)}return y=u.interleaved,y===null?(s.next=s,Ul(u)):(s.next=y.next,y.next=s),u.interleaved=s,ni(n,l)}function Ka(n,s,l){if(s=s.updateQueue,s!==null&&(s=s.shared,(l&4194240)!==0)){var u=s.lanes;u&=n.pendingLanes,l|=u,s.lanes=l,al(n,l)}}function $h(n,s){var l=n.updateQueue,u=n.alternate;if(u!==null&&(u=u.updateQueue,l===u)){var y=null,b=null;if(l=l.firstBaseUpdate,l!==null){do{var S={eventTime:l.eventTime,lane:l.lane,tag:l.tag,payload:l.payload,callback:l.callback,next:null};b===null?y=b=S:b=b.next=S,l=l.next}while(l!==null);b===null?y=b=s:b=b.next=s}else y=b=s;l={baseState:u.baseState,firstBaseUpdate:y,lastBaseUpdate:b,shared:u.shared,effects:u.effects},n.updateQueue=l;return}n=l.lastBaseUpdate,n===null?l.firstBaseUpdate=s:n.next=s,l.lastBaseUpdate=s}function Ya(n,s,l,u){var y=n.updateQueue;Ri=!1;var b=y.firstBaseUpdate,S=y.lastBaseUpdate,P=y.shared.pending;if(P!==null){y.shared.pending=null;var D=P,U=D.next;D.next=null,S===null?b=U:S.next=U,S=D;var ie=n.alternate;ie!==null&&(ie=ie.updateQueue,P=ie.lastBaseUpdate,P!==S&&(P===null?ie.firstBaseUpdate=U:P.next=U,ie.lastBaseUpdate=D))}if(b!==null){var ae=y.baseState;S=0,ie=U=D=null,P=b;do{var ne=P.lane,ge=P.eventTime;if((u&ne)===ne){ie!==null&&(ie=ie.next={eventTime:ge,lane:0,tag:P.tag,payload:P.payload,callback:P.callback,next:null});e:{var ke=n,Se=P;switch(ne=s,ge=l,Se.tag){case 1:if(ke=Se.payload,typeof ke=="function"){ae=ke.call(ge,ae,ne);break e}ae=ke;break e;case 3:ke.flags=ke.flags&-65537|128;case 0:if(ke=Se.payload,ne=typeof ke=="function"?ke.call(ge,ae,ne):ke,ne==null)break e;ae=re({},ae,ne);break e;case 2:Ri=!0}}P.callback!==null&&P.lane!==0&&(n.flags|=64,ne=y.effects,ne===null?y.effects=[P]:ne.push(P))}else ge={eventTime:ge,lane:ne,tag:P.tag,payload:P.payload,callback:P.callback,next:null},ie===null?(U=ie=ge,D=ae):ie=ie.next=ge,S|=ne;if(P=P.next,P===null){if(P=y.shared.pending,P===null)break;ne=P,P=ne.next,ne.next=null,y.lastBaseUpdate=ne,y.shared.pending=null}}while(!0);if(ie===null&&(D=ae),y.baseState=D,y.firstBaseUpdate=U,y.lastBaseUpdate=ie,s=y.shared.interleaved,s!==null){y=s;do S|=y.lane,y=y.next;while(y!==s)}else b===null&&(y.shared.lanes=0);Ji|=S,n.lanes=S,n.memoizedState=ae}}function Vh(n,s,l){if(n=s.effects,s.effects=null,n!==null)for(s=0;s<n.length;s++){var u=n[s],y=u.callback;if(y!==null){if(u.callback=null,u=l,typeof y!="function")throw Error(t(191,y));y.call(u)}}}var Er={},qn=Ci(Er),Rr=Ci(Er),_r=Ci(Er);function Xi(n){if(n===Er)throw Error(t(174));return n}function Vl(n,s){switch(Qe(_r,s),Qe(Rr,n),Qe(qn,Er),n=s.nodeType,n){case 9:case 11:s=(s=s.documentElement)?s.namespaceURI:Vt(null,"");break;default:n=n===8?s.parentNode:s,s=n.namespaceURI||null,n=n.tagName,s=Vt(s,n)}tt(qn),Qe(qn,s)}function Ls(){tt(qn),tt(Rr),tt(_r)}function Kh(n){Xi(_r.current);var s=Xi(qn.current),l=Vt(s,n.type);s!==l&&(Qe(Rr,n),Qe(qn,l))}function Kl(n){Rr.current===n&&(tt(qn),tt(Rr))}var ot=Ci(0);function Xa(n){for(var s=n;s!==null;){if(s.tag===13){var l=s.memoizedState;if(l!==null&&(l=l.dehydrated,l===null||l.data==="$?"||l.data==="$!"))return s}else if(s.tag===19&&s.memoizedProps.revealOrder!==void 0){if((s.flags&128)!==0)return s}else if(s.child!==null){s.child.return=s,s=s.child;continue}if(s===n)break;for(;s.sibling===null;){if(s.return===null||s.return===n)return null;s=s.return}s.sibling.return=s.return,s=s.sibling}return null}var Yl=[];function Xl(){for(var n=0;n<Yl.length;n++)Yl[n]._workInProgressVersionPrimary=null;Yl.length=0}var Qa=E.ReactCurrentDispatcher,Ql=E.ReactCurrentBatchConfig,Qi=0,lt=null,St=null,Tt=null,Ja=!1,Nr=!1,Pr=0,pg=0;function Ot(){throw Error(t(321))}function Jl(n,s){if(s===null)return!1;for(var l=0;l<s.length&&l<n.length;l++)if(!Rn(n[l],s[l]))return!1;return!0}function Zl(n,s,l,u,y,b){if(Qi=b,lt=s,s.memoizedState=null,s.updateQueue=null,s.lanes=0,Qa.current=n===null||n.memoizedState===null?wg:bg,n=l(u,y),Nr){b=0;do{if(Nr=!1,Pr=0,25<=b)throw Error(t(301));b+=1,Tt=St=null,s.updateQueue=null,Qa.current=vg,n=l(u,y)}while(Nr)}if(Qa.current=to,s=St!==null&&St.next!==null,Qi=0,Tt=St=lt=null,Ja=!1,s)throw Error(t(300));return n}function ec(){var n=Pr!==0;return Pr=0,n}function Bn(){var n={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Tt===null?lt.memoizedState=Tt=n:Tt=Tt.next=n,Tt}function vn(){if(St===null){var n=lt.alternate;n=n!==null?n.memoizedState:null}else n=St.next;var s=Tt===null?lt.memoizedState:Tt.next;if(s!==null)Tt=s,St=n;else{if(n===null)throw Error(t(310));St=n,n={memoizedState:St.memoizedState,baseState:St.baseState,baseQueue:St.baseQueue,queue:St.queue,next:null},Tt===null?lt.memoizedState=Tt=n:Tt=Tt.next=n}return Tt}function Mr(n,s){return typeof s=="function"?s(n):s}function tc(n){var s=vn(),l=s.queue;if(l===null)throw Error(t(311));l.lastRenderedReducer=n;var u=St,y=u.baseQueue,b=l.pending;if(b!==null){if(y!==null){var S=y.next;y.next=b.next,b.next=S}u.baseQueue=y=b,l.pending=null}if(y!==null){b=y.next,u=u.baseState;var P=S=null,D=null,U=b;do{var ie=U.lane;if((Qi&ie)===ie)D!==null&&(D=D.next={lane:0,action:U.action,hasEagerState:U.hasEagerState,eagerState:U.eagerState,next:null}),u=U.hasEagerState?U.eagerState:n(u,U.action);else{var ae={lane:ie,action:U.action,hasEagerState:U.hasEagerState,eagerState:U.eagerState,next:null};D===null?(P=D=ae,S=u):D=D.next=ae,lt.lanes|=ie,Ji|=ie}U=U.next}while(U!==null&&U!==b);D===null?S=u:D.next=P,Rn(u,s.memoizedState)||(Qt=!0),s.memoizedState=u,s.baseState=S,s.baseQueue=D,l.lastRenderedState=u}if(n=l.interleaved,n!==null){y=n;do b=y.lane,lt.lanes|=b,Ji|=b,y=y.next;while(y!==n)}else y===null&&(l.lanes=0);return[s.memoizedState,l.dispatch]}function nc(n){var s=vn(),l=s.queue;if(l===null)throw Error(t(311));l.lastRenderedReducer=n;var u=l.dispatch,y=l.pending,b=s.memoizedState;if(y!==null){l.pending=null;var S=y=y.next;do b=n(b,S.action),S=S.next;while(S!==y);Rn(b,s.memoizedState)||(Qt=!0),s.memoizedState=b,s.baseQueue===null&&(s.baseState=b),l.lastRenderedState=b}return[b,u]}function Yh(){}function Xh(n,s){var l=lt,u=vn(),y=s(),b=!Rn(u.memoizedState,y);if(b&&(u.memoizedState=y,Qt=!0),u=u.queue,ic(Zh.bind(null,l,u,n),[n]),u.getSnapshot!==s||b||Tt!==null&&Tt.memoizedState.tag&1){if(l.flags|=2048,Ir(9,Jh.bind(null,l,u,y,s),void 0,null),Et===null)throw Error(t(349));(Qi&30)!==0||Qh(l,s,y)}return y}function Qh(n,s,l){n.flags|=16384,n={getSnapshot:s,value:l},s=lt.updateQueue,s===null?(s={lastEffect:null,stores:null},lt.updateQueue=s,s.stores=[n]):(l=s.stores,l===null?s.stores=[n]:l.push(n))}function Jh(n,s,l,u){s.value=l,s.getSnapshot=u,eu(s)&&tu(n)}function Zh(n,s,l){return l(function(){eu(s)&&tu(n)})}function eu(n){var s=n.getSnapshot;n=n.value;try{var l=s();return!Rn(n,l)}catch{return!0}}function tu(n){var s=ni(n,1);s!==null&&In(s,n,1,-1)}function nu(n){var s=Bn();return typeof n=="function"&&(n=n()),s.memoizedState=s.baseState=n,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Mr,lastRenderedState:n},s.queue=n,n=n.dispatch=yg.bind(null,lt,n),[s.memoizedState,n]}function Ir(n,s,l,u){return n={tag:n,create:s,destroy:l,deps:u,next:null},s=lt.updateQueue,s===null?(s={lastEffect:null,stores:null},lt.updateQueue=s,s.lastEffect=n.next=n):(l=s.lastEffect,l===null?s.lastEffect=n.next=n:(u=l.next,l.next=n,n.next=u,s.lastEffect=n)),n}function iu(){return vn().memoizedState}function Za(n,s,l,u){var y=Bn();lt.flags|=n,y.memoizedState=Ir(1|s,l,void 0,u===void 0?null:u)}function eo(n,s,l,u){var y=vn();u=u===void 0?null:u;var b=void 0;if(St!==null){var S=St.memoizedState;if(b=S.destroy,u!==null&&Jl(u,S.deps)){y.memoizedState=Ir(s,l,b,u);return}}lt.flags|=n,y.memoizedState=Ir(1|s,l,b,u)}function su(n,s){return Za(8390656,8,n,s)}function ic(n,s){return eo(2048,8,n,s)}function ru(n,s){return eo(4,2,n,s)}function au(n,s){return eo(4,4,n,s)}function ou(n,s){if(typeof s=="function")return n=n(),s(n),function(){s(null)};if(s!=null)return n=n(),s.current=n,function(){s.current=null}}function lu(n,s,l){return l=l!=null?l.concat([n]):null,eo(4,4,ou.bind(null,s,n),l)}function sc(){}function cu(n,s){var l=vn();s=s===void 0?null:s;var u=l.memoizedState;return u!==null&&s!==null&&Jl(s,u[1])?u[0]:(l.memoizedState=[n,s],n)}function du(n,s){var l=vn();s=s===void 0?null:s;var u=l.memoizedState;return u!==null&&s!==null&&Jl(s,u[1])?u[0]:(n=n(),l.memoizedState=[n,s],n)}function hu(n,s,l){return(Qi&21)===0?(n.baseState&&(n.baseState=!1,Qt=!0),n.memoizedState=l):(Rn(l,s)||(l=Wd(),lt.lanes|=l,Ji|=l,n.baseState=!0),s)}function mg(n,s){var l=Ue;Ue=l!==0&&4>l?l:4,n(!0);var u=Ql.transition;Ql.transition={};try{n(!1),s()}finally{Ue=l,Ql.transition=u}}function uu(){return vn().memoizedState}function gg(n,s,l){var u=Ii(n);if(l={lane:u,action:l,hasEagerState:!1,eagerState:null,next:null},fu(n))pu(s,l);else if(l=zh(n,s,l,u),l!==null){var y=Gt();In(l,n,u,y),mu(l,s,u)}}function yg(n,s,l){var u=Ii(n),y={lane:u,action:l,hasEagerState:!1,eagerState:null,next:null};if(fu(n))pu(s,y);else{var b=n.alternate;if(n.lanes===0&&(b===null||b.lanes===0)&&(b=s.lastRenderedReducer,b!==null))try{var S=s.lastRenderedState,P=b(S,l);if(y.hasEagerState=!0,y.eagerState=P,Rn(P,S)){var D=s.interleaved;D===null?(y.next=y,Ul(s)):(y.next=D.next,D.next=y),s.interleaved=y;return}}catch{}finally{}l=zh(n,s,y,u),l!==null&&(y=Gt(),In(l,n,u,y),mu(l,s,u))}}function fu(n){var s=n.alternate;return n===lt||s!==null&&s===lt}function pu(n,s){Nr=Ja=!0;var l=n.pending;l===null?s.next=s:(s.next=l.next,l.next=s),n.pending=s}function mu(n,s,l){if((l&4194240)!==0){var u=s.lanes;u&=n.pendingLanes,l|=u,s.lanes=l,al(n,l)}}var to={readContext:bn,useCallback:Ot,useContext:Ot,useEffect:Ot,useImperativeHandle:Ot,useInsertionEffect:Ot,useLayoutEffect:Ot,useMemo:Ot,useReducer:Ot,useRef:Ot,useState:Ot,useDebugValue:Ot,useDeferredValue:Ot,useTransition:Ot,useMutableSource:Ot,useSyncExternalStore:Ot,useId:Ot,unstable_isNewReconciler:!1},wg={readContext:bn,useCallback:function(n,s){return Bn().memoizedState=[n,s===void 0?null:s],n},useContext:bn,useEffect:su,useImperativeHandle:function(n,s,l){return l=l!=null?l.concat([n]):null,Za(4194308,4,ou.bind(null,s,n),l)},useLayoutEffect:function(n,s){return Za(4194308,4,n,s)},useInsertionEffect:function(n,s){return Za(4,2,n,s)},useMemo:function(n,s){var l=Bn();return s=s===void 0?null:s,n=n(),l.memoizedState=[n,s],n},useReducer:function(n,s,l){var u=Bn();return s=l!==void 0?l(s):s,u.memoizedState=u.baseState=s,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:n,lastRenderedState:s},u.queue=n,n=n.dispatch=gg.bind(null,lt,n),[u.memoizedState,n]},useRef:function(n){var s=Bn();return n={current:n},s.memoizedState=n},useState:nu,useDebugValue:sc,useDeferredValue:function(n){return Bn().memoizedState=n},useTransition:function(){var n=nu(!1),s=n[0];return n=mg.bind(null,n[1]),Bn().memoizedState=n,[s,n]},useMutableSource:function(){},useSyncExternalStore:function(n,s,l){var u=lt,y=Bn();if(nt){if(l===void 0)throw Error(t(407));l=l()}else{if(l=s(),Et===null)throw Error(t(349));(Qi&30)!==0||Qh(u,s,l)}y.memoizedState=l;var b={value:l,getSnapshot:s};return y.queue=b,su(Zh.bind(null,u,b,n),[n]),u.flags|=2048,Ir(9,Jh.bind(null,u,b,l,s),void 0,null),l},useId:function(){var n=Bn(),s=Et.identifierPrefix;if(nt){var l=ti,u=ei;l=(u&~(1<<32-En(u)-1)).toString(32)+l,s=":"+s+"R"+l,l=Pr++,0<l&&(s+="H"+l.toString(32)),s+=":"}else l=pg++,s=":"+s+"r"+l.toString(32)+":";return n.memoizedState=s},unstable_isNewReconciler:!1},bg={readContext:bn,useCallback:cu,useContext:bn,useEffect:ic,useImperativeHandle:lu,useInsertionEffect:ru,useLayoutEffect:au,useMemo:du,useReducer:tc,useRef:iu,useState:function(){return tc(Mr)},useDebugValue:sc,useDeferredValue:function(n){var s=vn();return hu(s,St.memoizedState,n)},useTransition:function(){var n=tc(Mr)[0],s=vn().memoizedState;return[n,s]},useMutableSource:Yh,useSyncExternalStore:Xh,useId:uu,unstable_isNewReconciler:!1},vg={readContext:bn,useCallback:cu,useContext:bn,useEffect:ic,useImperativeHandle:lu,useInsertionEffect:ru,useLayoutEffect:au,useMemo:du,useReducer:nc,useRef:iu,useState:function(){return nc(Mr)},useDebugValue:sc,useDeferredValue:function(n){var s=vn();return St===null?s.memoizedState=n:hu(s,St.memoizedState,n)},useTransition:function(){var n=nc(Mr)[0],s=vn().memoizedState;return[n,s]},useMutableSource:Yh,useSyncExternalStore:Xh,useId:uu,unstable_isNewReconciler:!1};function Nn(n,s){if(n&&n.defaultProps){s=re({},s),n=n.defaultProps;for(var l in n)s[l]===void 0&&(s[l]=n[l]);return s}return s}function rc(n,s,l,u){s=n.memoizedState,l=l(u,s),l=l==null?s:re({},s,l),n.memoizedState=l,n.lanes===0&&(n.updateQueue.baseState=l)}var no={isMounted:function(n){return(n=n._reactInternals)?ln(n)===n:!1},enqueueSetState:function(n,s,l){n=n._reactInternals;var u=Gt(),y=Ii(n),b=ii(u,y);b.payload=s,l!=null&&(b.callback=l),s=_i(n,b,y),s!==null&&(In(s,n,y,u),Ka(s,n,y))},enqueueReplaceState:function(n,s,l){n=n._reactInternals;var u=Gt(),y=Ii(n),b=ii(u,y);b.tag=1,b.payload=s,l!=null&&(b.callback=l),s=_i(n,b,y),s!==null&&(In(s,n,y,u),Ka(s,n,y))},enqueueForceUpdate:function(n,s){n=n._reactInternals;var l=Gt(),u=Ii(n),y=ii(l,u);y.tag=2,s!=null&&(y.callback=s),s=_i(n,y,u),s!==null&&(In(s,n,u,l),Ka(s,n,u))}};function gu(n,s,l,u,y,b,S){return n=n.stateNode,typeof n.shouldComponentUpdate=="function"?n.shouldComponentUpdate(u,b,S):s.prototype&&s.prototype.isPureReactComponent?!br(l,u)||!br(y,b):!0}function yu(n,s,l){var u=!1,y=Ti,b=s.contextType;return typeof b=="object"&&b!==null?b=bn(b):(y=Xt(s)?$i:Ft.current,u=s.contextTypes,b=(u=u!=null)?Rs(n,y):Ti),s=new s(l,b),n.memoizedState=s.state!==null&&s.state!==void 0?s.state:null,s.updater=no,n.stateNode=s,s._reactInternals=n,u&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=y,n.__reactInternalMemoizedMaskedChildContext=b),s}function wu(n,s,l,u){n=s.state,typeof s.componentWillReceiveProps=="function"&&s.componentWillReceiveProps(l,u),typeof s.UNSAFE_componentWillReceiveProps=="function"&&s.UNSAFE_componentWillReceiveProps(l,u),s.state!==n&&no.enqueueReplaceState(s,s.state,null)}function ac(n,s,l,u){var y=n.stateNode;y.props=l,y.state=n.memoizedState,y.refs={},$l(n);var b=s.contextType;typeof b=="object"&&b!==null?y.context=bn(b):(b=Xt(s)?$i:Ft.current,y.context=Rs(n,b)),y.state=n.memoizedState,b=s.getDerivedStateFromProps,typeof b=="function"&&(rc(n,s,b,l),y.state=n.memoizedState),typeof s.getDerivedStateFromProps=="function"||typeof y.getSnapshotBeforeUpdate=="function"||typeof y.UNSAFE_componentWillMount!="function"&&typeof y.componentWillMount!="function"||(s=y.state,typeof y.componentWillMount=="function"&&y.componentWillMount(),typeof y.UNSAFE_componentWillMount=="function"&&y.UNSAFE_componentWillMount(),s!==y.state&&no.enqueueReplaceState(y,y.state,null),Ya(n,l,y,u),y.state=n.memoizedState),typeof y.componentDidMount=="function"&&(n.flags|=4194308)}function js(n,s){try{var l="",u=s;do l+=te(u),u=u.return;while(u);var y=l}catch(b){y=`
Error generating stack: `+b.message+`
`+b.stack}return{value:n,source:s,stack:y,digest:null}}function oc(n,s,l){return{value:n,source:null,stack:l??null,digest:s??null}}function lc(n,s){try{console.error(s.value)}catch(l){setTimeout(function(){throw l})}}var xg=typeof WeakMap=="function"?WeakMap:Map;function bu(n,s,l){l=ii(-1,l),l.tag=3,l.payload={element:null};var u=s.value;return l.callback=function(){co||(co=!0,Sc=u),lc(n,s)},l}function vu(n,s,l){l=ii(-1,l),l.tag=3;var u=n.type.getDerivedStateFromError;if(typeof u=="function"){var y=s.value;l.payload=function(){return u(y)},l.callback=function(){lc(n,s)}}var b=n.stateNode;return b!==null&&typeof b.componentDidCatch=="function"&&(l.callback=function(){lc(n,s),typeof u!="function"&&(Pi===null?Pi=new Set([this]):Pi.add(this));var S=s.stack;this.componentDidCatch(s.value,{componentStack:S!==null?S:""})}),l}function xu(n,s,l){var u=n.pingCache;if(u===null){u=n.pingCache=new xg;var y=new Set;u.set(s,y)}else y=u.get(s),y===void 0&&(y=new Set,u.set(s,y));y.has(l)||(y.add(l),n=Lg.bind(null,n,s,l),s.then(n,n))}function ku(n){do{var s;if((s=n.tag===13)&&(s=n.memoizedState,s=s!==null?s.dehydrated!==null:!0),s)return n;n=n.return}while(n!==null);return null}function Su(n,s,l,u,y){return(n.mode&1)===0?(n===s?n.flags|=65536:(n.flags|=128,l.flags|=131072,l.flags&=-52805,l.tag===1&&(l.alternate===null?l.tag=17:(s=ii(-1,1),s.tag=2,_i(l,s,1))),l.lanes|=1),n):(n.flags|=65536,n.lanes=y,n)}var kg=E.ReactCurrentOwner,Qt=!1;function Ht(n,s,l,u){s.child=n===null?Gh(s,null,l,u):Ms(s,n.child,l,u)}function Au(n,s,l,u,y){l=l.render;var b=s.ref;return Ds(s,y),u=Zl(n,s,l,u,b,y),l=ec(),n!==null&&!Qt?(s.updateQueue=n.updateQueue,s.flags&=-2053,n.lanes&=~y,si(n,s,y)):(nt&&l&&jl(s),s.flags|=1,Ht(n,s,u,y),s.child)}function Cu(n,s,l,u,y){if(n===null){var b=l.type;return typeof b=="function"&&!Nc(b)&&b.defaultProps===void 0&&l.compare===null&&l.defaultProps===void 0?(s.tag=15,s.type=b,Tu(n,s,b,u,y)):(n=go(l.type,null,u,s,s.mode,y),n.ref=s.ref,n.return=s,s.child=n)}if(b=n.child,(n.lanes&y)===0){var S=b.memoizedProps;if(l=l.compare,l=l!==null?l:br,l(S,u)&&n.ref===s.ref)return si(n,s,y)}return s.flags|=1,n=Li(b,u),n.ref=s.ref,n.return=s,s.child=n}function Tu(n,s,l,u,y){if(n!==null){var b=n.memoizedProps;if(br(b,u)&&n.ref===s.ref)if(Qt=!1,s.pendingProps=u=b,(n.lanes&y)!==0)(n.flags&131072)!==0&&(Qt=!0);else return s.lanes=n.lanes,si(n,s,y)}return cc(n,s,l,u,y)}function Eu(n,s,l){var u=s.pendingProps,y=u.children,b=n!==null?n.memoizedState:null;if(u.mode==="hidden")if((s.mode&1)===0)s.memoizedState={baseLanes:0,cachePool:null,transitions:null},Qe(Os,un),un|=l;else{if((l&1073741824)===0)return n=b!==null?b.baseLanes|l:l,s.lanes=s.childLanes=1073741824,s.memoizedState={baseLanes:n,cachePool:null,transitions:null},s.updateQueue=null,Qe(Os,un),un|=n,null;s.memoizedState={baseLanes:0,cachePool:null,transitions:null},u=b!==null?b.baseLanes:l,Qe(Os,un),un|=u}else b!==null?(u=b.baseLanes|l,s.memoizedState=null):u=l,Qe(Os,un),un|=u;return Ht(n,s,y,l),s.child}function Ru(n,s){var l=s.ref;(n===null&&l!==null||n!==null&&n.ref!==l)&&(s.flags|=512,s.flags|=2097152)}function cc(n,s,l,u,y){var b=Xt(l)?$i:Ft.current;return b=Rs(s,b),Ds(s,y),l=Zl(n,s,l,u,b,y),u=ec(),n!==null&&!Qt?(s.updateQueue=n.updateQueue,s.flags&=-2053,n.lanes&=~y,si(n,s,y)):(nt&&u&&jl(s),s.flags|=1,Ht(n,s,l,y),s.child)}function _u(n,s,l,u,y){if(Xt(l)){var b=!0;Ba(s)}else b=!1;if(Ds(s,y),s.stateNode===null)so(n,s),yu(s,l,u),ac(s,l,u,y),u=!0;else if(n===null){var S=s.stateNode,P=s.memoizedProps;S.props=P;var D=S.context,U=l.contextType;typeof U=="object"&&U!==null?U=bn(U):(U=Xt(l)?$i:Ft.current,U=Rs(s,U));var ie=l.getDerivedStateFromProps,ae=typeof ie=="function"||typeof S.getSnapshotBeforeUpdate=="function";ae||typeof S.UNSAFE_componentWillReceiveProps!="function"&&typeof S.componentWillReceiveProps!="function"||(P!==u||D!==U)&&wu(s,S,u,U),Ri=!1;var ne=s.memoizedState;S.state=ne,Ya(s,u,S,y),D=s.memoizedState,P!==u||ne!==D||Yt.current||Ri?(typeof ie=="function"&&(rc(s,l,ie,u),D=s.memoizedState),(P=Ri||gu(s,l,P,u,ne,D,U))?(ae||typeof S.UNSAFE_componentWillMount!="function"&&typeof S.componentWillMount!="function"||(typeof S.componentWillMount=="function"&&S.componentWillMount(),typeof S.UNSAFE_componentWillMount=="function"&&S.UNSAFE_componentWillMount()),typeof S.componentDidMount=="function"&&(s.flags|=4194308)):(typeof S.componentDidMount=="function"&&(s.flags|=4194308),s.memoizedProps=u,s.memoizedState=D),S.props=u,S.state=D,S.context=U,u=P):(typeof S.componentDidMount=="function"&&(s.flags|=4194308),u=!1)}else{S=s.stateNode,Uh(n,s),P=s.memoizedProps,U=s.type===s.elementType?P:Nn(s.type,P),S.props=U,ae=s.pendingProps,ne=S.context,D=l.contextType,typeof D=="object"&&D!==null?D=bn(D):(D=Xt(l)?$i:Ft.current,D=Rs(s,D));var ge=l.getDerivedStateFromProps;(ie=typeof ge=="function"||typeof S.getSnapshotBeforeUpdate=="function")||typeof S.UNSAFE_componentWillReceiveProps!="function"&&typeof S.componentWillReceiveProps!="function"||(P!==ae||ne!==D)&&wu(s,S,u,D),Ri=!1,ne=s.memoizedState,S.state=ne,Ya(s,u,S,y);var ke=s.memoizedState;P!==ae||ne!==ke||Yt.current||Ri?(typeof ge=="function"&&(rc(s,l,ge,u),ke=s.memoizedState),(U=Ri||gu(s,l,U,u,ne,ke,D)||!1)?(ie||typeof S.UNSAFE_componentWillUpdate!="function"&&typeof S.componentWillUpdate!="function"||(typeof S.componentWillUpdate=="function"&&S.componentWillUpdate(u,ke,D),typeof S.UNSAFE_componentWillUpdate=="function"&&S.UNSAFE_componentWillUpdate(u,ke,D)),typeof S.componentDidUpdate=="function"&&(s.flags|=4),typeof S.getSnapshotBeforeUpdate=="function"&&(s.flags|=1024)):(typeof S.componentDidUpdate!="function"||P===n.memoizedProps&&ne===n.memoizedState||(s.flags|=4),typeof S.getSnapshotBeforeUpdate!="function"||P===n.memoizedProps&&ne===n.memoizedState||(s.flags|=1024),s.memoizedProps=u,s.memoizedState=ke),S.props=u,S.state=ke,S.context=D,u=U):(typeof S.componentDidUpdate!="function"||P===n.memoizedProps&&ne===n.memoizedState||(s.flags|=4),typeof S.getSnapshotBeforeUpdate!="function"||P===n.memoizedProps&&ne===n.memoizedState||(s.flags|=1024),u=!1)}return dc(n,s,l,u,b,y)}function dc(n,s,l,u,y,b){Ru(n,s);var S=(s.flags&128)!==0;if(!u&&!S)return y&&Dh(s,l,!1),si(n,s,b);u=s.stateNode,kg.current=s;var P=S&&typeof l.getDerivedStateFromError!="function"?null:u.render();return s.flags|=1,n!==null&&S?(s.child=Ms(s,n.child,null,b),s.child=Ms(s,null,P,b)):Ht(n,s,P,b),s.memoizedState=u.state,y&&Dh(s,l,!0),s.child}function Nu(n){var s=n.stateNode;s.pendingContext?Mh(n,s.pendingContext,s.pendingContext!==s.context):s.context&&Mh(n,s.context,!1),Vl(n,s.containerInfo)}function Pu(n,s,l,u,y){return Ps(),Bl(y),s.flags|=256,Ht(n,s,l,u),s.child}var hc={dehydrated:null,treeContext:null,retryLane:0};function uc(n){return{baseLanes:n,cachePool:null,transitions:null}}function Mu(n,s,l){var u=s.pendingProps,y=ot.current,b=!1,S=(s.flags&128)!==0,P;if((P=S)||(P=n!==null&&n.memoizedState===null?!1:(y&2)!==0),P?(b=!0,s.flags&=-129):(n===null||n.memoizedState!==null)&&(y|=1),Qe(ot,y&1),n===null)return ql(s),n=s.memoizedState,n!==null&&(n=n.dehydrated,n!==null)?((s.mode&1)===0?s.lanes=1:n.data==="$!"?s.lanes=8:s.lanes=1073741824,null):(S=u.children,n=u.fallback,b?(u=s.mode,b=s.child,S={mode:"hidden",children:S},(u&1)===0&&b!==null?(b.childLanes=0,b.pendingProps=S):b=yo(S,u,0,null),n=ns(n,u,l,null),b.return=s,n.return=s,b.sibling=n,s.child=b,s.child.memoizedState=uc(l),s.memoizedState=hc,n):fc(s,S));if(y=n.memoizedState,y!==null&&(P=y.dehydrated,P!==null))return Sg(n,s,S,u,P,y,l);if(b){b=u.fallback,S=s.mode,y=n.child,P=y.sibling;var D={mode:"hidden",children:u.children};return(S&1)===0&&s.child!==y?(u=s.child,u.childLanes=0,u.pendingProps=D,s.deletions=null):(u=Li(y,D),u.subtreeFlags=y.subtreeFlags&14680064),P!==null?b=Li(P,b):(b=ns(b,S,l,null),b.flags|=2),b.return=s,u.return=s,u.sibling=b,s.child=u,u=b,b=s.child,S=n.child.memoizedState,S=S===null?uc(l):{baseLanes:S.baseLanes|l,cachePool:null,transitions:S.transitions},b.memoizedState=S,b.childLanes=n.childLanes&~l,s.memoizedState=hc,u}return b=n.child,n=b.sibling,u=Li(b,{mode:"visible",children:u.children}),(s.mode&1)===0&&(u.lanes=l),u.return=s,u.sibling=null,n!==null&&(l=s.deletions,l===null?(s.deletions=[n],s.flags|=16):l.push(n)),s.child=u,s.memoizedState=null,u}function fc(n,s){return s=yo({mode:"visible",children:s},n.mode,0,null),s.return=n,n.child=s}function io(n,s,l,u){return u!==null&&Bl(u),Ms(s,n.child,null,l),n=fc(s,s.pendingProps.children),n.flags|=2,s.memoizedState=null,n}function Sg(n,s,l,u,y,b,S){if(l)return s.flags&256?(s.flags&=-257,u=oc(Error(t(422))),io(n,s,S,u)):s.memoizedState!==null?(s.child=n.child,s.flags|=128,null):(b=u.fallback,y=s.mode,u=yo({mode:"visible",children:u.children},y,0,null),b=ns(b,y,S,null),b.flags|=2,u.return=s,b.return=s,u.sibling=b,s.child=u,(s.mode&1)!==0&&Ms(s,n.child,null,S),s.child.memoizedState=uc(S),s.memoizedState=hc,b);if((s.mode&1)===0)return io(n,s,S,null);if(y.data==="$!"){if(u=y.nextSibling&&y.nextSibling.dataset,u)var P=u.dgst;return u=P,b=Error(t(419)),u=oc(b,u,void 0),io(n,s,S,u)}if(P=(S&n.childLanes)!==0,Qt||P){if(u=Et,u!==null){switch(S&-S){case 4:y=2;break;case 16:y=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:y=32;break;case 536870912:y=268435456;break;default:y=0}y=(y&(u.suspendedLanes|S))!==0?0:y,y!==0&&y!==b.retryLane&&(b.retryLane=y,ni(n,y),In(u,n,y,-1))}return _c(),u=oc(Error(t(421))),io(n,s,S,u)}return y.data==="$?"?(s.flags|=128,s.child=n.child,s=jg.bind(null,n),y._reactRetry=s,null):(n=b.treeContext,hn=Ai(y.nextSibling),dn=s,nt=!0,_n=null,n!==null&&(yn[wn++]=ei,yn[wn++]=ti,yn[wn++]=Vi,ei=n.id,ti=n.overflow,Vi=s),s=fc(s,u.children),s.flags|=4096,s)}function Iu(n,s,l){n.lanes|=s;var u=n.alternate;u!==null&&(u.lanes|=s),zl(n.return,s,l)}function pc(n,s,l,u,y){var b=n.memoizedState;b===null?n.memoizedState={isBackwards:s,rendering:null,renderingStartTime:0,last:u,tail:l,tailMode:y}:(b.isBackwards=s,b.rendering=null,b.renderingStartTime=0,b.last=u,b.tail=l,b.tailMode=y)}function Du(n,s,l){var u=s.pendingProps,y=u.revealOrder,b=u.tail;if(Ht(n,s,u.children,l),u=ot.current,(u&2)!==0)u=u&1|2,s.flags|=128;else{if(n!==null&&(n.flags&128)!==0)e:for(n=s.child;n!==null;){if(n.tag===13)n.memoizedState!==null&&Iu(n,l,s);else if(n.tag===19)Iu(n,l,s);else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===s)break e;for(;n.sibling===null;){if(n.return===null||n.return===s)break e;n=n.return}n.sibling.return=n.return,n=n.sibling}u&=1}if(Qe(ot,u),(s.mode&1)===0)s.memoizedState=null;else switch(y){case"forwards":for(l=s.child,y=null;l!==null;)n=l.alternate,n!==null&&Xa(n)===null&&(y=l),l=l.sibling;l=y,l===null?(y=s.child,s.child=null):(y=l.sibling,l.sibling=null),pc(s,!1,y,l,b);break;case"backwards":for(l=null,y=s.child,s.child=null;y!==null;){if(n=y.alternate,n!==null&&Xa(n)===null){s.child=y;break}n=y.sibling,y.sibling=l,l=y,y=n}pc(s,!0,l,null,b);break;case"together":pc(s,!1,null,null,void 0);break;default:s.memoizedState=null}return s.child}function so(n,s){(s.mode&1)===0&&n!==null&&(n.alternate=null,s.alternate=null,s.flags|=2)}function si(n,s,l){if(n!==null&&(s.dependencies=n.dependencies),Ji|=s.lanes,(l&s.childLanes)===0)return null;if(n!==null&&s.child!==n.child)throw Error(t(153));if(s.child!==null){for(n=s.child,l=Li(n,n.pendingProps),s.child=l,l.return=s;n.sibling!==null;)n=n.sibling,l=l.sibling=Li(n,n.pendingProps),l.return=s;l.sibling=null}return s.child}function Ag(n,s,l){switch(s.tag){case 3:Nu(s),Ps();break;case 5:Kh(s);break;case 1:Xt(s.type)&&Ba(s);break;case 4:Vl(s,s.stateNode.containerInfo);break;case 10:var u=s.type._context,y=s.memoizedProps.value;Qe($a,u._currentValue),u._currentValue=y;break;case 13:if(u=s.memoizedState,u!==null)return u.dehydrated!==null?(Qe(ot,ot.current&1),s.flags|=128,null):(l&s.child.childLanes)!==0?Mu(n,s,l):(Qe(ot,ot.current&1),n=si(n,s,l),n!==null?n.sibling:null);Qe(ot,ot.current&1);break;case 19:if(u=(l&s.childLanes)!==0,(n.flags&128)!==0){if(u)return Du(n,s,l);s.flags|=128}if(y=s.memoizedState,y!==null&&(y.rendering=null,y.tail=null,y.lastEffect=null),Qe(ot,ot.current),u)break;return null;case 22:case 23:return s.lanes=0,Eu(n,s,l)}return si(n,s,l)}var Lu,mc,ju,Fu;Lu=function(n,s){for(var l=s.child;l!==null;){if(l.tag===5||l.tag===6)n.appendChild(l.stateNode);else if(l.tag!==4&&l.child!==null){l.child.return=l,l=l.child;continue}if(l===s)break;for(;l.sibling===null;){if(l.return===null||l.return===s)return;l=l.return}l.sibling.return=l.return,l=l.sibling}},mc=function(){},ju=function(n,s,l,u){var y=n.memoizedProps;if(y!==u){n=s.stateNode,Xi(qn.current);var b=null;switch(l){case"input":y=fe(n,y),u=fe(n,u),b=[];break;case"select":y=re({},y,{value:void 0}),u=re({},u,{value:void 0}),b=[];break;case"textarea":y=rt(n,y),u=rt(n,u),b=[];break;default:typeof y.onClick!="function"&&typeof u.onClick=="function"&&(n.onclick=Fa)}ir(l,u);var S;l=null;for(U in y)if(!u.hasOwnProperty(U)&&y.hasOwnProperty(U)&&y[U]!=null)if(U==="style"){var P=y[U];for(S in P)P.hasOwnProperty(S)&&(l||(l={}),l[S]="")}else U!=="dangerouslySetInnerHTML"&&U!=="children"&&U!=="suppressContentEditableWarning"&&U!=="suppressHydrationWarning"&&U!=="autoFocus"&&(r.hasOwnProperty(U)?b||(b=[]):(b=b||[]).push(U,null));for(U in u){var D=u[U];if(P=y?.[U],u.hasOwnProperty(U)&&D!==P&&(D!=null||P!=null))if(U==="style")if(P){for(S in P)!P.hasOwnProperty(S)||D&&D.hasOwnProperty(S)||(l||(l={}),l[S]="");for(S in D)D.hasOwnProperty(S)&&P[S]!==D[S]&&(l||(l={}),l[S]=D[S])}else l||(b||(b=[]),b.push(U,l)),l=D;else U==="dangerouslySetInnerHTML"?(D=D?D.__html:void 0,P=P?P.__html:void 0,D!=null&&P!==D&&(b=b||[]).push(U,D)):U==="children"?typeof D!="string"&&typeof D!="number"||(b=b||[]).push(U,""+D):U!=="suppressContentEditableWarning"&&U!=="suppressHydrationWarning"&&(r.hasOwnProperty(U)?(D!=null&&U==="onScroll"&&et("scroll",n),b||P===D||(b=[])):(b=b||[]).push(U,D))}l&&(b=b||[]).push("style",l);var U=b;(s.updateQueue=U)&&(s.flags|=4)}},Fu=function(n,s,l,u){l!==u&&(s.flags|=4)};function Dr(n,s){if(!nt)switch(n.tailMode){case"hidden":s=n.tail;for(var l=null;s!==null;)s.alternate!==null&&(l=s),s=s.sibling;l===null?n.tail=null:l.sibling=null;break;case"collapsed":l=n.tail;for(var u=null;l!==null;)l.alternate!==null&&(u=l),l=l.sibling;u===null?s||n.tail===null?n.tail=null:n.tail.sibling=null:u.sibling=null}}function qt(n){var s=n.alternate!==null&&n.alternate.child===n.child,l=0,u=0;if(s)for(var y=n.child;y!==null;)l|=y.lanes|y.childLanes,u|=y.subtreeFlags&14680064,u|=y.flags&14680064,y.return=n,y=y.sibling;else for(y=n.child;y!==null;)l|=y.lanes|y.childLanes,u|=y.subtreeFlags,u|=y.flags,y.return=n,y=y.sibling;return n.subtreeFlags|=u,n.childLanes=l,s}function Cg(n,s,l){var u=s.pendingProps;switch(Fl(s),s.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return qt(s),null;case 1:return Xt(s.type)&&qa(),qt(s),null;case 3:return u=s.stateNode,Ls(),tt(Yt),tt(Ft),Xl(),u.pendingContext&&(u.context=u.pendingContext,u.pendingContext=null),(n===null||n.child===null)&&(za(s)?s.flags|=4:n===null||n.memoizedState.isDehydrated&&(s.flags&256)===0||(s.flags|=1024,_n!==null&&(Tc(_n),_n=null))),mc(n,s),qt(s),null;case 5:Kl(s);var y=Xi(_r.current);if(l=s.type,n!==null&&s.stateNode!=null)ju(n,s,l,u,y),n.ref!==s.ref&&(s.flags|=512,s.flags|=2097152);else{if(!u){if(s.stateNode===null)throw Error(t(166));return qt(s),null}if(n=Xi(qn.current),za(s)){u=s.stateNode,l=s.type;var b=s.memoizedProps;switch(u[On]=s,u[Ar]=b,n=(s.mode&1)!==0,l){case"dialog":et("cancel",u),et("close",u);break;case"iframe":case"object":case"embed":et("load",u);break;case"video":case"audio":for(y=0;y<xr.length;y++)et(xr[y],u);break;case"source":et("error",u);break;case"img":case"image":case"link":et("error",u),et("load",u);break;case"details":et("toggle",u);break;case"input":pe(u,b),et("invalid",u);break;case"select":u._wrapperState={wasMultiple:!!b.multiple},et("invalid",u);break;case"textarea":$t(u,b),et("invalid",u)}ir(l,b),y=null;for(var S in b)if(b.hasOwnProperty(S)){var P=b[S];S==="children"?typeof P=="string"?u.textContent!==P&&(b.suppressHydrationWarning!==!0&&ja(u.textContent,P,n),y=["children",P]):typeof P=="number"&&u.textContent!==""+P&&(b.suppressHydrationWarning!==!0&&ja(u.textContent,P,n),y=["children",""+P]):r.hasOwnProperty(S)&&P!=null&&S==="onScroll"&&et("scroll",u)}switch(l){case"input":Ve(u),Je(u,b,!0);break;case"textarea":Ve(u),pt(u);break;case"select":case"option":break;default:typeof b.onClick=="function"&&(u.onclick=Fa)}u=y,s.updateQueue=u,u!==null&&(s.flags|=4)}else{S=y.nodeType===9?y:y.ownerDocument,n==="http://www.w3.org/1999/xhtml"&&(n=Xn(l)),n==="http://www.w3.org/1999/xhtml"?l==="script"?(n=S.createElement("div"),n.innerHTML="<script><\/script>",n=n.removeChild(n.firstChild)):typeof u.is=="string"?n=S.createElement(l,{is:u.is}):(n=S.createElement(l),l==="select"&&(S=n,u.multiple?S.multiple=!0:u.size&&(S.size=u.size))):n=S.createElementNS(n,l),n[On]=s,n[Ar]=u,Lu(n,s,!1,!1),s.stateNode=n;e:{switch(S=sr(l,u),l){case"dialog":et("cancel",n),et("close",n),y=u;break;case"iframe":case"object":case"embed":et("load",n),y=u;break;case"video":case"audio":for(y=0;y<xr.length;y++)et(xr[y],n);y=u;break;case"source":et("error",n),y=u;break;case"img":case"image":case"link":et("error",n),et("load",n),y=u;break;case"details":et("toggle",n),y=u;break;case"input":pe(n,u),y=fe(n,u),et("invalid",n);break;case"option":y=u;break;case"select":n._wrapperState={wasMultiple:!!u.multiple},y=re({},u,{value:void 0}),et("invalid",n);break;case"textarea":$t(n,u),y=rt(n,u),et("invalid",n);break;default:y=u}ir(l,y),P=y;for(b in P)if(P.hasOwnProperty(b)){var D=P[b];b==="style"?ua(n,D):b==="dangerouslySetInnerHTML"?(D=D?D.__html:void 0,D!=null&&Ge(n,D)):b==="children"?typeof D=="string"?(l!=="textarea"||D!=="")&&Tn(n,D):typeof D=="number"&&Tn(n,""+D):b!=="suppressContentEditableWarning"&&b!=="suppressHydrationWarning"&&b!=="autoFocus"&&(r.hasOwnProperty(b)?D!=null&&b==="onScroll"&&et("scroll",n):D!=null&&R(n,b,D,S))}switch(l){case"input":Ve(n),Je(n,u,!1);break;case"textarea":Ve(n),pt(n);break;case"option":u.value!=null&&n.setAttribute("value",""+_e(u.value));break;case"select":n.multiple=!!u.multiple,b=u.value,b!=null?Xe(n,!!u.multiple,b,!1):u.defaultValue!=null&&Xe(n,!!u.multiple,u.defaultValue,!0);break;default:typeof y.onClick=="function"&&(n.onclick=Fa)}switch(l){case"button":case"input":case"select":case"textarea":u=!!u.autoFocus;break e;case"img":u=!0;break e;default:u=!1}}u&&(s.flags|=4)}s.ref!==null&&(s.flags|=512,s.flags|=2097152)}return qt(s),null;case 6:if(n&&s.stateNode!=null)Fu(n,s,n.memoizedProps,u);else{if(typeof u!="string"&&s.stateNode===null)throw Error(t(166));if(l=Xi(_r.current),Xi(qn.current),za(s)){if(u=s.stateNode,l=s.memoizedProps,u[On]=s,(b=u.nodeValue!==l)&&(n=dn,n!==null))switch(n.tag){case 3:ja(u.nodeValue,l,(n.mode&1)!==0);break;case 5:n.memoizedProps.suppressHydrationWarning!==!0&&ja(u.nodeValue,l,(n.mode&1)!==0)}b&&(s.flags|=4)}else u=(l.nodeType===9?l:l.ownerDocument).createTextNode(u),u[On]=s,s.stateNode=u}return qt(s),null;case 13:if(tt(ot),u=s.memoizedState,n===null||n.memoizedState!==null&&n.memoizedState.dehydrated!==null){if(nt&&hn!==null&&(s.mode&1)!==0&&(s.flags&128)===0)Bh(),Ps(),s.flags|=98560,b=!1;else if(b=za(s),u!==null&&u.dehydrated!==null){if(n===null){if(!b)throw Error(t(318));if(b=s.memoizedState,b=b!==null?b.dehydrated:null,!b)throw Error(t(317));b[On]=s}else Ps(),(s.flags&128)===0&&(s.memoizedState=null),s.flags|=4;qt(s),b=!1}else _n!==null&&(Tc(_n),_n=null),b=!0;if(!b)return s.flags&65536?s:null}return(s.flags&128)!==0?(s.lanes=l,s):(u=u!==null,u!==(n!==null&&n.memoizedState!==null)&&u&&(s.child.flags|=8192,(s.mode&1)!==0&&(n===null||(ot.current&1)!==0?At===0&&(At=3):_c())),s.updateQueue!==null&&(s.flags|=4),qt(s),null);case 4:return Ls(),mc(n,s),n===null&&kr(s.stateNode.containerInfo),qt(s),null;case 10:return Gl(s.type._context),qt(s),null;case 17:return Xt(s.type)&&qa(),qt(s),null;case 19:if(tt(ot),b=s.memoizedState,b===null)return qt(s),null;if(u=(s.flags&128)!==0,S=b.rendering,S===null)if(u)Dr(b,!1);else{if(At!==0||n!==null&&(n.flags&128)!==0)for(n=s.child;n!==null;){if(S=Xa(n),S!==null){for(s.flags|=128,Dr(b,!1),u=S.updateQueue,u!==null&&(s.updateQueue=u,s.flags|=4),s.subtreeFlags=0,u=l,l=s.child;l!==null;)b=l,n=u,b.flags&=14680066,S=b.alternate,S===null?(b.childLanes=0,b.lanes=n,b.child=null,b.subtreeFlags=0,b.memoizedProps=null,b.memoizedState=null,b.updateQueue=null,b.dependencies=null,b.stateNode=null):(b.childLanes=S.childLanes,b.lanes=S.lanes,b.child=S.child,b.subtreeFlags=0,b.deletions=null,b.memoizedProps=S.memoizedProps,b.memoizedState=S.memoizedState,b.updateQueue=S.updateQueue,b.type=S.type,n=S.dependencies,b.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext}),l=l.sibling;return Qe(ot,ot.current&1|2),s.child}n=n.sibling}b.tail!==null&&at()>qs&&(s.flags|=128,u=!0,Dr(b,!1),s.lanes=4194304)}else{if(!u)if(n=Xa(S),n!==null){if(s.flags|=128,u=!0,l=n.updateQueue,l!==null&&(s.updateQueue=l,s.flags|=4),Dr(b,!0),b.tail===null&&b.tailMode==="hidden"&&!S.alternate&&!nt)return qt(s),null}else 2*at()-b.renderingStartTime>qs&&l!==1073741824&&(s.flags|=128,u=!0,Dr(b,!1),s.lanes=4194304);b.isBackwards?(S.sibling=s.child,s.child=S):(l=b.last,l!==null?l.sibling=S:s.child=S,b.last=S)}return b.tail!==null?(s=b.tail,b.rendering=s,b.tail=s.sibling,b.renderingStartTime=at(),s.sibling=null,l=ot.current,Qe(ot,u?l&1|2:l&1),s):(qt(s),null);case 22:case 23:return Rc(),u=s.memoizedState!==null,n!==null&&n.memoizedState!==null!==u&&(s.flags|=8192),u&&(s.mode&1)!==0?(un&1073741824)!==0&&(qt(s),s.subtreeFlags&6&&(s.flags|=8192)):qt(s),null;case 24:return null;case 25:return null}throw Error(t(156,s.tag))}function Tg(n,s){switch(Fl(s),s.tag){case 1:return Xt(s.type)&&qa(),n=s.flags,n&65536?(s.flags=n&-65537|128,s):null;case 3:return Ls(),tt(Yt),tt(Ft),Xl(),n=s.flags,(n&65536)!==0&&(n&128)===0?(s.flags=n&-65537|128,s):null;case 5:return Kl(s),null;case 13:if(tt(ot),n=s.memoizedState,n!==null&&n.dehydrated!==null){if(s.alternate===null)throw Error(t(340));Ps()}return n=s.flags,n&65536?(s.flags=n&-65537|128,s):null;case 19:return tt(ot),null;case 4:return Ls(),null;case 10:return Gl(s.type._context),null;case 22:case 23:return Rc(),null;case 24:return null;default:return null}}var ro=!1,Bt=!1,Eg=typeof WeakSet=="function"?WeakSet:Set,we=null;function Fs(n,s){var l=n.ref;if(l!==null)if(typeof l=="function")try{l(null)}catch(u){mt(n,s,u)}else l.current=null}function gc(n,s,l){try{l()}catch(u){mt(n,s,u)}}var Ou=!1;function Rg(n,s){if(Rl=Ca,n=gh(),vl(n)){if("selectionStart"in n)var l={start:n.selectionStart,end:n.selectionEnd};else e:{l=(l=n.ownerDocument)&&l.defaultView||window;var u=l.getSelection&&l.getSelection();if(u&&u.rangeCount!==0){l=u.anchorNode;var y=u.anchorOffset,b=u.focusNode;u=u.focusOffset;try{l.nodeType,b.nodeType}catch{l=null;break e}var S=0,P=-1,D=-1,U=0,ie=0,ae=n,ne=null;t:for(;;){for(var ge;ae!==l||y!==0&&ae.nodeType!==3||(P=S+y),ae!==b||u!==0&&ae.nodeType!==3||(D=S+u),ae.nodeType===3&&(S+=ae.nodeValue.length),(ge=ae.firstChild)!==null;)ne=ae,ae=ge;for(;;){if(ae===n)break t;if(ne===l&&++U===y&&(P=S),ne===b&&++ie===u&&(D=S),(ge=ae.nextSibling)!==null)break;ae=ne,ne=ae.parentNode}ae=ge}l=P===-1||D===-1?null:{start:P,end:D}}else l=null}l=l||{start:0,end:0}}else l=null;for(_l={focusedElem:n,selectionRange:l},Ca=!1,we=s;we!==null;)if(s=we,n=s.child,(s.subtreeFlags&1028)!==0&&n!==null)n.return=s,we=n;else for(;we!==null;){s=we;try{var ke=s.alternate;if((s.flags&1024)!==0)switch(s.tag){case 0:case 11:case 15:break;case 1:if(ke!==null){var Se=ke.memoizedProps,yt=ke.memoizedState,W=s.stateNode,O=W.getSnapshotBeforeUpdate(s.elementType===s.type?Se:Nn(s.type,Se),yt);W.__reactInternalSnapshotBeforeUpdate=O}break;case 3:var H=s.stateNode.containerInfo;H.nodeType===1?H.textContent="":H.nodeType===9&&H.documentElement&&H.removeChild(H.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(t(163))}}catch(de){mt(s,s.return,de)}if(n=s.sibling,n!==null){n.return=s.return,we=n;break}we=s.return}return ke=Ou,Ou=!1,ke}function Lr(n,s,l){var u=s.updateQueue;if(u=u!==null?u.lastEffect:null,u!==null){var y=u=u.next;do{if((y.tag&n)===n){var b=y.destroy;y.destroy=void 0,b!==void 0&&gc(s,l,b)}y=y.next}while(y!==u)}}function ao(n,s){if(s=s.updateQueue,s=s!==null?s.lastEffect:null,s!==null){var l=s=s.next;do{if((l.tag&n)===n){var u=l.create;l.destroy=u()}l=l.next}while(l!==s)}}function yc(n){var s=n.ref;if(s!==null){var l=n.stateNode;switch(n.tag){case 5:n=l;break;default:n=l}typeof s=="function"?s(n):s.current=n}}function qu(n){var s=n.alternate;s!==null&&(n.alternate=null,qu(s)),n.child=null,n.deletions=null,n.sibling=null,n.tag===5&&(s=n.stateNode,s!==null&&(delete s[On],delete s[Ar],delete s[Il],delete s[dg],delete s[hg])),n.stateNode=null,n.return=null,n.dependencies=null,n.memoizedProps=null,n.memoizedState=null,n.pendingProps=null,n.stateNode=null,n.updateQueue=null}function Bu(n){return n.tag===5||n.tag===3||n.tag===4}function Wu(n){e:for(;;){for(;n.sibling===null;){if(n.return===null||Bu(n.return))return null;n=n.return}for(n.sibling.return=n.return,n=n.sibling;n.tag!==5&&n.tag!==6&&n.tag!==18;){if(n.flags&2||n.child===null||n.tag===4)continue e;n.child.return=n,n=n.child}if(!(n.flags&2))return n.stateNode}}function wc(n,s,l){var u=n.tag;if(u===5||u===6)n=n.stateNode,s?l.nodeType===8?l.parentNode.insertBefore(n,s):l.insertBefore(n,s):(l.nodeType===8?(s=l.parentNode,s.insertBefore(n,l)):(s=l,s.appendChild(n)),l=l._reactRootContainer,l!=null||s.onclick!==null||(s.onclick=Fa));else if(u!==4&&(n=n.child,n!==null))for(wc(n,s,l),n=n.sibling;n!==null;)wc(n,s,l),n=n.sibling}function bc(n,s,l){var u=n.tag;if(u===5||u===6)n=n.stateNode,s?l.insertBefore(n,s):l.appendChild(n);else if(u!==4&&(n=n.child,n!==null))for(bc(n,s,l),n=n.sibling;n!==null;)bc(n,s,l),n=n.sibling}var Mt=null,Pn=!1;function Ni(n,s,l){for(l=l.child;l!==null;)Hu(n,s,l),l=l.sibling}function Hu(n,s,l){if(Fn&&typeof Fn.onCommitFiberUnmount=="function")try{Fn.onCommitFiberUnmount(ba,l)}catch{}switch(l.tag){case 5:Bt||Fs(l,s);case 6:var u=Mt,y=Pn;Mt=null,Ni(n,s,l),Mt=u,Pn=y,Mt!==null&&(Pn?(n=Mt,l=l.stateNode,n.nodeType===8?n.parentNode.removeChild(l):n.removeChild(l)):Mt.removeChild(l.stateNode));break;case 18:Mt!==null&&(Pn?(n=Mt,l=l.stateNode,n.nodeType===8?Ml(n.parentNode,l):n.nodeType===1&&Ml(n,l),fr(n)):Ml(Mt,l.stateNode));break;case 4:u=Mt,y=Pn,Mt=l.stateNode.containerInfo,Pn=!0,Ni(n,s,l),Mt=u,Pn=y;break;case 0:case 11:case 14:case 15:if(!Bt&&(u=l.updateQueue,u!==null&&(u=u.lastEffect,u!==null))){y=u=u.next;do{var b=y,S=b.destroy;b=b.tag,S!==void 0&&((b&2)!==0||(b&4)!==0)&&gc(l,s,S),y=y.next}while(y!==u)}Ni(n,s,l);break;case 1:if(!Bt&&(Fs(l,s),u=l.stateNode,typeof u.componentWillUnmount=="function"))try{u.props=l.memoizedProps,u.state=l.memoizedState,u.componentWillUnmount()}catch(P){mt(l,s,P)}Ni(n,s,l);break;case 21:Ni(n,s,l);break;case 22:l.mode&1?(Bt=(u=Bt)||l.memoizedState!==null,Ni(n,s,l),Bt=u):Ni(n,s,l);break;default:Ni(n,s,l)}}function Gu(n){var s=n.updateQueue;if(s!==null){n.updateQueue=null;var l=n.stateNode;l===null&&(l=n.stateNode=new Eg),s.forEach(function(u){var y=Fg.bind(null,n,u);l.has(u)||(l.add(u),u.then(y,y))})}}function Mn(n,s){var l=s.deletions;if(l!==null)for(var u=0;u<l.length;u++){var y=l[u];try{var b=n,S=s,P=S;e:for(;P!==null;){switch(P.tag){case 5:Mt=P.stateNode,Pn=!1;break e;case 3:Mt=P.stateNode.containerInfo,Pn=!0;break e;case 4:Mt=P.stateNode.containerInfo,Pn=!0;break e}P=P.return}if(Mt===null)throw Error(t(160));Hu(b,S,y),Mt=null,Pn=!1;var D=y.alternate;D!==null&&(D.return=null),y.return=null}catch(U){mt(y,s,U)}}if(s.subtreeFlags&12854)for(s=s.child;s!==null;)zu(s,n),s=s.sibling}function zu(n,s){var l=n.alternate,u=n.flags;switch(n.tag){case 0:case 11:case 14:case 15:if(Mn(s,n),Wn(n),u&4){try{Lr(3,n,n.return),ao(3,n)}catch(Se){mt(n,n.return,Se)}try{Lr(5,n,n.return)}catch(Se){mt(n,n.return,Se)}}break;case 1:Mn(s,n),Wn(n),u&512&&l!==null&&Fs(l,l.return);break;case 5:if(Mn(s,n),Wn(n),u&512&&l!==null&&Fs(l,l.return),n.flags&32){var y=n.stateNode;try{Tn(y,"")}catch(Se){mt(n,n.return,Se)}}if(u&4&&(y=n.stateNode,y!=null)){var b=n.memoizedProps,S=l!==null?l.memoizedProps:b,P=n.type,D=n.updateQueue;if(n.updateQueue=null,D!==null)try{P==="input"&&b.type==="radio"&&b.name!=null&&Ce(y,b),sr(P,S);var U=sr(P,b);for(S=0;S<D.length;S+=2){var ie=D[S],ae=D[S+1];ie==="style"?ua(y,ae):ie==="dangerouslySetInnerHTML"?Ge(y,ae):ie==="children"?Tn(y,ae):R(y,ie,ae,U)}switch(P){case"input":De(y,b);break;case"textarea":gt(y,b);break;case"select":var ne=y._wrapperState.wasMultiple;y._wrapperState.wasMultiple=!!b.multiple;var ge=b.value;ge!=null?Xe(y,!!b.multiple,ge,!1):ne!==!!b.multiple&&(b.defaultValue!=null?Xe(y,!!b.multiple,b.defaultValue,!0):Xe(y,!!b.multiple,b.multiple?[]:"",!1))}y[Ar]=b}catch(Se){mt(n,n.return,Se)}}break;case 6:if(Mn(s,n),Wn(n),u&4){if(n.stateNode===null)throw Error(t(162));y=n.stateNode,b=n.memoizedProps;try{y.nodeValue=b}catch(Se){mt(n,n.return,Se)}}break;case 3:if(Mn(s,n),Wn(n),u&4&&l!==null&&l.memoizedState.isDehydrated)try{fr(s.containerInfo)}catch(Se){mt(n,n.return,Se)}break;case 4:Mn(s,n),Wn(n);break;case 13:Mn(s,n),Wn(n),y=n.child,y.flags&8192&&(b=y.memoizedState!==null,y.stateNode.isHidden=b,!b||y.alternate!==null&&y.alternate.memoizedState!==null||(kc=at())),u&4&&Gu(n);break;case 22:if(ie=l!==null&&l.memoizedState!==null,n.mode&1?(Bt=(U=Bt)||ie,Mn(s,n),Bt=U):Mn(s,n),Wn(n),u&8192){if(U=n.memoizedState!==null,(n.stateNode.isHidden=U)&&!ie&&(n.mode&1)!==0)for(we=n,ie=n.child;ie!==null;){for(ae=we=ie;we!==null;){switch(ne=we,ge=ne.child,ne.tag){case 0:case 11:case 14:case 15:Lr(4,ne,ne.return);break;case 1:Fs(ne,ne.return);var ke=ne.stateNode;if(typeof ke.componentWillUnmount=="function"){u=ne,l=ne.return;try{s=u,ke.props=s.memoizedProps,ke.state=s.memoizedState,ke.componentWillUnmount()}catch(Se){mt(u,l,Se)}}break;case 5:Fs(ne,ne.return);break;case 22:if(ne.memoizedState!==null){Vu(ae);continue}}ge!==null?(ge.return=ne,we=ge):Vu(ae)}ie=ie.sibling}e:for(ie=null,ae=n;;){if(ae.tag===5){if(ie===null){ie=ae;try{y=ae.stateNode,U?(b=y.style,typeof b.setProperty=="function"?b.setProperty("display","none","important"):b.display="none"):(P=ae.stateNode,D=ae.memoizedProps.style,S=D!=null&&D.hasOwnProperty("display")?D.display:null,P.style.display=ha("display",S))}catch(Se){mt(n,n.return,Se)}}}else if(ae.tag===6){if(ie===null)try{ae.stateNode.nodeValue=U?"":ae.memoizedProps}catch(Se){mt(n,n.return,Se)}}else if((ae.tag!==22&&ae.tag!==23||ae.memoizedState===null||ae===n)&&ae.child!==null){ae.child.return=ae,ae=ae.child;continue}if(ae===n)break e;for(;ae.sibling===null;){if(ae.return===null||ae.return===n)break e;ie===ae&&(ie=null),ae=ae.return}ie===ae&&(ie=null),ae.sibling.return=ae.return,ae=ae.sibling}}break;case 19:Mn(s,n),Wn(n),u&4&&Gu(n);break;case 21:break;default:Mn(s,n),Wn(n)}}function Wn(n){var s=n.flags;if(s&2){try{e:{for(var l=n.return;l!==null;){if(Bu(l)){var u=l;break e}l=l.return}throw Error(t(160))}switch(u.tag){case 5:var y=u.stateNode;u.flags&32&&(Tn(y,""),u.flags&=-33);var b=Wu(n);bc(n,b,y);break;case 3:case 4:var S=u.stateNode.containerInfo,P=Wu(n);wc(n,P,S);break;default:throw Error(t(161))}}catch(D){mt(n,n.return,D)}n.flags&=-3}s&4096&&(n.flags&=-4097)}function _g(n,s,l){we=n,Uu(n)}function Uu(n,s,l){for(var u=(n.mode&1)!==0;we!==null;){var y=we,b=y.child;if(y.tag===22&&u){var S=y.memoizedState!==null||ro;if(!S){var P=y.alternate,D=P!==null&&P.memoizedState!==null||Bt;P=ro;var U=Bt;if(ro=S,(Bt=D)&&!U)for(we=y;we!==null;)S=we,D=S.child,S.tag===22&&S.memoizedState!==null?Ku(y):D!==null?(D.return=S,we=D):Ku(y);for(;b!==null;)we=b,Uu(b),b=b.sibling;we=y,ro=P,Bt=U}$u(n)}else(y.subtreeFlags&8772)!==0&&b!==null?(b.return=y,we=b):$u(n)}}function $u(n){for(;we!==null;){var s=we;if((s.flags&8772)!==0){var l=s.alternate;try{if((s.flags&8772)!==0)switch(s.tag){case 0:case 11:case 15:Bt||ao(5,s);break;case 1:var u=s.stateNode;if(s.flags&4&&!Bt)if(l===null)u.componentDidMount();else{var y=s.elementType===s.type?l.memoizedProps:Nn(s.type,l.memoizedProps);u.componentDidUpdate(y,l.memoizedState,u.__reactInternalSnapshotBeforeUpdate)}var b=s.updateQueue;b!==null&&Vh(s,b,u);break;case 3:var S=s.updateQueue;if(S!==null){if(l=null,s.child!==null)switch(s.child.tag){case 5:l=s.child.stateNode;break;case 1:l=s.child.stateNode}Vh(s,S,l)}break;case 5:var P=s.stateNode;if(l===null&&s.flags&4){l=P;var D=s.memoizedProps;switch(s.type){case"button":case"input":case"select":case"textarea":D.autoFocus&&l.focus();break;case"img":D.src&&(l.src=D.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(s.memoizedState===null){var U=s.alternate;if(U!==null){var ie=U.memoizedState;if(ie!==null){var ae=ie.dehydrated;ae!==null&&fr(ae)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(t(163))}Bt||s.flags&512&&yc(s)}catch(ne){mt(s,s.return,ne)}}if(s===n){we=null;break}if(l=s.sibling,l!==null){l.return=s.return,we=l;break}we=s.return}}function Vu(n){for(;we!==null;){var s=we;if(s===n){we=null;break}var l=s.sibling;if(l!==null){l.return=s.return,we=l;break}we=s.return}}function Ku(n){for(;we!==null;){var s=we;try{switch(s.tag){case 0:case 11:case 15:var l=s.return;try{ao(4,s)}catch(D){mt(s,l,D)}break;case 1:var u=s.stateNode;if(typeof u.componentDidMount=="function"){var y=s.return;try{u.componentDidMount()}catch(D){mt(s,y,D)}}var b=s.return;try{yc(s)}catch(D){mt(s,b,D)}break;case 5:var S=s.return;try{yc(s)}catch(D){mt(s,S,D)}}}catch(D){mt(s,s.return,D)}if(s===n){we=null;break}var P=s.sibling;if(P!==null){P.return=s.return,we=P;break}we=s.return}}var Ng=Math.ceil,oo=E.ReactCurrentDispatcher,vc=E.ReactCurrentOwner,xn=E.ReactCurrentBatchConfig,We=0,Et=null,xt=null,It=0,un=0,Os=Ci(0),At=0,jr=null,Ji=0,lo=0,xc=0,Fr=null,Jt=null,kc=0,qs=1/0,ri=null,co=!1,Sc=null,Pi=null,ho=!1,Mi=null,uo=0,Or=0,Ac=null,fo=-1,po=0;function Gt(){return(We&6)!==0?at():fo!==-1?fo:fo=at()}function Ii(n){return(n.mode&1)===0?1:(We&2)!==0&&It!==0?It&-It:fg.transition!==null?(po===0&&(po=Wd()),po):(n=Ue,n!==0||(n=window.event,n=n===void 0?16:Xd(n.type)),n)}function In(n,s,l,u){if(50<Or)throw Or=0,Ac=null,Error(t(185));lr(n,l,u),((We&2)===0||n!==Et)&&(n===Et&&((We&2)===0&&(lo|=l),At===4&&Di(n,It)),Zt(n,u),l===1&&We===0&&(s.mode&1)===0&&(qs=at()+500,Wa&&Ei()))}function Zt(n,s){var l=n.callbackNode;fm(n,s);var u=ka(n,n===Et?It:0);if(u===0)l!==null&&yi(l),n.callbackNode=null,n.callbackPriority=0;else if(s=u&-u,n.callbackPriority!==s){if(l!=null&&yi(l),s===1)n.tag===0?ug(Xu.bind(null,n)):Lh(Xu.bind(null,n)),lg(function(){(We&6)===0&&Ei()}),l=null;else{switch(Hd(u)){case 1:l=ws;break;case 4:l=qd;break;case 16:l=wa;break;case 536870912:l=Bd;break;default:l=wa}l=rf(l,Yu.bind(null,n))}n.callbackPriority=s,n.callbackNode=l}}function Yu(n,s){if(fo=-1,po=0,(We&6)!==0)throw Error(t(327));var l=n.callbackNode;if(Bs()&&n.callbackNode!==l)return null;var u=ka(n,n===Et?It:0);if(u===0)return null;if((u&30)!==0||(u&n.expiredLanes)!==0||s)s=mo(n,u);else{s=u;var y=We;We|=2;var b=Ju();(Et!==n||It!==s)&&(ri=null,qs=at()+500,es(n,s));do try{Ig();break}catch(P){Qu(n,P)}while(!0);Hl(),oo.current=b,We=y,xt!==null?s=0:(Et=null,It=0,s=At)}if(s!==0){if(s===2&&(y=sl(n),y!==0&&(u=y,s=Cc(n,y))),s===1)throw l=jr,es(n,0),Di(n,u),Zt(n,at()),l;if(s===6)Di(n,u);else{if(y=n.current.alternate,(u&30)===0&&!Pg(y)&&(s=mo(n,u),s===2&&(b=sl(n),b!==0&&(u=b,s=Cc(n,b))),s===1))throw l=jr,es(n,0),Di(n,u),Zt(n,at()),l;switch(n.finishedWork=y,n.finishedLanes=u,s){case 0:case 1:throw Error(t(345));case 2:ts(n,Jt,ri);break;case 3:if(Di(n,u),(u&130023424)===u&&(s=kc+500-at(),10<s)){if(ka(n,0)!==0)break;if(y=n.suspendedLanes,(y&u)!==u){Gt(),n.pingedLanes|=n.suspendedLanes&y;break}n.timeoutHandle=Pl(ts.bind(null,n,Jt,ri),s);break}ts(n,Jt,ri);break;case 4:if(Di(n,u),(u&4194240)===u)break;for(s=n.eventTimes,y=-1;0<u;){var S=31-En(u);b=1<<S,S=s[S],S>y&&(y=S),u&=~b}if(u=y,u=at()-u,u=(120>u?120:480>u?480:1080>u?1080:1920>u?1920:3e3>u?3e3:4320>u?4320:1960*Ng(u/1960))-u,10<u){n.timeoutHandle=Pl(ts.bind(null,n,Jt,ri),u);break}ts(n,Jt,ri);break;case 5:ts(n,Jt,ri);break;default:throw Error(t(329))}}}return Zt(n,at()),n.callbackNode===l?Yu.bind(null,n):null}function Cc(n,s){var l=Fr;return n.current.memoizedState.isDehydrated&&(es(n,s).flags|=256),n=mo(n,s),n!==2&&(s=Jt,Jt=l,s!==null&&Tc(s)),n}function Tc(n){Jt===null?Jt=n:Jt.push.apply(Jt,n)}function Pg(n){for(var s=n;;){if(s.flags&16384){var l=s.updateQueue;if(l!==null&&(l=l.stores,l!==null))for(var u=0;u<l.length;u++){var y=l[u],b=y.getSnapshot;y=y.value;try{if(!Rn(b(),y))return!1}catch{return!1}}}if(l=s.child,s.subtreeFlags&16384&&l!==null)l.return=s,s=l;else{if(s===n)break;for(;s.sibling===null;){if(s.return===null||s.return===n)return!0;s=s.return}s.sibling.return=s.return,s=s.sibling}}return!0}function Di(n,s){for(s&=~xc,s&=~lo,n.suspendedLanes|=s,n.pingedLanes&=~s,n=n.expirationTimes;0<s;){var l=31-En(s),u=1<<l;n[l]=-1,s&=~u}}function Xu(n){if((We&6)!==0)throw Error(t(327));Bs();var s=ka(n,0);if((s&1)===0)return Zt(n,at()),null;var l=mo(n,s);if(n.tag!==0&&l===2){var u=sl(n);u!==0&&(s=u,l=Cc(n,u))}if(l===1)throw l=jr,es(n,0),Di(n,s),Zt(n,at()),l;if(l===6)throw Error(t(345));return n.finishedWork=n.current.alternate,n.finishedLanes=s,ts(n,Jt,ri),Zt(n,at()),null}function Ec(n,s){var l=We;We|=1;try{return n(s)}finally{We=l,We===0&&(qs=at()+500,Wa&&Ei())}}function Zi(n){Mi!==null&&Mi.tag===0&&(We&6)===0&&Bs();var s=We;We|=1;var l=xn.transition,u=Ue;try{if(xn.transition=null,Ue=1,n)return n()}finally{Ue=u,xn.transition=l,We=s,(We&6)===0&&Ei()}}function Rc(){un=Os.current,tt(Os)}function es(n,s){n.finishedWork=null,n.finishedLanes=0;var l=n.timeoutHandle;if(l!==-1&&(n.timeoutHandle=-1,og(l)),xt!==null)for(l=xt.return;l!==null;){var u=l;switch(Fl(u),u.tag){case 1:u=u.type.childContextTypes,u!=null&&qa();break;case 3:Ls(),tt(Yt),tt(Ft),Xl();break;case 5:Kl(u);break;case 4:Ls();break;case 13:tt(ot);break;case 19:tt(ot);break;case 10:Gl(u.type._context);break;case 22:case 23:Rc()}l=l.return}if(Et=n,xt=n=Li(n.current,null),It=un=s,At=0,jr=null,xc=lo=Ji=0,Jt=Fr=null,Yi!==null){for(s=0;s<Yi.length;s++)if(l=Yi[s],u=l.interleaved,u!==null){l.interleaved=null;var y=u.next,b=l.pending;if(b!==null){var S=b.next;b.next=y,u.next=S}l.pending=u}Yi=null}return n}function Qu(n,s){do{var l=xt;try{if(Hl(),Qa.current=to,Ja){for(var u=lt.memoizedState;u!==null;){var y=u.queue;y!==null&&(y.pending=null),u=u.next}Ja=!1}if(Qi=0,Tt=St=lt=null,Nr=!1,Pr=0,vc.current=null,l===null||l.return===null){At=1,jr=s,xt=null;break}e:{var b=n,S=l.return,P=l,D=s;if(s=It,P.flags|=32768,D!==null&&typeof D=="object"&&typeof D.then=="function"){var U=D,ie=P,ae=ie.tag;if((ie.mode&1)===0&&(ae===0||ae===11||ae===15)){var ne=ie.alternate;ne?(ie.updateQueue=ne.updateQueue,ie.memoizedState=ne.memoizedState,ie.lanes=ne.lanes):(ie.updateQueue=null,ie.memoizedState=null)}var ge=ku(S);if(ge!==null){ge.flags&=-257,Su(ge,S,P,b,s),ge.mode&1&&xu(b,U,s),s=ge,D=U;var ke=s.updateQueue;if(ke===null){var Se=new Set;Se.add(D),s.updateQueue=Se}else ke.add(D);break e}else{if((s&1)===0){xu(b,U,s),_c();break e}D=Error(t(426))}}else if(nt&&P.mode&1){var yt=ku(S);if(yt!==null){(yt.flags&65536)===0&&(yt.flags|=256),Su(yt,S,P,b,s),Bl(js(D,P));break e}}b=D=js(D,P),At!==4&&(At=2),Fr===null?Fr=[b]:Fr.push(b),b=S;do{switch(b.tag){case 3:b.flags|=65536,s&=-s,b.lanes|=s;var W=bu(b,D,s);$h(b,W);break e;case 1:P=D;var O=b.type,H=b.stateNode;if((b.flags&128)===0&&(typeof O.getDerivedStateFromError=="function"||H!==null&&typeof H.componentDidCatch=="function"&&(Pi===null||!Pi.has(H)))){b.flags|=65536,s&=-s,b.lanes|=s;var de=vu(b,P,s);$h(b,de);break e}}b=b.return}while(b!==null)}ef(l)}catch(Ae){s=Ae,xt===l&&l!==null&&(xt=l=l.return);continue}break}while(!0)}function Ju(){var n=oo.current;return oo.current=to,n===null?to:n}function _c(){(At===0||At===3||At===2)&&(At=4),Et===null||(Ji&268435455)===0&&(lo&268435455)===0||Di(Et,It)}function mo(n,s){var l=We;We|=2;var u=Ju();(Et!==n||It!==s)&&(ri=null,es(n,s));do try{Mg();break}catch(y){Qu(n,y)}while(!0);if(Hl(),We=l,oo.current=u,xt!==null)throw Error(t(261));return Et=null,It=0,At}function Mg(){for(;xt!==null;)Zu(xt)}function Ig(){for(;xt!==null&&!tl();)Zu(xt)}function Zu(n){var s=sf(n.alternate,n,un);n.memoizedProps=n.pendingProps,s===null?ef(n):xt=s,vc.current=null}function ef(n){var s=n;do{var l=s.alternate;if(n=s.return,(s.flags&32768)===0){if(l=Cg(l,s,un),l!==null){xt=l;return}}else{if(l=Tg(l,s),l!==null){l.flags&=32767,xt=l;return}if(n!==null)n.flags|=32768,n.subtreeFlags=0,n.deletions=null;else{At=6,xt=null;return}}if(s=s.sibling,s!==null){xt=s;return}xt=s=n}while(s!==null);At===0&&(At=5)}function ts(n,s,l){var u=Ue,y=xn.transition;try{xn.transition=null,Ue=1,Dg(n,s,l,u)}finally{xn.transition=y,Ue=u}return null}function Dg(n,s,l,u){do Bs();while(Mi!==null);if((We&6)!==0)throw Error(t(327));l=n.finishedWork;var y=n.finishedLanes;if(l===null)return null;if(n.finishedWork=null,n.finishedLanes=0,l===n.current)throw Error(t(177));n.callbackNode=null,n.callbackPriority=0;var b=l.lanes|l.childLanes;if(pm(n,b),n===Et&&(xt=Et=null,It=0),(l.subtreeFlags&2064)===0&&(l.flags&2064)===0||ho||(ho=!0,rf(wa,function(){return Bs(),null})),b=(l.flags&15990)!==0,(l.subtreeFlags&15990)!==0||b){b=xn.transition,xn.transition=null;var S=Ue;Ue=1;var P=We;We|=4,vc.current=null,Rg(n,l),zu(l,n),eg(_l),Ca=!!Rl,_l=Rl=null,n.current=l,_g(l),nl(),We=P,Ue=S,xn.transition=b}else n.current=l;if(ho&&(ho=!1,Mi=n,uo=y),b=n.pendingLanes,b===0&&(Pi=null),lm(l.stateNode),Zt(n,at()),s!==null)for(u=n.onRecoverableError,l=0;l<s.length;l++)y=s[l],u(y.value,{componentStack:y.stack,digest:y.digest});if(co)throw co=!1,n=Sc,Sc=null,n;return(uo&1)!==0&&n.tag!==0&&Bs(),b=n.pendingLanes,(b&1)!==0?n===Ac?Or++:(Or=0,Ac=n):Or=0,Ei(),null}function Bs(){if(Mi!==null){var n=Hd(uo),s=xn.transition,l=Ue;try{if(xn.transition=null,Ue=16>n?16:n,Mi===null)var u=!1;else{if(n=Mi,Mi=null,uo=0,(We&6)!==0)throw Error(t(331));var y=We;for(We|=4,we=n.current;we!==null;){var b=we,S=b.child;if((we.flags&16)!==0){var P=b.deletions;if(P!==null){for(var D=0;D<P.length;D++){var U=P[D];for(we=U;we!==null;){var ie=we;switch(ie.tag){case 0:case 11:case 15:Lr(8,ie,b)}var ae=ie.child;if(ae!==null)ae.return=ie,we=ae;else for(;we!==null;){ie=we;var ne=ie.sibling,ge=ie.return;if(qu(ie),ie===U){we=null;break}if(ne!==null){ne.return=ge,we=ne;break}we=ge}}}var ke=b.alternate;if(ke!==null){var Se=ke.child;if(Se!==null){ke.child=null;do{var yt=Se.sibling;Se.sibling=null,Se=yt}while(Se!==null)}}we=b}}if((b.subtreeFlags&2064)!==0&&S!==null)S.return=b,we=S;else e:for(;we!==null;){if(b=we,(b.flags&2048)!==0)switch(b.tag){case 0:case 11:case 15:Lr(9,b,b.return)}var W=b.sibling;if(W!==null){W.return=b.return,we=W;break e}we=b.return}}var O=n.current;for(we=O;we!==null;){S=we;var H=S.child;if((S.subtreeFlags&2064)!==0&&H!==null)H.return=S,we=H;else e:for(S=O;we!==null;){if(P=we,(P.flags&2048)!==0)try{switch(P.tag){case 0:case 11:case 15:ao(9,P)}}catch(Ae){mt(P,P.return,Ae)}if(P===S){we=null;break e}var de=P.sibling;if(de!==null){de.return=P.return,we=de;break e}we=P.return}}if(We=y,Ei(),Fn&&typeof Fn.onPostCommitFiberRoot=="function")try{Fn.onPostCommitFiberRoot(ba,n)}catch{}u=!0}return u}finally{Ue=l,xn.transition=s}}return!1}function tf(n,s,l){s=js(l,s),s=bu(n,s,1),n=_i(n,s,1),s=Gt(),n!==null&&(lr(n,1,s),Zt(n,s))}function mt(n,s,l){if(n.tag===3)tf(n,n,l);else for(;s!==null;){if(s.tag===3){tf(s,n,l);break}else if(s.tag===1){var u=s.stateNode;if(typeof s.type.getDerivedStateFromError=="function"||typeof u.componentDidCatch=="function"&&(Pi===null||!Pi.has(u))){n=js(l,n),n=vu(s,n,1),s=_i(s,n,1),n=Gt(),s!==null&&(lr(s,1,n),Zt(s,n));break}}s=s.return}}function Lg(n,s,l){var u=n.pingCache;u!==null&&u.delete(s),s=Gt(),n.pingedLanes|=n.suspendedLanes&l,Et===n&&(It&l)===l&&(At===4||At===3&&(It&130023424)===It&&500>at()-kc?es(n,0):xc|=l),Zt(n,s)}function nf(n,s){s===0&&((n.mode&1)===0?s=1:(s=xa,xa<<=1,(xa&130023424)===0&&(xa=4194304)));var l=Gt();n=ni(n,s),n!==null&&(lr(n,s,l),Zt(n,l))}function jg(n){var s=n.memoizedState,l=0;s!==null&&(l=s.retryLane),nf(n,l)}function Fg(n,s){var l=0;switch(n.tag){case 13:var u=n.stateNode,y=n.memoizedState;y!==null&&(l=y.retryLane);break;case 19:u=n.stateNode;break;default:throw Error(t(314))}u!==null&&u.delete(s),nf(n,l)}var sf;sf=function(n,s,l){if(n!==null)if(n.memoizedProps!==s.pendingProps||Yt.current)Qt=!0;else{if((n.lanes&l)===0&&(s.flags&128)===0)return Qt=!1,Ag(n,s,l);Qt=(n.flags&131072)!==0}else Qt=!1,nt&&(s.flags&1048576)!==0&&jh(s,Ga,s.index);switch(s.lanes=0,s.tag){case 2:var u=s.type;so(n,s),n=s.pendingProps;var y=Rs(s,Ft.current);Ds(s,l),y=Zl(null,s,u,n,y,l);var b=ec();return s.flags|=1,typeof y=="object"&&y!==null&&typeof y.render=="function"&&y.$$typeof===void 0?(s.tag=1,s.memoizedState=null,s.updateQueue=null,Xt(u)?(b=!0,Ba(s)):b=!1,s.memoizedState=y.state!==null&&y.state!==void 0?y.state:null,$l(s),y.updater=no,s.stateNode=y,y._reactInternals=s,ac(s,u,n,l),s=dc(null,s,u,!0,b,l)):(s.tag=0,nt&&b&&jl(s),Ht(null,s,y,l),s=s.child),s;case 16:u=s.elementType;e:{switch(so(n,s),n=s.pendingProps,y=u._init,u=y(u._payload),s.type=u,y=s.tag=qg(u),n=Nn(u,n),y){case 0:s=cc(null,s,u,n,l);break e;case 1:s=_u(null,s,u,n,l);break e;case 11:s=Au(null,s,u,n,l);break e;case 14:s=Cu(null,s,u,Nn(u.type,n),l);break e}throw Error(t(306,u,""))}return s;case 0:return u=s.type,y=s.pendingProps,y=s.elementType===u?y:Nn(u,y),cc(n,s,u,y,l);case 1:return u=s.type,y=s.pendingProps,y=s.elementType===u?y:Nn(u,y),_u(n,s,u,y,l);case 3:e:{if(Nu(s),n===null)throw Error(t(387));u=s.pendingProps,b=s.memoizedState,y=b.element,Uh(n,s),Ya(s,u,null,l);var S=s.memoizedState;if(u=S.element,b.isDehydrated)if(b={element:u,isDehydrated:!1,cache:S.cache,pendingSuspenseBoundaries:S.pendingSuspenseBoundaries,transitions:S.transitions},s.updateQueue.baseState=b,s.memoizedState=b,s.flags&256){y=js(Error(t(423)),s),s=Pu(n,s,u,l,y);break e}else if(u!==y){y=js(Error(t(424)),s),s=Pu(n,s,u,l,y);break e}else for(hn=Ai(s.stateNode.containerInfo.firstChild),dn=s,nt=!0,_n=null,l=Gh(s,null,u,l),s.child=l;l;)l.flags=l.flags&-3|4096,l=l.sibling;else{if(Ps(),u===y){s=si(n,s,l);break e}Ht(n,s,u,l)}s=s.child}return s;case 5:return Kh(s),n===null&&ql(s),u=s.type,y=s.pendingProps,b=n!==null?n.memoizedProps:null,S=y.children,Nl(u,y)?S=null:b!==null&&Nl(u,b)&&(s.flags|=32),Ru(n,s),Ht(n,s,S,l),s.child;case 6:return n===null&&ql(s),null;case 13:return Mu(n,s,l);case 4:return Vl(s,s.stateNode.containerInfo),u=s.pendingProps,n===null?s.child=Ms(s,null,u,l):Ht(n,s,u,l),s.child;case 11:return u=s.type,y=s.pendingProps,y=s.elementType===u?y:Nn(u,y),Au(n,s,u,y,l);case 7:return Ht(n,s,s.pendingProps,l),s.child;case 8:return Ht(n,s,s.pendingProps.children,l),s.child;case 12:return Ht(n,s,s.pendingProps.children,l),s.child;case 10:e:{if(u=s.type._context,y=s.pendingProps,b=s.memoizedProps,S=y.value,Qe($a,u._currentValue),u._currentValue=S,b!==null)if(Rn(b.value,S)){if(b.children===y.children&&!Yt.current){s=si(n,s,l);break e}}else for(b=s.child,b!==null&&(b.return=s);b!==null;){var P=b.dependencies;if(P!==null){S=b.child;for(var D=P.firstContext;D!==null;){if(D.context===u){if(b.tag===1){D=ii(-1,l&-l),D.tag=2;var U=b.updateQueue;if(U!==null){U=U.shared;var ie=U.pending;ie===null?D.next=D:(D.next=ie.next,ie.next=D),U.pending=D}}b.lanes|=l,D=b.alternate,D!==null&&(D.lanes|=l),zl(b.return,l,s),P.lanes|=l;break}D=D.next}}else if(b.tag===10)S=b.type===s.type?null:b.child;else if(b.tag===18){if(S=b.return,S===null)throw Error(t(341));S.lanes|=l,P=S.alternate,P!==null&&(P.lanes|=l),zl(S,l,s),S=b.sibling}else S=b.child;if(S!==null)S.return=b;else for(S=b;S!==null;){if(S===s){S=null;break}if(b=S.sibling,b!==null){b.return=S.return,S=b;break}S=S.return}b=S}Ht(n,s,y.children,l),s=s.child}return s;case 9:return y=s.type,u=s.pendingProps.children,Ds(s,l),y=bn(y),u=u(y),s.flags|=1,Ht(n,s,u,l),s.child;case 14:return u=s.type,y=Nn(u,s.pendingProps),y=Nn(u.type,y),Cu(n,s,u,y,l);case 15:return Tu(n,s,s.type,s.pendingProps,l);case 17:return u=s.type,y=s.pendingProps,y=s.elementType===u?y:Nn(u,y),so(n,s),s.tag=1,Xt(u)?(n=!0,Ba(s)):n=!1,Ds(s,l),yu(s,u,y),ac(s,u,y,l),dc(null,s,u,!0,n,l);case 19:return Du(n,s,l);case 22:return Eu(n,s,l)}throw Error(t(156,s.tag))};function rf(n,s){return jn(n,s)}function Og(n,s,l,u){this.tag=n,this.key=l,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=s,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=u,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function kn(n,s,l,u){return new Og(n,s,l,u)}function Nc(n){return n=n.prototype,!(!n||!n.isReactComponent)}function qg(n){if(typeof n=="function")return Nc(n)?1:0;if(n!=null){if(n=n.$$typeof,n===X)return 11;if(n===z)return 14}return 2}function Li(n,s){var l=n.alternate;return l===null?(l=kn(n.tag,s,n.key,n.mode),l.elementType=n.elementType,l.type=n.type,l.stateNode=n.stateNode,l.alternate=n,n.alternate=l):(l.pendingProps=s,l.type=n.type,l.flags=0,l.subtreeFlags=0,l.deletions=null),l.flags=n.flags&14680064,l.childLanes=n.childLanes,l.lanes=n.lanes,l.child=n.child,l.memoizedProps=n.memoizedProps,l.memoizedState=n.memoizedState,l.updateQueue=n.updateQueue,s=n.dependencies,l.dependencies=s===null?null:{lanes:s.lanes,firstContext:s.firstContext},l.sibling=n.sibling,l.index=n.index,l.ref=n.ref,l}function go(n,s,l,u,y,b){var S=2;if(u=n,typeof n=="function")Nc(n)&&(S=1);else if(typeof n=="string")S=5;else e:switch(n){case N:return ns(l.children,y,b,s);case I:S=8,y|=8;break;case G:return n=kn(12,l,s,y|2),n.elementType=G,n.lanes=b,n;case oe:return n=kn(13,l,s,y),n.elementType=oe,n.lanes=b,n;case le:return n=kn(19,l,s,y),n.elementType=le,n.lanes=b,n;case Q:return yo(l,y,b,s);default:if(typeof n=="object"&&n!==null)switch(n.$$typeof){case F:S=10;break e;case B:S=9;break e;case X:S=11;break e;case z:S=14;break e;case K:S=16,u=null;break e}throw Error(t(130,n==null?n:typeof n,""))}return s=kn(S,l,s,y),s.elementType=n,s.type=u,s.lanes=b,s}function ns(n,s,l,u){return n=kn(7,n,u,s),n.lanes=l,n}function yo(n,s,l,u){return n=kn(22,n,u,s),n.elementType=Q,n.lanes=l,n.stateNode={isHidden:!1},n}function Pc(n,s,l){return n=kn(6,n,null,s),n.lanes=l,n}function Mc(n,s,l){return s=kn(4,n.children!==null?n.children:[],n.key,s),s.lanes=l,s.stateNode={containerInfo:n.containerInfo,pendingChildren:null,implementation:n.implementation},s}function Bg(n,s,l,u,y){this.tag=s,this.containerInfo=n,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=rl(0),this.expirationTimes=rl(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=rl(0),this.identifierPrefix=u,this.onRecoverableError=y,this.mutableSourceEagerHydrationData=null}function Ic(n,s,l,u,y,b,S,P,D){return n=new Bg(n,s,l,P,D),s===1?(s=1,b===!0&&(s|=8)):s=0,b=kn(3,null,null,s),n.current=b,b.stateNode=n,b.memoizedState={element:u,isDehydrated:l,cache:null,transitions:null,pendingSuspenseBoundaries:null},$l(b),n}function Wg(n,s,l){var u=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:M,key:u==null?null:""+u,children:n,containerInfo:s,implementation:l}}function af(n){if(!n)return Ti;n=n._reactInternals;e:{if(ln(n)!==n||n.tag!==1)throw Error(t(170));var s=n;do{switch(s.tag){case 3:s=s.stateNode.context;break e;case 1:if(Xt(s.type)){s=s.stateNode.__reactInternalMemoizedMergedChildContext;break e}}s=s.return}while(s!==null);throw Error(t(171))}if(n.tag===1){var l=n.type;if(Xt(l))return Ih(n,l,s)}return s}function of(n,s,l,u,y,b,S,P,D){return n=Ic(l,u,!0,n,y,b,S,P,D),n.context=af(null),l=n.current,u=Gt(),y=Ii(l),b=ii(u,y),b.callback=s??null,_i(l,b,y),n.current.lanes=y,lr(n,y,u),Zt(n,u),n}function wo(n,s,l,u){var y=s.current,b=Gt(),S=Ii(y);return l=af(l),s.context===null?s.context=l:s.pendingContext=l,s=ii(b,S),s.payload={element:n},u=u===void 0?null:u,u!==null&&(s.callback=u),n=_i(y,s,S),n!==null&&(In(n,y,S,b),Ka(n,y,S)),S}function bo(n){if(n=n.current,!n.child)return null;switch(n.child.tag){case 5:return n.child.stateNode;default:return n.child.stateNode}}function lf(n,s){if(n=n.memoizedState,n!==null&&n.dehydrated!==null){var l=n.retryLane;n.retryLane=l!==0&&l<s?l:s}}function Dc(n,s){lf(n,s),(n=n.alternate)&&lf(n,s)}function Hg(){return null}var cf=typeof reportError=="function"?reportError:function(n){console.error(n)};function Lc(n){this._internalRoot=n}vo.prototype.render=Lc.prototype.render=function(n){var s=this._internalRoot;if(s===null)throw Error(t(409));wo(n,s,null,null)},vo.prototype.unmount=Lc.prototype.unmount=function(){var n=this._internalRoot;if(n!==null){this._internalRoot=null;var s=n.containerInfo;Zi(function(){wo(null,n,null,null)}),s[Jn]=null}};function vo(n){this._internalRoot=n}vo.prototype.unstable_scheduleHydration=function(n){if(n){var s=Ud();n={blockedOn:null,target:n,priority:s};for(var l=0;l<xi.length&&s!==0&&s<xi[l].priority;l++);xi.splice(l,0,n),l===0&&Kd(n)}};function jc(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11)}function xo(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11&&(n.nodeType!==8||n.nodeValue!==" react-mount-point-unstable "))}function df(){}function Gg(n,s,l,u,y){if(y){if(typeof u=="function"){var b=u;u=function(){var U=bo(S);b.call(U)}}var S=of(s,u,n,0,null,!1,!1,"",df);return n._reactRootContainer=S,n[Jn]=S.current,kr(n.nodeType===8?n.parentNode:n),Zi(),S}for(;y=n.lastChild;)n.removeChild(y);if(typeof u=="function"){var P=u;u=function(){var U=bo(D);P.call(U)}}var D=Ic(n,0,!1,null,null,!1,!1,"",df);return n._reactRootContainer=D,n[Jn]=D.current,kr(n.nodeType===8?n.parentNode:n),Zi(function(){wo(s,D,l,u)}),D}function ko(n,s,l,u,y){var b=l._reactRootContainer;if(b){var S=b;if(typeof y=="function"){var P=y;y=function(){var D=bo(S);P.call(D)}}wo(s,S,n,y)}else S=Gg(l,s,n,y,u);return bo(S)}Gd=function(n){switch(n.tag){case 3:var s=n.stateNode;if(s.current.memoizedState.isDehydrated){var l=or(s.pendingLanes);l!==0&&(al(s,l|1),Zt(s,at()),(We&6)===0&&(qs=at()+500,Ei()))}break;case 13:Zi(function(){var u=ni(n,1);if(u!==null){var y=Gt();In(u,n,1,y)}}),Dc(n,1)}},ol=function(n){if(n.tag===13){var s=ni(n,134217728);if(s!==null){var l=Gt();In(s,n,134217728,l)}Dc(n,134217728)}},zd=function(n){if(n.tag===13){var s=Ii(n),l=ni(n,s);if(l!==null){var u=Gt();In(l,n,s,u)}Dc(n,s)}},Ud=function(){return Ue},$d=function(n,s){var l=Ue;try{return Ue=n,s()}finally{Ue=l}},ar=function(n,s,l){switch(s){case"input":if(De(n,l),s=l.name,l.type==="radio"&&s!=null){for(l=n;l.parentNode;)l=l.parentNode;for(l=l.querySelectorAll("input[name="+JSON.stringify(""+s)+'][type="radio"]'),s=0;s<l.length;s++){var u=l[s];if(u!==n&&u.form===n.form){var y=Oa(u);if(!y)throw Error(t(90));ft(u),De(u,y)}}}break;case"textarea":gt(n,l);break;case"select":s=l.value,s!=null&&Xe(n,!!l.multiple,s,!1)}},ma=Ec,ga=Zi;var zg={usingClientEntryPoint:!1,Events:[Cr,Ts,Oa,fa,pa,Ec]},qr={findFiberByHostInstance:Ui,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},Ug={bundleType:qr.bundleType,version:qr.version,rendererPackageName:qr.rendererPackageName,rendererConfig:qr.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:E.ReactCurrentDispatcher,findHostInstanceByFiber:function(n){return n=el(n),n===null?null:n.stateNode},findFiberByHostInstance:qr.findFiberByHostInstance||Hg,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var So=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!So.isDisabled&&So.supportsFiber)try{ba=So.inject(Ug),Fn=So}catch{}}return tn.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=zg,tn.createPortal=function(n,s){var l=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!jc(s))throw Error(t(200));return Wg(n,s,null,l)},tn.createRoot=function(n,s){if(!jc(n))throw Error(t(299));var l=!1,u="",y=cf;return s!=null&&(s.unstable_strictMode===!0&&(l=!0),s.identifierPrefix!==void 0&&(u=s.identifierPrefix),s.onRecoverableError!==void 0&&(y=s.onRecoverableError)),s=Ic(n,1,!1,null,null,l,!1,u,y),n[Jn]=s.current,kr(n.nodeType===8?n.parentNode:n),new Lc(s)},tn.findDOMNode=function(n){if(n==null)return null;if(n.nodeType===1)return n;var s=n._reactInternals;if(s===void 0)throw typeof n.render=="function"?Error(t(188)):(n=Object.keys(n).join(","),Error(t(268,n)));return n=el(s),n=n===null?null:n.stateNode,n},tn.flushSync=function(n){return Zi(n)},tn.hydrate=function(n,s,l){if(!xo(s))throw Error(t(200));return ko(null,n,s,!0,l)},tn.hydrateRoot=function(n,s,l){if(!jc(n))throw Error(t(405));var u=l!=null&&l.hydratedSources||null,y=!1,b="",S=cf;if(l!=null&&(l.unstable_strictMode===!0&&(y=!0),l.identifierPrefix!==void 0&&(b=l.identifierPrefix),l.onRecoverableError!==void 0&&(S=l.onRecoverableError)),s=of(s,null,n,1,l??null,y,!1,b,S),n[Jn]=s.current,kr(n),u)for(n=0;n<u.length;n++)l=u[n],y=l._getVersion,y=y(l._source),s.mutableSourceEagerHydrationData==null?s.mutableSourceEagerHydrationData=[l,y]:s.mutableSourceEagerHydrationData.push(l,y);return new vo(s)},tn.render=function(n,s,l){if(!xo(s))throw Error(t(200));return ko(null,n,s,!1,l)},tn.unmountComponentAtNode=function(n){if(!xo(n))throw Error(t(40));return n._reactRootContainer?(Zi(function(){ko(null,null,n,!1,function(){n._reactRootContainer=null,n[Jn]=null})}),!0):!1},tn.unstable_batchedUpdates=Ec,tn.unstable_renderSubtreeIntoContainer=function(n,s,l,u){if(!xo(l))throw Error(t(200));if(n==null||n._reactInternals===void 0)throw Error(t(38));return ko(n,s,l,!1,u)},tn.version="18.3.1-next-f1338f8080-20240426",tn}var vf;function e0(){if(vf)return Bc.exports;vf=1;function h(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(h)}catch(e){console.error(e)}}return h(),Bc.exports=Zg(),Bc.exports}var xf;function t0(){if(xf)return Ao;xf=1;var h=e0();return Ao.createRoot=h.createRoot,Ao.hydrateRoot=h.hydrateRoot,Ao}var n0=t0();const i0=ud(n0),Gc=0,nn={oath:{name:"Oath to Order",type:"Spell",description:`4th-level evocation (ritual).
Casting Time: 1 minute
Range: Self
Components: V (Song), M (Guardian Masks)

When cast at the top of the Clock Tower, simultaneously frees all four divine guardian giants from the cursed forms imposed by Majora's Mask, then teleports them to you.`},sonata:{name:"Sonata of Awakening",type:"Spell",description:`1st-level abjuration (ritual).
Casting Time: 2 minutes
Range: 60 feet

You end the unconscious condition on one creature within range. This can also force a meditating, sleeping, or unconscious creature out of astral projection.`},goron:{name:"Goron Lullaby",type:"Spell",description:`1st-level enchantment (ritual).
Casting Time: 2 minutes
Range: 60 feet

Sends creatures into a magical slumber. A creature must succeed a Wisdom saving throw or fall unconscious. Undead/immune creatures are unaffected.`},bossa:{name:"New Wave Bossa Nova",type:"Spell",description:`1st-level abjuration (ritual).
Casting Time: 2 minutes
Range: 60 feet

You end one psychological condition, such as charmed or frightened, affecting a creature within range.`},elegy:{name:"Elegy of Emptiness",type:"Spell",description:`5th-level illusion (ritual).
Casting Time: 2 minutes
Range: Self

You leave behind a statue that resembles you. It has half your HP and takes damage for you. Only one statue active at a time.`},storms:{name:"Song of Storms",type:"Spell",description:`2nd-level transmutation (ritual).
Casting Time: 2 minutes
Range: 1 mile

Changes weather conditions, creating or ending a storm within 1d4 x 5 minutes.`}},Y={odolwaRemains:{name:"Odolwa's Remains",type:"Item",description:"The mask containing the corrupted spirit of the Swamp Guardian."},gohtRemains:{name:"Goht's Remains",type:"Item",description:"The mask containing the corrupted spirit of the Mountain Guardian."},gyorgRemains:{name:"Gyorg's Remains",type:"Item",description:"The mask containing the corrupted spirit of the Ocean Guardian."},twinmoldRemains:{name:"Twinmold's Remains",type:"Item",description:"The mask containing the corrupted spirit of the Canyon Guardian."},dekuMask:{name:"Deku Mask",type:"Mask",description:"Allows the wearer to transform into a Deku Scrub. Grants proficiency with woodwinds."},goronMask:{name:"Goron Mask",type:"Mask",description:"Allows the wearer to transform into a Goron. Grants proficiency with drums."},zoraMask:{name:"Zora Mask",type:"Mask",description:"Allows the wearer to transform into a Zora."},bremenMask:{name:"Bremen Mask",type:"Mask",description:"Small animals follow you while you play music. Attunement allows casting animal friendship/messenger at will."},blastMask:{name:"Blast Mask",type:"Mask",description:"Action to explode (4d6 fire + 1d6 piercing to self/others). Attunement reduces self damage."},allNightMask:{name:"All-Night Mask",type:"Mask",description:"Shortens rests. Attunement grants immunity to sleep/unconscious conditions."},kafeiMask:{name:"Kafei's Mask",type:"Mask",description:"Learn details about Kafei. Attunement allows locating him."},kamaroMask:{name:"Kamaro's Mask",type:"Mask",description:"Dance like Kamaro. Attunement charms viewers."},keatonMask:{name:"Keaton Mask",type:"Mask",description:"Summon/confuse Keatons. Attunement allows entering border ethereal."},garoMask:{name:"Garo's Mask",type:"Mask",description:"+2 Stealth. Summon a Garo ally once per day."},romaniMask:{name:"Romani's Mask",type:"Mask",description:"Doubles potion effects. Attunement allows enchanting milk into healing potions."},troupeMask:{name:"Troupe Leader's Mask",type:"Mask",description:"Disadvantage on target's attacks. Attunement stops target from attacking."},stoneMask:{name:"Stone Mask",type:"Mask",description:"Advantage on Stealth. Attunement grants invisibility while motionless."},postmanHat:{name:"Postman's Hat",type:"Mask",description:"Open mailboxes. Attunement allows double actions."},bunnyHood:{name:"Bunny Hood",type:"Mask",description:"Doubles speed. Attunement triples speed."},couplesMask:{name:"Couple's Mask",type:"Mask",description:"Cast calm emotions. Attunement charms people."},maskOfTruth:{name:"Mask of Truth",type:"Mask",description:"Speak with Gossip Stones/Animals. Read minds."},maskOfScents:{name:"Mask of Scents",type:"Mask",description:"Advantage on smell checks. Find mushrooms."},donGeroMask:{name:"Don Gero's Mask",type:"Mask",description:"Speak with frogs. Conduct choir."},gibdoMask:{name:"Gibdo Mask",type:"Mask",description:"Friendly with Gibdos/Redeads. Command them."},captainsHat:{name:"Captain's Hat",type:"Mask",description:"Friendly with Stalfos. Command them."},bottle:{name:"Magic Bottle",type:"Item",description:"Indestructible container that preserves contents indefinitely. Can hold creatures/souls."},heart:{name:"Piece of Heart",type:"Item",description:"Collect 4 to create a Heart Container (40 Temp HP)."},moonsTear:{name:"Moon's Tear",type:"Item",description:"Arcane focus. Restores mana or spell slots."},lensOfTruth:{name:"Lens of Truth",type:"Item",description:"See through illusions and invisible objects."},goldDust:{name:"Gold Dust",type:"Item",description:"Fine Goron gold dust. Used for forging."},gildedSword:{name:"Gilded Sword",type:"Item",description:"Permanent upgrade. +2 to attack/damage."},mirrorShield:{name:"Mirror Shield",type:"Item",description:"A legendary shield that can reflect light and energy."}},dt=(h,e)=>{const[t,i]=e.split(":").map(Number);let r=t;t<6&&(r=t+24);const a=(r-6)*60+i;return(h-1)*24*60+a},an=h=>{const[e,t]=h.split(":").map(Number),i=e>=12&&e<24?"pm":"am",r=e%12||12;return t>0?`${r}:${t.toString().padStart(2,"0")}${i}`:`${r}${i}`},kf=h=>{const t=h%1440+360,i=Math.floor(t/60)%24,r=t%60;return`${i.toString().padStart(2,"0")}:${r.toString().padStart(2,"0")}`},Ct=(h,e,t,i,r,a,o,c,d,f=[1,2,3],p)=>f.map(g=>({id:`${h}-d${g}`,day:g,timeDisplay:an(i),sortTime:dt(g,i),endTime:dt(g,r),title:e,description:t,region:a,location:o,category:c,relatedId:d,pageReference:p})),op=(h,e,t,i=[])=>{const r=e.flatMap(c=>{if(!c.scheduleEvents||c.scheduleEvents.length===0)return c.defaultActivity?[1,2,3].map(f=>({id:`npc-${c.id}-downtime-d${f}`,day:f,timeDisplay:"All Day",sortTime:dt(f,"06:00"),endTime:dt(f+1,"06:00"),title:c.defaultActivity,description:"Downtime / Routine",region:c.locationRegion,location:c.defaultLocation||c.locationSpecific,category:"NPC Schedule",relatedId:c.id,isDowntime:!0})):[];const d=[];if(c.scheduleEvents.forEach((f,p)=>{(f.day==="All"?[1,2,3]:[f.day]).forEach(w=>{const x=dt(w,f.start),k=dt(w,f.end);d.push({id:`npc-${c.id}-${w}-${p}`,day:w,timeDisplay:an(f.start),sortTime:x,endTime:k,title:f.title,description:f.description,region:c.locationRegion,location:f.location,category:"NPC Schedule",relatedId:c.id,condition:f.condition})})}),c.defaultActivity)for(let f=1;f<=3;f++){const p=dt(f,"06:00"),g=dt(f===3?4:f+1,"06:00"),w=d.filter(k=>k.day===f).sort((k,v)=>k.sortTime-v.sortTime);let x=p;w.forEach(k=>{k.sortTime>x&&d.push({id:`npc-${c.id}-downtime-d${f}-${x}`,day:f,timeDisplay:an(kf(x)),sortTime:x,endTime:k.sortTime,title:c.defaultActivity,description:"Downtime / Routine",region:c.locationRegion,location:c.defaultLocation||c.locationSpecific,category:"NPC Schedule",relatedId:c.id,isDowntime:!0}),k.endTime&&k.endTime>x&&(x=k.endTime)}),x<g&&d.push({id:`npc-${c.id}-downtime-d${f}-end`,day:f,timeDisplay:an(kf(x)),sortTime:x,endTime:g,title:c.defaultActivity,description:"Downtime / Routine",region:c.locationRegion,location:c.defaultLocation||c.locationSpecific,category:"NPC Schedule",relatedId:c.id,isDowntime:!0})}return d}),a=[];t.forEach(c=>{c.steps.forEach((d,f)=>{const p=!!((d.day||d.days&&d.days.length>0)&&d.time);let g=[],w="",x="",k="";p?(g=d.days?d.days:d.day?[d.day]:[],w=d.time,x=d.endTime||"",k=an(d.time)):(d.day||d.days&&d.days.length>0)&&(g=d.days?d.days:d.day?[d.day]:[],w="06:00",x="20:00",k="Any Time"),g.forEach(v=>{const A=dt(v,w);let C=A+120;x&&(C=dt(v,x));const T=`${c.id}-step-${f}-d${v}`;a.push({id:T,day:v,timeDisplay:k,sortTime:A,endTime:C,title:d.title,description:d.description,region:c.region,location:d.location,category:c.isMainQuest?"Main Quest":"Side Quest",relatedId:c.id,condition:d.prerequisiteStepId?{type:"requires_step",stepId:d.prerequisiteStepId}:void 0,pageReference:d.pageReference})})})});const o=i.flatMap(c=>Ct(`shop-${c.id}`,c.name,c.description,c.openingTime,c.closingTime,c.region,c.location,"Business"));return[...h,...r,...a,...o].sort((c,d)=>c.sortTime-d.sortTime)};var q=(h=>(h.ClockTown="Clock Town",h.TerminaField="Termina Field",h.SouthernSwamp="Southern Swamp",h.NorthernMountain="Northern Mountain",h.WesternSea="Western Sea",h.EasternCanyon="Eastern Canyon",h.World="World Events",h))(q||{});const li=[{id:"mayor-dotour",name:"Mayor Chouchou Dotour",icon:"icons/Mayor Dotour.png",locationRegion:q.ClockTown,locationSpecific:"Mayor's Office",description:"Once a much more prominent figure in the political and social life of the city, Mayor Dotour has been gradually worn down by the pressure of his work into a weak and vacillating man caught between the frequent arguments of the town council. Despite this he remains a kind man, concerned for the well being of his citizens.",schedule:`10:00 am-8:00 pm: Mayor's Office.
8:00 pm-10:00 am At the Mayor's Residence.`,defaultActivity:"Sleeping/Resting",defaultLocation:"Mayor's Residence",pages:"14",quests:["q25","q10"],connections:["Madame Aroma","Kafei","Mutoh","Viscen"],wikiLink:"https://zelda.fandom.com/wiki/Mayor_Dotour",scheduleEvents:[{day:"All",start:"10:00",end:"20:00",location:"Mayor's Office",title:"Mayor's Meeting",description:"Stuck in a political debate."},{day:"All",start:"20:00",end:"06:00",location:"Mayor's Residence",title:"Resting",description:"At home with family."}]},{id:"kafei",name:"Kafei Dotour",icon:"icons/Kafei.png",locationRegion:q.ClockTown,locationSpecific:"Curiosity Shop Backroom",description:"The son of the mayor, Kafei is well connected and well educated. A debonair young man, Kafei was Clock Towns most eligible bachelor before his engagement to Anju. After the engagement though, Kafei disappeared. The truth of the matter is that Kafei was cursed by the Skull Kid, transformed into a child, and has been hiding out in the back room of the Curiosity Shop, owned by Gerant Mann, a childhood friend. Kafei loves Anju deeply, but is ashamed of what happened and refuses to face her until he has recovered the wedding mask that was stolen from him.",schedule:`Day 1-2: Backroom (Watching).
Day 2 3:25 pm: Laundry Pool (Receives Letter).
Day 2 12:30 am: Chases Sakon.
Day 3 6:00 pm: Ikana Canyon (Waiting).`,defaultActivity:"Hiding/Watching",defaultLocation:"Curiosity Shop Backroom",pages:"16",quests:["q24","q10"],connections:["Anju","Madame Aroma","Gerant Mann"],wikiLink:"https://zelda.fandom.com/wiki/Kafei",scheduleEvents:[{day:1,start:"06:00",end:"07:00",location:"South Clock Town",title:"Deposits Letter",description:"Mailing letter to Anju."},{day:1,start:"07:00",end:"06:00",location:"Curiosity Shop",title:"Kafei Hiding",description:"Watching Curiosity Shop."},{day:2,start:"06:00",end:"15:30",location:"Curiosity Shop",title:"Kafei Hiding",description:"Watching Curiosity Shop."},{day:2,start:"15:30",end:"16:30",location:"Laundry Pool",title:"Kafei Checks Mail",description:"Receives Anju's letter."},{day:2,start:"00:30",end:"06:00",location:"Termina Field",title:"Kafei Chases Sakon",description:"Follows thief to Ikana.",condition:{type:"requires_step_not",stepId:"q14-1"}},{day:3,start:"06:00",end:"18:00",location:"Ikana Canyon",title:"Kafei Camps Out",description:"Waiting at Sakon's Hideout.",condition:{type:"requires_step_not",stepId:"q14-1"}},{day:3,start:"06:00",end:"06:00",location:"Curiosity Shop",title:"Kafei Stuck",description:"Hiding in backroom, missed his chance.",condition:{type:"requires_step",stepId:"q14-1"}}]},{id:"viscen",name:"Captain Royale Viscen",icon:"icons/Viscen.png",locationRegion:q.ClockTown,locationSpecific:"Mayor's Office",description:"Captain Viscen is the captain of the town guard and their foremost recruiter, he is a dutiful public servant genuinely concerned with the wellbeing of the citizens. In the face of the crashing moon, Viscen has been advocating for a total evacuation of the city.",schedule:`Afternoons: Mayor's Office (Arguing).
Evenings: Patrol/Home.`,defaultActivity:"Patrolling",defaultLocation:"Clock Town",pages:"16",quests:["q25","q37"],connections:["Mayor Dotour","Mutoh"],wikiLink:"https://zelda.fandom.com/wiki/Viscen",scheduleEvents:[{day:"All",start:"12:00",end:"18:00",location:"Mayor's Office",title:"Council Meeting",description:"Arguing for evacuation."},{day:"All",start:"18:00",end:"22:00",location:"Clock Town",title:"Evening Patrol",description:"Checking the guards."}]},{id:"mutoh",name:"Mutoh Tek",icon:"icons/Mutoh.png",locationRegion:q.ClockTown,locationSpecific:"Mayor's Office",description:"The head of the Clock Town Carnival Committee, Mutoh is stubborn, short-tempered, and belligerent. In the face of the falling moon, Mutoh has decided that the whole thing is overblown and that the carnival is too important a tradition to abandon. Mutoh has a family that have all already fled town.",schedule:`Afternoons: Mayor's Office (Arguing).
Otherwise: Carnival Site.`,defaultActivity:"Supervising Construction",defaultLocation:"South Clock Town",pages:"16",quests:["q25"],connections:["Mayor Dotour","Viscen"],wikiLink:"https://zelda.fandom.com/wiki/Mutoh",scheduleEvents:[{day:"All",start:"12:00",end:"18:00",location:"Mayor's Office",title:"Council Meeting",description:"Arguing against evacuation."},{day:"All",start:"06:00",end:"12:00",location:"South Clock Town",title:"Supervising",description:"Yelling at workers."},{day:"All",start:"18:00",end:"06:00",location:"South Clock Town",title:"Supervising",description:"Yelling at workers."}]},{id:"postman",name:"Cartero Postier (Postman)",icon:"icons/Postman.png",locationRegion:q.ClockTown,locationSpecific:"Post Office",description:"Perhaps the most dedicated civil servant in Termina, Postier the postman has no social life and no real interest in anything except the timely delivery of mail. He may not even take action unless it is within the strict bounds of his schedule.",schedule:`9:00 am-12:00 pm Collecting Mail.
1:00 pm-3:00 pm Delivering Mail.
3:00 pm Training (Post Office).
Day 2 12:00 am: Mails Letter (S. Clock Town).
Day 3 6:00 pm: Milk Bar (Delivery).`,defaultActivity:"Resting/Training",defaultLocation:"Post Office",pages:"16",quests:["q12","q27","q24"],connections:["Madame Aroma"],wikiLink:"https://zelda.fandom.com/wiki/Postman",scheduleEvents:[{day:1,start:"09:00",end:"12:00",location:"Clock Town",title:"Postman Collection",description:"Collecting mail from boxes."},{day:1,start:"13:00",end:"15:00",location:"Clock Town",title:"Postman Delivery",description:"Delivering mail."},{day:1,start:"15:00",end:"24:00",location:"Post Office",title:"Postman Training",description:"Mental training."},{day:2,start:"09:00",end:"12:00",location:"Clock Town",title:"Postman Collection",description:"Collecting mail from boxes."},{day:2,start:"13:00",end:"15:00",location:"Clock Town",title:"Postman Delivery",description:"Delivering mail."},{day:2,start:"15:00",end:"24:00",location:"Post Office",title:"Postman Training",description:"Mental training."},{day:2,start:"00:00",end:"01:00",location:"South Clock Town",title:"Mailing Letter",description:"Mailing Anju's letter."},{day:3,start:"18:00",end:"06:00",location:"Post Office",title:"Postman Panics",description:"Waiting for permission to flee."}]},{id:"anju",name:"Anju Kokko",icon:"icons/Anju.png",locationRegion:q.ClockTown,locationSpecific:"Stock Pot Inn",description:"A young woman who inherited control of the stock pot inn after the death of her father, Tortus. She was planning to be married in only a few days, but her husband-to-be, Kafei, has recently disappeared. With this, caring for her elderly grandmother, the stress of planning the festival and the impending destruction from the moon, Anju has been frazzled and makes a lot of mistakes in the management of the inn.",schedule:`6:00 am-11:00 am Inn Desk.
11:00 am-1:00 pm Kitchen (Cooking).
1:00 pm-8:30 pm Inn Desk.
Day 1 11:30 pm: Kitchen (Meeting).
Day 2 9:30 pm: Employee Room (Talking w/ Mother).
Day 3 6:00 pm: Flees to Ranch.`,defaultActivity:"Resting/Sleeping",defaultLocation:"Stock Pot Inn (Room)",pages:"16",quests:["q24","q11","q15","q26"],connections:["Kafei","Cremia","Granmere Koko"],wikiLink:"https://zelda.fandom.com/wiki/Anju",scheduleEvents:[{day:1,start:"06:00",end:"11:00",location:"Stock Pot Inn",title:"Anju at Desk",description:"Working reception."},{day:1,start:"11:00",end:"12:00",location:"Stock Pot Inn Kitchen",title:"Anju Cooking",description:"Cooking lunch for Grandma."},{day:1,start:"12:00",end:"13:00",location:"Grandma's Room",title:"Serving Lunch",description:"Delivering food to Grandma."},{day:1,start:"13:00",end:"13:50",location:"Employee Room",title:"Lunch Break",description:"Taking a break."},{day:1,start:"13:50",end:"20:30",location:"Stock Pot Inn",title:"Anju at Desk",description:"Working reception."},{day:1,start:"23:30",end:"06:00",location:"Stock Pot Inn Kitchen",title:"Anju in Kitchen",description:"Waiting for Kafei's messenger."},{day:2,start:"06:00",end:"11:30",location:"Stock Pot Inn",title:"Anju at Desk",description:"Working reception."},{day:2,start:"11:30",end:"13:00",location:"East Clock Town",title:"Walking",description:"Taking a walk in the rain."},{day:2,start:"13:00",end:"13:50",location:"Stock Pot Inn",title:"Lunch Break",description:"Quick lunch."},{day:2,start:"13:50",end:"16:00",location:"Laundry Pool",title:"Thinking",description:"Sitting on the bench."},{day:2,start:"16:00",end:"20:30",location:"Stock Pot Inn",title:"Anju at Desk",description:"Working reception."},{day:2,start:"21:30",end:"06:00",location:"Employee Room",title:"Anju with Mother",description:"Talking in employee room."},{day:3,start:"06:00",end:"11:00",location:"Stock Pot Inn",title:"Anju at Desk",description:"Working reception."},{day:3,start:"11:00",end:"13:00",location:"Stock Pot Inn Kitchen",title:"Anju Cooking",description:"Cooking lunch."},{day:3,start:"13:00",end:"18:00",location:"Stock Pot Inn",title:"Anju at Desk",description:"Working reception."},{day:3,start:"18:00",end:"06:00",location:"Romani Ranch",title:"Anju Flees",description:"Goes to Romani Ranch with family.",condition:{type:"requires_step_not",stepId:"q24-5"}},{day:3,start:"18:00",end:"06:00",location:"Stock Pot Inn Room",title:"Anju Waiting",description:"Waiting for Kafei in her room.",condition:{type:"requires_step",stepId:"q24-5"}}]},{id:"granmere",name:"Granmere Koko",icon:"icons/Anjus Mother.png",locationRegion:q.ClockTown,locationSpecific:"Stock Pot Inn",description:"Anjus grandmother on her fathers side, Granmere is possibly one of the oldest individuals in all of Termina. She used to spend a lot of time in her better days taking care of all the children in Clock Town and became a master at telling bed time stories that are guaranteed to put kids to sleep. Granmere has started to fade in her old age and dementia has set in, which she is more than willing to exploit.",schedule:"All Day: Stock Pot Inn Room.",defaultActivity:"Sitting/Telling Stories",defaultLocation:"Stock Pot Inn (Room)",pages:"17",quests:["q26"],connections:["Anju"],wikiLink:"https://zelda.fandom.com/wiki/Anju%27s_Grandmother",scheduleEvents:[{day:1,start:"08:00",end:"20:00",location:"Stock Pot Inn",title:"Telling Stories",description:"Reading stories."},{day:2,start:"08:00",end:"20:00",location:"Stock Pot Inn",title:"Telling Stories",description:"Reading stories."},{day:3,start:"08:00",end:"18:00",location:"Stock Pot Inn",title:"Telling Stories",description:"Reading stories."},{day:3,start:"18:00",end:"06:00",location:"Romani Ranch",title:"Fleeing",description:"Taking refuge."}]},{id:"gerant",name:"Gerant Mann",icon:"icons/Shopkeeper.png",locationRegion:q.ClockTown,locationSpecific:"Curiosity Shop",description:"Gerant owns and operates the Curiosity Shop, a well-stocked pawn shop in the market district. His policy of not asking too many questions and broad range of contacts means he is also a fence for a lot of stolen goods. There are some hints though that he had secretly been working with Kafei to try and crack a local thieves ring.",schedule:"Night: Curiosity Shop.",defaultActivity:"Resting",defaultLocation:"Curiosity Shop Backroom",pages:"17",quests:["q24","q14"],connections:["Kafei","Sakon"],wikiLink:"https://zelda.fandom.com/wiki/Curiosity_Shop_Man",scheduleEvents:[{day:"All",start:"21:00",end:"06:00",location:"Curiosity Shop",title:"Working",description:"Manning the counter."}]},{id:"talon",name:"Talon Barten",icon:"icons/Barten.png",locationRegion:q.ClockTown,locationSpecific:"Milk Bar",description:"The owner of the Milk Bar and its main bartender. Mr. Barten has tied his life to his bar and he has no intention of abandoning it or leaving it looking anything short of spotless. He has a history with Anjus family and the late father of Cremia and Romani out in Romanis Ranch. This history with the latter may be why he opened a milk bar.",schedule:`12:00 pm-7:00 pm: Cleaning.
8:00 pm-4:00 am: Operating Bar.`,defaultActivity:"Sleeping/Preparing",defaultLocation:"Milk Bar",pages:"17",quests:["q22"],connections:["Gorman","Madame Aroma"],wikiLink:"https://zelda.fandom.com/wiki/Mr._Barten",scheduleEvents:[{day:"All",start:"10:00",end:"21:00",location:"Milk Bar",title:"Cleaning",description:"Cleaning the bar."},{day:"All",start:"22:00",end:"06:00",location:"Milk Bar",title:"Operating Bar",description:"Serving drinks."}]},{id:"tapis",name:"Tapis",icon:"icons/Swordsman.png",locationRegion:q.ClockTown,locationSpecific:"Swordsman's School",description:"A skilled swordsman who traveled to clock town and decided to open a school of swordsmanship. He is a brave fighter and a stern teacher. However, when faced with a threat he cant cut, like the moon crashing, he shows himself to be a complete coward.",schedule:`9:00 am-9:00 pm: Dojo.
Night: Back room.`,defaultActivity:"Hiding/Sleeping",defaultLocation:"Swordsman's School (Back)",pages:"18",quests:["q19"],connections:[],wikiLink:"https://zelda.fandom.com/wiki/Swordsman",scheduleEvents:[{day:"All",start:"09:00",end:"21:00",location:"Swordsman's School",title:"Teaching",description:"Training students."},{day:"All",start:"21:00",end:"09:00",location:"Swordsman's School",title:"Cowering",description:"Hiding in the back room."}]},{id:"propri",name:"Propri Bomba",icon:"icons/Bomb Shop Guy.png",locationRegion:q.ClockTown,locationSpecific:"Bomb Shop",description:"The owner and operator of the bomb shop, he is an expert in all things gunpowder. Also a bit of an inventor, he has been sketching out plans to use explosives to propel a vessel to the moon to try to find some way to stop it from crashing; or maybe just blow it up.",schedule:"10:00 am-11:00 pm: Bomb Shop.",defaultActivity:"Sleeping",defaultLocation:"Bomb Shop (Back)",pages:"18",quests:["q14"],connections:["Vieille Bomba"],wikiLink:"https://zelda.fandom.com/wiki/Bomb_Shop",scheduleEvents:[{day:"All",start:"10:00",end:"23:00",location:"Bomb Shop",title:"Working",description:"Selling bombs."}]},{id:"old-lady",name:"Vieille Bomba",icon:"icons/Bomb Lady.png",locationRegion:q.ClockTown,locationSpecific:"Bomb Shop",description:"The mother of the bomb shop owner. Despite her age she frequently makes trips to the northern mountains for black powder, weapons and other gear for sale in the bomb shop. Theres a running debate in town though if she is doing this because shes stubborn or if her son is inconsiderate.",schedule:`Day 1 12:00 am: N. Clock Town (Delivery/Robbery).
All Day: Bomb Shop.`,defaultActivity:"Working/Resting",defaultLocation:"Bomb Shop",pages:"18",quests:["q14"],connections:["Propri Bomba","Sakon"],wikiLink:"https://zelda.fandom.com/wiki/Old_Lady_from_Bomb_Shop",scheduleEvents:[{day:1,start:"00:00",end:"01:00",location:"North Clock Town",title:"Delivery",description:"Carrying heavy bomb bag."},{day:"All",start:"06:00",end:"22:00",location:"Bomb Shop",title:"Working",description:"Helping in the shop."}]},{id:"banker",name:"Banquier",icon:"icons/Banker.png",locationRegion:q.ClockTown,locationSpecific:"West Clock Town",description:"The proprietor of the clock town bank. A bit of a financial wild man, they have been throwing new ideas for the bank beyond simply holding and releasing money at the wall for a while now. Their fiscal bets have largely paid off and there is a sizable amount of rupees stored within the banks safe. Banquier doesnt seem to need to sleep and is always full of energy, some suspect that this is because of a boon from the great fairy",schedule:"All Day: Bank Counter.",defaultActivity:"Working (Sleepless)",defaultLocation:"Bank",pages:"18",quests:["q9"],connections:[],wikiLink:"https://zelda.fandom.com/wiki/Banker",scheduleEvents:[{day:"All",start:"06:00",end:"06:00",location:"Bank",title:"Working",description:"Slapping thighs and counting rupees."}]},{id:"toto",name:"Toto",icon:"icons/Toto.png",locationRegion:q.ClockTown,locationSpecific:"Milk Bar / Mayor's Residence",description:"Toto is only in town for a little while, coming up from the southern seas to discuss the arrangement of the performance for the band the Indigo-Gos. Unfortunately, as a consequence of the Skull Kids spate of curses, the bands lead singer, Lulu, has lost her voice and the band will have to cancel. The band was a big draw, and he spends the majority of his days in the Mayors residence talking with Madame Aroma who is trying to get his to at least get the rest of the band in. He spends his evenings in the Milk Bar, genuinely regretting not being able to bring the band in and have them perform.",schedule:`Day 1-2 10:00 am: Mayor's Residence (Meeting).
Day 1-2 10:00 pm: Milk Bar (Sound Check).`,defaultActivity:"Waiting/Wandering",defaultLocation:"Clock Town",pages:"18",quests:["q22"],connections:["Madame Aroma","Gorman"],wikiLink:"https://zelda.fandom.com/wiki/Toto",scheduleEvents:[{day:1,start:"10:00",end:"11:00",location:"Mayor's Residence",title:"Toto Meeting",description:"Discussing performance with Aroma."},{day:1,start:"22:00",end:"01:00",location:"Milk Bar",title:"Toto Sound Check",description:"Testing acoustics."},{day:2,start:"10:00",end:"11:00",location:"Mayor's Residence",title:"Toto Meeting",description:"Discussing performance with Aroma."},{day:2,start:"22:00",end:"01:00",location:"Milk Bar",title:"Toto Sound Check",description:"Testing acoustics."}]},{id:"jim",name:"Jim Verona",icon:"icons/Jim.png",locationRegion:q.ClockTown,locationSpecific:"North Clock Town",description:"A young boy that has managed to wrangle together the towns other children into the Bombers Secret Society of Justice assuming the leadership of the group after others aged out of it. Jim has decided that the bombers first need to get as much information as possible before taking action, so he has been directing all of his crew to keep their ears open for rumors and secrets.",schedule:`All Day: N. Clock Town (Popping Balloon).
Hide and Seek: All Clock Town.`,defaultActivity:"Patrolling/Hiding",defaultLocation:"North Clock Town",pages:"18",quests:["q7","q23"],connections:["Bombers"],wikiLink:"https://zelda.fandom.com/wiki/Jim",scheduleEvents:[{day:"All",start:"06:00",end:"20:00",location:"North Clock Town",title:"Bombers Practice",description:"Trying to pop the Majora Balloon."}]},{id:"gorman",name:"Inigo Gorman",icon:"icons/Gorman.png",locationRegion:q.ClockTown,locationSpecific:"East Clock Town",description:"The leader and founder of the troupe, Gorman has always struggled with depression and the stress of having his big performance that he expected would put his efforts on the map canceled, has sunk him into a deep funk. He splits his time between waiting to be seen at the mayors office to try and get his performers either bumped to a headline act, kept on as side performers, or at the very least paid; and drinking himself into a stupor at the bar.",schedule:`Day 1 10:00 am: Mayor's Office.
Day 1-2 10:00 pm: Milk Bar (Drinking).
Day 2 Day: Inn Room (Sulking).`,defaultActivity:"Sulking/Sleeping",defaultLocation:"Stock Pot Inn (Room)",pages:"19",quests:["q22","q23"],connections:["Gorman Bros","Madame Aroma","Toto"],wikiLink:"https://zelda.fandom.com/wiki/Gorman",scheduleEvents:[{day:1,start:"06:00",end:"10:00",location:"Stock Pot Inn Lobby",title:"Waiting",description:"Waiting for audience."},{day:1,start:"10:00",end:"12:00",location:"Mayor's Office",title:"Petitioning",description:"Trying to get an audience."},{day:1,start:"13:00",end:"22:00",location:"Milk Bar",title:"Drinking",description:"Day drinking."},{day:1,start:"22:00",end:"06:00",location:"Milk Bar",title:"Drinking",description:"Drowning sorrows."},{day:2,start:"06:00",end:"21:00",location:"Stock Pot Inn Room",title:"Sulking",description:"Lying in bed."},{day:2,start:"22:00",end:"06:00",location:"Milk Bar",title:"Drinking",description:"Drowning sorrows."}]},{id:"rosa-sisters",name:"The Rosa Sisters, Judo and Marilla",icon:"icons/Dancer Blue.png",locationRegion:q.ClockTown,locationSpecific:"West Clock Town",description:"Twin dancers and contortionists, lithe and beautiful. They are skilled performers but feel that their work is stale, and they are middling choreographers.",schedule:"Night 6:00 pm-6:00 am: West Clock Town (Practicing).",defaultActivity:"Resting",defaultLocation:"Stock Pot Inn (Room)",pages:"19",quests:["q31"],connections:["Gorman","Kamaro"],wikiLink:"https://zelda.fandom.com/wiki/Rosa_Sisters",scheduleEvents:[{day:"All",start:"06:00",end:"18:00",location:"Stock Pot Inn Room",title:"Thinking",description:"Pacing and thinking."},{day:"All",start:"18:00",end:"06:00",location:"West Clock Town",title:"Rosa Sisters Practice",description:"Practicing dance moves."}]},{id:"guru-guru",name:"Guru-Guru",icon:"icons/Guru Guru.png",locationRegion:q.ClockTown,locationSpecific:"Laundry Pool",description:"Guru-Guru is a composer and phonograph player for the Gorman Troupe. He usually seems like a very kind and friendly fellow, but he can also be deeply critical and jealous. He is of the private opinion that none of the other performers match up to his talent, especially the Rosa sisters.",schedule:`Day: Stock Pot Inn Room.
Night (6:00 pm-6:00 am): Laundry Pool (Practicing).`,defaultActivity:"Resting/Brooding",defaultLocation:"Stock Pot Inn (Room)",pages:"19",quests:["q13"],connections:["Gorman","Rosa Sisters"],wikiLink:"https://zelda.fandom.com/wiki/Guru-Guru",scheduleEvents:[{day:"All",start:"06:00",end:"18:00",location:"Stock Pot Inn Room",title:"Resting",description:"Staying in room."},{day:"All",start:"18:00",end:"06:00",location:"Laundry Pool",title:"Guru-Guru Practice",description:"Playing the Song of Storms."}]},{id:"jugglers",name:"Juggler Twins ('Red' and 'Blue')",icon:"icons/Juggler Blue.png",locationRegion:q.ClockTown,locationSpecific:"East Clock Town",description:"Red and Blue are jesters, jugglers, and clowns. Their act involves keeping balls in the air while setting each other up for punchlines and puns. Theyre also compulsive gossip mongers, listening to rumors to get material for their act.",schedule:`10:00 am-6:00 pm: East Clock Town (Practicing).
6:00 pm-12:00 am: Stock Pot Inn (Gambling).`,defaultActivity:"Sleeping",defaultLocation:"Stock Pot Inn (Room)",pages:"19",quests:[],connections:["Gorman"],wikiLink:"https://zelda.fandom.com/wiki/Juggler_Twins",scheduleEvents:[{day:"All",start:"10:00",end:"18:00",location:"East Clock Town",title:"Practicing",description:"Juggling and telling jokes."},{day:"All",start:"18:00",end:"24:00",location:"Stock Pot Inn",title:"Gambling",description:"Playing cards in the lobby."}]},{id:"madame-aroma",name:"Madame Aroma Dotour",icon:"icons/Madame Aroma.png",locationRegion:q.ClockTown,locationSpecific:"Mayor's Residence",description:"The Mayor's wife and entertainment overseer. Looking for her missing son Kafei.",schedule:`Day 1-2 10:00 am-8:00 pm: Mayor's Drawing Room.
Day 3 6:00 pm: Milk Bar.`,defaultActivity:"Resting",defaultLocation:"Mayor's Residence",pages:"15",quests:["q10"],connections:["Mayor Dotour","Kafei","Toto","Gorman"],wikiLink:"https://zelda.fandom.com/wiki/Madame_Aroma",scheduleEvents:[{day:1,start:"10:00",end:"20:00",location:"Mayor's Residence",title:"Madame Aroma Office",description:"Overseeing performances."},{day:2,start:"10:00",end:"20:00",location:"Mayor's Residence",title:"Madame Aroma Office",description:"Overseeing performances."},{day:3,start:"18:00",end:"06:00",location:"Milk Bar",title:"Drinking",description:"Waiting for the end."}]},{id:"sakon",name:"Sakon",icon:"icons/Sakon.png",locationRegion:q.ClockTown,locationSpecific:"Roaming",description:"A menace across the whole of Termina, Sakon has stolen enough of value to bankrupt a fiefdom. Some of his ill-gotten gains have been sold at the Curiosity Shop, but he keeps the prizes of his collection in his hideout which he has loaded with tricks and traps, the paranoid parts of his mind worried about thieves coming after what he believes to be his.",schedule:`Day 1 12:00 am: N. Clock Town (Robbery).
Day 2 11:00 pm: Curiosity Shop (Fencing).
Day 3 6:00 pm: Ikana Hideout.`,defaultActivity:"Prowling/Hiding",defaultLocation:"Ikana Canyon",pages:"85",quests:["q14","q24"],connections:["Kafei","Gerant Mann"],wikiLink:"https://zelda.fandom.com/wiki/Sakon",scheduleEvents:[{day:1,start:"06:00",end:"18:00",location:"Ikana Canyon",title:"Prancing",description:"Roaming the canyon."},{day:1,start:"18:00",end:"24:00",location:"North Clock Town",title:"Waiting",description:"Waiting for bomb bag delivery."},{day:1,start:"00:00",end:"01:00",location:"North Clock Town",title:"Robbery",description:"Stealing bomb bags."},{day:2,start:"23:00",end:"06:00",location:"Curiosity Shop",title:"Sakon Fencing",description:"Selling stolen bomb bags.",condition:{type:"requires_step_not",stepId:"q14-1"}},{day:3,start:"18:00",end:"06:00",location:"Ikana Canyon",title:"Guarding Hideout",description:"Protecting his loot."}]},{id:"tingle",name:"Tingle",icon:"icons/Tingle.png",locationRegion:q.ClockTown,locationSpecific:"Roaming",description:"Strange man who thinks he is a fairy. Sells maps.",schedule:"All Day: Floating in N. Clock Town (and other regions).",defaultActivity:"Floating",defaultLocation:"North Clock Town",pages:"261",quests:["q42"],connections:["Swampy"],wikiLink:"https://zelda.fandom.com/wiki/Tingle",scheduleEvents:[{day:"All",start:"06:00",end:"20:00",location:"North Clock Town",title:"Floating",description:"Selling maps to tourists."}]},{id:"romani",name:"Romani Malon",icon:"icons/Romani.png",locationRegion:q.TerminaField,locationSpecific:"Romani Ranch",description:"Boisterous, excitable, and adventurous with a penchant for giving people nicknames. When Romani was born, her late father changed the name of the ranch to hers, something that may have made his passing even more bittersweet. Romani has been distressed by the recent spate of violence and vandalism that has been overtaking the farm that shares her name, and she feels a bit of responsibility for protecting the place and her cows. She saw the aliens that have been surveying the farm at the middle of the night and has been practicing with a bow to try and chase them off as well as trying, unsuccessfully, to convince her sister about this threat.",schedule:`6:00 am-6:00 pm: Practice.
Day 2 2:00 am: Defends Barn.
Day 3: Fugue state (if failed).`,defaultActivity:"Sleeping",defaultLocation:"Romani Ranch (House)",pages:"32",quests:["q33"],connections:["Cremia","Mamamu Yan"],wikiLink:"https://zelda.fandom.com/wiki/Romani",scheduleEvents:[{day:1,start:"06:00",end:"18:00",location:"Romani Ranch",title:"Romani Practice",description:"Running around, practicing archery."},{day:1,start:"18:00",end:"20:00",location:"Romani Ranch House",title:"Romani Dinner",description:"Eating dinner in the house."},{day:2,start:"06:00",end:"18:00",location:"Romani Ranch Barn",title:"Talking to Sister",description:"Discussing the 'ghosts'."},{day:2,start:"02:00",end:"05:30",location:"Romani Ranch",title:"Defending Barn",description:"Fighting off aliens."},{day:3,start:"06:00",end:"18:00",location:"Romani Ranch",title:"Romani Catatonic",description:"Sitting in a daze, traumatized.",condition:{type:"requires_step_not",stepId:"q33-2"}},{day:3,start:"06:00",end:"18:00",location:"Romani Ranch",title:"Romani Practice",description:"Happily practicing archery.",condition:{type:"requires_step",stepId:"q33-2"}},{day:3,start:"18:00",end:"20:00",location:"Romani Ranch House",title:"Romani Dinner",description:"Eating dinner in the house."}]},{id:"cremia",name:"Cremia Malon",icon:"icons/Cremia.png",locationRegion:q.TerminaField,locationSpecific:"Romani Ranch",description:"After her fathers recent passing, the ranch was left to Romani and Cremia. Cremia has stepped up in nearly every capacity, she runs the ranch, she manages deliveries, she tends to the cows, and she takes care of her sister. Cremia has been driven to distraction by all the petty attacks and assaults the Gorman brothers have been inflicting on their ranch, especially because she hasnt been able to figure out who is behind them. Cremia was childhood friends with Anju and Kafei, but hasnt been able to visit them since her parents died and she assumed more responsibility at the ranch. This increased responsibility has left Cremia feeling stifled, anxious, and lonely.",schedule:`6:00 am-6:00 pm: Ranch Work.
Day 2 6:00 pm: Milk Delivery Run (Milk Road).`,defaultActivity:"Sleeping/Housework",defaultLocation:"Romani Ranch (House)",pages:"33",quests:["q34","q33"],connections:["Romani","Anju","Mamamu Yan"],wikiLink:"https://zelda.fandom.com/wiki/Cremia",scheduleEvents:[{day:1,start:"06:00",end:"18:00",location:"Romani Ranch Barn",title:"Cremia Contemplating",description:"Worried about the ranch."},{day:1,start:"18:00",end:"20:00",location:"Romani Ranch House",title:"Dinner",description:"Eating dinner."},{day:2,start:"06:00",end:"18:00",location:"Romani Ranch Barn",title:"Cremia Milking",description:"Milking the cows."},{day:2,start:"18:00",end:"21:00",location:"Milk Road",title:"Milk Delivery",description:"Driving the wagon to town."},{day:3,start:"06:00",end:"18:00",location:"Romani Ranch Barn",title:"Cremia Contemplating",description:"Worried about the ranch."},{day:3,start:"18:00",end:"20:00",location:"Romani Ranch House",title:"Dinner",description:"Eating dinner."}]},{id:"grog",name:"Grog",icon:"icons/Grog.png",locationRegion:q.TerminaField,locationSpecific:"Romani Ranch (Cucco Shack)",description:"Grog was hired a few years back by Romani and Cremias father. Grog is quiet, fatalistic, and may suffer from depression, the only things he really seems to be passionate about are his cuccos. Grog is an expert at cucco husbandry but has been sunk into melancholy that, with the moon crashing, he will never see his current flock grow to maturity.",schedule:"6:00 am-8:00 pm: Cucco Shack.",defaultActivity:"Sleeping",defaultLocation:"Cucco Shack",pages:"33",quests:["q35"],connections:[],wikiLink:"https://zelda.fandom.com/wiki/Grog",scheduleEvents:[{day:"All",start:"06:00",end:"20:00",location:"Cucco Shack",title:"Tending Cuccos",description:"Watching chicks."}]},{id:"mamamu",name:"Mamamu Yan",icon:"icons/Mamau Yan.png",locationRegion:q.TerminaField,locationSpecific:"Doggy Racetrack",description:"Mamamu Yan is a dog breeder and friend of Romani and Cremias late parents. She was given permission to, as part of her dog training, open and operate a racing track for the dogs at the ranch.",schedule:"6:00 am-8:00 pm: Doggy Racetrack.",defaultActivity:"Sleeping",defaultLocation:"Doggy Racetrack (House)",pages:"33",quests:["q36","q23"],connections:["Romani","Cremia"],wikiLink:"https://zelda.fandom.com/wiki/Mamamu_Yan",scheduleEvents:[{day:"All",start:"06:00",end:"20:00",location:"Doggy Racetrack",title:"Hosting Races",description:"Managing the bets."}]},{id:"gorman-bros",name:"The Gorman Brothers (Fratelli & Hermano)",icon:"icons/Gorman Brother Blue.png",locationRegion:q.TerminaField,locationSpecific:"Gorman Track",description:"Two out of a set of identical triplets (along with Inigo Gorman, the leader of the Gorman Troupe) the Gorman brothers are two of the most ruthless thugs in Termina. On the surface, the Gorman brothers are just average scoundrels that breed horses and run lavish races on their track. Behind the scenes, the Gormans command a team of bandits that attack Termina Field and Romani Ranch.",schedule:"6:00 am-6:00 pm: Gorman Track.",defaultActivity:"Scheming/Sleeping",defaultLocation:"Gorman Track House",pages:"34",quests:["q32","q23","q34"],connections:["Inigo Gorman"],wikiLink:"https://zelda.fandom.com/wiki/Gorman_Brothers",scheduleEvents:[{day:"All",start:"06:00",end:"18:00",location:"Gorman Track",title:"Racing",description:"Running the horse races."},{day:2,start:"18:00",end:"21:00",location:"Milk Road",title:"Raiding",description:"Attacking Cremia's wagon."}]},{id:"shikashi",name:"Professor Shikashi",icon:"icons/Astronomer.png",locationRegion:q.TerminaField,locationSpecific:"Astral Observatory",description:"Astronomer studying the moon. Keeper of the Bombers' hideout code.",schedule:"All Day: Astral Observatory.",defaultActivity:"Stargazing",defaultLocation:"Astral Observatory",pages:"27",quests:["q29","q7"],connections:["Bombers"],wikiLink:"https://zelda.fandom.com/wiki/Astral_Observatory",scheduleEvents:[{day:"All",start:"06:00",end:"06:00",location:"Astral Observatory",title:"Stargazing",description:"Watching the moon fall."}]},{id:"kamaro",name:"Kamaro",icon:"icons/Kamaro.png",locationRegion:q.TerminaField,locationSpecific:"North Termina Field",description:"Ghost of a charismatic dancer. Enjoys moonlight.",schedule:"12:00 am-6:00 am: Mushroom Rocks (North Termina Field).",defaultActivity:"Faded",defaultLocation:"Spirit World",pages:"153",quests:["q31"],connections:["Rosa Sisters"],wikiLink:"https://zelda.fandom.com/wiki/Kamaro",scheduleEvents:[{day:"All",start:"00:00",end:"06:00",location:"North Termina Field",title:"Kamaro Dance",description:"Ghostly dancing on mushroom rocks."}]},{id:"shiro",name:"Shiro",icon:"icons/Shiro.png",locationRegion:q.TerminaField,locationSpecific:"Road to Ikana",description:"A guard of Clock Town who has been appointed to watch over the pass as things became more dangerous in Termina. He has been insecure about being plain and unexceptional, and when he attempted to stop the skull kid, he was cursed with permanent invisibility, ensuring he would never stand out. He has mostly resigned himself to this fate.",schedule:"All Day: Road to Ikana (calling for help).",defaultActivity:"Calling for Help",defaultLocation:"Road to Ikana",pages:"83",quests:["q37"],connections:[],wikiLink:"https://zelda.fandom.com/wiki/Shiro",scheduleEvents:[{day:"All",start:"06:00",end:"06:00",location:"Road to Ikana",title:"Invisible",description:"Waving for help unseen."}]},{id:"swampy",name:"Swampy",icon:"icons/Swampy.png",locationRegion:q.SouthernSwamp,locationSpecific:"Tourism Bureau",description:"A man passionate about his understanding of the swamp. Swampy opened the swamp tourism bureau to help people who are less prepared still appreciate and explore the swamp. He worries a lot about his son, Tingle, who has become convinced that he is a fairy and run off to learn magic. Swampy has enacted a number of novel ways to try to drive swamp tourism, including a recent inclusion of photography setups.",schedule:"6:00 am-10:00 pm: Tourism Bureau.",defaultActivity:"Sleeping",defaultLocation:"Tourism Bureau",pages:"39",quests:["q42","q23"],connections:["Tingle","Koume"],wikiLink:"https://zelda.fandom.com/wiki/Swamp_Tourist_Center_Guide",scheduleEvents:[{day:"All",start:"06:00",end:"22:00",location:"Tourism Bureau",title:"Guiding",description:"Running the contest."}]},{id:"koume",name:"Koume",icon:"icons/Koume.png",locationRegion:q.SouthernSwamp,locationSpecific:"Woods of Mystery / Tourism Center",description:"Twin witches that split their work between the swamp tourism bureau and their potion shop. They frequently take their brooms off into the woods of mystery for potion ingredients. The two witches seem exceedingly old, but they are very spry and lively for their age, and are frequently playful. The sisters bicker and argue as much as they cooperate and agree.",schedule:`Day 1: Injured in Woods.
Day 2-3: Ticket Counter (if saved).`,defaultActivity:"Flying/Resting",defaultLocation:"Potion Shop",pages:"39",quests:["q38","q43"],connections:["Kotake"],wikiLink:"https://zelda.fandom.com/wiki/Koume",scheduleEvents:[{day:1,start:"06:00",end:"06:00",location:"Woods of Mystery",title:"Koume Injured",description:"Trapped in the Woods of Mystery.",condition:{type:"requires_step_not",stepId:"q38-1"}},{day:2,start:"06:00",end:"18:00",location:"Tourism Bureau",title:"Koume at Counter",description:"Selling boat tour tickets.",condition:{type:"requires_step",stepId:"q38-1"}},{day:3,start:"06:00",end:"18:00",location:"Tourism Bureau",title:"Koume at Counter",description:"Selling boat tour tickets.",condition:{type:"requires_step",stepId:"q38-1"}}]},{id:"kotake",name:"Kotake",icon:"icons/Kotake.png",locationRegion:q.SouthernSwamp,locationSpecific:"Potion Shop",description:"Potion Hag. Makes red and blue potions. Twin sister of Koume.",schedule:"6:00 am-6:00 pm Potion Shop.",defaultActivity:"Sleeping/Brewing",defaultLocation:"Potion Shop",pages:"39",quests:["q38"],connections:["Koume"],wikiLink:"https://zelda.fandom.com/wiki/Kotake",scheduleEvents:[{day:"All",start:"06:00",end:"18:00",location:"Potion Shop",title:"Brewing",description:"Making potions."}]},{id:"deku-king",name:"Deku King (Rio Mojo)",icon:"icons/Deku Kung.png",locationRegion:q.SouthernSwamp,locationSpecific:"Deku Palace",description:"A prideful, paranoid, short-sighted, and quick to act royal. The Deku king is the supreme lord of the deku people. He sends out orders seemingly at random, caught along on his mercurial whims. He can be violent, merciful, generous, and dangerous all between one minute and the next. The only thing that has managed to stop the deku king once he gets into the swing of things has been his daughter.",schedule:"Throne Room.",defaultActivity:"Ruling/Punishing",defaultLocation:"Deku Palace Throne Room",pages:"41",quests:["mq1"],connections:["Deku Princess"],wikiLink:"https://zelda.fandom.com/wiki/Deku_King",scheduleEvents:[{day:"All",start:"06:00",end:"20:00",location:"Deku Palace",title:"King Ruling",description:"Sitting on throne, angry."}]},{id:"deku-princess",name:"Deku Princess (Princhesa Mojo)",icon:"icons/Deku Princess.png",locationRegion:q.SouthernSwamp,locationSpecific:"Woodfall Temple",description:"The deku princess is a tempering influence on her father, she is kind and concerned for her people and those who live in the surrounding region. She promotes cooperation with the other peoples in the swamp rather than the deku nativism of her father. However, she cannot do much to calm her fathers impulses while she is kidnapped.",schedule:"Woodfall Temple (Captured).",defaultActivity:"Captured",defaultLocation:"Woodfall Temple",pages:"41",quests:["mq1","q44"],connections:["Deku King","Deku Butler"],wikiLink:"https://zelda.fandom.com/wiki/Deku_Princess",scheduleEvents:[{day:"All",start:"06:00",end:"06:00",location:"Woodfall Temple",title:"Captured",description:"Trapped in the temple."}]},{id:"deku-butler",name:"The Deku Butler",icon:"icons/Deku Butler.png",locationRegion:q.SouthernSwamp,locationSpecific:"Deku Palace",description:"The loyal servant of the deku royals, the deku butler is a skilled warrior and racer. He has been mourning the loss of his son, a young deku warrior who had promised to journey to the lost woods beneath clock town to try to find some aid from the poison and the masked warrior that had occupied Woodfall.",schedule:"Deku Palace / Shrine.",defaultActivity:"Serving/Pacing",defaultLocation:"Deku Palace",pages:"41",quests:["q44-3"],connections:["Deku King"],wikiLink:"https://zelda.fandom.com/wiki/Deku_Butler",scheduleEvents:[{day:"All",start:"06:00",end:"20:00",location:"Deku Palace",title:"Serving",description:"Attending the King."}]},{id:"henri",name:"Henri Maudit",icon:"icons/Spider Cursed.png",locationRegion:q.SouthernSwamp,locationSpecific:"Swamp Spider House",description:"A wealthy man who traveled to the swamp in search of even greater fortune. He was allegedly told that he would find a mansion inside of the swamp that held more gold than even he could spend. When he found it though, he was cursed and transformed into a deformed form like a skulltula. He will offer a great deal to anyone who can break his curse.",schedule:"All Day: Swamp Spider House.",defaultActivity:"Cursed",defaultLocation:"Swamp Spider House",pages:"41",quests:["q41"],connections:[],wikiLink:"https://zelda.fandom.com/wiki/Fearful_Spider_House",scheduleEvents:[{day:"All",start:"06:00",end:"06:00",location:"Swamp Spider House",title:"Cursed",description:"Trapped in spider form."}]},{id:"smiths",name:"The Smithies (Zubora & Gabora)",icon:"icons/Zubora.png",locationRegion:q.NorthernMountain,locationSpecific:"Mountain Smithy",description:"A pair of long time business partners. Zubora is the shorter front man of the business who works with the customers and handles the detail work. Gabora is a hulking monster of a man wearing a mask who takes care of the heavy lifting and the forging. The two are talented smiths, eager to test the limits of their capabilities and make a tidy profit at the same time.",schedule:"7:00 am-10:00 pm: Mountain Smithy.",defaultActivity:"Resting",defaultLocation:"Mountain Smithy",pages:"53",quests:["q49","q23"],connections:[],wikiLink:"https://zelda.fandom.com/wiki/Mountain_Smithy",scheduleEvents:[{day:"All",start:"07:00",end:"22:00",location:"Mountain Smithy",title:"Forging",description:"Hammering away."}]},{id:"goron-child",name:"Kogoro (Goron Child)",icon:"icons/Goron Child.png",locationRegion:q.NorthernMountain,locationSpecific:"Goron Shrine",description:"The son of the Goron Elder, Kogoro has been doted upon for being the most recent birth in the goron village in some time. However, with the death of the Goron hero Darmani and the departure of his father to try and quell the winds on Snowhead, the young goron has become absolutely insufferable and cries ceaselessly.",schedule:"All Day: Goron Shrine (Crying).",defaultActivity:"Crying/Sleeping",defaultLocation:"Goron Shrine",pages:"55",quests:["mq2-1","q47-1"],connections:["Goron Elder"],wikiLink:"https://zelda.fandom.com/wiki/Elder%27s_Son",scheduleEvents:[{day:"All",start:"06:00",end:"24:00",location:"Goron Shrine",title:"Son Crying",description:"Crying loudly in the shrine."}]},{id:"goron-elder",name:"Rogoro (Goron Elder)",icon:"icons/Goron Elder.png",locationRegion:q.NorthernMountain,locationSpecific:"Mountain Village",description:"The elder goron, serving both a spiritual and political function. In earlier times, Rogoro was able to defer most of his active responsibilities to Darmani III. But with the goron heros death, Rogoro was forced to make his elderly body step up to try and protect his people.",schedule:"Frozen on lake until thawed.",defaultActivity:"Frozen/Recovering",defaultLocation:"Mountain Village (Lake)",pages:"55",quests:["mq2-1","q47-1"],connections:["Goron Child"],wikiLink:"https://zelda.fandom.com/wiki/Goron_Elder",scheduleEvents:[{day:"All",start:"06:00",end:"24:00",location:"Mountain Village",title:"Elder Frozen",description:"Frozen in a block of ice.",condition:{type:"requires_step_not",stepId:"mq2-2"}}]},{id:"darmani",name:"Darmani III",icon:"icons/Goron.png",locationRegion:q.NorthernMountain,locationSpecific:"Goron Graveyard",description:"Ghost of the Goron Hero. Died trying to reach Snowhead.",schedule:"All Day: Goron Graveyard.",defaultActivity:"Haunting",defaultLocation:"Goron Graveyard",pages:"53",quests:["q46"],connections:["Goron Elder"],wikiLink:"https://zelda.fandom.com/wiki/Darmani",scheduleEvents:[{day:"All",start:"06:00",end:"24:00",location:"Goron Graveyard",title:"Darmani Ghost",description:"Haunting his grave."}]},{id:"hungry-goron",name:"Hungry Goron",icon:"icons/Goron.png",locationRegion:q.NorthernMountain,locationSpecific:"Mountain Village",description:"Goron stuck on a ledge, starving. Wants rock sirloin.",schedule:"All Day: Mountain Village (Ledge).",defaultActivity:"Starving",defaultLocation:"Mountain Village Ledge",pages:"53",quests:["q47-2"],connections:[],wikiLink:"https://zelda.fandom.com/wiki/Hungry_Goron",scheduleEvents:[{day:"All",start:"06:00",end:"06:00",location:"Mountain Village",title:"Starving",description:"Stuck on ledge."}]},{id:"lago",name:"Professor Lago Mizuumi",icon:"icons/Ocean Researcher.png",locationRegion:q.WesternSea,locationSpecific:"Marine Research Lab",description:"The professor studies the ecosystems of the oceans and maintains several tanks of water that preserve perfect atmospheric conditions for the local waters.",schedule:"All Day: Marine Research Lab.",defaultActivity:"Researching",defaultLocation:"Marine Research Lab",pages:"67",quests:["q3-1"],connections:["Mikau"],wikiLink:"https://zelda.fandom.com/wiki/Marine_Research_Lab",scheduleEvents:[{day:"All",start:"06:00",end:"20:00",location:"Marine Research Lab",title:"Researching",description:"Feeding fish."}]},{id:"pescador",name:"Pescador Fischer",icon:"icons/Fisherman.png",locationRegion:q.WesternSea,locationSpecific:"Fisherman's Hut",description:"The most accomplished fisherman on the western coast, Pescador used to spend most of his time on the ocean with his boat, but now he spends most of his time on shore. He has a particular obsession with the Gerudo pirates and longs to get up close with one of those local beauties.",schedule:"All Day: Fisherman's Hut (Displaying Seahorse).",defaultActivity:"Idling",defaultLocation:"Fisherman's Hut",pages:"67",quests:["q53","q60"],connections:["Pirate Queen Aveil"],wikiLink:"https://zelda.fandom.com/wiki/Fisherman",scheduleEvents:[{day:"All",start:"06:00",end:"20:00",location:"Fisherman's Hut",title:"Fisherman",description:"Admiring his seahorse."}]},{id:"aveil",name:"Pirate Queen Aveil",icon:"icons/Aveil.png",locationRegion:q.WesternSea,locationSpecific:"Pirates' Fortress",description:"The leader of the Gerudo Pirates. She is a canny manipulator, and good at keeping her people motivated. Aveils current obsession is the treasure she was told was hidden inside of the Great Bay Temple. Despite her many skills, Aveil has a crippling fear of bees.",schedule:"All Day: Pirates' Fortress Throne Room.",defaultActivity:"Guarding Eggs",defaultLocation:"Pirates' Fortress",pages:"70",quests:["q3-1"],connections:["Skull Kid"],wikiLink:"https://zelda.fandom.com/wiki/Aveil",scheduleEvents:[{day:"All",start:"06:00",end:"24:00",location:"Pirates' Fortress",title:"Aveil Guarding",description:"Guarding the dragon eggs."}]},{id:"beavers",name:"Norbert and Daggett (Beaver Bros)",icon:"icons/Beaver Old.png",locationRegion:q.WesternSea,locationSpecific:"Grand Falls",description:"Two beavers who keep a fine collection of treasures inside of their dam. They enjoy racing through their dams above the waterfall and are extremely confident in their speed. They were visited not too long ago by Mikau, the zora hero, who hoped to get a magic bottle from the duo.",schedule:"All Day: Beaver Dam (Waterfall Top).",defaultActivity:"Swimming/Racing",defaultLocation:"Beaver Dam",pages:"72",quests:["q57"],connections:[],wikiLink:"https://zelda.fandom.com/wiki/Beaver",scheduleEvents:[{day:"All",start:"06:00",end:"18:00",location:"Grand Falls",title:"Racing",description:"Swimming laps."}]},{id:"mikau",name:"Mikau",icon:"icons/Mikau.png",locationRegion:q.WesternSea,locationSpecific:"Great Bay Coast / Zora Hall",description:"Zora warrior and guitarist. Dying on the shore after failing to raid the pirates.",schedule:"Day 1: Dying on Great Bay Coast.",defaultActivity:"Dying/Dead",defaultLocation:"Great Bay Coast",pages:"258",quests:["q51","q59"],connections:["Lulu","Evan","Japas"],wikiLink:"https://zelda.fandom.com/wiki/Mikau",scheduleEvents:[{day:1,start:"06:00",end:"06:00",location:"Great Bay Coast",title:"Mikau Dying",description:"Washed up on the shore, critically injured."}]},{id:"lulu",name:"Lulu",icon:"icons/Lulu.png",locationRegion:q.WesternSea,locationSpecific:"Zora Hall",description:"The lead singer of the Indigo-Gos, she recently gave birth to a clutch of eggs that were stolen by gerudo pirates. The shock of what happened has rendered her completely mute.",schedule:"All Day: Zora Hall (Gazing at sea).",defaultActivity:"Gazing/Mourning",defaultLocation:"Zora Hall (Outside)",pages:"72",quests:["q3-1"],connections:["Mikau","Evan"],wikiLink:"https://zelda.fandom.com/wiki/Lulu",scheduleEvents:[{day:"All",start:"06:00",end:"24:00",location:"Zora Hall",title:"Lulu Gazing",description:"Staring out at the ocean, voiceless."}]},{id:"evan",name:"Evan",icon:"icons/Evan.png",locationRegion:q.WesternSea,locationSpecific:"Zora Hall",description:"The band leader of the Indigo-Gos, hes also their lead composer. His biggest frustration, other than their upcoming gig being canceled, is that the band is mostly known for songs popularized by the bands old lineup, nothing new.",schedule:"All Day: Zora Hall (Room).",defaultActivity:"Composing",defaultLocation:"Zora Hall (Room)",pages:"72",quests:["q59","q23"],connections:["Lulu","Japas","Tijo"],wikiLink:"https://zelda.fandom.com/wiki/Evan",scheduleEvents:[{day:"All",start:"06:00",end:"22:00",location:"Zora Hall",title:"Evan Composing",description:"Writing songs in his room."}]},{id:"japas",name:"Japas",icon:"icons/Japas.png",locationRegion:q.WesternSea,locationSpecific:"Zora Hall",description:"Japas is the bassist for the Indigo-Gos. Hes a good composer and likes to take his spare time in jam sessions with the bands other members, trying to write a hit that he can actually get Evan to listen to.",schedule:"All Day: Zora Hall (Room).",defaultActivity:"Jamming",defaultLocation:"Zora Hall (Room)",pages:"72",quests:["q59","q23"],connections:["Evan","Mikau"],wikiLink:"https://zelda.fandom.com/wiki/Japas",scheduleEvents:[{day:"All",start:"10:00",end:"20:00",location:"Zora Hall",title:"Japas Jamming",description:"Playing bass in his room."}]},{id:"tijo",name:"Tijo",icon:"icons/Tijo.png",locationRegion:q.WesternSea,locationSpecific:"Zora Hall",description:"The drummer for the Indigo-Gos, Tijo is a laid-back, calm, and rather heavy-set zora who spends most of his time just banging out rhythms on his drums.",schedule:"All Day: Zora Hall (Room).",defaultActivity:"Drumming/Sleeping",defaultLocation:"Zora Hall (Room)",pages:"72",quests:["q59"],connections:["Evan"],wikiLink:"https://zelda.fandom.com/wiki/Tijo",scheduleEvents:[{day:"All",start:"06:00",end:"22:00",location:"Zora Hall",title:"Tijo Drumming",description:"Practicing drums."}]},{id:"poe-collector",name:"The Poe Collector",icon:"icons/Poe Collector.png",locationRegion:q.EasternCanyon,locationSpecific:"Spirit House / Canyon Pass",description:"A mysterious figure seen all over Ikana Canyon. He will first be seen keeping watch over the pass, waiting for someone to prove theyre capable enough to face the spirits of Ikana. Little is known about the Poe Collector or their identity, but there are several theories. Some believe that he is yet another ghost, that he was a soldier from the kingdom, or that he is the last living member of the Ikana Royal Family. Regardless of his origin, he is not a hostile entity and seems to want the kingdom to be put to rest.",schedule:"Canyon Pass / Spirit House.",defaultActivity:"Waiting",defaultLocation:"Canyon Pass",pages:"83",quests:["q65"],connections:[],wikiLink:"https://zelda.fandom.com/wiki/Poe_Collector",scheduleEvents:[{day:"All",start:"06:00",end:"18:00",location:"Canyon Pass",title:"Watching",description:"Guarding the pass."},{day:"All",start:"18:00",end:"06:00",location:"Spirit House",title:"Hosting Game",description:"Running the Poe challenge."}]},{id:"keeta",name:"Captain Keeta",icon:"icons/Captain Keeta.png",locationRegion:q.EasternCanyon,locationSpecific:"Ikana Graveyard",description:"The reanimated body of the last commander of the Ikana Military. He was the leader of all the soldiers that have now become stalfos in living death, and his presence still carries its import with those beings. The captain hopes to return to rest, but is unwilling to do so unless he can pass on his authority to someone worthy.",schedule:"Night: Patrolling Graveyard.",defaultActivity:"Slumbering",defaultLocation:"Ikana Graveyard (Grave)",pages:"84",quests:["q61"],connections:["Igos du Ikana"],wikiLink:"https://zelda.fandom.com/wiki/Captain_Keeta",scheduleEvents:[{day:"All",start:"20:00",end:"04:00",location:"Ikana Graveyard",title:"Captain Keeta Patrol",description:"Patrolling the graveyard.",condition:{type:"requires_step_not",stepId:"q61-1"}}]},{id:"dampe",name:"Damp",icon:"icons/Dampe.png",locationRegion:q.EasternCanyon,locationSpecific:"Ikana Graveyard",description:"The last in a long line of crypt keepers that once served the Ikana Kings. It could be argued that this elderly, malformed, widower is the last living subject of the Ikana Kingdom. Damp is terrified of ghosts, and the rise of the undead in Ikana canyon has been nerve wracking for him, but he does his best to properly care for the memorials he oversees.",schedule:`Day: Graveyard.
Night: Cabin.`,defaultActivity:"Hiding",defaultLocation:"Gravedigger's Cabin",pages:"84",quests:["q62"],connections:[],wikiLink:"https://zelda.fandom.com/wiki/Dampe",scheduleEvents:[{day:"All",start:"06:00",end:"18:00",location:"Ikana Graveyard",title:"Digging",description:"Tending graves."},{day:"All",start:"18:00",end:"06:00",location:"Gravedigger's Cabin",title:"Hiding",description:"Avoiding ghosts."}]},{id:"flat",name:"Flat",icon:"icons/Flat.png",locationRegion:q.EasternCanyon,locationSpecific:"Ikana Graveyard",description:"The spirit of one of the two royal composers. When his brother, the other composer, Sharp went mad, he locked his brother under the graveyard and his spirit haunts the crypt where he was imprisoned, working on a spell that could undo the damage his brother caused.",schedule:"All Day: Beneath Graveyard.",defaultActivity:"Haunting",defaultLocation:"Beneath Graveyard",pages:"84",quests:["q62-1"],connections:["Sharp"],wikiLink:"https://zelda.fandom.com/wiki/Flat",scheduleEvents:[{day:"All",start:"06:00",end:"06:00",location:"Beneath Graveyard",title:"Haunting",description:"Trapped in crypt."}]},{id:"sharp",name:"Sharp",icon:"icons/Sharp.png",locationRegion:q.EasternCanyon,locationSpecific:"Spring Water Cave",description:"One of the two composer brothers of the Ikana Kingdom. When the war started to turn, Sharp went insane. When his brother Flat tried to stop his acts, Sharp had him imprisoned in the Ikana Graveyard. Then stopped up the spring that fed the river of the Ikana Kingdom. When Twinmold resurrected his spirit, the spring was stopped up again and he haunts it still.",schedule:"All Day: Spring Water Cave.",defaultActivity:"Haunting",defaultLocation:"Spring Water Cave",pages:"86",quests:["q63-1"],connections:["Flat"],wikiLink:"https://zelda.fandom.com/wiki/Sharp",scheduleEvents:[{day:"All",start:"06:00",end:"06:00",location:"Spring Water Cave",title:"Haunting",description:"Cursing the spring."}]},{id:"igos",name:"Igos du Ikana",icon:"icons/Igos Du Ikana.png",locationRegion:q.EasternCanyon,locationSpecific:"Ancient Castle of Ikana",description:"The risen king of Ikana Kingdom. Prone to poetry, Igos dreams of using the undeath of himself and his followers to rebuild his kingdom and expand its borders further than they had ever stretched before. Igos is a skilled warrior and is attended to by two skeletal warriors and entertained by dancing gibdos.",schedule:"All Day: Throne Room.",defaultActivity:"Ruling",defaultLocation:"Ikana Castle Throne Room",pages:"86",quests:["mq4-1"],connections:["Captain Keeta"],wikiLink:"https://zelda.fandom.com/wiki/Igos_du_Ikana",scheduleEvents:[{day:"All",start:"06:00",end:"24:00",location:"Ikana Castle",title:"King Igos",description:"Waiting in his castle."}]},{id:"vater",name:"Vater Otou",icon:"icons/Pamelas Father Cursed.png",locationRegion:q.EasternCanyon,locationSpecific:"Music Box House",description:"A researcher of the supernatural who moved to Ikana Canyon to study the spirits there. He ventured too close to the well and was cursed by the Gibdos. He is slowly transforming into one of the undead monsters he studied. His daughter Pamela keeps him locked in the basement to protect him and others.",schedule:"All Day: Music Box House Basement.",defaultActivity:"Cursed",defaultLocation:"Music Box House Basement",pages:"85",quests:["q63"],connections:["Pamela"],wikiLink:"https://zelda.fandom.com/wiki/Pamela%27s_Father",scheduleEvents:[{day:"All",start:"06:00",end:"06:00",location:"Music Box House Basement",title:"Cursed",description:"Locked in the basement."}]},{id:"pamela",name:"Pamela",icon:"icons/Pamela.png",locationRegion:q.EasternCanyon,locationSpecific:"Music Box House",description:"The daughter of the researcher Vater Otou. She is fiercely protective of her father and terrified of the Gibdos circling their house. She rarely leaves the house, only stepping out to check the water wheel that powers the music box keeping the Gibdos at bay.",schedule:"All Day: Music Box House (Hiding).",defaultActivity:"Hiding",defaultLocation:"Music Box House",pages:"85",quests:["q63"],connections:["Vater Otou"],wikiLink:"https://zelda.fandom.com/wiki/Pamela",scheduleEvents:[{day:"All",start:"06:00",end:"18:00",location:"Music Box House",title:"Pamela Outside",description:"Checking the water flow.",condition:{type:"requires_step_not",stepId:"q63-1"}},{day:"All",start:"18:00",end:"06:00",location:"Music Box House",title:"Pamela Hiding",description:"Protecting her father.",condition:{type:"requires_step_not",stepId:"q63-1"}}]},{id:"skull-kid",name:"Skull Kid",icon:"icons/Skull Kid Masked.png",locationRegion:q.ClockTown,locationSpecific:"Clock Tower",description:"A mischievous imp who stole Majora's Mask from the Happy Mask Salesman. The mask's dark power has possessed him, amplifying his pranks into world-threatening disasters. He waits atop the Clock Tower for the moon to fall.",schedule:"Clock Tower Roof (Final Day Midnight).",defaultActivity:"Waiting",defaultLocation:"Clock Tower Roof",pages:"95",quests:["mq-end"],connections:["Tatl","Tael"],wikiLink:"https://zelda.fandom.com/wiki/Skull_Kid",scheduleEvents:[{day:3,start:"18:00",end:"06:00",location:"Clock Tower Roof",title:"Waiting",description:"Calling down the moon."}]}],cs=[{id:"mq1",questNumber:1,isMainQuest:!0,title:"Purify the Southern Swamp",region:q.SouthernSwamp,description:"The Skull Kid, using Majora's Mask, cursed the four guardians of Termina and sealed and warped their power inside of masks, transforming them into monsters. The swamp's guardian giant has been turned into a tribal warrior, and their divine power has been turned into a deadly poison that is slowly contaminating the swamp's water.",pageReference:"140",rewards:[Y.odolwaRemains,nn.oath],steps:[{id:"mq1-1",title:"Hear the Monkey's Plea",description:`The deku king, after the disappearance of his daughter, has pinned the blame on the monkeyfolk that accompanied the Deku Princess to Woodfall Temple. And imprisoned the monkey inside of the deku throne room.

Adventurers who sneak into the monkey prison (accessible through a window on the eastern palace gardens) can learn the sonata of awakening from the captured monkey.

Alternatively, adventurers can offer to the Deku King to attempt to rescue the missing princess and the king will teach adventurers the sonata if they succeed a DC 15 Charisma (Persuasion) check. The king mistrusts outsiders and any non-deku adventurers will make the check with disadvantage.`,location:"Deku Palace",xpReward:150,itemRewards:[nn.sonata],curiosityShopUnlock:{itemName:"Cape of the Mountebank",id:"si-1"},pageReference:"140"},{id:"mq1-2",title:"Defeat Odolwa",description:`The boss within the great chamber of Woodfall Temple, Odolwa is a warped guardian spirit or deity. Defeating Odolwa allows the victors to claim play the song of healing to release the guardian giant and claim Odolwa's Remains. As soon as the guardian is freed, the poison of Odolwa is swiftly purged from the swamp.

On freeing the guardian, it will appear as a vision to the adventurers. It will speak in a mixture of giant and celestial, requiring an understanding of both languages to adequately understand, and tell listeners of its peril. On hearing the giant out, or simply at the end of the speech, it will teach the listeners the oath to order. Though, only adventurers, or an adventuring team, who speak both languages will understand the lesson being taught.`,location:"Woodfall Temple",xpReward:350,itemRewards:[Y.odolwaRemains,nn.oath],curiosityShopUnlock:{itemName:"Dancing Sword",id:"si-1-2"},pageReference:"140",affectsTimeline:!0,prerequisiteStepId:"mq1-1"}],failureConsequence:"If Odolwa is not defeated by the close of the third day, their poison will spread throughout Termina. The Deku king will kill the monkey and start a war between the deku and the monkeyfolk of the southern swamp. Both parties will die though, as the poison renders the swamp inaccessible, and it then spreads to the whole of Termina."},{id:"mq2",questNumber:2,isMainQuest:!0,title:"Purify the Northern Mountain",region:q.NorthernMountain,description:"The Skull Kid, using Majora's Mask, cursed the four guardians of Termina and sealed and warped their power inside of masks, transforming them into monsters. The mountain's guardian giant has been turned into a mechanical beast, and their divine power has been turned into a deadly cold that has been burying the mountain in snow and sealing it in ice.",pageReference:"140",rewards:[Y.gohtRemains,nn.oath],steps:[{id:"mq2-1",title:"Calm the Goron Child",description:`The Goron Elder has gone missing as they attempt to travel to Snowhead Temple and the Elder's Son, lost and afraid, has been unable to stop crying. Unfortunately, the entire Goron population of the Goron Village has held up inside the Goron shrine and not only does the child's crying make it impossible for anyone to get any rest, it risks an avalanche.

Adventurers can find the Goron Elder, obscured by snow, with a DC 15 Wisdom (Survival) check. He is frozen and near death on the frozen lake near the between the goron village and mountain village. They will need to be healed and recovered. They refuse to return to the goron village so long as Snowhead is cursed, but will teach adventurers the goron lullaby to quiet the child.

Alternatively, a calm emotions spell or a DC 15 Charisma (Performance) check will calm the Goron child enough for them to teach adventurers the song.`,location:"Goron Shrine / Mountain Village",xpReward:150,itemRewards:[nn.goron],curiosityShopUnlock:{itemName:"Horn of Blasting",id:"si-2"},pageReference:"140",characterId:"goron-child"},{id:"mq2-2",title:"Defeat Goht",description:`The boss within the great chamber of Snowhead Temple, Goht is a warped guardian spirit or deity. Defeating Goht allows the victors to claim Goht's Remains, and release the guardian giant. As soon as the guardian is freed, the unnatural freeze ends, and any snow created by Goht's influence melts.

On freeing the guardian, it will appear as a vision to the adventurers. It will speak in a mixture of giant and celestial, requiring an understanding of both languages to adequately understand, and tell listeners of its peril. On hearing the giant out, or simply at the end of the speech, it will teach the listeners the oath to order. Though, only adventurers, or an adventuring team, who speak both languages will understand the lesson being taught.`,location:"Snowhead Temple",xpReward:350,itemRewards:[Y.gohtRemains,nn.oath],curiosityShopUnlock:{itemName:"Animated Shield",id:"si-2-2"},pageReference:"141",affectsTimeline:!0,prerequisiteStepId:"mq2-1"}],failureConsequence:"If Goht is not defeated by the close of the third day, the cold will lock the entire mountain in ice. Every living thing there will be frozen solid before the cold spreads further down."},{id:"mq3",questNumber:3,isMainQuest:!0,title:"Purify the Western Seas",region:q.WesternSea,description:"The Skull Kid, using Majora's Mask, cursed the four guardians of Termina and sealed and warped their power inside of masks, transforming them into monsters. The ocean's guardian giant has been turned into a vicious fish, and their divine power has been turned into a miasmatic heat that is slowly boiling the region's water.",pageReference:"141",rewards:[Y.gyorgRemains,nn.oath],steps:[{id:"mq3-1",title:"Recover the Zora's Voice",description:`The Zora singer Lulu had her eggs stolen by Gerudo pirates who were told by the skull kid that they held the secret to accessing the great treasure in Great Bay Temple. There are two special temperature-controlled water tanks located throughout the coast, one in the ocean research laboratory, and one in the Gerudo Fortress. If all seven eggs are collected in one place the eggs will form the notes for the new wave bossa nova. Four eggs are located in the Gerudo pirate's fortress, three are in the underwater depths near pinnacle rock.

The Gerudo pirates are initially hostile to intruders and have been swayed by the Skull Kid into holding the zora eggs hostage and collecting the rest. However, Aveil can be convinced to work with adventurers and temporarily end hostilities with the Zora with a DC 17 Charisma (Persuasion) check along with a bribe or 'tribute' worth at least 1,000 GP.`,location:"Pirates' Fortress / Pinnacle Rock",xpReward:150,itemRewards:[nn.bossa],curiosityShopUnlock:{itemName:"Tentacle Rod",id:"si-3"},pageReference:"141",characterId:"aveil"},{id:"mq3-2",title:"Defeat Gyorg",description:`The boss within the great chamber of Great Bay Temple, Gyorg is a warped guardian spirit or deity. Defeating Gyorg allows the victors to claim Gyorg's Remains, and release the guardian giant. As soon as the guardian is freed, the climate of Termina's seas is immediately returned to normal.

On freeing the guardian, it will appear as a vision to the adventurers. It will speak in a mixture of giant and celestial, requiring an understanding of both languages to adequately understand, and tell listeners of its peril. On hearing the giant out, or simply at the end of the speech, it will teach the listeners the oath to order. Though, only adventurers, or an adventuring team, who speak both languages will understand the lesson being taught.`,location:"Great Bay Temple",xpReward:350,itemRewards:[Y.gyorgRemains,nn.oath],curiosityShopUnlock:{itemName:"Staff of Thunder and Lightning",id:"si-3-2"},pageReference:"141",affectsTimeline:!0,prerequisiteStepId:"mq3-1"}],failureConsequence:"If Gyorg is not defeated by the close of the third day, all life in the oceans will die, the zora and the gerudo will gradually starve, as will the rest of the region."},{id:"mq4",questNumber:4,isMainQuest:!0,title:"Purify the Eastern Canyon",region:q.EasternCanyon,description:"The Skull Kid, using Majora's Mask, cursed the four guardians of Termina and sealed and warped their power inside of masks, transforming them into monsters. The canyon's guardian giant has been turned into a pair of great worms, and their divine power has been turned into a curse of undeath that has raised the fallen kingdom of the canyon.",pageReference:"141",rewards:[Y.twinmoldRemains,nn.oath],steps:[{id:"mq4-1",title:"Put the Undead King to Rest",description:`The Ikana king Igos du Ikana has been resurrected thanks to the power of Twinmold and believes that, with his new power, he can restore the Ikana Kingdom with this new strength. Then, once they have restored the glory of Ikana, they can sweep out into Termina. He believes that this second chance at 'life' and the strength given to him give him the right to rule. However, the king is honorable and, if convinced, will allow adventurers to challenge his right to conquest.

Adventurers must defeat first the undead king's retainers, then the king himself. The battle will be to the death, as the undead royals have little fear of dying. If adventurers succeed, the king will teach them the elegy of emptiness.

If the Ikana king's spirit is dispelled, purged, or otherwise removed from the material plane during the course of the battle, he will be unable to teach adventurers the elegy.`,location:"Ikana Castle",xpReward:150,itemRewards:[nn.elegy],curiosityShopUnlock:{itemName:"Mace of Disruption",id:"si-4"},pageReference:"142",characterId:"igos"},{id:"mq4-2",title:"Defeat Twinmold",description:`The boss within the great chamber of Stone Tower Temple, Twinmold is a warped guardian spirit or deity. Defeating Twinmold allows the victors to claim Twinmold's Remains, and release the guardian giant. As soon as the guardian is freed, the curse of undeath is ended and the undead in Ikana Canyon are all purified.

On freeing the guardian, it will appear as a vision to the adventurers. It will speak in a mixture of giant and celestial, requiring an understanding of both languages to adequately understand, and tell listeners of its peril. On hearing the giant out, or simply at the end of the speech, it will teach the listeners the oath to order. Though, only adventurers, or an adventuring team, who speak both languages will understand the lesson being taught.`,location:"Stone Tower Temple",xpReward:350,itemRewards:[Y.twinmoldRemains,nn.oath],curiosityShopUnlock:{itemName:"Carpet of Flying",id:"si-4-2"},pageReference:"142",affectsTimeline:!0,prerequisiteStepId:"mq4-1"}],failureConsequence:"If Twinmold is not defeated at the close of the third day, the undead that occupy Ikana will gradually move out into the whole of Termina, seeking to rebuild their old kingdom into an empire of the dead."},{id:"q5",questNumber:5,title:"Inter the Deku Explorer",region:q.ClockTown,description:"In the Lost Woods tunnels underneath Clock Town, a twisted tree stands a short ways beyond the entrance to the clock tower's works. This tree is the remains of a Deku hero that went to seek assistance with the poison swamp from the Deku clan said to live beyond the lost woods, and was cursed by the Skull Kid. Anyone who looks closely could swear that the little tree is weeping sap.",pageReference:"142",rewards:[Y.dekuMask],steps:[{id:"q5-1",title:"Heal the Twisted Tree",description:"Adventurers who play the song of healing for the tree will receive the races mask (deku), and the crying will stop. This deku had proficiency with woodwinds and this version of the mask will confer that proficiency.",location:"Under Clock Tower",xpReward:120,itemRewards:[Y.dekuMask],curiosityShopUnlock:{itemName:"Staff of the Woodlands",id:"si-5"},pageReference:"142"}]},{id:"q6",questNumber:6,title:"Restore the Great Fairies",region:q.World,description:"The great fairies of Termina, five old and powerful fey, have been shattered by the skull kid. Their bodies divided into independent 'stray fairies.' If these fairies are collected and brought back to the fairy fountains where the great fairies reside, the broken fey may be restored. In gratitude, the great fairies will offer their rescuers a boon. However, the great fairies are powerful and perceptive enough that they can sense the temporal energy that adventurers are infused with, and can sense if the strength of their boon is already present. They are also intelligent enough to deduce what that means. The great fairies will not grant a boon to any adventurer that already possesses a boon from them.",pageReference:"142",rewards:[{name:"Great Fairy's Sword",type:"Item",description:"A legendary greatsword."},{name:"Various Blessings",type:"Other",description:"Boons granted by each Fairy."}],steps:[{id:"q6-1",title:"Restore Great Fairy of Clock Town",description:"The great fairy of Clock Town is the great fairy of magic, when all the stray fairies of Clock Town have been returned to Clock Town's fairy fountain. The great fairy will reform, regaining her shape and her fey power. In gratitude she will offer adventurers blessings related to Magic and Spells.",xpReward:20,location:"N. Clock Town",curiosityShopUnlock:{itemName:"Necklace of Prayer Beads",id:"si-6"},pageReference:"143"},{id:"q6-2",title:"Restore Great Fairy of Woodfall",description:"The great fairy of Woodfall is the great fairy of power. Retrieving the ten stray fairies inside of Woodfall temple and bringing them to the great fairy's fountain of Woodfall will reform the shattered fey, restoring her body and her power. Once she is whole, she will offer the adventurers who saved her blessings related to Combat Power and Form.",xpReward:20,location:"Woodfall",curiosityShopUnlock:{itemName:"Sun Blade",id:"si-6b"},pageReference:"143"},{id:"q6-3",title:"Restore Great Fairy of Snowhead",description:"The great fairy of Snowhead is the great fairy of wisdom. Retrieving the ten stray fairies inside of Snowhead temple and bringing them to the great fairy's fountain of Snowhead will reform the shattered fey, restoring her body and her power. Once she is whole, she will offer the adventurers who saved her blessings related to Magic Resistance and Mana.",xpReward:20,location:"Snowhead",curiosityShopUnlock:{itemName:"Mantle of Spell Resistance",id:"si-6c"},pageReference:"144"},{id:"q6-4",title:"Restore Great Fairy of Great Bay",description:"The great fairy of the Great Bat is the great fairy of courage. Retrieving the ten stray fairies inside of Great Bay temple and bringing them to the great fairy's fountain of Great Bay will reform the shattered fey, restoring her body and her power. Once she is whole, she will offer the adventurers who saved her blessings related to Fortitude and Protection.",xpReward:20,location:"Zora Cape",curiosityShopUnlock:{itemName:"Bracers of Defense",id:"si-6d"},pageReference:"144"},{id:"q6-5",title:"Restore Great Fairy of Stone Tower",description:"The great fairy of the Stone Tower is the great fairy of kindness. Retrieving the ten stray fairies inside of Stone Tower Temple and bringing them to the great fairy's fountain of Stone Tower will reform the shattered fey, restoring her body and her power. Once she is whole, she will offer the adventurers who saved her blessings related to Stats and Fortune.",xpReward:20,location:"Ikana Canyon",curiosityShopUnlock:{itemName:"Wings of Flying",id:"si-6e"},pageReference:"144"},{id:"q6-6",title:"All Great Fairies Restored",description:"If a great fairy is restored while all four of her sisters have also been restored during the same temporal cycle, that fairy will gift adventurers with the Great Fairys sword.",xpReward:20,location:"Any Fountain",itemRewards:[{name:"Great Fairy's Sword",type:"Item",description:"Legendary Greatsword."}],pageReference:"145"}],failureConsequence:"If the great fairies are not restored by the close of the third day, there is little consequence to so long as Termina is saved. The stray fairies will gradually drift back together over a period of about a week."},{id:"q7",questNumber:7,title:"The Bomber's Notebook",region:q.ClockTown,description:"The young boy frequently found in North Clock Town, Jim Bombazu, has been practicing with his blowgun to 'stay ready for trouble.' He is the leader of the Bombers and, if adventurers manage to convince him that they are trying to help settle the problems in Termina, he will offer membership in the society.",pageReference:"145",rewards:[{name:"Bomber's Notebook",type:"Item",description:"Tracks schedule and quests."},{name:"Secret Code",type:"Other",description:"Code to enter the hideout (12453)."}],steps:[{id:"q7-1",title:"Catch the Bombers",description:`Jim will call the other four members of the Bomber's Society and all five will hide in different areas of Clock Town. Adventurers have one hour to find all five members, making Wisdom (Perception) checks in each region against the kid's Dexterity (Stealth) checks, then tagging the kids to mark them as 'out.' The kids have a +2 to Stealth and may take the dash action as a reaction once during a chase.

If you manage to catch all four kids within the time limit, Jim will award you with the Bomber's Notebook, and teach you their secret code, 12453.`,location:"Clock Town",characterId:"jim",xpReward:120,itemRewards:[{name:"Bomber's Notebook",type:"Item"}],curiosityShopUnlock:{itemName:"Stone of Good Luck",id:"si-7"},pageReference:"145"}]},{id:"q8",questNumber:8,title:"Business Scrub Scramble",region:q.World,description:"Across Termina, five enterprising capitalist deku scrubs have set up shops. However, as the grass is always greener, they all feel they would be happier in different locations. They're all willing to sell their properties, if the right incentive could be offered.",pageReference:"145",rewards:[Y.heart],steps:[{id:"q8-1",title:"Town Deku Flower",description:`The business scrub that has set up shop in Clock Town is looking to move somewhere warmer, but wants to have some assurances of financial stability before they move. They will sell a deed to their small plot for 1,000 rupees. Alternatively, they will sell the property for 200 rupees if the buyer can add a moons tear gem to the bargain.

Curious adventurers can discover a piece of heart hidden in the soft soil underneath the business scrubs plot.`,xpReward:24,location:"S. Clock Town",curiosityShopUnlock:{itemName:"Winged Boots",id:"si-8a"},itemRewards:[{name:"Town Title Deed",type:"Item"}],pageReference:"145"},{id:"q8-2",title:"Swamp Deku Flower",description:`The deku scrub by the swamp tourism bureau is looking to sell his property and move somewhere dryer with more foot traffic, but mostly just looking to move out. They are willing to sell their plot for 1,000 rupees, but are willing to cut a deal for 200 rupees if the buyer throws in the deed to the Clock Town plot.

Curious adventurers can discover a piece of heart hidden in the soft soil underneath the business scrubs plot.`,xpReward:30,location:"Swamp Tourism",curiosityShopUnlock:{itemName:"Goggles of Night",id:"si-8b"},itemRewards:[{name:"Swamp Title Deed",type:"Item"}],pageReference:"146"},{id:"q8-3",title:"Mountain Deku Flower",description:`The business scrub by the Goron Shrine is homesick for the swamp and is looking for an excuse to cut their losses and move home. They are willing to sell their plot for 1,000 rupees, but are willing to cut a deal for 200 rupees if the buyer throws in the deed to the southern Swamp plot.

Curious adventurers can discover a piece of heart hidden in the soft soil underneath the business scrubs plot.`,xpReward:30,location:"Goron Village",curiosityShopUnlock:{itemName:"Decanter of Endless Water",id:"si-8c"},itemRewards:[{name:"Mountain Title Deed",type:"Item"}],pageReference:"146"},{id:"q8-4",title:"Ocean Deku Flower",description:`The business scrub inside the Zora Hall is tired of the thick smell of the ocean and the humidity and wants to move somewhere cooler and fresher. They are willing to sell their plot for 1,000 rupees, but are willing to cut a deal for 200 rupees if the buyer throws in the deed to the northern mountain plot.

Curious adventurers can discover a piece of heart hidden in the soft soil underneath the business scrubs plot.`,xpReward:30,location:"Zora Hall",curiosityShopUnlock:{itemName:"Robe of Useful Items",id:"si-8d"},itemRewards:[{name:"Ocean Title Deed",type:"Item"}],pageReference:"146"},{id:"q8-5",title:"Canyon Deku Flower",description:`The business scrub that established themselves in the Valley beneath the old kingdom is absolutely done with the arid heat and the lack of foot traffic, they want to move somewhere by the sea. They are willing to sell their plot for 1,000 rupees, but are willing to cut a deal for 200 rupees if the buyer throws in the deed to the western ocean plot.

Curious adventurers can discover a piece of heart hidden in the soft soil underneath the business scrubs plot.`,xpReward:30,location:"Ikana Canyon",itemRewards:[{name:"200 Rupees",type:"Item"},Y.heart],pageReference:"146"}]},{id:"q9",questNumber:9,title:"Bank Loyalty Program",region:q.ClockTown,description:"The Clock Town bank, hoping to drum up support for their new banking initiatives, are offering incentives for those clients that deposit a certain amount of rupees into their accounts.",pageReference:"146",rewards:[{name:"Clock Town Cheque Book",type:"Item"},Y.heart],steps:[{id:"q9-1",title:"A Special Gift From the Bank",description:"Any adventurers that make a one-time deposit of at least 200 rupees into the bank will be gifted a Clock Town Bank cheque book by the banks proprietor.",xpReward:60,location:"West Clock Town",curiosityShopUnlock:{itemName:"Bag of Holding",id:"si-9a"},itemRewards:[{name:"Clock Town Cheque Book",type:"Item",description:"Tracks bank balance across time."}],characterId:"banker",pageReference:"146"},{id:"q9-2",title:"Breaking the Bank",description:"When, after a deposit, a bank client has at least 2,000 rupees in their bank account, the banker will give out a piece of heart.",xpReward:60,location:"West Clock Town",curiosityShopUnlock:{itemName:"Elemental Gem (Yellow Diamond)",id:"si-9b"},itemRewards:[Y.heart],prerequisiteStepId:"q9-1",characterId:"banker",pageReference:"146"}]},{id:"q10",questNumber:10,title:"Madame Aroma's Search",region:q.ClockTown,description:"During the Skull Kid's rampage of mischief in Clock Town Kafei, the son of the mayor, vanished without a trace. His mother, sick with worry has been focused on discovering her son's whereabouts.",pageReference:"146",rewards:[Y.kafeiMask,{name:"Bottle (Chateau Romani)",type:"Item"}],steps:[{id:"q10-1",title:"Find My Son!",description:"Madame Aroma has called for investigators to hunt for her missing son, Kafei. Any adventurers that arrive can say they came in answer to her posting. If adventurers manage to convince her with a DC 12 Charisma (Persuasion) check that they need more resources, she will provide investigators with Kafei's mask to help them find her son.",xpReward:50,location:"Mayor's House",characterId:"madame-aroma",curiosityShopUnlock:{itemName:"Amulet of Proof against Detection and Location",id:"si-10a"},itemRewards:[Y.kafeiMask],pageReference:"146",day:1,time:"10:00",endTime:"20:00",days:[1,2]},{id:"q10-2",title:"Make a Special Delivery",description:"If adventurers receive the letter for Madame Aroma during Quest 24-6, they can take it to her. During the final day Madame Aroma can be found inside of the Milk Bar. She has been drinking there all day. Upon receipt of the letter from her son, she will purchase adventurers a magic bottle containing chateau Romani.",xpReward:150,location:"Milk Bar",characterId:"madame-aroma",curiosityShopUnlock:{itemName:"Immovable Rod",id:"si-10b"},itemRewards:[{name:"Bottle (Chateau Romani)",type:"Item"}],day:3,time:"10:00",endTime:"23:00",pageReference:"147",prerequisiteStepId:"q24-6"}],failureConsequence:"If Madame Aroma does not get any word of her sons life, she will remain in Clock Town as the moon comes down, essentially committing suicide."},{id:"q11",questNumber:11,title:"A Stay at the Stock Pot Inn",region:q.ClockTown,description:"Anju, the innkeeper and owner of the Stock Pot Inn has been driven to distraction by the disappearance of her finance and the recent departure of much of her staff. As such, she has had a hard time mixing up guests and reservations.",pageReference:"147",rewards:[{name:"Room Key",type:"Item"}],steps:[{id:"q11-1",title:"Check In",description:`Between 2:00 PM and 4:00 PM on the first day a Goron guest by the name of Link is scheduled to arrive at the Stock Pot Inn. If an adventurer tells Anju their name is Link and that they have a reservation, she will give them a free room key for a room that has been reserved through the entire festival.

The Goron who was scheduled to arrive will actually be relieved, as the moon seems like a much more imminent threat in Clock Town than the cold did in the mountains. He will remain in Clock Town for the rest of the day, then return to the mountain.`,xpReward:120,day:1,time:"14:00",endTime:"16:00",location:"Stock Pot Inn",characterId:"anju",curiosityShopUnlock:{itemName:"Hat of Disguise",id:"si-11"},itemRewards:[{name:"Room Key",type:"Item"}],pageReference:"147"}]},{id:"q12",questNumber:12,title:"A Challenge to Count On",region:q.ClockTown,description:"Between 3 PM and 9 PM on the first and second days, the postman can be found inside of the small apartment in the back of the post office. He keeps the apartment open in case anyone comes in with postal business while he plays his timing game.",pageReference:"147",rewards:[Y.heart],steps:[{id:"q12-1",title:"Win Postman's Game",description:"The postman will challenge adventurers to beat his timing game, and they may pay 20 rupees to take on his challenge. The postman will show an hourglass timer that counts down ten seconds and then hide it from view and flip it. If adventurers who accept the challenge call 'time' precisely at the ten-second mark, he will reward them with a piece of heart. Otherwise they may try again.",xpReward:120,location:"Post Office",characterId:"postman",curiosityShopUnlock:{itemName:"Headband of Intellect",id:"si-12"},itemRewards:[Y.heart],day:1,days:[1,2],time:"15:00",endTime:"21:00",pageReference:"147"}]},{id:"q13",questNumber:13,title:"A Melancholy Melody",region:q.ClockTown,description:"Between 6 PM and midnight of the first and second day Guru-Guru can be found rehearsing with his instrument by the town's laundry pool. A DC 10 Wisdom (Insight) check will show that he is deeply preoccupied with something.",pageReference:"147",rewards:[Y.bremenMask],steps:[{id:"q13-1",title:"Listen to Guru-Guru",description:`Adventurers who convince Guru-Guru to share his story with a DC 16 Charisma (Persuasion) check will find out that he used to be a performer for an animal circus. He played the music for the animals to perform to but felt jealous of the dog that played the circus' ring leader. Guru-Guru will confess that, in a fit of jealousy, he stole the mask the dog wore for the circus act and fled.

After being allowed to vent about this issue, Guru-Guru will ask adventurers if they 'understand his plight,' adventurers can convince them they sincerely understand with either a successful DC 13 Charisma (Deception) or Charisma (Deception) check. If Guru-Guru is convinced of their sincerity, he will give the Bremen mask to the adventurers who listen.`,xpReward:120,location:"Laundry Pool",characterId:"guru-guru",curiosityShopUnlock:{itemName:"Helm of Comprehending Languages",id:"si-13"},itemRewards:[Y.bremenMask],day:1,days:[1,2],time:"18:00",endTime:"24:00",pageReference:"147"}],failureConsequence:"If Guru-Guru doesnt have any catharsis from sharing his story, his future performances will gradually become more stilted and awkward until he retires in shame."},{id:"q14",questNumber:14,title:"A Midnight Attack",region:q.ClockTown,description:"The thief Sakon has caught on to some word that the bomb shop owners will be transporting a new shipment of weapons and high quality gunpowder from the Gorons and has set up an ambush to steal them.",pageReference:"145",rewards:[Y.blastMask,Y.allNightMask],steps:[{id:"q14-1",title:"The Bomb Business",description:`At midnight of the first day (00:00 Day 1), the old lady from the Bomb Shop arrives in North Clock Town carrying merchandise for her son to sell. Sakon the thief attacks her, knocks her down, and runs off with the bomb bags.

If adventurers defeat Sakon (He will drop the bags and flee if he is reduced to half HP), the old lady will gift adventurers with the blast mask and continue to the bomb shop.`,day:1,time:"00:00",endTime:"01:00",location:"N. Clock Town",characterId:"old-lady",xpReward:150,itemRewards:[Y.blastMask],curiosityShopUnlock:{itemName:"Circlet of Blasting",id:"si-14a"},affectsTimeline:!0,pageReference:"147"},{id:"q14-2",title:"Something Else Snatched",description:"If the adventurers completed quest 14-1: The Bomb Business, the all-night mask will be made available for sale at the Curiosity Shop on the night of the third day.",day:3,time:"22:00",endTime:"24:00",location:"Curiosity Shop",xpReward:50,itemRewards:[Y.allNightMask],curiosityShopUnlock:{itemName:"Gloves of Thievery",id:"si-14b"},prerequisiteStepId:"q14-1",pageReference:"148"}],failureConsequence:"If the old woman is not protected, she will not be seriously harmed, but the weapons she is carrying will not be available for sale."},{id:"q15",questNumber:15,title:"The Ghost of the Inn",region:q.ClockTown,description:"Adventurers who go to the Stock Pot Inn's bathroom between midnight and 4 AM will discover that the inn's toilet is haunted. A disembodied hand stretches out from inside the toilet and will plead for paper.",pageReference:"148",rewards:[Y.heart],steps:[{id:"q15-1",title:"Give Paper",description:"If adventurers give the spirit any sort of paper, the ghost will give them a piece of heart.",xpReward:120,location:"Stock Pot Inn Toilet",characterId:"toilet-hand",curiosityShopUnlock:{itemName:"Pipes of the Sewers",id:"si-15"},itemRewards:[Y.heart],day:1,days:[1,2,3],time:"00:00",endTime:"04:00",pageReference:"148"}],failureConsequence:"If the ghost is not calmed, other patrons of the Stock Pot Inn will complain about the strange moaning and groaning they hear in the middle of the night, but otherwise theres no consequence."},{id:"q16",questNumber:16,title:"Target Shooting Champ",region:q.ClockTown,description:"The operator of the Clock Town Shooting Gallery is eager to bring people into their gallery to raise interest and try to get people buying goods from their shop. They charge 20 rupees for challengers to try their skill at the shooting gallery.",pageReference:"148",rewards:[{name:"Large Quiver",type:"Item"},Y.heart],steps:[{id:"q16-1",title:"Clear the Gallery",description:`Inside of the town shooting gallery, the shopkeeper offers an advanced quiver to anyone who can beat their target challenge.

Challengers will be provided with a shortbow and ten arrows. There are seven targets set up, four are 'easy' shots (AC 13) and three are 'hard' (AC 16). If the challenger hits all the targets within ten shots, they will be rewarded with a +2 arrow or +2 crossbow bolt.`,xpReward:100,location:"East Clock Town",curiosityShopUnlock:{itemName:"Bracers of Archery",id:"si-16"},itemRewards:[{name:"Large Quiver",type:"Item"}],time:"06:00",endTime:"22:00",days:[1,2,3],pageReference:"148"},{id:"q16-2",title:"Master the Gallery",description:"If, during the shooting gallery game, challengers never roll below 13 and make at least 3 rolls of 16 or higher, the Shooting Gallery owner will also award them with a piece of heart.",xpReward:100,location:"East Clock Town",curiosityShopUnlock:{itemName:"Quaal's Feather Token (Any)",id:"si-16-2"},itemRewards:[Y.heart],prerequisiteStepId:"q16-1",time:"06:00",endTime:"22:00",days:[1,2,3],pageReference:"148"}]},{id:"q17",questNumber:17,title:"Three Days of Gaming",region:q.ClockTown,description:"Honey and Darling own and operate a little shop that they are constantly rearranging and restructuring. Every day they have a new game available inside the shop. Playing the games costs challengers 15 rupees. If a single challenger wins every single one of their games, Honey and Darling will present them with a piece of heart.",pageReference:"148",rewards:[Y.heart],steps:[{id:"q17-1",title:"Bowling (Day 1)",description:`On the first day, Honey and Darling have set their shop into a bowling lane. Making an attempt costs 10 rupees each time and Honey and Darling offer a purple rupee, worth 50, for the winners.

Challengers have two rounds to knock down all of the pins. Make an improvised weapon check using Strength. A result of 12 is needed to get the ball all the way down the lane. Challengers win after three sets of bowling if they have knocked down at least eight pins in each set.`,day:1,location:"East Clock Town",xpReward:66,curiosityShopUnlock:{itemName:"Gauntlets of Ogre Power",id:"si-17"},time:"10:00",endTime:"17:00",pageReference:"148"},{id:"q17-2",title:"Baskets (Day 2)",description:`For the second day of their games, Honey and Darling have set up a hoop-shoot game. Making an attempt at the game costs challengers 10 rupees to play, and Honey and Darling have offered 50 rupees to winners.

Adventurers have four balls with which to make shots. Shooting the ball is done with an improvised weapon check using Dexterity. Adventurers need five points to win and have four shots in which to win it.`,day:2,location:"East Clock Town",xpReward:66,curiosityShopUnlock:{itemName:"Rope of Climbing",id:"si-17-2"},prerequisiteStepId:"q17-1",time:"10:00",endTime:"17:00",pageReference:"149"},{id:"q17-3",title:"Target Shooting (Day 3)",description:`On the third day, Honey and Darling set up their shop into a target shooting gallery, with the additional quirk that the floor challengers must stand on rotates while the targets also move.

Challengers are given a shortbow and five arrows. When they take a shot they first roll to hit, then draw from a deck of cards. The targets AC is equal to the cards value + 5. Three successful shots win the game and an award of 50 Rupees.`,day:3,location:"East Clock Town",xpReward:66,curiosityShopUnlock:{itemName:"Wand of Magic Missiles",id:"si-17-3"},itemRewards:[Y.heart],prerequisiteStepId:"q17-2",time:"10:00",endTime:"17:00",pageReference:"149"}]},{id:"q18",questNumber:18,title:"Lucky Numbers",region:q.ClockTown,description:"Each day the lottery shop offers a 50 rupee prize to anyone who puts in 5 rupees to guess the winning numbers. Any individual can bet up to 100 rupees, earning a maximum of 1000 rupees per bet. Numbers are recorded, and the same numbers may not be entered twice over the same night. The winning numbers are drawn at 11 PM each night and do not change between iterations.",pageReference:"149",rewards:[{name:"50 Rupees",type:"Item"}],steps:[{id:"q18-1",title:"Win the Lottery",description:"Guess the winning numbers (Day 1, 2, or 3) to win the pot.",xpReward:120,location:"West Clock Town",curiosityShopUnlock:{itemName:"Cloak of Protection",id:"si-18"},itemRewards:[{name:"50 Rupees",type:"Item"}],time:"18:00",endTime:"23:00",days:[1,2,3],pageReference:"149"}]},{id:"q19",questNumber:19,title:"Master Swordsman",region:q.ClockTown,description:"A traveling swordsman has traveled into Clock Town and set up a school to teach people how to fight with the blade. He has devised a test for himself, one that reaches the limit of his ability, and has offered it as a challenge for people to test their swordsmanship skills. He's confident that no one will succeed.",pageReference:"149",rewards:[Y.heart],steps:[{id:"q19-1",title:"Swordsman's Test",description:`The swordsman will set up a series of training platforms upon which adventurers can demonstrate their swordsmanship skills. He has offered a grand prize for the first person to succeed in his challenge. For 50 rupees, adventurers can take the test with the prize on the line, or take the 'normal test' for 20 rupees.

The swordsman has five wooden targets set up in a circle. Each target has an AC of 13 and 10 HP. Challengers have five turns to attack the targets and must destroy at least three of the five dummies to succeed in the swordsmans challenge and be awarded with 200 rupees. If challengers destroy all five targets, the swordsman also awards them with a piece of heart.`,xpReward:75,location:"Swordsman's School",characterId:"tapis",curiosityShopUnlock:{itemName:"Wind Fan",id:"si-19"},itemRewards:[Y.heart],days:[1,2,3],time:"06:00",endTime:"21:00",pageReference:"149"},{id:"q19-2",title:"Duel the Master",description:`If guests have proved themselves through the swordsmans challenges, he will offer them one additional trial, facing the swordsman in battle. A traditional one-on-one duel using blunted weapons. Whichever participant has been dropped down to half their hit point maximum first is the loser of the duel.

If anyone manages to defeat the swordsman, he will offer them a reward of 200 rupees for giving him a fine challenge, and then close his shop for the rest of the day.`,xpReward:125,location:"Swordsman's School",characterId:"tapis",curiosityShopUnlock:{itemName:"Sword of Vengeance",id:"si-19-2"},itemRewards:[{name:"200 Rupees",type:"Item"}],prerequisiteStepId:"q19-1",days:[1,2,3],time:"06:00",endTime:"21:00",pageReference:"149"}]},{id:"q20",questNumber:20,title:"A Treasure-Chest Prize",region:q.ClockTown,description:"The treasure chest game, run by a flirtatious young woman in Clock Town offers a spectacular prize for anyone willing to put up the money to play. Challengers must succeed a series of gambles to advance and, the further they progress, the bigger the ante and the greater the reward.",pageReference:"150",rewards:[Y.heart],steps:[{id:"q20-1",title:"Win the Big Prize",description:`There are four magical chests, once the bet has been made, the three chests will populate with prizes. One chest has a winning prize, one chest has a 'losing' prize, and two chests is empty. If challengers chose the empty chest, they lose the game and have to start over from the beginning.

Win through 10 rounds of increasing ante. Round 10: 100 rupee ante; piece of heart/50 rupees.`,xpReward:200,location:"East Clock Town",curiosityShopUnlock:{itemName:"Deck of Illusions",id:"si-20"},itemRewards:[Y.heart],time:"06:00",endTime:"22:00",days:[1,2,3],pageReference:"150"}]},{id:"q21",questNumber:21,title:"Find Keaton!",region:q.ClockTown,description:"Across Termina are patches of grass that shake oddly, indicating that Keaton is hiding inside of them. Intruding in the grass while wearing the Keaton mask will cause Keaton to appear.",pageReference:"150",rewards:[Y.heart],steps:[{id:"q21-1",title:"Answer Keaton's Riddles",description:`Keaton will quickly realize that the intruders are not actual keaton, but will take it all as a fun game. Keaton will then ask three riddles.

Answering Keatons riddles successfully will endear adventurers to the fey, he will gift them with a piece of heart and offer to share secrets he has learned from observing the world and its people from the grasses.`,location:"N. Clock Town",xpReward:200,curiosityShopUnlock:{itemName:"Wand of Secrets",id:"si-21"},itemRewards:[Y.heart],pageReference:"150"}]},{id:"q22",questNumber:22,title:"Music Moves the Heart",region:q.ClockTown,description:"The owner and operator of the Gorman Troupe was influenced by the first iteration of the band the Indigo-Gos. Wracked with anxiety and depression he has been spending his nights holed up drinking in the Milk Bar.",pageReference:"150",rewards:[Y.troupeMask],steps:[{id:"q22-1",title:"Sound Check at the Milk Bar",description:"Between 10 PM and 5 AM of the first and second nights Toto, the manager of the Zora band the Indigo-Gos is in the Milk Bar to test the bar's acoustics. Adventurers will be asked to perform The Ballad of the Wind Fish. Adventurers can make a DC 15 Charisma (Performance) check to learn and perform the tune for Toto. If the adventurers successfully perform The Ballad of the Wind Fish for Toto, he will offer to give them one of the fine instruments they were performing on.",xpReward:100,location:"Milk Bar",characterId:"toto",curiosityShopUnlock:{itemName:"Instrument of the Bards",id:"si-22"},days:[1,2],time:"22:00",endTime:"05:00",pageReference:"151"},{id:"q22-2",title:"The Troupe Leader's Memories",description:"Arro Gorman, the leader of the Troupe that would have been performing during the upcoming festival, spends his nights inside of the Milk Bar. Upon hearing The Ballad of the Wind Fish, Gorman will be reminded of why he decided to go into theater in the first place. When he was a child, he heard a performance of The Ballad of the Wind fish by the previous members of the Indigo-Gos and was inspired. When Gorman hears the ballad, he will begin weeping openly and give adventurers who perform it the troupe leader's mask in gratitude.",xpReward:100,location:"Milk Bar",characterId:"gorman",curiosityShopUnlock:{itemName:"Elemental Gem (Blue Sapphire)",id:"si-22-2"},itemRewards:[Y.troupeMask],prerequisiteStepId:"q22-1",days:[1,2],time:"22:00",endTime:"05:00",pageReference:"152"}],failureConsequence:"Gorman, already on the verge of a severe episode, will likely do something drastic or harmful if he does not manage to receive this form of catharsis before the festival."},{id:"q23",questNumber:23,title:"Fraternal Milk",region:q.TerminaField,description:`Inigo Gorman has been more than willing to gripe and complain, but when hes deep in his cups hell let slip what he really craves. Inigo is hoping for a taste of home, the milk made at his brothers farm, and he may have a reward for those who can bring him some.
The Gorman brothers are willing to part with some of the milk they offer, but not for money. They want a sword that was used by the garo.
Once defeated, one of the garo will be willing to part with their swords to a worthy victor, but they ask for a hibiscus blossom from the southern swamp, but theyre out of season.
Swampy has a dried hibiscus blossom that hes willing to part with, in exchange for a scale from the bass player of the Indigo-Gos.
Japas will part with a scale, if he can get a special steel guitar pick he commissioned from the mountain smithy.
Gabora will hand over the pick, if he is given a pretty ribbon like the one worn by the winner of the doggy races.
Mamau Yan will hand over one of her prize ribbons if the asker would be so kind as to run to Clock Town and get a bag of dog food one of the Bombers promised to deliver.
Jim Bombazu will pass along the dog food, and give adventurers 5 rupees for reminding him of the promise he failed to honor and completing it for him.
Once Gorman has finished his milk, he will thank the adventurers and gift them with the magic bottle his brothers packed it in, knowing only he would be asking for some.`,pageReference:"151",rewards:[Y.bottle],steps:[{id:"q23-1",title:"The Trading Sequence",description:`1. The Gorman brothers are willing to part with some of the milk they offer, but not for money. They want a sword that was used by the garo.
2. Once defeated, one of the garo will be willing to part with a sword from a weapon cache they concealed when they were alive, but they ask for a hibiscus blossom from the southern swamp, which are unfortunately out of season.
3. Swampy has a dried hibiscus blossom that hes willing to part with, in exchange for a scale from the bass player of the Indigo-Gos.
4. Japas will part with a scale, if he can get a special steel guitar pick he commissioned from the mountain smithy.
5. Gabora will do a rush job for the pick, if he is given a pretty ribbon like the one worn by the winner of the doggy races.
6. Mamau Yan will hand over one of her prize ribbons if the asker would be so kind as to run to Clock Town and get a bag of dog food one of the Bombers promised to deliver.
7. Jim Bombazu will pass along the dog food, and give adventurers 5 rupees for reminding him of the promise he failed to honor and completing it for him.
Once Gorman has finished his milk, he will thank the adventurers and gift them with the magic bottle his brothers packed it in, knowing only he would be asking for some. Gorman also offers that he will speak to his brothers and try to help them reform their business.`,xpReward:200,location:"Various",characterId:"gorman",curiosityShopUnlock:{itemName:"Periapt of Health",id:"si-23"},itemRewards:[Y.bottle],pageReference:"151"}],failureConsequence:"If Gorman does not reconnect with his brothers, he will not be seriously harmed, but the weapons she is carrying will not be available for sale."},{id:"q24",questNumber:24,title:"Anju's Anguish and A Testament of Love",region:q.ClockTown,description:"Anju was Kafei's betrothed, she believes that he'll come back to her and is desperate for any news that could be brought to her. At the same time Kafei, cursed by the skull kid, has been trying to reclaim a mark of their engagement before he feels worthy of returning to Anju and his family.",pageReference:"152",rewards:[Y.couplesMask],steps:[{id:"q24-1",title:"Appointment with Anju",description:"At 1:30, the Mailman arrives at the Stock Pot Inn with a letter to Anju from her missing finance, Kafei. Between 2:00 PM and 8:00 PM on the first day, if an adventurer comes to the Stock Pot Inn and tells Anju that they are looking for Kafei, she will tell them that he has been in touch with her, and to meet her at 11:30 in the inn's kitchen.",xpReward:0,location:"Stock Pot Inn",characterId:"anju",day:1,time:"14:00",endTime:"20:00",curiosityShopUnlock:{itemName:"Keoghtom's Ointment",id:"si-24-1"},pageReference:"152"},{id:"q24-2",title:"A Midnight Request",description:"If adventurers arranged the late-night meeting with Anju, she will be waiting for them in the kitchen at the back of the inn between 11:30 PM and Midnight on the first day. Anju will tell the adventurers about her upcoming wedding and give the adventurer a letter to send to Kafei on her behalf.",xpReward:25,location:"Stock Pot Inn Kitchen",characterId:"anju",day:1,time:"23:30",endTime:"24:00",curiosityShopUnlock:{itemName:"Gloves of Missile Snaring",id:"si-24-2"},prerequisiteStepId:"q24-1",pageReference:"152"},{id:"q24-3",title:"Deliver the Love Letter",description:"The adventurers must place the letter addressed to Kafei in one of the town's mailboxes any time before 9 AM of the second day.",xpReward:0,location:"Clock Town Mailbox",day:2,time:"06:00",endTime:"09:00",curiosityShopUnlock:{itemName:"Sending Stones",id:"si-24-3"},prerequisiteStepId:"q24-2",pageReference:"152"},{id:"q24-4",title:"The Letter's Recipient",description:"Kafei has been hiding out in the apartment behind the Curiosity Shop. If Kafei is found before he receives Anju's letter, he will flee and actively try to avoid any contact with people. After 3:30 PM on the second day, Kafei will have received the letter and is willing to talk to adventurers investigating his disappearance. He will explain how he was cursed by the Skull Kid and his wedding mask was stolen by Sakon the thief. Kafei will give the adventurers his Pendant of Memories to give to Anju.",xpReward:0,location:"Laundry Pool",characterId:"kafei",day:2,time:"15:30",endTime:"16:30",curiosityShopUnlock:{itemName:"Helm of Telepathy",id:"si-24-4"},prerequisiteStepId:"q24-3",pageReference:"152"},{id:"q24-5",title:"Precious Pendant",description:"If Anju receives the Pendant of Memories before 9:00 PM on the second day, she will realize that Kafei still cares and will promise to wait for him, even if the moon comes down.",xpReward:50,location:"Stock Pot Inn",characterId:"anju",day:2,time:"16:30",endTime:"21:00",curiosityShopUnlock:{itemName:"Medallion of Thoughts",id:"si-24-5"},prerequisiteStepId:"q24-4",pageReference:"152"},{id:"q24-6",title:"Kafei's Leftovers",description:"At midnight of the Second day, Sakon the thief will go to the curiosity shop to sell some goods. Kafei will recognize them and give chase. Before he runs off, he will give the Curiosity shop owner a letter to give to his mother. Adventurers that talk to the Curiosity Shop owner about Kafei between 6 AM and 10 PM on the final day will be told that the man has chased after Sakon, where the thief's hideout is located, and be given the letter to deliver to Kafei's mother. In addition to this information, in gratitude for all that adventurers have done to help his friend Kafei, if they agree to help further the Curiosity Shop owner will give them the Keaton mask.",xpReward:0,location:"Curiosity Shop Backroom",day:3,time:"06:00",endTime:"22:00",curiosityShopUnlock:{itemName:"Boots of Elvenkind",id:"si-24-6"},itemRewards:[Y.keatonMask],prerequisiteStepId:"q24-4",pageReference:"152"},{id:"q24-7",title:"Raid Sakon's Hideout",description:"Kafei, having found the thief that stole his wedding mask, is hiding outside the thief's hideout waiting for an opportunity to break in. He has been hiding there since 6:00 AM on the third day. Sakon will exit his hideout at 6:00 PM on the final day, his cavern door closes slowly but, so long as the thief believes he's alone he will leave as soon as it starts shutting. (Sakons passive Perception is 14) Sakon has heard that the sun mask's owner has been coming for him, and set a trap in front of the mask. Unless they adventurers stop him, Kafei will trigger this trap and the hideout entrance will lock, trapping everyone inside. The mask is placed on a conveyor belt that will begin moving towards the end of the hideout. At the end there is a pit that will seal itself shut once weight has been dropped into it. The pit can be opened, but doing so takes at least an hour. Sakon has set up two routes on either side of the conveyor belt, each one has different challenges on each side. The path to the left has monsters, the path to the right has puzzles. The left path has a monster defending the door, the doors on the right path have a number-pad lock on the door, and a puzzle written on the door. The door unlocks with the correct answer. Both paths have 10 rounds to make it from the entrance to the final chamber where there is a button that will seal the pit early, making it possible to simply grab the sun mask.",xpReward:125,location:"Ikana Canyon",characterId:"kafei",day:3,time:"18:00",endTime:"20:00",curiosityShopUnlock:{itemName:"Elemental Gem (Red Corundum)",id:"si-24-7"},prerequisiteStepId:"q24-6",pageReference:"152"},{id:"q24-8",title:"The Couple's Vow",description:"As soon as Kafei has recovered the Sun's mask, he will run back to Clock Town to marry Anju. As soon as he arrives, he begins a hasty ceremony. The sun and moon masks will magically fuse as part of the ceremony and the grateful couple will give adventurers the resulting couple's mask in thanks for all they've done.",xpReward:200,location:"Stock Pot Inn",characterId:"anju",day:3,time:"04:30",endTime:"06:00",curiosityShopUnlock:{itemName:"Ring of Regeneration",id:"si-24-8"},itemRewards:[Y.couplesMask],prerequisiteStepId:"q24-7",pageReference:"153"}],failureConsequence:"If Anju does not receive the pendant before 9:00 in Quest 24-5, she will give up on Kafei and assume he truly has abandoned her. She will flee town with her mother at noon of the third day instead of waiting. If Anju has been assured of Kafeis life and intent, but Kafei was not assisted with Sakon, Anju will wait in Clock Town alone and die under the moon. If Kafei is not accompanied into Sakons hideout, he will be killed, either by the thiefs traps or by Sakon himself."},{id:"q25",questNumber:25,title:"The Never-Ending Meeting",region:q.ClockTown,description:"On the first two days between 10 AM and 8 PM, Clock Town's mayor is trapped in an endless meeting where the foreman of festival construction and the guard captain argue furiously about whether to cancel the ceremony and order an evacuation, or continue as normal. If adventurers arrive wearing the couple's mask, the mayor will be inspired to speak up and propose the compromise that citizens may leave as they wish, and will be recommended to seek shelter, but an evacuation will not be ordered and the workers may continue to set up for the festival. Without the couples mask, calming the meeting will require either a DC20 Charisma (Intimidation) or Charisma (Persuasion) check or the use of the calm emotions spell, though Mutoh and Viscen will both try to resist the spells effect. The mayor, grateful that the meeting has ended, gives adventurers a piece of heart.",pageReference:"153",rewards:[Y.heart],steps:[{id:"q25-1",title:"Resolve the Argument",description:"Enter the Mayor's office wearing the Couple's Mask to silence the argument and bring peace to the meeting.",xpReward:120,location:"Mayor's Office",characterId:"mayor-dotour",days:[1,2],time:"10:00",endTime:"20:00",curiosityShopUnlock:{itemName:"Eversmoking Bottle",id:"si-25"},itemRewards:[Y.heart],pageReference:"153"}],failureConsequence:"If the meeting continues to drag on, there will be increased unrest among the people of Clock Town, as an evacuation has not been ordered and they feel trapped in the city."},{id:"q26",questNumber:26,title:"Grandmother's Stories",region:q.ClockTown,description:"Anju's Grandmother, in the early stages of senility, has been spending most of her time in her room at the Stock Pot Inn. She's pretty bored, and enjoys telling stories so she'll share the stories with people willing to listen. However, she's practiced her storytelling with the goal of getting children to go to sleep and has developed an almost hypnotic cadence to her voice.",pageReference:"153",rewards:[Y.heart],steps:[{id:"q26-1",title:"History of the Carnival",description:"If listeners choose to listen to the story of the carnival, the DM reads the fist paragraph of the carnival story in Appendix G: Legends of Termina, then listeners must make a DC 20 Wisdom saving throw, falling asleep for an hour on a failure. Since this effect is not strictly magical, feats like fey ancestry are not proof against it. However, anyone wearing and attuned to the all-night mask automatically succeeds this check. If at least two listeners succeed the check, or any succeed with a critical, read the entire story. Once the story is concluded ask one of the following questions: What did the traditional masks originally represent? Where do celebrants get their masks for the carnival? How do couples celebrate the carnival? If listeners can correctly answer the question, Granny gives them a piece of heart of being a good child.",xpReward:60,location:"Stock Pot Inn",characterId:"granmere",curiosityShopUnlock:{itemName:"Gem of Brightness",id:"si-26-1"},itemRewards:[Y.heart],days:[1,2],time:"08:00",endTime:"20:00",pageReference:"153"},{id:"q26-2",title:"Termina Mythology",description:"If listeners choose to listen to the story of the giants, the DM reads the fist paragraph of the four giants story in Appendix G: Legends of Termina, then listeners must make a DC 20 Wisdom saving throw, falling asleep for an hour on a failure. Since this effect is not strictly magical, feats like fey ancestry are not proof against it. However, anyone wearing and attuned to the all-night mask automatically succeeds this check. If at least two listeners succeed the check, or any succeed with a critical, read the entire story. Once the story is concluded ask one of the following questions: How far did each giant travel before resting? How do the people call the giants when they need them? Where did the giants send the imp? If listeners can correctly answer the question, Granny gives them a piece of heart of being a good child.",xpReward:60,location:"Stock Pot Inn",characterId:"granmere",curiosityShopUnlock:{itemName:"Necklace of Adaptation",id:"si-26-2"},itemRewards:[Y.heart],days:[1,2],time:"08:00",endTime:"20:00",pageReference:"154"}],failureConsequence:"There is no consequence to not listening to the old womans stories, but shell appreciate it if you do."},{id:"q27",questNumber:27,title:"The Postman's Peril",region:q.ClockTown,description:"The postman refuses to abandon his duty to the town without a direct order to flee. He is a direct subordinate of Madame Aroma and will not leave without her express permission. Madame Aroma will only be willing to give permission to leave if she received the letter from her son during Quest 10-2. Without the letter from Kafei to show her son is alive, she will be petty enough to refuse the postman's request and force him to die with her when the moon crashes. If the postman is allowed to leave he will give adventurers the postman's hat in gratitude, then promptly flee.",pageReference:"154",rewards:[Y.postmanHat],steps:[{id:"q27-1",title:"Free the Postman",description:"After giving the Letter to Mama to Madame Aroma (Quest 10-2), she allows the Postman to flee. Talk to him to receive his hat.",xpReward:120,location:"Milk Bar / Post Office",characterId:"postman",day:3,time:"12:00",endTime:"24:00",curiosityShopUnlock:{itemName:"Boots of Striding and Springing",id:"si-27"},itemRewards:[Y.postmanHat],prerequisiteStepId:"q10-2",pageReference:"154"}],failureConsequence:"If the mailman is not released from his obligations, he will be killed by the moon and may lash out radically against the system that he feels has trapped him."},{id:"q28",questNumber:28,title:"Rescue the Abandoned Fairy",region:q.ClockTown,description:"In the Lost Woods tunnels underneath Clock Town, the fairy Tatl was left trapped and abandoned in a cavern, left behind by the Skull Kid. She has been beaten and abused by the Skull Kid at increasing measure ever since they picked up Majoras Mask. Finally having enough, Tatl stood up to the Skull Kid, and was trapped in the depths under Clock Town. However, her brother, Tael, is still with the Skull Kid, and shes afraid for him. Tatl is eager to fight with the Skull Kid, and will answer any questions adventurers might have about them. Tatl can also be persuaded to accompany adventurers along their quests, and tell them what she knows about Termina, even offering some hints about quests.",pageReference:"154",rewards:[{name:"Tatl (Companion)",type:"Other"}],steps:[{id:"q28-1",title:"Rescue Tatl",description:"Find and rescue Tatl from the caverns under Clock Town. She will join you.",xpReward:120,location:"Under Clock Tower",curiosityShopUnlock:{itemName:"Ring of Spell Storing",id:"si-28"},pageReference:"154"}],failureConsequence:"There is no greater consequence to leaving Tatl alone in the dark. She will eventually be able to make her own way out, though with immense difficulty."},{id:"q29",questNumber:29,title:"Gazing at the Stars",region:q.TerminaField,description:"Inside the Astral Observatory the astronomer has been observing the moon in its descent towards Termina. He has especially been noticing the occasional droplet of small pieces of refined moon stones that have been falling from the descending moon that the astronomer has been calling moons tears. He had collected two so far, but they had been stolen by the Skull Kid. Adventurers can look through the telescope at the moon and see one of the stones dropping from its eye to a random point on Termina Field, where it can be collected. The astronomer is willing to buy the moons tear for 500 rupees, though its easily worth double that. It can also function as an arcane focus.",pageReference:"155",rewards:[Y.moonsTear],steps:[{id:"q29-1",title:"Collect Moon's Tear",description:"Look through the telescope to see a Moon's Tear fall. Collect it outside the observatory.",xpReward:120,location:"Astral Observatory",characterId:"shikashi",curiosityShopUnlock:{itemName:"Pearl of Power",id:"si-29"},itemRewards:[Y.moonsTear],pageReference:"155"}]},{id:"q30",questNumber:30,title:"The Scrub's Secret Stash",region:q.TerminaField,description:"The Clock Town business scrub keeps a hidden stash of goods in a hidden grotto in Termina Field. He is protective of his goods, but willing to sell them at a steep discount if it means keeping the location of his stash secret. The biggest item in the scrubs inventory is a piece of heart, and he is willing to sell it for 150 rupees if adventurers promise to keep the location of his storage stash secret. With a successful DC 16 Charisma (Intimidation) or Charisma (Persuasion) check theyll be willing to let it go for only 100.",pageReference:"155",rewards:[Y.heart],steps:[{id:"q30-1",title:"Buy the Piece of Heart",description:"Find the grotto and buy the Piece of Heart from the scrub for 150 (or 100) rupees.",xpReward:120,location:"Termina Field Grotto",curiosityShopUnlock:{itemName:"Ring of Mind Shielding",id:"si-30"},itemRewards:[Y.heart],pageReference:"155"}]},{id:"q31",questNumber:31,title:"A Dance with Meaning",region:q.World,description:"Kamaro was a skilled dancer and choreographer. At one time they performed for the greatest halls in front of roaring crowds. Their movements were considered inspirational and many are still followed. It is rumored that they were working on a final opus, but they died before they could display it to anyone.",pageReference:"155",rewards:[Y.kamaroMask,Y.heart],steps:[{id:"q31-1",title:"Dancing with a Ghost",description:"During the night, the spirit of Kamaro the dancer manifests atop a stone pillar in the north-western region of Termina fields. Kamaro's spirit appears to the naked eye as a softly glowing, slowly moving, aura of ethereal energy. Kamaro and his dance can be seen clearly with the see invisibility spell or the lens of truth. If player's cast speak with dead with Kamaro's spirit, the ghost will tell them that they hoped to share the dances they created with the world, but died before they were able. Once they hear Kamaro's story, adventurers can cast the song of healing to create Kamaro's mask. Alternatively, Adventurers can make a DC 16 Charisma (Performance) check to replicate Kamaro's dance. If Kamaro sees the adventurers perform his dance, the spirit will pass on and leave Kamaro's mask behind that way.",xpReward:100,location:"North Termina Field",characterId:"kamaro",time:"00:00",endTime:"06:00",curiosityShopUnlock:{itemName:"Oil of Slipperiness",id:"si-31-1"},itemRewards:[Y.kamaroMask],pageReference:"155"},{id:"q31-2",title:"The Rosa Sister's New Groove",description:"Between 8 PM and 2 AM during the first and second days, the Rosa Sisters can be found in the west Clock Town plaza rehearsing dances for the upcoming festival, a DC 13 Wisdom (Insight) check will reveal that the dancers are not too invested in the performance. If adventurers ask, the dancers will confide that they're worried their performance is becoming stale and they have been trying to come up with a new more artistically deep dance for the upcoming festival performance. Adventurers can make a DC 18 Charisma (Performance) check to perform Kamaro's dance for the sisters if they know it, or perform it perfectly if they are wearing Kamaro's mask. Upon seeing it, the sisters will demand a repeat performance so they can learn these moves, and will give the adventurers a piece of heart after learning the dance.",xpReward:100,location:"West Clock Town",characterId:"rosa-sisters",days:[1,2],time:"18:00",endTime:"06:00",curiosityShopUnlock:{itemName:"Eyes of Charming",id:"si-31-2"},itemRewards:[Y.heart],prerequisiteStepId:"q31-1",pageReference:"155"}],failureConsequence:"If Kamaros ghost is not put to rest, he will begin haunting others, scaring traders and travelers in Termina field with his strange ethereal music and ghostly form."},{id:"q32",questNumber:32,title:"A Race Near Milk Road",region:q.TerminaField,description:"Every day between the hours of 6 AM and 6 PM the Gorman brothers operating at their race track and ranch to the south of Romani Ranch will offer horse racing challenges to visitors, demanding 100 rupees to participate in the race. Playing the Minigame. The race runs a length of 300 feet (though this is an abstraction). Every round, each rider must make a Wisdom (Animal Handling) check; with a DC for different types of horses listed in the Table 4-2: Gorman Ranch Racing Horses Table. With each successful Animal Handling check, the first number listed as the Horse's speed is added to its 'running tally.' If the check fails, that horses tally doesn't increase that turn. When a racer's tally equals or exceeds 300, that horse crosses the finish line. A racer can try to move at the higher listed speed by lashing the animal furiously; in this case, the Animal Handling check is made with advantage, but the horse must also make a successful DC 10 Constitution check at the end of this round or its speed is halved for the rest of the race. No initiative is involved. Riders can make their Animal Handling checks in any order, or all at the same time. If two or more horses cross the finish line on the same round, the one with the highest tally wins. If the tallies are the same, the racers tied. In the event of a tie, brawls are likely to break out in track side betting pools. The Gorman Brothers are notorious cheaters. First they will take a false start, automatically adding 5 to their first Animal Handling check. Secondly, they have set traps and stumbling blocks across their racing tracks, they know to avoid them, but if any racer rolls lower than 5 their horses speed will be reduced by half for their next successful round; If a racer succeeds on a DC 14 Wisdom (Perception) check at the beginning of their round, they can avoid the trap and this effect, racers automatically avoid these traps if they have already encountered them. Adventurers that win the race will be awarded garo's mask.",pageReference:"156",rewards:[Y.garoMask],steps:[{id:"q32-1",title:"Beat the Gorman Bros",description:"Pay 100 rupees to race the brothers. Win to receive the Garo's Mask.",xpReward:120,location:"Gorman Track",characterId:"gorman-bros",time:"06:00",endTime:"18:00",curiosityShopUnlock:{itemName:"Saddle of the Cavalier",id:"si-32"},itemRewards:[Y.garoMask],pageReference:"156"}],failureConsequence:"Defeating the Gorman brothers in a race, even despite their cheating, puts a little bit of humility into them. If they are not beaten, they will expand their dirty dealing in gambling and racing."},{id:"q33",questNumber:33,title:"Protect Romani's Cows!",region:q.TerminaField,description:"Every year, at a certain night, monsters have descended on Romani Ranch to kidnap their cows. Only has one person has seen the creatures responsible for the disappearance, young Romani. Everyone around her assumes that Romanis time spent practicing archery is just childish fantasy, but she knows the terrible thing that is coming, and can only assume what will happen if shes not ready.",pageReference:"156",rewards:[{name:"Milk Bottle",type:"Item"}],steps:[{id:"q33-1",title:"Assistant Ghost Stopper",description:"For a few days now, cows have been going missing from Romani Ranch. No evidence has been found that could explain these disappearances. Romani, the younger sister of Cremia for whom the ranch was named, has seen strange creatures she believes are ghosts that have been abducting the ranch's cows. Despite seeing this and knowing why cows have been missing, Romani didn't tell her sister what was happening to keep her from worrying. If adventurers speak to Romani between 6 AM and 6 PM during the first day, she will recruit adventurers to help her protect the farm from the ghosts and tell them to be at the farm by 2:30 AM, which is when the ghosts appeared before.",xpReward:0,location:"Romani Ranch",characterId:"romani",day:1,time:"06:00",endTime:"18:00",curiosityShopUnlock:{itemName:"Driftglobe",id:"si-33-1"},pageReference:"156"},{id:"q33-2",title:"Busting Ghosts",description:"Starting at 2:30 AM and until 5:30 AM flatwoods drones will arrive in waves to attack the ranch's barn and steal the cows protected inside. Playing the Siege. Mark 20 unoccupied points on the map of Romanis Ranch at least 60 feet from the barn and at least 10 feet apart from each other. The DM has a total of 100 flatwoods drones they keep in reserve. At the beginning of each round, the DM roll a D20, rolls of 1-13 are inactive, rolls of 14-20 are active. Drones can only be placed on the map during active rounds and the DM may place a drone into any unoccupied space that they initially marked off. If the space is occupied, instead of summoning a drone, it blasts away any creature or object occuying the space, dealing 4d6 bludgeoning damage and knocking the object 10 feet in a random direction, a drone is still expended from the DMs reserve through this. The siege ends at 6 AM, sunrise, of the next day, or when the DMs reserve of drones has been expended. When the siege concludes, the master drone will fly over, appearing as a ball of bright light, then fly off into the sky.",xpReward:500,location:"Romani Ranch",characterId:"romani",day:2,time:"02:30",endTime:"05:15",curiosityShopUnlock:{itemName:"Robe of Stars",id:"si-33-2"},itemRewards:[{name:"Milk Bottle",type:"Item"}],prerequisiteStepId:"q33-1",affectsTimeline:!0,pageReference:"156"}],failureConsequence:"If the adventurers fail to defend the ranch, Romani will have been psychically assaulted by the they while she was defending the cows. As a result Romani will be sunk into a semi-catatonic state, she will not respond to any stimuli and just sit and watch with a blank expression. Cremia will then abandon everything else to take care of her sister."},{id:"q34",questNumber:34,title:"Protect the Milk",region:q.TerminaField,description:"If adventurers speak with Cremia between 6 AM and 6 PM on the first or second day, she will tell the adventurers that she is planning to make a delivery of food and milk to Clock Town on the night of the second day. She will also tell them that she has been running into bandits during her last few delivery runs and that she would appreciate company and protection. Adventurers can meet Cremia at 6 PM and ride with her on her delivery cart to the delivery destination. Riding down the delivery route, you will discover that the route has been blocked off by a set of heavy iron bars and the cart must cut through the Gorman Race Track to get to Clock Town. If Cremia and the adventurers wait too long at the fence, the Gorman brothers and a small posse, in disguise, will attack there. Otherwise, the two brothers will attack as soon as the delivery cart starts down the Gorman track. The Gorman Brothers are not actively trying to kill anyone and are instead attempting to destroy the goods that Cremia is delivering. The Gorman Brothers posse consists of 1 bandit captain and two bandits per adventurer, all of which are riding horses. Cremia has a large cargo of milk and other supplies on her wagon, which is being pulled by two horses. The wagon has an AC of 14, and the cargo has a collective total of 120 HP which represents the total amount of intact cargo being delivered. If the players arrive in Clock Town with at least half the goods Cremia was delivering, she will reward adventurers with Romani's mask.",pageReference:"157",rewards:[Y.romaniMask],steps:[{id:"q34-1",title:"Escort Cremia",description:"Ride with Cremia at 6 PM on Day 2. Defend the wagon from the Gorman Brothers (masked bandits).",xpReward:500,location:"Milk Road",characterId:"cremia",day:2,time:"18:00",endTime:"20:00",curiosityShopUnlock:{itemName:"Heward's Handy Haversack",id:"si-34"},itemRewards:[Y.romaniMask],prerequisiteStepId:"q33-2",pageReference:"157"}],failureConsequence:"If Cremias shipment is not protected, the bottles will be smashed and Cremia will be severely beaten, or worse. This and other setbacks will be the final nails in Romani Ranchs business, and the farm will eventually collapse."},{id:"q35",questNumber:35,title:"Cucco Shack's Cute Chicks",region:q.TerminaField,description:"The cucco keeper, Grog has had their usual depressive personality made worse by the encroaching moon and the prospect of certain impending death. His only wish is to see his ten cucco chicks grow to adults before they all die. Adventurers may use the Bremen mask's magic to age the chicks to adults. A successful DC 14 Wisdom (Animal Handling) check allows adventurers to round up all the chicks and use the Bremen mask to age the all the chicks at once in half an hour's time. Accomplishing this takes an hour with a check result of 10-12, an hour and a half with a result of 8-10, and two hours for any lower results. In gratitude, Grog will gift adventurers with the bunny hood for showing him his adult cuccos.",pageReference:"157",rewards:[Y.bunnyHood],steps:[{id:"q35-1",title:"Age the Chicks",description:"Use the Bremen Mask to march the ten chicks around until they mature into roosters.",xpReward:120,location:"Romani Ranch",characterId:"grog",time:"06:00",endTime:"20:00",curiosityShopUnlock:{itemName:"Eyes of the Eagle",id:"si-35"},itemRewards:[Y.bunnyHood],pageReference:"157"}],failureConsequence:"Grog is depressed and will continue to sink into that state if the cuccos dont provide that little glimpse of hope. However, outside of Grogs mental health, theres little consequence to not aging the chicks as, so long as the world is saved, theyll grow up anyway."},{id:"q36",questNumber:36,title:"Win Big at the Doggy Race",region:q.TerminaField,description:"Connected to Romani Ranch is the doggy racetrack, a small court run by Mamamu Yan where she takes her small pack of terriers and uses their exercise ring as an excuse to make some money on the side. Visitors can bet on a dog to win and Yan lists the odds based on the previous weeks racing history. Playing the Minigame. Table 4-1: Doggy Track Dogs, lists all the dogs in Mamamu Yans Kennels and their odds at the track. Betters pick a dog and place a bet not exceeding 500 rupees on their chosen racer. The GM rolls a d100 and the result determines the winning dog. Then rolls twice more to determine which dogs place. The winning dog pays out the full value of the payout listed in the table. A second-place dog pays out half the value of the payout listed on the table. A third place dog repays half the value of the bet. Speaking with the Dogs: Betters may try to speak with the racing dogs using an attuned mask of truth or another method. If they do so, they can make a DC 13 Wisdom (Animal Handling) or (Insight) check to pick a good racing dog. On a success, the DM picks a random dog from the list",pageReference:"157",rewards:[Y.heart],steps:[{id:"q36-1",title:"Bet on a Winner",description:"Place a bet and win more than 150 rupees to receive a Piece of Heart.",xpReward:120,location:"Doggy Racetrack",characterId:"mamamu",time:"06:00",endTime:"20:00",curiosityShopUnlock:{itemName:"Bag of Tricks",id:"si-36"},itemRewards:[Y.heart],pageReference:"157"}]},{id:"q37",questNumber:37,title:"Find the Stone-Faced Soldier",region:q.TerminaField,description:"At the entrance to Ikana Canyon the soldier Shiro stands, completely invisible. He can only be seen with the lens of truth or through see invisibility. Upon being discovered, Shiro will tell adventurers that he had always been plain, boring enough that he seemed to just blend into the background. Then, he was cursed with invisibility by the skull kid, but that the witches in the swamp may have a potion that can break the curse. Performing the song of healing for Shiro will indeed break the curse and, in gratitude, he will give adventurers the resulting stone mask.",pageReference:"158",rewards:[Y.stoneMask],steps:[{id:"q37-1",title:"Heal Shiro",description:"Use the Lens of Truth to see Shiro near the stone circle. Give him a Red or Blue potion to heal him.",xpReward:120,location:"Road to Ikana",characterId:"shiro",curiosityShopUnlock:{itemName:"Periapt of Wound Closure",id:"si-37"},itemRewards:[Y.stoneMask],pageReference:"158"}],failureConsequence:"Shiro is invisible and all but abandoned. If he is not rescued and his curse of invisibility broken, he will either starve to death, resort to banditry, or die under the moon."},{id:"q38",questNumber:38,title:"Rescue the Swamp Witch",region:q.SouthernSwamp,description:"Koume, one of the twin witches of the swamp, went into the woods of mystery in search of the rare medicinal herbs and magical ingredients that grow there, but she ran into the Skull Kid who overwhelmed her with the power of Majoras Mask and left her broken inside of the woods. Crippled as she is, the witch is unable to leave the forest under her own power, and the shifting landscape of the forest means she is never in the same place and cant navigate her way out. Map 5-2: The Woods of Mystery shows the layout of the forest and the path adventurers need to follow to reach her. Any deviation from the path will eject travelers from the woods and they will discover they have lost an hour. A small group of monkeyfolk wait outside the woods, they will offer to guide travelers through the woods to Koume if the adventurers pledge to rescue their leader who was imprisoned by the deku. When adventurers reach Koume, they will find her injured and belligerent. She is rude and abrasive, but she knows what she needs, a potion from her sister Kotake will heal her right up, though a cure wounds spell cast at 3rd-level will also heal her. If adventurers leave to tell Kotake about the trouble her sister is in, she will provide them with a magic bottle filled with a potion of greater healing to help her sister, free of charge.",pageReference:"158",rewards:[{name:"Bottle (Red Potion)",type:"Item"}],steps:[{id:"q38-1",title:"Find Koume",description:"Locate the injured Koume in the Woods of Mystery. Get a Red Potion from Kotake at the Potion Shop and bring it to her.",xpReward:200,location:"Woods of Mystery",characterId:"koume",curiosityShopUnlock:{itemName:"Alchemy Jug",id:"si-38"},itemRewards:[{name:"Bottle (Red Potion)",type:"Item"}],pageReference:"158"}],failureConsequence:"Leaving Koume into the woods means leaving her to die. Kotake will go out searching for her sister if she has no word from her, but wont be able to find her in time. The monkeys can find her, but Kotake will ignore their advice. It is possible to save Koumes life by giving the monkeys a potion of healing but without any intervention, the witch will die."},{id:"q39",questNumber:39,title:"Swamp Shooting Champ",region:q.SouthernSwamp,description:"The swamp shooting gallery has moving targets and offers a reward for anyone who can beat their challenge. Taking the challenge costs 40 rupees. Challengers will be provided with a longbow and ten arrows.",pageReference:"158",rewards:[{name:"Largest Quiver",type:"Item"},Y.heart],steps:[{id:"q39-1",title:"Clear the Gallery",description:"The swamp shooting gallery has moving targets and offers a reward for anyone who can beat their challenge. Taking the challenge costs 40 rupees. Challengers will be provided with a longbow and ten arrows. If the challenger hits all the targets, they will be rewarded with a +1 arrow. Playing the Minigame. Set up a deck of cards, removing aces and face cards, then draw a card at the start of each round. Up to six cards. The cards suit determines which target will appear, and its AC, the cards value determines how long it remains on the board. Each target has an HP of 1. Challengers have the ten arrows with which to make their attack, there is no time limit and they are not required to take a shot every round, but they should not know how long an individual target will remain on the field.",xpReward:75,location:"Swamp Shooting Gallery",curiosityShopUnlock:{itemName:"Quiver of Ehlonna",id:"si-39-1"},itemRewards:[{name:"Largest Quiver",type:"Item"}],pageReference:"158"},{id:"q39-2",title:"Master the Gallery",description:"For no additional cost, challengers at the shooting gallery can opt to take the harder trial. Adventurers receive the same gear but the GM, to determine the targets that appear, draw eight cards instead of six. If challengers succeed in hitting all the targets for this challenge, they receive a piece of heart.",xpReward:125,location:"Swamp Shooting Gallery",curiosityShopUnlock:{itemName:"Arrow-Catching Shield",id:"si-39-2"},itemRewards:[Y.heart],prerequisiteStepId:"q39-1",pageReference:"159"}]},{id:"q40",questNumber:40,title:"Swamp Fishing Hole",region:q.SouthernSwamp,description:"The swamp passage has a building built within the trees with a deep-man made pond dug inside of it. The proprietor has stocked this pond with a number and variety of different fish and is offering enthusiasts the chance to win prizes based on the size and variety of the fish they manage to catch. Playing the Minigame. The fishing hole minigame is essentially a modified version of Go Fish. To play the DM shuffles and lays down a deck of cards, then deals seven cards to the fishing player and draw seven cards themselves. The objective is to have at least two different cards of the same value, the higher the value of the card, the rarer the fish, the more cards of that value, the bigger the fish. Once cards have been dealt the fishing player may then make a DC 13 Wisdom (survival) check. On a success, they may shuffle any number of cards back into the deck and draw back up to seven. Then the fishing player may make a DC 14 fishing gear tool check using Wisdom as the ability. On a success, the fishing player may ask the DM if they have any cards of a particular value; if they do, the DM must hand over all cards of that value, and then draw back up to seven, if they do not, the player draws two cards off the top of the deck, then discards down to seven cards, shuffling discarded cards back into the deck. If a player matches four cards, they may put the matches aside and draw back up to seven. After five rounds, the fishing player reveals the best set of four cards they collected, and then make a fishing gear tool check, using Strength or Dexterity, with a DC determined by the fish caught to reel the fish in. The fish available to be caught, the card suits required to catch them, the DC to reel them in, and the prizes awarded are listed in Table 10-X: Swamp Fishing. Some fish are attracted if fishers are wearing a specific mask while they are fishing. These odd fish, along with every other fish variety that has been stocked in the fishing pond is posted on the wall for fishers to consult. The fish that will appear based on the masks you are wearing are: The ancient fish, attracted to the gibdo mask; The cuccofish, attracted to the Bremen mask; The fragrant reekfish, attracted to the mask of scents; The mooranha, attracted to Romani's mask; The postal salmon, attracted to the Postman's hat. If adventurers are not wearing these masks, but assemble the appropriate suit, they instead pull a random trinket from the trinket table in chapter 5 of the Player's Handbook.",pageReference:"159",rewards:[Y.heart],steps:[{id:"q40-1",title:"Catch the Big One",description:"Catch the Colossal Catfish or Lord Chapu Chapu to win a Piece of Heart.",xpReward:200,location:"Swamp Fishing Hole",curiosityShopUnlock:{itemName:"Cloak of Elvenkind",id:"si-40"},itemRewards:[Y.heart],pageReference:"159"}]},{id:"q41",questNumber:41,title:"The Terrifying Swamp House",region:q.SouthernSwamp,description:"Rumors surround the swamp house that a powerful curse holds the mansion in its sway. On entering, travelers will find the twisted form of Henri Maudit. He will tell explorers that he came to the house in search of gold, but was tricked and cursed into the form he now occupied. He will explain that the curse is sustained by creatures inside the house, 10 gold skulltulas. If adventurers can kill all of these monsters, he would be free of the curse and he offers his mask of truth as an incentive. Playing the Minigame. There are 10 gold skulltulas and five curse skulltulas hiding inside of the swamp spider house and each room inside the house has five locations where spiders could be hiding. The DM will pick 15 of those locations and place one type of spider in each. When explorers enter a room their passive perception will allow them to determine if any of the loudly chittering spiders remain hiding in that room, with a DC set by the location the spider is hiding. The DM must include each hiding spot in their description of each room and players may freely investigate with an Intelligence (Investigation) check, its DC also set by the spiders hiding place. When a spider is discovered, players may make a DC 15 Intelligence (Nature) check, or DC 17 Intelligence (Arcana) check to determine what type of spider they have found. The spiders are typically placid, but will attack if agitated. When all 10 gold skulltulas have been destroyed, the curse on Maudit will break and he will award players with the promised mask.",pageReference:"160",rewards:[Y.maskOfTruth],steps:[{id:"q41-1",title:"Break the Curse",description:"Collect all 10 Gold Skulltula tokens in the Swamp Spider House to lift the curse on Henri Maudit.",xpReward:200,location:"Swamp Spider House",characterId:"henri",curiosityShopUnlock:{itemName:"Slippers of Spider Climbing",id:"si-41"},itemRewards:[Y.maskOfTruth],pageReference:"160"}]},{id:"q42",questNumber:42,title:"Pictograph Contest",region:q.SouthernSwamp,description:"With the acquisition of a pictograph box and the ability to take photographs with the device, the Swamp Tourism Bureau has decided to arrange a pictograph contest to showcase the beauty of the swamp. When using the pictograph tool to take photographs of the swamp, you can make what is essentially an improvised tool check using Wisdom to take photographs. The result of the roll determines the quality of the photograph. Photos from a result of 10 or lower comes with an award of 10 rupees. Photos of a result of 11-14 comes with an award of 20 rupees. Photos of a result of 15-19 comes with an award of 50 rupees. Photos of a result of 20 or higher come with an award of 100 rupees.",pageReference:"160",rewards:[Y.heart,Y.heart],steps:[{id:"q42-1",title:"Photo of Tingle",description:"Tingle is the son of the chief of the Swamp Tourism Bureau. Though the man is disappointed by his son and his childish fixation on fairies, and will not speak of him in public, he does still love his son. If the adventurers take a picture of Tingle for the man, he will tear up and award them with a piece of heart.",xpReward:60,location:"Tourism Center",characterId:"swampy",curiosityShopUnlock:{itemName:"Dust of Sneezing and Choking",id:"si-42-1"},itemRewards:[Y.heart],pageReference:"161"},{id:"q42-2",title:"Photo of Deku King",description:"The Deku King has been a reclusive madman hiding inside his palace. Even before the loss of his daughter, the king and his court were practically unseen. If the adventurers manage to sneak a photograph of the Deku King, or convince them to let a photo be taken, the Swamp Tourism Bureau will award the photographers a piece of heart.",xpReward:60,location:"Tourism Center",characterId:"swampy",curiosityShopUnlock:{itemName:"Weapon of Warning",id:"si-42-2"},itemRewards:[Y.heart],pageReference:"161"}]},{id:"q43",questNumber:43,title:"A Hag's New Business",region:q.SouthernSwamp,description:"After Koume has been rescued in quest 38 and Odolwa has been defeated, the witch will start up a new line of business, broom surfing. Koume will say that this game is a competition, and ask for 50 rupees from each participant. Once decided, she will give each challenger a broom of flying and instruct them to race one lap around the natural circuit formed by the swamps water flow, which she will demonstrate for them. Playing the Minigame. As the players fly with the broom, they will have to determine how fast they want to race and then make an Acrobatics check to try and stay on the broom, with a DC determined by the speed at which they are racing as per Table 10-X: Broom Racing Checks. Failing the check by more than 5 results in a stumble, making the next check with a -1. Failing the check by more than 10 will result in the racer falling off. If a racer falls off they can, as a reaction, make a DC 14 Strength (Athletics) or Dexterity (Acrobatics) check to grab hold and climb back on, reducing their speed to 0 for the next round, but keeping them in the race. Koume will follow as the pace-setter, traveling at a speed of 35 feet. Koume will award the winner of the race a piece of heart. If anyone beats her pace time, shell gift the winner (if they beat her time) a magic bottle.",pageReference:"161",rewards:[Y.heart,Y.bottle],steps:[{id:"q43-1",title:"Broom Racing",description:"Win the broom race to get a Piece of Heart. Beat Koume's time for an Empty Bottle.",xpReward:200,location:"Tourism Center",characterId:"koume",prerequisiteStepId:"mq1-2",curiosityShopUnlock:{itemName:"Broom of Flying",id:"si-43"},itemRewards:[Y.heart],pageReference:"161"}]},{id:"q44",questNumber:44,title:"A Royal Rush",region:q.SouthernSwamp,description:"The Deku princess went to try to resolve the poison that was pouring out from Woodfall Temple. With the help of one of the monkeyfolk, she entered the temple, but was captured by Odolwa. Her disappearance threw the Deku Kingdom into chaos, but her return could restore it.",pageReference:"161",rewards:[Y.maskOfScents],steps:[{id:"q44-1",title:"Return the Princess",description:"The Deku Princess can be found in room W13 in Woodfall Temple, accessible through W12 where Odolwa waits. When Odolwa has been defeated, the princess can be rescued. If what has happened is explained to her she will be incensed and demand to be taken back to the Deku Kingdom as soon as possible so she can stop her father and free the innocent monkey.",xpReward:75,location:"Deku Palace",characterId:"deku-king",prerequisiteStepId:"mq1-2",curiosityShopUnlock:{itemName:"Rod of Rulership",id:"si-44-1"},pageReference:"161"},{id:"q44-2",title:"A Monkey's Innocence",description:"The deku king is intent on killing the monkey as retribution for its supposed role in the kidnapping and assumed death of the princess. If the princess is rescued after defeating Odolwa in Quest 44-1, shell be more than able to speak in her friends defense. If the princess is not with you, the deku king will take more convincing. Adventurers will need o develop a reasonable argument (as determined by the DM) and then succeed a DC 15 Charisma (Persuasion) or (Intimidation) check to convince the Deku King to stand down.",xpReward:25,location:"Deku Palace",curiosityShopUnlock:{itemName:"Gloves of Swimming and Climbing",id:"si-44-2"},prerequisiteStepId:"q44-1",pageReference:"161"},{id:"q44-3",title:"Chase the Butler",description:"The king will declare that, for rescuing the princess and proving the innocence of a true ally of the kingdom, the adventurers shall be awarded a prize from within the royal treasury. He then orders the Deku Butler to escort them. The butler will decide to add a final test or game to the award and will begin to dash away, telling followers to simply keep up before running down the castles halls. Playing the Minigame. The Deku Butler has a speed of 30 feet and will use the dash action each round to reach a destination 300 feet away. Once he has reached it, he will close the door after three rounds. To further complicate matters, there are roots and other stumbling blocks lining the passage. The butler knows them each perfectly, but chasing adventurers will need to make Dexterity saving throws every 10 feet, or lose five feet of their movement speed for each failure. To determine the challenge of each Dexterity save, draw a card from a deck; the difficulty equals the cards value +8. Once you have caught up with the deku butler, he will apologize and explain that he was caught up with memories of chasing his lost son down these same halls. After apologizing, he will hand over the mask of scents. If adventurers ask him further about his son, he will tell of a deku hero who left for the tunnels under clock town to seek help from another world, providing an additional hook for quest 5.",xpReward:125,location:"Deku Shrine",characterId:"deku-butler",curiosityShopUnlock:{itemName:"Elemental Gem (Emerald)",id:"si-44-3"},itemRewards:[Y.maskOfScents],prerequisiteStepId:"q44-2",pageReference:"162"}]},{id:"q45",questNumber:45,title:"Follow the Feathers",region:q.NorthernMountain,description:"Nearby the goron shrine, positioned high above the dark chasm below the goron villages cliffs is a small cave that can be seen at the top of a thin spire of stone. Between the cliffs and the cave there are a series of magical platforms that are completely invisible. Goron shaman consider it a rite of passage to leap between the invisible platforms and make it all the way over to the cavern and all the way back. Kaepora Gaebora wants to provide adventurers with another tool to help them oppose Majora, and will place their feathers onto the platforms to guide you.",pageReference:"162",rewards:[Y.lensOfTruth],steps:[{id:"q45-1",title:"Lone Peak Shrine",description:"Cross the chasm using the owl feathers as guides. Inside of the cavern, adventurers can recover the lens of truth. With the lens, adventurers can see the platforms, and no longer need to make Perception checks to see them.",xpReward:120,location:"Goron Village",curiosityShopUnlock:{itemName:"Lantern of Revealing",id:"si-45"},itemRewards:[Y.lensOfTruth],pageReference:"162"}]},{id:"q46",questNumber:46,title:"Absolve the Goron Hero",region:q.NorthernMountain,description:"People in the Mountain Village have been talking about spectral visions of the goron hero, Darmani III, who died trying to end the threats in Snowhead Temple. Rumors have been circling through the villages in the mountain that Darmani cannot rest so long as the gorons are in danger. Inside the Goron Shrine that overlooks the mountain village, the restless spirit of the Goron hero Darmani III lingers over his shrine. The hero attempted to end the curse of ice coming from Snowhead but, unable to see the biggoron blocking the way and blasting away people challenging the slope, he was thrown over the side of the thin passage and fell to his death in the deep caldera.",pageReference:"162",rewards:[Y.goronMask],steps:[{id:"q46-1",title:"Heal Darmani",description:"Darmani is visible on the ethereal plane. Use the Lens of Truth to see Darmani's ghost. If adventurers pledge to finish the Goron hero's work and perform the song of healing, the hero's spirit will pass on and they will receive the races mask (goron). Darmani also had proficiency with drums, and this version of the mask will confer that proficiency.",xpReward:120,location:"Goron Graveyard",characterId:"darmani",curiosityShopUnlock:{itemName:"Ring of the Ram",id:"si-46"},itemRewards:[Y.goronMask],pageReference:"162"}]},{id:"q47",questNumber:47,title:"A Goron's Grief",region:q.NorthernMountain,description:"The winters that have plagued the northern mountains have caused some other problems for the goron that live there. One goron has been keeping the entirety of the goron sanctuary awake, another has been trapped in the cold.",pageReference:"162",rewards:[Y.donGeroMask],steps:[{id:"q47-1",title:"The Elder's Son is Sleepy",description:"None of the gorons that have trapped themselves inside of the goron shrine have been able to sleep since the Goron Elder has left as his son has not stopped crying for a second. The kid seems to have iron and inexhaustible lungs. The youngest goron on the northern mountain, the child of the goron elder, has been screaming incessantly following the death of Darmani and the subsequent disappearance of the goron elder. Play the Goron Lullaby for the Elder's Son to put him to sleep. Use the Rock Sirloin you receive for the next step.",xpReward:100,location:"Goron Shrine",characterId:"goron-child",curiosityShopUnlock:{itemName:"Ring of Warmth",id:"si-47-1"},pageReference:"163"},{id:"q47-2",title:"Feed the Hungry Goron",description:"A goron is so hungry that he climbed up one of the cliff faces by the mountain village trying to find some rich stones that he could eat so he doesnt starve to death. Unfortunately he very obviously got stuck up there. Near the frozen waterfall, on top of it in fact, is a goron who got trapped up there trying to climb the ice in search of minerals to sustain themselves through this unusually lean winter. Throw the Rock Sirloin to the shivering Goron on the ledge in Mountain Village. If adventurers manage to get the goron down and provide them with a rock sirloin, the goron will give them Don Geros mask.",xpReward:100,location:"Mountain Village",characterId:"hungry-goron",curiosityShopUnlock:{itemName:"Boots of the Winterlands",id:"si-47-2"},itemRewards:[Y.donGeroMask],prerequisiteStepId:"q47-1",pageReference:"163"}],failureConsequence:"If Goht is defeated and the mountain thawed, there is little consequence to letting these quests sit by the wayside. If Goht is not defeated, the goron in the sanctuary will be driven out into the cold and likely starve to death with the one on the waterfall while they try to dig out their old mines."},{id:"q48",questNumber:48,title:"Goron Races! Rock N' Roll",region:q.NorthernMountain,description:"The goron have been stiff and exhausted from their forced confinement in the Goron Shrine. Many of them have been talking about how eager they are to stretch their muscles and take place in one of their great rolling races. When the curse of Goht has been broken, the gorons will arrange a great race in celebration and to stretch their muscles after a period of imposed confinement. Visitors are welcome to participate in the races, but the goron will warn people of other races that goron races are a bit... rough.",pageReference:"163",rewards:[Y.goldDust],steps:[{id:"q48-1",title:"Win the Goron Race",description:"Participate in and win the Goron Race after Goht is defeated. Adventurers that win the race will be awarded a magic bottle containing fine gold dust.",xpReward:200,location:"Goron Racetrack",prerequisiteStepId:"mq2-2",curiosityShopUnlock:{itemName:"Mithral Armor",id:"si-48"},itemRewards:[Y.goldDust],pageReference:"163"}]},{id:"q49",questNumber:49,title:"A Sharper Sword",region:q.NorthernMountain,description:"The smiths of the Mountain Village are famous for their high quality weapons, but they havent been able to forge something for some time. Some of the guards in Clock Town may be pining for the kind of quality that those two can offer. In the mountain village to the north of Clock Town there are two master smiths that operate a forge. They have been wanting to show off their skills and demonstrate what their skills and forge are capable of making. In a perverse way, the disasters brought about by Majoras Mask have been the perfect opportunity for them.",pageReference:"163",rewards:[Y.gildedSword],steps:[{id:"q49-1",title:"The Razor Sword",description:"In exchange for 100 rupees, the smiths of the mountain village will agree to reforge any mundane weapon and imbue it with the razor weapon enchantment. The forging and enchantment process will take 24 hours to complete.",xpReward:40,location:"Mountain Smithy",characterId:"smiths",curiosityShopUnlock:{itemName:"Sentinel Shield",id:"si-49-1"},pageReference:"163"},{id:"q49-2",title:"The Gilded Sword",description:"If an adventurer has a weapon enchanted with the Razor Sword enchantment and at least one pound of fine Goron gold dust, then in exchange for 500 rupees the smiths of the mountain village with further enhance the weapon with the golden weapon enchantment. Forging and enhancing the enchantment will take 24 hours to complete.",xpReward:80,location:"Mountain Smithy",characterId:"smiths",prerequisiteStepId:"q49-1",curiosityShopUnlock:{itemName:"Brooch of Shielding",id:"si-49-2"},itemRewards:[Y.gildedSword],pageReference:"164"}]},{id:"q50",questNumber:50,title:"Reunite the Frog Choir",region:q.World,description:"One of the foremost destinations after the winter is the famous frog choir that performs in the northern mountain. Though few people are really aware that the frog choir is intentionally performing, everyone who visits the mountains appreciates the sound. Though they cant perform while the waters are frozen and many of the frogs have left for different places while the band is disbanded. After the winter that blanketed the northern mountains has been thawed with the defeat of Goht, life will return to the ponds of the mountain village. Questions abound as to the famed frog choir will reunite now that it is safe to return to the mountains.",pageReference:"164",rewards:[Y.heart],steps:[{id:"q50-1",title:"Conduct the Choir",description:"A single frog rests on a lily pad... If adventurers are wearing Don Geros Mask, the frog will beg them to reunite the choir and tell them more about where to find the other members. One frog sought civilization and went to Clock Town (it can be found in the laundry pool). Two frogs wanted warmer waters and went to the swamp (one is near the witchs potion shop, the other was transformed into Gekko). The fourth frog went to try sea climes and traveled to the ocean (where they were also transformed into Gekko). Return to Mountain Village in spring to conduct them.",xpReward:200,location:"Mountain Village (Spring)",curiosityShopUnlock:{itemName:"Ring of Jumping",id:"si-50"},itemRewards:[Y.heart],pageReference:"164"}],failureConsequence:"If the frogs are left to their own devices, there will be little consequence to the world at large, but the mountains will have lost a certain verve with their absence."},{id:"q51",questNumber:51,title:"Put the Zora Guitarist to Rest",region:q.WesternSea,description:"The Zora hero and the lead guitarist of the zora band the Indigo-Gos rushed out to the pirates fortress to retrieve the eggs they stole. No one has heard from him since he left. A cloud of gulls hovers over the southern part of the coast, they seem to be pecking at some flotsam or something. Rushing to save the stolen eggs of Lulu Mikau, a warrior and the lead guitarist for the zora band, charged into the Gerudo Pirates fortress. Unfortunately the horde of pirates proved too much for him, and as a reward for his foolish bravery he was beaten near to death and tossed into the ocean. Mikau drifted through the currents, harassed by gulls as he slowly dies.",pageReference:"164",rewards:[Y.zoraMask],steps:[{id:"q51-1",title:"Heal Mikau",description:"Mikau can be easily seen from the shore, a cloud of gulls marking his location. Once on shore, Mikau has enough strength for an impassioned plea. He will tell his rescuers what happened and beg them to save Lulus eggs from the pirates. He tried himself and failed, if only someone could heal him, or could carry on his quest. Mikau knows he is about to die, however, he cannot rest. If adventurers perform the song of healing, Mikau will surrender himself to its power. Mikau will fade away and leave behind the races mask (zora mask).",xpReward:40,location:"Great Bay Coast",characterId:"mikau",curiosityShopUnlock:{itemName:"Ring of Free Action",id:"si-51-1"},itemRewards:[Y.zoraMask],pageReference:"164"},{id:"q51-2",title:"Healing the Guitarist",description:"Mikau can be restored to health with dedication and effort, he has barely any strength left and spare the dying will only buy time. To heal Mikau will require the use of spare the dying to stabilize him, greater restoration to ease his exhaustion, and cure wounds cast at 3rd-level or higher to restore his health. If Mikau is restored to health, he will assist his rescuers.",xpReward:80,location:"Great Bay Coast",characterId:"mikau",curiosityShopUnlock:{itemName:"Philter of Love",id:"si-51-2"},pageReference:"164"}],failureConsequence:"If Mikau is not put to rest, his spirit will begin to haunt Lulu, trying to provide her some comfort or protect her like he couldnt when he was alive. This will only serve to drive her deeper into grief, especially if her eggs still have not been recovered."},{id:"q52",questNumber:52,title:"Ocean Fishing Hole",region:q.WesternSea,description:"Pictures of fish are put up with arrows guiding people down to the fishing hole. Some of the fish depicted are very rare. A small salt water pond built nearby zora cape that the owner has kept climate-controlled and stocked with exotic fish. They offer prizes for fisherman who manage to catch the so-called boss fish in the pond.",pageReference:"165",rewards:[Y.heart],steps:[{id:"q52-1",title:"Catch the Big One",description:"The fish available to be caught include the King Savage Shark and Ace Great Fairy Fish. Successfully catching either of the two fish that come with an award of a piece of heart also comes with an award of 200 XP.",xpReward:200,location:"Ocean Fishing Hole",curiosityShopUnlock:{itemName:"Ring of Water Walking",id:"si-52"},itemRewards:[Y.heart],pageReference:"165"}]},{id:"q53",questNumber:53,title:"A Fish's Wish",region:q.WesternSea,description:"In the Fishermans hut, hes been displaying a prize catch (and one of the few things hes been able to catch lately), an extremely restless seahorse. A seahorse has been captured by the fisherman who lives on the Great Bay coast. The fisherman has the creature on display in a large bowl and will proudly announce that hes the only one skilled enough to have fished something out of the water by pinnacle rock. A DC 14 Wisdom (Insight) check will show that the seahorse looks distressed, more so than a fish in a bowl should look.",pageReference:"165",rewards:[Y.heart],steps:[{id:"q53-1",title:"Seahorse Rescue",description:"The fisherman is reluctant to part with his exotic prize. He will only accept money reluctantly... However, there is something he wants desperately. The fisherman is fixated on the gerudo pirates who live nearby. He believes theyre the most beautiful things in existence. He will offer to exchange the seahorse for a high-quality pictograph of the pirate queen, or for a lock of her hair.",xpReward:75,location:"Fisherman's Hut",characterId:"pescador",curiosityShopUnlock:{itemName:"Cap of Water Breathing",id:"si-53-1"},pageReference:"166"},{id:"q53-2",title:"Defeat Sea Snakes",description:"Using some method to speak with animals will allow explorers to communicate with the seahorse. The fish will explain that it has a partner trapped by monsters in the abyss by pinnacle rock and beg for help to rescue them. Four deep pythons live within the depths of the waters by Pinnacle Rock. The seahorse will be able to guide you through the waters. If the four sea serpents are destroyed, the trapped seahorse will come out and the two seahorses will gift their saviors with a piece of heart.",xpReward:125,location:"Pinnacle Rock",curiosityShopUnlock:{itemName:"Staff of the Python",id:"si-53-2"},itemRewards:[Y.heart],prerequisiteStepId:"q53-1",pageReference:"166"}],failureConsequence:"Trapped down in the abyss, the lost seahorse will eventually either starve to death, or be eaten by the deep pythons when they try to escape."},{id:"q54",questNumber:54,title:"The Suspicious Ocean House",region:q.WesternSea,description:"Strange rumors abound about the abandoned spider house, talk of curses and hidden treasure are floating around. Outside of the Oceanside Spider House, a crowd will slowly gather, hoping to use the building as a shelter when the moon falls. However, each time anyone tries to go in, they almost immediately flee, overwhelmed with terror. The house is cursed, and will not allow weaker souls entry. One of them will inform adventurers that they saw golden spiders inside of the building and that, if they can all be destroyed, the curse will break.",pageReference:"166",rewards:[{name:"Giant's Wallet",type:"Item"}],steps:[{id:"q54-1",title:"Clear the House",description:"To incentivize curse-breakers, the crowd will offer to take up a collection to offer payment to anyone who will break the curse. When all 10 gold skulltulas have been destroyed, the curse on the house will break and the people waiting to take shelter outside will give the adventurers 1,000 rupees (or Giant's Wallet if Day 1).",xpReward:200,location:"Oceanside Spider House",curiosityShopUnlock:{itemName:"Wand of Web",id:"si-54"},itemRewards:[{name:"Giant's Wallet",type:"Item"}],pageReference:"166"}]},{id:"q55",questNumber:55,title:"Spider House Mystery",region:q.WesternSea,description:"The former owner of the spider house has long since left the place abandoned but its rumored that he locked away a valuable treasure somewhere in the building. Six stalchildren have been dispatched to the Oceanside Spider House to investigate its mysteries to potentially aid the kingdom of Ikana. They havent come to any solid conclusions yet, but they have managed to piece together some hints on a treasure hidden within the strange house.",pageReference:"167",rewards:[Y.heart],steps:[{id:"q55-1",title:"Colored Masks Code",description:"If adventurers are wearing the Captains Hat to pass as Captain Keeta, the stalchildren will share what they have learned. Inside of the dining room are a set of four masks... Hitting the switches in the specific order revealed by the stalchildren will open the hatch in the fireplace inside the Oceanside Spider House, allowing access to OS6 and the piece of heart held in a treasure chest inside of it.",xpReward:300,location:"Oceanside Spider House",curiosityShopUnlock:{itemName:"Eyes of Minute Seeing",id:"si-55"},itemRewards:[Y.heart],pageReference:"167"}]},{id:"q56",questNumber:56,title:"Gimme a Break",region:q.WesternSea,description:"An enterprising zora has set up a little game for other Zora to challenge themselves with for strength and accuracy. By the shore of the Great Bay, near Zora Cape, there is an enterprising zora who has set up a small game of skill. They have set up a row of clay pots and a small rack of boomerangs. Anyone can pay 10 rupees to take a shot at smashing all of the pots with one of the boomerangs, and a prize is awarded depending on the level of challenge.",pageReference:"167",rewards:[Y.heart],steps:[{id:"q56-1",title:"Break the Pots",description:"There are six ceramic pots set up on posts in an arcing path. Challengers must throw the boomerang with an improvised ranged weapon check... If you break all pots in one throw, you win a Piece of Heart.",xpReward:200,location:"Zora Cape",curiosityShopUnlock:{itemName:"Wand of the War Mage (+1)",id:"si-56"},itemRewards:[Y.heart],pageReference:"167"}]},{id:"q57",questNumber:57,title:"Race the Beaver Bros",region:q.WesternSea,description:"The pair of beavers that live at the top of the waterfall have been making big talk about how theyre faster than anyone in the water, and have been staking the magic items in their possessions on that claim. The two beaver brothers, Norbert and Daggett, have been calling all comers to try and face them in a race through their new dam. To entice challengers to brave the falls needed to access the dam, they have been staking a magic bottle that theyll give to winners.",pageReference:"168",rewards:[Y.bottle,Y.heart],steps:[{id:"q57-1",title:"Race Daggett",description:"The first challenge is chasing down the younger beaver brother, Daggett... The race is a fair contest... When Daggett is caught, he will acknowledge that he said he would give you a magic bottle, but cant hand it over without his brothers permission.",xpReward:75,location:"Waterfall Rapids",characterId:"beavers",curiosityShopUnlock:{itemName:"Mariner's Armor",id:"si-57-1"},pageReference:"168"},{id:"q57-2",title:"Race Norbert",description:"After Daggett has been caught in a race, he will bring out his older brother Norbert. Norbert asks challengers to take on the same race, with himself as their opponent... When challengers manage to catch Norbert, he will hand over the magic bottle that was promised.",xpReward:125,location:"Waterfall Rapids",characterId:"beavers",prerequisiteStepId:"q57-1",curiosityShopUnlock:{itemName:"Ring of Swimming",id:"si-57-2"},itemRewards:[Y.bottle],pageReference:"168"}]},{id:"q58",questNumber:58,title:"Playing Paparazzi",region:q.WesternSea,description:"With the Indigo-Gos popularity, a lot of the Zora have become massive fans. Some of these zora will pay top dollar for candid pictures of the band. The zora of Zora Cape have become fanatics for the band the Indigo-Gos and they will pay handsomely for memorabilia.",pageReference:"168",rewards:[{name:"Rupees",type:"Item"}],steps:[{id:"q58-1",title:"Photo of Lulu",description:"A zora can be found trying to peer into the private rooms of the bands members. When confronted, they will confess to trying to peer into their private spaces. If adventures have a pictograph box, the zora will offer to purchase candid pictures of the Indigo-Gos for 100 rupees each and an additional 500 rupees for a complete set of photographs. Take a picture of Lulu and sell it to the fan in Zora Hall.",xpReward:120,location:"Zora Hall",characterId:"lulu",curiosityShopUnlock:{itemName:"Cloak of the Manta Ray",id:"si-58"},pageReference:"168"}],failureConsequence:"There is absolutely no consequence for not taking candid photos of the zora band without their knowledge or permission."},{id:"q59",questNumber:59,title:"A Zora Swan Song",region:q.WesternSea,description:"With Lulu, the lead singer of the Indigo-Gos, rendered mute the band has been trying to come up with some new songs that do not involve her, but the band leader hasnt been listening to the other members suggestions. Japas, the bassist for the zora band, has been working with Mikau to develop a new tune for the band. Unfortunately, with Mikau missing, hes missing a jam partner and the work they already did. Mikau wrote the cords down, Japas just tried to remember.",pageReference:"168",rewards:[Y.heart],steps:[{id:"q59-1",title:"Jam Session",description:"Adventurers will need to break into Mikaus room to find his journal... The journal has the cords Japas cant remember, and hell bring the tune to Evan, the bands manager. Evan is reluctant to change the set... but can be convinced... Once Evan has been convinced Japas will gift 'you dudes' with a piece of heart.",xpReward:120,location:"Zora Hall",characterId:"evan",curiosityShopUnlock:{itemName:"Dust of Disappearance",id:"si-59"},itemRewards:[Y.heart],pageReference:"168"}]},{id:"q60",questNumber:60,title:"The Seafarer's Challenge",region:q.WesternSea,description:"Pescador has been talking about opening a side business while fishing is poor, but doesnt want to do it while the Great Bay is under its evil influence. The fisherman has been thinking of ways to expand his income base since the waters of Great Bay started getting murky. But wanted to wait until they cleared to make sure people would stay safe. If Gyorg has been defeated, he will open up his little challenge to the public.",pageReference:"169",rewards:[Y.heart],steps:[{id:"q60-1",title:"Island Hop",description:"The fisherman has lashed together five boats... and used them to connect two small islands... He offers to let people take his challenge for 20 rupees. Jump from one island to the other and light the torch... The first time an adventurer makes it across the boats, the fisherman will reward them with a piece of heart.",xpReward:200,location:"Great Bay Coast",characterId:"pescador",prerequisiteStepId:"mq3-2",curiosityShopUnlock:{itemName:"Trident of Fish Command",id:"si-60"},itemRewards:[Y.heart],pageReference:"169"}]},{id:"q61",questNumber:61,title:"Racing the Captain",region:q.EasternCanyon,description:"The marker on Captain Keetas headstone calls for someone to 'awaken' him and quell his furious flame. Captain Keeta rests underneath the stone walls at the edge of the Ikana Graveyard, his bones becoming a foundation for the structure as his life was a founding pillar of the Ikana military. During the night, Captain Keeta can be risen with the sonata of awakening.",pageReference:"169",rewards:[Y.captainsHat],steps:[{id:"q61-1",title:"Defeat Keeta",description:"Once awakened, Keeta will pose a challenge, he has left a symbol of his authority nearby, and will give it to those who can prove themselves to him in a martial race... If Captain Keeta can be defeated... He will salute the challengers... and 'promoting' them to the ranks of captain in the Ikanan army and giving them the captains hat.",xpReward:200,location:"Ikana Graveyard",characterId:"keeta",curiosityShopUnlock:{itemName:"Dust of Dryness",id:"si-61"},itemRewards:[Y.captainsHat],pageReference:"169"}],failureConsequence:"Leaving Captain Keeta to rest nearby the graveyard has very little consequence on their afterlife, or the surroundings. So long as Twinmold is defeated, very little will happen with Keeta in any way, as nothing will be tethering them to the world any more."},{id:"q62",questNumber:62,title:"You Shall Find Me a Grave Man",region:q.EasternCanyon,description:"The stalfos in the graveyard stalk particular graves at different nights, but their positions and movements almost makes it seem like theyre guarding something. Speaking to the stalchildren that occupy the Ikana Graveyard at night while wearing the captain's hat, allows you to instruct them to open a different grave each night. Each grave has a passage underneath the tomb that hides different rewards secreted away a long time ago.",pageReference:"170",rewards:[Y.heart,{name:"Empty Bottle",type:"Item"},nn.storms],steps:[{id:"q62-1",title:"Day 1 Grave (Flat)",description:"Delving into the first of the coffins... large crypt commemorating the two composer brothers, Flat and Sharp... When explorers approach, they will be greeted by the ghost of Flat... He will teach the explorers the song (Song of Storms) and ask them to help his brother.",xpReward:200,location:"Ikana Graveyard",characterId:"flat",day:1,time:"20:00",endTime:"04:00",curiosityShopUnlock:{itemName:"Javelin of Lightning",id:"si-62-1"},itemRewards:[nn.storms],pageReference:"170"},{id:"q62-2",title:"Day 2 Grave",description:"Underneath the second coffin is a long tunnel leading to a crypt... Inside of the crypt is a single iron knuckle standing guard... When the Iron Knuckle is defeated it will reveal a piece of heart.",xpReward:75,location:"Ikana Graveyard",day:2,time:"20:00",endTime:"04:00",curiosityShopUnlock:{itemName:"Adamantine Armor",id:"si-62-2"},itemRewards:[Y.heart],pageReference:"170"},{id:"q62-3",title:"Day 3 Grave (Dampe)",description:"If adventurers have cleared any of the earlier graves... Damp himself will meet them... He will tell them that the last grave guarded by stalchildren holds a great treasure of Ikana... Once in the tomb, Damp will lead them forwards to a great tomb... three ghosts will appear... The ghosts are three former monarchs of Ikana... they ask for three gifts... When adventurers leave something for the three ghosts... the ghosts disappear and leave behind a pile of riches. A magic bottle, a piece of heart, and 1,000 rupees.",xpReward:325,location:"Ikana Graveyard",characterId:"dampe",day:3,time:"20:00",endTime:"04:00",curiosityShopUnlock:{itemName:"Wand of Magic Detection",id:"si-62-3"},itemRewards:[{name:"Empty Bottle",type:"Item"}],pageReference:"170"}]},{id:"q63",questNumber:63,title:"The Music Box House",region:q.EasternCanyon,description:"A noted archaeologist and his daughter traveled to the old kingdom and began learning about the undead of the valley as well as the old ruins. Their house had once driven away the undead with a water-driven wheel that powered a magical sound, but with the spring stopped up, there's no water to power the wheel.",pageReference:"170",rewards:[Y.gibdoMask],steps:[{id:"q63-1",title:"The Composer's Ghost",description:"At the far east of the old Ikana Kingdom, up the dried river bed, is the spring water cave. Before the curse of undeath spread through Ikana Kingdom the spring spread water through the kingdom, but now the ghost of Sharp has returned, and his curse dried up the spring... If adventurers perform the song of storms for Sharp... Sharp will be able to rest again... he will pass on and the spring will be restored.",xpReward:100,location:"Spring Water Cave",characterId:"sharp",curiosityShopUnlock:{itemName:"Pipes of Haunting",id:"si-63-1"},pageReference:"170"},{id:"q63-2",title:"The Mummy's Curse",description:"The ancient ruins of Ikana Canyon attracted the interest of archaeologist and researcher of the undead, Vater Otou, who brought his daughter with him... Unfortunately Vater was caught in the spread of the curse of undeath... and received a curse himself. Vater has slowly begun to transform into a gibdo... He locked himself away in the basement... If adventurers restore the spring and activate the water wheel that turns the music box which repels the undead, Pamela will begin sneaking outside... If adventurers manage to sneak past Pamela, they will find Vater in the basement... Performing the song of healing for Vater will break the curse, creating the gibdo mask...",xpReward:100,location:"Music Box House",characterId:"vater",prerequisiteStepId:"q63-1",curiosityShopUnlock:{itemName:"Staff of the Adder",id:"si-63-2"},itemRewards:[Y.gibdoMask],pageReference:"171"}],failureConsequence:`If Sharp's ghost is not put to rest and Twinmold remains alive, the old kingdom will stay dried and barren. It will remain uninhabitable without that source of water.

If the archaeologist's curse is not somehow purged, eventually the binds holding him will fail and either he will hurt his daughter, or his daughter will be forced to hurt him.`},{id:"q64",questNumber:64,title:"Beneath the Well",region:q.EasternCanyon,description:"The walls of the Ikana Castle have long since been walled off with thick masonry and rendered inaccessible. The old well, long since dried up, may be another way into the castle. Underneath the well in Ikana Canyon is a warren of tunnels that form a maze leading to the interior of Ikana Castle. The various passages are guarded by gibdo. Communicating with the gibdo using the gibdo mask will reveal that each of the undead is guarding a door, but will open it if they can be provided with a specific item.",pageReference:"171",rewards:[Y.heart,Y.mirrorShield],steps:[{id:"q64-1",title:"Gibdo Trading",description:"The gibdo guarding the doors to the chambers will pose a sort of riddle, and pass on when the answer has been provided to them. Making their way from the well to the entrance underneath Ikana Castle allows access to the Castle courtyard.",xpReward:200,location:"Beneath the Well",curiosityShopUnlock:{itemName:"Bag of Beans",id:"si-64"},itemRewards:[Y.mirrorShield],pageReference:"171"}],failureConsequence:"The spirits under the well are trapped there and bound by their lingering duty. Even if the curse spread by Twinmold is not broken, they will remain within the well."},{id:"q65",questNumber:65,title:"Free the Canyon Ghosts",region:q.EasternCanyon,description:"The Poe Collector, a keeper of strange spirits has four of his prizes that he wants to offer as a challenge for brave travelers. The poe collector stands outside his shop waiting for people to come by. The mysterious man who guards the entrance to Ikana canyon has command over the spirits of four sisters, long dead witches that refuse to pass on. He offers a challenge to those traveling through the canyon. For 30 rupees, adventurers may fight the four poe sisters: Amy, Beth, Joelle, and Meg.",pageReference:"172",rewards:[Y.heart],steps:[{id:"q65-1",title:"Poe Sisters",description:"Defeating the sisters will prompt the gatekeeper to award challengers with a piece of heart.",xpReward:200,location:"Spirit House",characterId:"poe-collector",curiosityShopUnlock:{itemName:"Mace of Terror",id:"si-65"},itemRewards:[Y.heart],pageReference:"172"}],failureConsequence:"If the four spirits are not defeated, they will eventually escape their seals and start to haunt the canyon. However, this could take anywhere from days to decades to actually happen."},{id:"q66",questNumber:66,title:"Vanquished Foes Return",region:q.EasternCanyon,description:"The hidden shrine offers a challenge of combat for those who come to visit the shrine. A whispered voice tells visitors to challenge these angry spirits. Hidden behind the waterfall of the Eastern Canyon (Area I6) is a shrine that holds the spirits of the lesser monsters that were called to serve the great monsters created by the Skull Kid and Majoras Mask. These mini-bosses wait all at once to form a gauntlet to fight those who would challenge them.",pageReference:"172",rewards:[Y.heart],steps:[{id:"q66-1",title:"Secret Shrine",description:"Upon entering the hidden shrine and stepping into the challenge room, you will face the following monsters in the following order... When one is defeated, it immediately fades into dust, the next mini boss will appear... In addition to XP received for defeating the revived minibosses, adventurers will be awarded with 500 XP.",xpReward:500,location:"Secret Shrine",curiosityShopUnlock:{itemName:"Nine Lives Stealer",id:"si-66"},itemRewards:[Y.heart],pageReference:"172"}],failureConsequence:"There is no consequence to not defeating the spirits of the mini bosses."}],lp=[...Ct("b-bomb","Bomb Shop Open","A shop for the discerning customers of all things that explode. Famous for bombs but also sells fireworks and pouches of loose gunpowder.","10:00","23:00",q.ClockTown,"Bomb Shop","Business","propri"),...Ct("b-curiosity","Curiosity Shop Open","A consignment/pawn shop that doesn't ask too many questions about what they're buying and selling. Things that go missing tend to turn up here.","22:00","06:00",q.ClockTown,"Curiosity Shop","Business","kafei"),...Ct("b-trading","Trading Post Open","Sale of gear and equipment. Features windows into the ceiling, a thick layer of sod, plants, and a small creek running through the store.","06:00","21:00",q.ClockTown,"Trading Post","Business"),...Ct("b-lottery","Lottery Shop Open","A small location with a lobby for people to place bets on the lottery and claim winnings. Has a heavily secured back room.","06:00","23:00",q.ClockTown,"Lottery Shop","Business"),...Ct("b-mayor","Mayor's Office Open","Political gridlock.","10:00","20:00",q.ClockTown,"Mayor's Residence","Business","mayor-dotour"),...Ct("b-milk","Milk Bar Open","A members only club named after its signature milk cocktails. The drinking hole of the town's wealthy and well connected. Serves good food and excellent drinks.","10:00","23:00",q.ClockTown,"Milk Bar","Business","talon"),...Ct("b-stockpot","Stock Pot Inn Open","The largest and finest inn in Clock Town. Has had hard times recently after staff fled. Anju has assumed all responsibilities.","08:00","20:30",q.ClockTown,"Stock Pot Inn","Business","anju"),...Ct("b-shooting","Shooting Gallery","A clubhouse for sportsmen and hunters. Sells hunting supplies and offers an archery challenge.","06:00","22:00",q.ClockTown,"Shooting Gallery","Business"),...Ct("b-treasure","Treasure Chest Shop","A game gallery with a simple premise: three chests, a random one has a prize. Choose right to keep playing.","06:00","22:00",q.ClockTown,"Treasure Chest Shop","Business"),...Ct("b-post","Post Office","Residence of the town's postman. Collects mail in the morning, delivers in the afternoon.","09:00","15:00",q.ClockTown,"Post Office","Business","postman",[1,2]),...Ct("b-swordsman","Swordsman's School","Run by a skilled swordsman from another country. Offers to teach the way of the sword and offers a 'test' for a grand reward.","09:00","21:00",q.ClockTown,"Swordsman's School","Business","tapis",[1,2]),{id:"b-swamp-d1",day:1,timeDisplay:"6:00am",sortTime:dt(1,"06:00"),endTime:dt(1,"18:00"),title:"Swamp Tourism",description:"Raised on posts above the marsh with a roof of interwoven vines. Offers boat rides to show off the swamp's beauty.",region:q.SouthernSwamp,location:"Tourism Bureau",category:"Business",condition:{type:"requires_step",stepId:"q38-1"}},{id:"b-swamp-d2",day:2,timeDisplay:"6:00am",sortTime:dt(2,"06:00"),endTime:dt(2,"18:00"),title:"Swamp Tourism",description:"Raised on posts above the marsh with a roof of interwoven vines. Offers boat rides to show off the swamp's beauty.",region:q.SouthernSwamp,location:"Tourism Bureau",category:"Business",condition:{type:"requires_step",stepId:"q38-1"}},{id:"b-swamp-d3",day:3,timeDisplay:"6:00am",sortTime:dt(3,"06:00"),endTime:dt(3,"18:00"),title:"Swamp Tourism",description:"Raised on posts above the marsh with a roof of interwoven vines. Offers boat rides to show off the swamp's beauty.",region:q.SouthernSwamp,location:"Tourism Bureau",category:"Business",condition:{type:"requires_step",stepId:"q38-1"}},...Ct("b-smithy","Mountain Smithy","The largest building of the village. A humble single-room construct sheltered under vast eaves with a great chimney. The two smiths are experts.","06:00","18:00",q.NorthernMountain,"Mountain Smithy","Business","smiths"),...Ct("b-ranch","Romani Ranch","Milk and practice.","06:00","20:00",q.TerminaField,"Romani Ranch","Business","cremia"),...Ct("b-mamamu","Doggy Racetrack","A small dirt racetrack with an assortment of pens. Mamamu Yan keeps her precious pups here.","06:00","20:00",q.TerminaField,"Doggy Racetrack","Business","mamamu"),...Ct("b-gorman","Gorman Track","A large oval track set up to be a fixture of Termina's racing and gambling crowds.","06:00","18:00",q.TerminaField,"Gorman Track","Business","gorman-bros"),...Ct("b-swamp-shoot","Swamp Shooting","A hunting lodge built to take advantage of the animals of the swamp. Expanded to include a shooting gallery.","06:00","22:00",q.SouthernSwamp,"Swamp Shooting Gallery","Business"),...Ct("b-potion","Magic Hag's Potion Shop","Elevated, flask-shaped building atop a large tree. Offers various potions for sale, and can brew rare potions if ingredients are provided.","06:00","18:00",q.SouthernSwamp,"Potion Shop","Business","kotake"),...Ct("b-goron-race","Goron Racetrack","Originally an open-top mine shaped into a rolling racetrack.","06:00","18:00",q.NorthernMountain,"Goron Racetrack","Business",void 0,[1,2,3]).map(h=>({...h,condition:{type:"requires_step",stepId:"mq2-2"}})),{id:"b-ocean-fish-d1",day:1,timeDisplay:"6:00am",sortTime:dt(1,"06:00"),endTime:dt(1,"22:00"),title:"Ocean Fishing",description:"A small salt water pond kept climate-controlled and stocked with exotic fish.",region:q.WesternSea,location:"Ocean Fishing Hole",category:"Business",condition:{type:"requires_step",stepId:"mq3-2"}},{id:"b-ocean-fish-d2",day:2,timeDisplay:"6:00am",sortTime:dt(2,"06:00"),endTime:dt(2,"22:00"),title:"Ocean Fishing",description:"A small salt water pond kept climate-controlled and stocked with exotic fish.",region:q.WesternSea,location:"Ocean Fishing Hole",category:"Business",condition:{type:"requires_step",stepId:"mq3-2"}},{id:"b-ocean-fish-d3",day:3,timeDisplay:"6:00am",sortTime:dt(3,"06:00"),endTime:dt(3,"22:00"),title:"Ocean Fishing",description:"A small salt water pond kept climate-controlled and stocked with exotic fish.",region:q.WesternSea,location:"Ocean Fishing Hole",category:"Business",condition:{type:"requires_step",stepId:"mq3-2"}},{id:"w-moon-crash",day:3,timeDisplay:"6:00am",sortTime:dt(4,"06:00"),title:"MOONFALL",description:"Termina is destroyed.",region:q.World,location:"Clock Town",category:"World Event"}],s0=[],Sf=[{id:"si-1",name:"Cape of the Mountebank",price:3223,requiredStepId:"mq1-1",questName:"Hear the Monkey's Plea",description:"A loose, silky red cloak with gold embroidery.",stats:`Wondrous item, rare (requires attunement)

This cape smells faintly of brimstone. While wearing it, you can use it to cast the Dimension Door spell as an action. This property of the cape can't be used again until the next dawn. When you disappear, you leave behind a cloud of smoke, and you appear in a similar cloud of smoke at your destination. The smoke lightly obscures the space you left and the space you appear in, and it dissipates at the end of your next turn. `},{id:"si-1-2",name:"Dancing Sword",price:9406,requiredStepId:"mq1-2",questName:"Defeat Odolwa",description:"A sleek, perfectly balanced blade that hums when released.",stats:`Weapon (any sword), very rare (requires attunement)

You can use a bonus action to toss this magic sword into the air and speak the command word. When you do so, the sword begins to hover, flies up to 30 feet, and attacks one creature of your choice within 5 feet of it. The sword uses your attack roll and ability score modifier to damage rolls.

While the sword hovers, you can use a bonus action to cause it to fly up to 30 feet to another spot within 30 feet of you. As part of the same bonus action, you can cause the sword to attack one creature within 5 feet of it.

After 4 attacks, it flies up to 30 feet and tries to return to your hand.`},{id:"si-2",name:"Horn of Blasting",price:819,requiredStepId:"mq2-1",questName:"Calm the Goron Child",description:"A curved horn carved from the tusk of a frozen beast.",stats:`Wondrous item, rare

You can use an action to speak the horn's command word and then blow the horn, which emits a thunderous blast in a 30-foot cone that is audible 600 feet away. Each creature in the cone must make a DC 15 Constitution saving throw. On a failed save, a creature takes 5d6 thunder damage and is deafened for 1 minute. On a successful save, a creature takes half as much damage and isn't deafened.

Each use of the horn's magic has a 20 percent chance of causing the horn to explode. The explosion deals 10d6 fire damage to the blower and destroys the horn.`},{id:"si-2-2",name:"Animated Shield",price:9195,requiredStepId:"mq2-2",questName:"Defeat Goht",description:"A heavy steel shield emblazoned with mechanical gears.",stats:`Armor (shield), very rare (requires attunement)

While holding this shield, you can speak its command word as a bonus action to cause it to animate. The shield leaps into the air and hovers in your space to protect you as if you were wielding it, leaving your hands free. The shield remains animated for 1 minute, until you use a bonus action to end this effect, or until you are incapacitated or die, at which point the shield falls to the ground or into your hand if you have one free.`},{id:"si-3",name:"Tentacle Rod",price:640,requiredStepId:"mq3-1",questName:"Recover the Zora's Voice",description:"A strange, rubbery rod with three writhing tendrils at the end.",stats:`Rod, rare (requires attunement)

Made by the Drow, this rod is a magic weapon that ends in three rubbery tentacles. While holding the rod, you can use an action to direct each tentacle to attack a creature you can see within 15 feet of you. Each tentacle makes a melee attack roll with a +9 bonus. On a hit, the tentacle deals 1d6 bludgeoning damage. If you hit a target with all three tentacles, it must make a DC 15 Constitution saving throw. On a failure, the creature's speed is halved, it has disadvantage on Dexterity saving throws, and it can't use reactions for 1 minute.`},{id:"si-3-2",name:"Staff of Thunder and Lightning",price:9379,requiredStepId:"mq3-2",questName:"Defeat Gyorg",description:"A sturdy oak staff engraved with storm motifs.",stats:`Staff, very rare (requires attunement)

This staff can be wielded as a magic quarterstaff that grants a +2 bonus to attack and damage rolls made with it. It also has the following properties:

Lightning Strike: When you hit with a melee attack, you can cause the target to take an extra 2d6 lightning damage.

Thunderclap: When you hit with a melee attack, you can cause the staff to emit a crack of thunder. The target must succeed on a DC 17 Constitution saving throw or become stunned until the end of your next turn.

Lightning: Action to cause a 5-foot wide line of lightning 60 feet long (9d6 lightning damage, Dex save DC 17 half).

Thunder: Action to cause a 60-foot cone of thunder (2d6 thunder damage, Con save DC 17).`},{id:"si-4",name:"Mace of Disruption",price:564,requiredStepId:"mq4-1",questName:"Put the Undead King to Rest",description:"A heavy iron mace that glows with a faint holy light.",stats:`Weapon (mace), rare (requires attunement)
Damage: 1d6
Damage Type: Bludgeoning
Weight: 4

When you hit a fiend or an undead with this magic weapon, that creature takes an extra 2d6 radiant damage. If the target has 25 hit points or fewer after taking this damage, it must succeed on a DC 15 Wisdom saving throw or be destroyed. On a successful save, the creature becomes frightened of you until the end of your next turn.

While you hold this weapon, it sheds bright light in a 20-foot radius and dim light for an additional 20 feet.`},{id:"si-4-2",name:"Carpet of Flying",price:9972,requiredStepId:"mq4-2",questName:"Defeat Twinmold",description:"An ornate rug woven with patterns of clouds and wind.",stats:`Wondrous item, very rare

You can speak the carpet's command word as an action to make the carpet hover and fly. It moves according to your spoken directions, provided that you are within 30 feet of it.

Size: 4 ft. x 6 ft.
Capacity: 400 lb.
Flying Speed: 60 ft.

If the carpet carries more than its capacity, its speed is reduced to 30 feet. It cannot carry more than double its capacity.`},{id:"si-5",name:"Staff of the Woodlands",price:1006,requiredStepId:"q5-1",questName:"Inter the Deku Explorer",description:"A gnarled staff that looks like it grew into its current shape.",stats:`Staff, rare (requires attunement by a druid)
Weight: 4
Properties: Versatile (1d8)
Damage: 1d6
Damage Type: Bludgeoning

+2 bonus to attack and damage rolls made with this magic quarterstaff. +2 bonus to spell attack rolls (Druid spells).

Charges: 10. Regains 1d6+4 daily at dawn.
Spells: Animal Friendship (1 ch), Awaken (5 ch), Barkskin (2 ch), Locate Animals or Plants (2 ch), Speak with Animals (1 ch), Speak with Plants (3 ch), Wall of Thorns (6 ch).

Tree Form: You can use an action to plant one end of the staff in the earth and turn it into a healthy tree (60ft tall, 5ft dia).`},{id:"si-6",name:"Necklace of Prayer Beads",price:2082,requiredStepId:"q6-1",questName:"Restore Great Fairy of Clock Town",description:"A string of beads blessed by the Great Fairy of Magic.",stats:`Wondrous item, rare (requires attunement by a cleric, druid, or paladin)

This necklace has 1d4+2 magic beads made from aquamarine, pearl, or topaz. Each bead contains a spell that you can cast as a bonus action.

Blessing (1 bead): Casts Bless (lvl 1).
Curing (1 bead): Casts Cure Wounds (lvl 2) or Lesser Restoration.
Favor (1 bead): Casts Greater Restoration.
Wind Walk (1 bead): Casts Wind Walk.`},{id:"si-6b",name:"Sun Blade",price:3900,requiredStepId:"q6-2",questName:"Restore Great Fairy of Woodfall",description:"A sword hilt that projects a blade of pure radiance.",stats:`Weapon (longsword), rare (requires attunement)
Damage: 1d8
Damage Type: Radiant
Weight: 3
Properties: Versatile (1d10), Finesse

This item appears to be a longsword hilt. While grasping the hilt, you can use a bonus action to cause a blade of pure radiance to spring into existence, or make the blade disappear. While the blade exists, this magic longsword has the Finesse property. If you are proficient with shortswords or longswords, you are proficient with the sun blade.

You gain a +2 bonus to attack and damage rolls made with this weapon, which deals radiant damage instead of slashing damage. When you hit an undead with it, that target takes an extra 1d8 radiant damage.

The sword's luminous blade emits bright light in a 15-foot radius and dim light for an additional 15 feet. The light is sunlight.`},{id:"si-6c",name:"Mantle of Spell Resistance",price:2219,requiredStepId:"q6-3",questName:"Restore Great Fairy of Snowhead",description:"A shimmering cloak that seems to absorb magical energy.",stats:`Wondrous item, rare (requires attunement)

You have advantage on saving throws against spells while you wear this cloak.`},{id:"si-6d",name:"Bracers of Defense",price:765,requiredStepId:"q6-4",questName:"Restore Great Fairy of Great Bay",description:"Polished silver bracers that deflect blows.",stats:`Wondrous item, rare (requires attunement)
Weight: 0.5

While wearing these bracers, you gain a +2 bonus to AC if you are wearing no armor and using no shield.`},{id:"si-6e",name:"Wings of Flying",price:2597,requiredStepId:"q6-5",questName:"Restore Great Fairy of Stone Tower",description:"A cloak that transforms into bat-like wings.",stats:`Wondrous item, rare (requires attunement)

While wearing this cloak, you can use an action to speak its command word. This turns the cloak into a pair of bat wings or bird wings on your back for 1 hour or until you repeat the command word as an action. The wings give you a flying speed of 60 feet. When they disappear, you can't use them again for 1d12 hours.`},{id:"si-7",name:"Stone of Good Luck",price:167,requiredStepId:"q7-1",questName:"The Bomber's Notebook",description:"A polished agate that feels warm to the touch.",stats:`Wondrous item, uncommon (requires attunement)

While this stone is on your person, you gain a +1 bonus to ability checks and saving throws.`},{id:"si-8a",name:"Winged Boots",price:156,requiredStepId:"q8-1",questName:"Town Deku Flower",description:"Boots with small white wings at the ankles.",stats:`Wondrous item, uncommon (requires attunement)

While you wear these boots, you have a flying speed equal to your walking speed. You can use the boots to fly for up to 4 hours, all at once or in several shorter flights, each one using a minimum of 1 minute from the duration. If you are flying when the duration expires, you descend at a rate of 30 feet per round until you land.`},{id:"si-8b",name:"Goggles of Night",price:100,requiredStepId:"q8-2",questName:"Swamp Deku Flower",description:"Dark lenses that allow vision in absolute darkness.",stats:`Wondrous item, uncommon

While wearing these dark lenses, you have darkvision out to a range of 60 feet. If you already have darkvision, wearing the goggles increases its range by 60 feet.`},{id:"si-8c",name:"Decanter of Endless Water",price:147,requiredStepId:"q8-3",questName:"Mountain Deku Flower",description:"A flask that never runs dry.",stats:`Wondrous item, uncommon
Weight: 2

This stoppered flask sloshes when shaken, even if it is empty. You can use an action to remove the stopper and speak one of three command words:

- 'Stream': produces 1 gallon of water.
- 'Fountain': produces 5 gallons of water.
- 'Geyser': produces 30 gallons of water that gushes forth in a geyser 30 feet long and 1 foot wide. As a bonus action while holding the decanter, you can aim the geyser at a creature you can see within 30 feet of you. The target must succeed on a DC 13 Strength saving throw or take 1d4 bludgeoning damage and fall prone.`},{id:"si-8d",name:"Robe of Useful Items",price:382,requiredStepId:"q8-4",questName:"Ocean Deku Flower",description:"A robe covered in cloth patches of various shapes.",stats:`Wondrous item, uncommon

This robe has cloth patches of various shapes and colors covering it. While wearing the robe, you can use an action to detach one of the patches, causing it to become the object or creature it represents. Patches: 2 Daggers, 2 Bullseye lanterns, 2 Steel mirrors, 2 10-foot poles, 2 Hempen ropes, 2 Sacks. (Plus 4d4 random items).`},{id:"si-9a",name:"Bag of Holding",price:96,requiredStepId:"q9-1",questName:"A Special Gift From the Bank",description:"A bag that is larger on the inside than the outside.",stats:`Wondrous item, uncommon
Weight: 15

This bag has an interior space considerably larger than its outside dimensions, roughly 2 feet in diameter at the mouth and 4 feet deep. The bag can hold up to 500 pounds, not exceeding a volume of 64 cubic feet. The bag weighs 15 pounds, regardless of its contents.`},{id:"si-9b",name:"Elemental Gem (Yellow Diamond)",price:291,requiredStepId:"q9-2",questName:"Breaking the Bank",description:"A gemstone containing the essence of an Earth Elemental.",stats:`Wondrous item, uncommon

This gem contains a mote of elemental energy. When you use an action to break the gem, an Earth Elemental is summoned as if you had cast the Conjure Elemental spell, and the gem is destroyed.`},{id:"si-10a",name:"Amulet of Proof against Detection and Location",price:145,requiredStepId:"q10-1",questName:"Find My Son!",description:"A golden amulet that shields the wearer from divination.",stats:`Wondrous item, uncommon (requires attunement)

While wearing this amulet, you are hidden from divination magic. You can't be targeted by such magic or perceived through magical scrying sensors.`},{id:"si-10b",name:"Immovable Rod",price:300,requiredStepId:"q10-2",questName:"Make a Special Delivery",description:"A flat iron rod with a button on one end.",stats:`Wondrous item, uncommon

This flat iron rod has a button on one end. You can use an action to press the button, which causes the rod to become magically fixed in place. Until you or another creature uses an action to push the button again, the rod doesn't move, even if it is defying gravity. The rod can hold up to 8,000 pounds of weight.`},{id:"si-11",name:"Hat of Disguise",price:156,requiredStepId:"q11-1",questName:"A Stay at the Stock Pot Inn",description:"A simple hat that allows the wearer to alter their appearance.",stats:`Wondrous item, uncommon (requires attunement)

While wearing this hat, you can use an action to cast the Disguise Self spell from it at will. The spell ends if the hat is removed.`},{id:"si-12",name:"Headband of Intellect",price:288,requiredStepId:"q12-1",questName:"A Challenge to Count On",description:"A simple gold headband set with small gems.",stats:`Wondrous item, uncommon (requires attunement)

Your Intelligence score is 19 while you wear this headband. It has no effect on you if your Intelligence is already 19 or higher.`},{id:"si-13",name:"Helm of Comprehending Languages",price:266,requiredStepId:"q13-1",questName:"A Melancholy Melody",description:"A helm that allows understanding of any spoken or written language.",stats:`Wondrous item, uncommon

While wearing this helm, you can use an action to cast the Comprehend Languages spell from it at will.`},{id:"si-14a",name:"Circlet of Blasting",price:97,requiredStepId:"q14-1",questName:"The Bomb Business",description:"A gold circlet that focuses fiery energy.",stats:`Wondrous item, uncommon

While wearing this circlet, you can use an action to cast the Scorching Ray spell with it. When you make the spell's attacks, you do so with an attack bonus of +5. The circlet can't be used this way again until the next dawn.`},{id:"si-14b",name:"Gloves of Thievery",price:380,requiredStepId:"q14-2",questName:"Something Else Snatched",description:"Invisible gloves that enhance dexterity.",stats:`Wondrous item, uncommon

These gloves are invisible while worn. While wearing them, you gain a +5 bonus to Dexterity (Sleight of Hand) checks and Dexterity checks made to pick locks.`},{id:"si-15",name:"Pipes of the Sewers",price:269,requiredStepId:"q15-1",questName:"The Ghost of the Inn",description:"Wooden pipes that attract swarms of rats.",stats:`Wondrous item, uncommon (requires attunement)
Weight: 2

While you are holding these pipes, you are proficient with them. You can play the pipes to summon swarms of rats (1-3 charges) or command existing swarms of rats.`},{id:"si-16",name:"Bracers of Archery",price:340,requiredStepId:"q16-1",questName:"Clear the Town Shooting Gallery",description:"Leather bracers that improve bowmanship.",stats:`Wondrous item, uncommon (requires attunement)

While wearing these bracers, you have proficiency with the longbow and shortbow, and you gain a +2 bonus to damage rolls on ranged attacks made with such weapons.`},{id:"si-16-2",name:"Quaal's Feather Token (Any)",price:2405,requiredStepId:"q16-2",questName:"Master the Town Shooting Gallery",description:"A magical feather that transforms into an object.",stats:`Wondrous item, rare

This tiny object looks like a feather. Different types of feather tokens exist. You can use an action to touch the item to a space and speak its command word. The token disappears and creates the corresponding object (e.g. Boat, Fan, Tree, Whip, Anchor).`},{id:"si-17",name:"Gauntlets of Ogre Power",price:236,requiredStepId:"q17-1",questName:"Bowling",description:"Iron gauntlets that grant immense strength.",stats:`Wondrous item, uncommon (requires attunement)

Your Strength score is 19 while you wear these gauntlets. They have no effect on you if your Strength is already 19 or higher.`},{id:"si-17-2",name:"Rope of Climbing",price:279,requiredStepId:"q17-2",questName:"Baskets",description:"A 60-foot length of rope that moves on command.",stats:`Wondrous item, uncommon
Weight: 3

This 60-foot length of silk rope weighs 3 pounds and can hold up to 3,000 pounds. If you hold one end of the rope and use an action to speak the command word, the rope animates. As a bonus action, you can command the other end to move toward a destination you choose. You can also tell the rope to fasten itself securely or knot itself.`},{id:"si-17-3",name:"Wand of Magic Missiles",price:212,requiredStepId:"q17-3",questName:"Target Shooting",description:"A slender wand that fires darts of magical force.",stats:`Wand, uncommon

This wand has 7 charges. While holding it, you can use an action to expend 1 or more of its charges to cast the Magic Missile spell from it. For 1 charge, you cast the 1st-level version of the spell. You can increase the spell slot level by one for each additional charge you expend. The wand regains 1d6 + 1 expended charges daily at dawn. If you expend the wand's last charge, roll a d20. On a 1, the wand crumbles into ashes and is destroyed.`},{id:"si-18",name:"Cloak of Protection",price:174,requiredStepId:"q18-1",questName:"Lucky Numbers",description:"A sturdy cloak that deflects attacks.",stats:`Wondrous item, uncommon (requires attunement)

You gain a +1 bonus to AC and saving throws while you wear this cloak.`},{id:"si-19",name:"Wind Fan",price:368,requiredStepId:"q19-1",questName:"Swordsman's Test",description:"A fan that creates a gust of wind.",stats:`Wondrous item, uncommon

While holding this fan, you can use an action to cast the Gust of Wind spell (save DC 13) from it. Once used, the fan shouldn't be used again until the next dawn. Each time it is used again before then, it has a cumulative 20 percent chance of not working and tearing into nonmagical tatters.`},{id:"si-19-2",name:"Sword of Vengeance",price:276,requiredStepId:"q19-2",questName:"Duel the Master",description:"A cursed sword that compels the wielder to fight.",stats:`Weapon (any sword), uncommon (requires attunement)
Properties: Cursed

You gain a +1 bonus to attack and damage rolls made with this magic weapon.

Curse: This sword is cursed and possessed by a vengeful spirit. Becoming attuned to it extends the curse to you. As long as you remain cursed, you are unwilling to part with the sword, keeping it on your person at all times. If you take damage while wielding this sword, you must succeed on a DC 15 Wisdom saving throw or become frightened of the attacker until the end of your next turn. While frightened, you must use your action to attack the source of your fear.`},{id:"si-20",name:"Deck of Illusions",price:312,requiredStepId:"q20-1",questName:"A Treasure-Chest Prize",description:"A deck of cards that create major illusions.",stats:`Wondrous item, uncommon

This box contains a set of parchment cards. A full deck has 34 cards. You can use an action to draw a card at random and throw it to the ground within 30 feet of you. An illusion of one or more creatures forms over the thrown card and remains until dispelled. The illusionary creature appears real, of the appropriate size, and behaves as if it were a real creature.`},{id:"si-21",name:"Wand of Secrets",price:280,requiredStepId:"q21-1",questName:"Find Keaton!",description:"A wand that vibrates near secret doors.",stats:`Wand, uncommon

The wand has 3 charges. While holding it, you can use an action to expend 1 of its charges, and if a secret door or trap is within 30 feet of you, the wand pulses and points at the one nearest to you. The wand regains 1d3 expended charges daily at dawn.`},{id:"si-22",name:"Instrument of the Bards",price:8796,requiredStepId:"q22-1",questName:"Sound Check at the Milk Bar",description:"A masterwork instrument granting bardic power.",stats:`Wondrous item, rarity varies (requires attunement by a bard)
Weight: varies

An Instrument of the Bards is an exquisite example of its kind, superior to an ordinary instrument in every way. Seven types of these instruments exist, each named after a legendary bard college.

Spells: You can use an action to play the instrument and cast one of its spells. Once the instrument has been used to cast a spell, it can't be used to cast that spell again until the next dawn. The spells use your spellcasting ability and spell save DC.

All instruments can cast: Fly, Invisibility, Levitate, Protection from Evil and Good.`},{id:"si-22-2",name:"Elemental Gem (Blue Sapphire)",price:111,requiredStepId:"q22-2",questName:"The Troupe Leader's Memories",description:"A gemstone containing the essence of an Air Elemental.",stats:`Wondrous item, uncommon

This gem contains a mote of elemental energy. When you use an action to break the gem, an Air Elemental is summoned as if you had cast the Conjure Elemental spell, and the gem is destroyed.`},{id:"si-23",name:"Periapt of Health",price:323,requiredStepId:"q23-1",questName:"Fraternal Milk",description:"A pendant that grants immunity to disease.",stats:`Wondrous item, uncommon (requires attunement)

You are immune to contracting any disease while you wear this pendant. If you are already infected with a disease, the effects of the disease are suppressed you wear the pendant.`},{id:"si-24-1",name:"Keoghtom's Ointment",price:263,requiredStepId:"q24-1",questName:"Appointment with Anju",description:"A jar of healing ointment.",stats:`Wondrous item, uncommon
Weight: 0.5

This glass jar, 3 inches in diameter, contains 1d4 + 1 doses of a thick mixture that smells faintly of aloe. The jar and its contents weigh 1/2 pound. As an action, one dose of the ointment can be swallowed or applied to the skin. The creature that receives it regains 2d8 + 2 hit points, ceases to be poisoned, and is cured of any disease.`},{id:"si-24-2",name:"Gloves of Missile Snaring",price:224,requiredStepId:"q24-2",questName:"A Midnight Request",description:"Gloves that help catch incoming projectiles.",stats:`Wondrous item, uncommon (requires attunement)

These gloves seem to almost magnetically attract incoming ranged weapon attacks to the wearer's hands. When a ranged weapon attack hits you while you're wearing them, you can use your reaction to reduce the damage by 1d10 + your Dexterity modifier, provided that you have a free hand. If you reduce the damage to 0, you can catch the missile if it is small enough for you to hold in that hand.`},{id:"si-24-3",name:"Sending Stones",price:373,requiredStepId:"q24-3",questName:"Deliver the Love Letter",description:"Two smooth stones that allow communication.",stats:`Wondrous item, uncommon

Sending Stones come in pairs, with each smooth stone carved to match the other so the pairing is easily recognized. While you touch one stone, you can use an action to cast the Sending spell from it. The target is the bearer of the other stone. If no creature bears the other stone, you know that fact as soon as you use the stone and don't cast the spell. Once sending is cast through the stones, they can't be used again until the next dawn.`},{id:"si-24-4",name:"Helm of Telepathy",price:377,requiredStepId:"q24-4",questName:"The Letter's Recipient",description:"A helm that allows the wearer to read thoughts.",stats:`Wondrous item, uncommon (requires attunement)

While wearing this helm, you can use an action to cast the Detect Thoughts spell (save DC 13) from it. As long as you maintain concentration on the spell, you can use a bonus action to send a telepathic message to a creature you are focused on. It can reply using a bonus action to do so while your focus on it continues.

While focusing on a creature with Detect Thoughts, you can use an action to cast the Suggestion spell (save DC 13) from the helm on that creature. Once used, the Suggestion property can't be used again until the next dawn.`},{id:"si-24-5",name:"Medallion of Thoughts",price:385,requiredStepId:"q24-5",questName:"Precious Pendant",description:"A medallion that reads surface thoughts.",stats:`Wondrous item, uncommon (requires attunement)

The medallion has 3 charges. While wearing it, you can use an action and expend 1 charge to cast the Detect Thoughts spell (save DC 13) from it. The medallion regains 1d3 expended charges daily at dawn.`},{id:"si-24-6",name:"Boots of Elvenkind",price:255,requiredStepId:"q24-6",questName:"Kafei's Leftovers",description:"Boots that silence the wearer's steps.",stats:`Wondrous item, uncommon

While you wear these boots, your steps make no sound, regardless of the surface you are moving across. You also have advantage on Dexterity (Stealth) checks that rely on moving silently.`},{id:"si-24-7",name:"Elemental Gem (Red Corundum)",price:325,requiredStepId:"q24-7",questName:"Raid Sakon's Hideout",description:"A gemstone containing the essence of a Fire Elemental.",stats:`Wondrous item, uncommon

This gem contains a mote of elemental energy. When you use an action to break the gem, a Fire Elemental is summoned as if you had cast the Conjure Elemental spell, and the gem is destroyed.`},{id:"si-24-8",name:"Ring of Regeneration",price:9124,requiredStepId:"q24-8",questName:"The Couple's Vow",description:"A ring that slowly heals the wearer.",stats:`Ring, very rare (requires attunement)

While wearing this ring, you regain 1d6 hit points every 10 minutes, provided that you have at least 1 hit point. If you lose a body part, the ring causes the missing part to regrow and return to full functionality after 1d6 + 1 days if you have at least 1 hit point the whole time.`},{id:"si-25",name:"Eversmoking Bottle",price:184,requiredStepId:"q25-1",questName:"The Never-Ending Meeting",description:"A bottle that produces a massive cloud of smoke.",stats:`Wondrous item, uncommon
Weight: 1

Smoke leaks from the lead-stoppered mouth of this brass bottle, which weighs 1 pound. When you use an action to remove the stopper, a cloud of thick smoke pours out in a 60-foot radius from the bottle. The cloud's area is heavily obscured. Each minute the bottle remains open and within the cloud, the radius increases by 10 feet until it reaches its maximum radius of 120 feet. The cloud persists as long as the bottle is open. Closing the bottle requires you to speak its command word as an action.`},{id:"si-26-1",name:"Gem of Brightness",price:389,requiredStepId:"q26-1",questName:"History of the Carnival",description:"A crystal that can emit blinding beams of light.",stats:`Wondrous item, uncommon

This prism has 50 charges. While you are holding it, you can use an action to speak one of three command words to cause one of the following effects:

- The gem sheds bright light in a 30-foot radius and dim light for an additional 30 feet. This effect doesn't expend a charge. It lasts until you use a bonus action to repeat the command word or until you use another function of the gem.
- Expends 1 charge: The gem creates a beam of brilliant light that flashes from it in a 60-foot cone. Each creature in the cone must succeed on a DC 15 Constitution saving throw or become blinded for 1 minute. A creature blinded by this effect makes another Constitution saving throw at the end of each of its turns. On a successful save, it is no longer blinded.
- Expends 5 charges: The gem creates a blinding flash of light in a 60-foot cone. Each creature in the cone must succeed on a DC 15 Constitution saving throw or be blinded for 1 minute. A creature blinded by this effect makes another Constitution saving throw at the end of each of its turns. On a successful save, it is no longer blinded.`},{id:"si-26-2",name:"Necklace of Adaptation",price:159,requiredStepId:"q26-2",questName:"Termina Mythology",description:"A necklace that allows the wearer to breathe in any environment.",stats:`Wondrous item, uncommon (requires attunement)

While wearing this necklace, you can breathe normally in any environment, and you have advantage on saving throws made against harmful gases and vapors (such as cloudkill and stinking cloud effects, inhaled poisons, and the breath weapons of some dragons).`},{id:"si-27",name:"Boots of Striding and Springing",price:197,requiredStepId:"q27-1",questName:"The Postman's Peril",description:"Boots that increase walking speed and jump distance.",stats:`Wondrous item, uncommon (requires attunement)

While you wear these boots, your walking speed becomes 30 feet, unless your walking speed is higher, and your speed isn't reduced if you are encumbered or wearing heavy armor. In addition, you can jump three times the normal distance, though you can't jump farther than your remaining movement would allow.`},{id:"si-28",name:"Ring of Spell Storing",price:655,requiredStepId:"q28-1",questName:"Rescue the Abandoned Fairy",description:"A ring that can store spells for later use.",stats:`Ring, rare (requires attunement)

This ring stores spells cast into it, holding them until the attuned wearer uses them. The ring can store up to 5 levels worth of spells at a time. Any creature can cast a spell of 1st through 5th level into the ring by touching the ring as the spell is cast. The spell has no effect, other than to be stored in the ring. If the ring can't hold the spell, the spell is expended without effect.

While wearing this ring, you can cast any spell stored in it. The spell uses the slot level, spell save DC, spell attack bonus, and spellcasting ability of the original caster, but is otherwise treated as if you cast the spell.`},{id:"si-29",name:"Pearl of Power",price:377,requiredStepId:"q29-1",questName:"Gazing at the Stars",description:"A pearl that can restore a spell slot.",stats:`Wondrous item, uncommon (requires attunement by a spellcaster)

While this pearl is on your person, you can use an action to speak its command word and regain one expended spell slot. If the expended slot was of 4th level or higher, the new slot is 3rd level. Once you use the pearl, it can't be used again until the next dawn.`},{id:"si-30",name:"Ring of Mind Shielding",price:92,requiredStepId:"q30-1",questName:"The Scrub's Secret Stash",description:"A ring that protects the mind from intrusion.",stats:`Ring, uncommon (requires attunement)

While wearing this ring, you are immune to magic that allows other creatures to read your thoughts, determine whether you are lying, know your alignment, or know your creature type. Creatures can telepathically communicate with you only if you allow it.

You can use an action to cause the ring to become invisible until you use another action to make it visible, until you remove the ring, or until you die.

If you die while wearing the ring, your soul enters it, unless it already houses a soul. You can remain in the ring or depart for the afterlife. As long as your soul is in the ring, you can telepathically communicate with any creature wearing it. A wearer can't prevent this telepathic communication.`},{id:"si-31-1",name:"Oil of Slipperiness",price:100,requiredStepId:"q31-1",questName:"Dancing With a Ghost",description:"Oil that grants freedom of movement.",stats:`Potion, uncommon

This sticky black unguent is thick and heavy. You can use an action to spread it over your body, granting you the effect of the Freedom of Movement spell for 8 hours. Alternatively, you can use an action to pour the oil onto the ground, covering a 10-foot square, where it functions like the Grease spell.`},{id:"si-31-2",name:"Eyes of Charming",price:366,requiredStepId:"q31-2",questName:"The Rosa Sister's New Groove",description:"Lenses that allow the casting of charm person.",stats:`Wondrous item, uncommon (requires attunement)

These crystal lenses fit over the eyes. While wearing them, you can use an action to cast the Charm Person spell (save DC 13) on a humanoid within 30 feet of you that you can see. The lenses have 3 charges. The lenses regain all expended charges daily at dawn.`},{id:"si-32",name:"Saddle of the Cavalier",price:294,requiredStepId:"q32-1",questName:"A Race Near Milk Road",description:"A saddle that prevents the rider from being dismounted.",stats:`Wondrous item, uncommon

While in this saddle, you can't be dismounted against your will if you're conscious, and attack rolls against the mount have disadvantage.`},{id:"si-33-1",name:"Driftglobe",price:203,requiredStepId:"q33-1",questName:"Assistant Ghost Stopper",description:"A floating glass sphere that emits light.",stats:`Wondrous item, uncommon
Weight: 1

This small sphere of thick glass weighs 1 pound. If you are within 60 feet of it, you can speak its command word and cause it to emanate the Light or Daylight spell. Once used, the daylight effect can't be used again until the next dawn. You can speak another command word as an action to make the illuminated globe rise into the air and float no more than 5 feet off the ground. The globe hovers in this way until you or another creature grasps it. If you move more than 60 feet from the hovering globe, it follows you until it is within 60 feet of you. It takes the shortest route to do so. If prevented from moving, the globe sinks gently to the ground and becomes inactive, and its light winks out.`},{id:"si-33-2",name:"Robe of Stars",price:9016,requiredStepId:"q33-2",questName:"Busting Ghosts",description:"A dark blue robe embroidered with stars that can be used as missiles.",stats:`Wondrous item, very rare (requires attunement)

This black or dark blue robe is embroidered with small white or silver stars. You gain a +1 bonus to saving throws while you wear it.

Six stars, located on the robe's upper front portion, are particularly large. While wearing this robe, you can use an action to pull off one of the stars and use it to cast Magic Missile as a 5th-level spell. Daily at dusk, 1d6 removed stars reappear on the robe.

While you wear the robe, you can use an action to enter the Astral Plane along with everything you are wearing and carrying. You remain there until you use an action to return to the plane you were on. You reappear in the last space you occupied, or if that space is occupied, the nearest unoccupied space.`},{id:"si-34",name:"Heward's Handy Haversack",price:1522,requiredStepId:"q34-1",questName:"Protect the Milk",description:"A backpack with extra-dimensional pockets.",stats:`Wondrous item, rare
Weight: 5

This backpack has a central pouch and two side pouches. Each side pouch holds up to 20 pounds of material, not exceeding a volume of 2 cubic feet. The central pouch holds up to 80 pounds of material, not exceeding a volume of 8 cubic feet. The haversack always weighs 5 pounds, regardless of its contents.

Placing an object in the haversack follows the normal rules for interacting with objects. Retrieving an item from the haversack requires an action. When you reach into the haversack for a specific item, the item is always magically on top.`},{id:"si-35",name:"Eyes of the Eagle",price:325,requiredStepId:"q35-1",questName:"Cucco Shack's Cute Chicks",description:"Lenses that grant sharp vision.",stats:`Wondrous item, uncommon (requires attunement)

These crystal lenses fit over the eyes. While wearing them, you have advantage on Wisdom (Perception) checks that rely on sight. In conditions of clear visibility, you can make out details of even extremely distant creatures and objects as small as 2 feet across.`},{id:"si-36",name:"Bag of Tricks",price:271,requiredStepId:"q36-1",questName:"Win Big at the Doggy Race",description:"A bag containing fuzzy balls that transform into animals.",stats:`Wondrous item, uncommon
Weight: 0.5

This ordinary bag, made from gray, rust, or tan cloth, appears empty. Reaching inside the bag, however, reveals the presence of a small, fuzzy object. The bag weighs 1/2 pound. You can use an action to pull the fuzzy object from the bag and throw it up to 20 feet away. When the object lands, it transforms into a creature you determine by rolling a d8. The creature is friendly to you and your companions, and it acts on your turn. You can use a bonus action to command how the creature moves and what action it takes on its next turn, or to give it general orders, such as to attack your enemies. In the absence of such orders, the creature acts in a fashion appropriate to its nature. Once three fuzzy objects have been pulled from the bag, the bag can't be used again until the next dawn.`},{id:"si-37",name:"Periapt of Wound Closure",price:313,requiredStepId:"q37-1",questName:"Find the Stone-Faced Soldier",description:"A pendant that stabilizes the wearer.",stats:`Wondrous item, uncommon (requires attunement)

While you wear this pendant, you stabilize whenever you are dying at the start of your turn. In addition, whenever you roll a Hit Die to regain hit points, double the number of hit points it restores.`},{id:"si-38",name:"Alchemy Jug",price:384,requiredStepId:"q38-1",questName:"Rescue the Swamp Witch",description:"A jug that can produce various liquids.",stats:`Wondrous item, uncommon
Weight: 12

This ceramic jug appears to be able to hold a gallon of liquid and weighs 12 pounds whether full or empty. Sloshing sounds come from within the jug when it is shaken, even if the jug is empty. You can use an action and name one liquid from the table below to cause the jug to produce the chosen liquid. Afterward, you can uncork the jug as an action and pour that liquid out, up to 2 gallons per minute. The maximum amount of liquid the jug can produce depends on the liquid you named.

Acid (8 oz), Basic poison (1/2 oz), Beer (4 gal), Honey (1 gal), Mayonnaise (2 gal), Oil (1 qt), Vinegar (2 gal), Water, fresh (8 gal), Water, salt (12 gal), Wine (1 gal).`},{id:"si-39-1",name:"Quiver of Ehlonna",price:195,requiredStepId:"q39-1",questName:"Clear the Swamp Shooting Gallery",description:"A quiver that holds far more arrows than normal.",stats:`Wondrous item, uncommon
Weight: 2

Each of the quiver's three compartments connects to an extradimensional space that allows the quiver to hold numerous items while never weighing more than 2 pounds. The shortest compartment can hold up to sixty arrows, bolts, or similar objects. The midsize compartment holds up to eighteen javelins or similar objects. The longest compartment holds up to six long objects, such as bows, quarterstaffs, or spears.`},{id:"si-39-2",name:"Arrow-Catching Shield",price:2554,requiredStepId:"q39-2",questName:"Master the Swamp Shooting Gallery",description:"A shield that attracts and blocks missiles.",stats:`Armor (shield), rare (requires attunement)

You gain a +2 bonus to AC against ranged attacks while you wield this shield. This bonus is in addition to the shield's normal bonus to AC. In addition, whenever an attacker makes a ranged attack against a target within 10 feet of you, you can use your reaction to become the target of the attack instead.`},{id:"si-40",name:"Cloak of Elvenkind",price:355,requiredStepId:"q40-1",questName:"Swamp Fishing Hole",description:"A cloak that shifts color to camouflage the wearer.",stats:`Wondrous item, uncommon (requires attunement)

While you wear this cloak with its hood up, Wisdom (Perception) checks made to see you have disadvantage, and you have advantage on Dexterity (Stealth) checks made to hide, as the cloak's color shifts to camouflage you.`},{id:"si-41",name:"Slippers of Spider Climbing",price:200,requiredStepId:"q41-1",questName:"The Terrifying Swamp House",description:"Slippers that allow walking on walls.",stats:`Wondrous item, uncommon (requires attunement)

While you wear these light shoes, you can move up, down, and across vertical surfaces and upside down along ceilings, while leaving your hands free. You have a climbing speed equal to your walking speed. However, the slippers don't allow you to move this way on a slippery surface, such as one covered by ice or oil.`},{id:"si-42-1",name:"Dust of Sneezing and Choking",price:141,requiredStepId:"q42-1",questName:"Photo of Tingle",description:"Dust that incapacitates those who breathe it.",stats:`Wondrous item, uncommon

This small container holds enough dust for one use. When you use an action to throw the dust into the air, you and each creature that needs to breathe within 30 feet of you must succeed on a DC 15 Constitution saving throw or become unable to breathe, while sneezing uncontrollably. A creature affected in this way is incapacitated and suffocating. As long as it is conscious, a creature can repeat the saving throw at the end of each of its turns, ending the effect on it on a success. The Lesser Restoration spell can also end the effect on a creature.`},{id:"si-42-2",name:"Weapon of Warning",price:151,requiredStepId:"q42-2",questName:"Photo of Deku King",description:"A weapon that alerts the bearer to danger.",stats:`Weapon (any), uncommon (requires attunement)

This magic weapon warns you of danger. While the weapon is on your person, you have advantage on initiative rolls. In addition, you and any of your companions within 30 feet of you can't be surprised, except when incapacitated by something other than nonmagical sleep. The weapon magically awakens you and your companions within range if any of you are sleeping naturally when combat begins.`},{id:"si-43",name:"Broom of Flying",price:256,requiredStepId:"q43-1",questName:"A Hag's New Business",description:"A wooden broom that can fly.",stats:`Wondrous item, uncommon
Weight: 3

This wooden broom, which weighs 3 pounds, functions like a mundane broom until you stand astride it and speak its command word. It then hovers beneath you and can be ridden in the air. It has a flying speed of 50 feet. It can carry up to 400 pounds, but its flying speed becomes 30 feet while carrying over 200 pounds. The broom stops hovering when you land.`},{id:"si-44-1",name:"Rod of Rulership",price:1168,requiredStepId:"q44-1",questName:"Rescue the Deku Princess",description:"A rod that can charm huge groups.",stats:`Rod, rare (requires attunement)

You can use an action to present the rod and command obedience from each creature of your choice that you can see within 120 feet of you. Each target must succeed on a DC 15 Wisdom saving throw or be charmed by you for 8 hours. While charmed in this way, the creature regards you as its trusted leader. If harmed by you or your companions, or commanded to do something contrary to its nature, a target ceases to be charmed in this way. The rod can't be used again until the next dawn.`},{id:"si-44-2",name:"Gloves of Swimming and Climbing",price:83,requiredStepId:"q44-2",questName:"A Monkey's Innocence",description:"Gloves that assist in movement.",stats:`Wondrous item, uncommon (requires attunement)

While wearing these gloves, climbing and swimming doesn't cost you extra movement, and you gain a +5 bonus to Strength (Athletics) checks made to climb or swim.`},{id:"si-44-3",name:"Elemental Gem (Emerald)",price:240,requiredStepId:"q44-3",questName:"Chase the Deku Butler",description:"A gemstone containing the essence of a Water Elemental.",stats:`Wondrous item, uncommon

This gem contains a mote of elemental energy. When you use an action to break the gem, a Water Elemental is summoned as if you had cast the Conjure Elemental spell, and the gem is destroyed.`},{id:"si-45",name:"Lantern of Revealing",price:86,requiredStepId:"q45-1",questName:"Follow the Feathers",description:"A hooded lantern that reveals invisible creatures.",stats:`Wondrous item, uncommon

While lit, this hooded lantern burns for 6 hours on 1 pint of oil, shedding bright light in a 30-foot radius and dim light for an additional 30 feet. Invisible creatures and objects are visible as long as they are in the lantern's bright light. You can use an action to lower the hood, reducing the light to dim light in a 5-foot radius.`},{id:"si-46",name:"Ring of the Ram",price:1568,requiredStepId:"q46-1",questName:"Absolve the Goron Hero",description:"A ring carved to resemble a ram's head.",stats:`Ring, rare (requires attunement)

This ring has 3 charges, and it regains 1d3 expended charges daily at dawn. While wearing the ring, you can use an action to expend 1 to 3 of its charges to attack one creature you can see within 60 feet of you. The ring produces a spectral ram's head and makes its attack roll with a +7 bonus. On a hit, for each charge you spend, the target takes 2d10 force damage and is pushed 5 feet away from you. Alternatively, you can expend 1 to 3 charges as an action to try to break an object you can see within 60 feet of you that isn't being worn or carried. The ring makes a Strength check with a +5 bonus for each charge you spend.`},{id:"si-47-1",name:"Ring of Warmth",price:336,requiredStepId:"q47-1",questName:"The Elder's Son is Sleepy",description:"A ring that keeps the wearer warm.",stats:`Ring, uncommon (requires attunement)

While wearing this ring, you have resistance to cold damage. In addition, you and everything you wear and carry are unharmed by temperatures as low as -50 degrees Fahrenheit.`},{id:"si-47-2",name:"Boots of the Winterlands",price:126,requiredStepId:"q47-2",questName:"Feed the Hungry Goron",description:"Furred boots that protect against cold.",stats:`Wondrous item, uncommon (requires attunement)

These furred boots are snug and feel quite warm. While you wear them, you gain the following benefits:
- You have resistance to cold damage.
- You ignore difficult terrain created by ice or snow.
- You can tolerate temperatures as low as -50 degrees Fahrenheit without any additional protection. If you wear heavy clothes, you can tolerate temperatures as low as -100 degrees Fahrenheit.`},{id:"si-48",name:"Mithral Armor",price:249,requiredStepId:"q48-1",questName:"Goron Races! Rock N' Roll",description:"Armor that is light and flexible.",stats:`Armor (medium or heavy, but not hide), uncommon

Mithral is a light, flexible metal. A mithral chain shirt or breastplate can be worn under normal clothes. If the armor normally imposes disadvantage on Dexterity (Stealth) checks or has a Strength requirement, the mithral version of the armor doesn't.`},{id:"si-49-1",name:"Sentinel Shield",price:360,requiredStepId:"q49-1",questName:"The Famous Razor Sword",description:"A shield emblazoned with an eye.",stats:`Armor (shield), uncommon

While holding this shield, you have advantage on initiative rolls and Wisdom (Perception) checks. The shield is emblazoned with a symbol of an eye.`},{id:"si-49-2",name:"Brooch of Shielding",price:220,requiredStepId:"q49-2",questName:"The Glorious Golden Sword",description:"A brooch that protects against force damage.",stats:`Wondrous item, uncommon (requires attunement)

While wearing this brooch, you have resistance to force damage, and you are immune to damage from the Magic Missile spell.`},{id:"si-50",name:"Ring of Jumping",price:370,requiredStepId:"q50-1",questName:"Reunite the Frog Choir",description:"A ring that enhances jump distance.",stats:`Ring, uncommon (requires attunement)

While wearing this ring, you can use a bonus action to cast the Jump spell from it at will, but can target only yourself.`},{id:"si-51-1",name:"Ring of Free Action",price:2071,requiredStepId:"q51-1",questName:"Put the Zora Guitarist to Rest",description:"A ring that prevents movement restrictions.",stats:`Ring, rare (requires attunement)

While you wear this ring, difficult terrain doesn't cost you extra movement. In addition, magic can neither reduce your speed nor cause you to be paralyzed or restrained.`},{id:"si-51-2",name:"Philter of Love",price:163,requiredStepId:"q51-2",questName:"Healing the Guitarist",description:"A potion that causes infatuation.",stats:`Potion, uncommon

The next time you see a creature within 10 minutes after drinking this philter, you become charmed by that creature for 1 hour. If the creature is of a species and gender you are normally attracted to, you regard it as your true love while you are charmed.`},{id:"si-52",name:"Ring of Water Walking",price:92,requiredStepId:"q52-1",questName:"Ocean Fishing Hole",description:"A ring that allows walking on liquid.",stats:`Ring, uncommon

While wearing this ring, you can stand on and move across any liquid surface as if it were solid ground.`},{id:"si-53-1",name:"Cap of Water Breathing",price:172,requiredStepId:"q53-1",questName:"Seahorse Rescue Mission",description:"A cap that allows breathing underwater.",stats:`Wondrous item, uncommon

While wearing this cap underwater, you can speak its command word as an action to create a bubble of air around your head. It allows you to breathe normally underwater. This bubble stays with you until you speak the command word again, the cap is removed, or you are no longer underwater.`},{id:"si-53-2",name:"Staff of the Python",price:256,requiredStepId:"q53-2",questName:"Defeat the Sea Snakes",description:"A staff that transforms into a giant snake.",stats:`Staff, uncommon (requires attunement by a cleric, druid, or warlock)

You can use an action to speak this staff's command word and throw the staff on the ground within 10 feet of you. The staff becomes a Giant Constrictor Snake under your control and acts on its own initiative count. By using a bonus action to speak the command word again, you return the staff to its normal form in a space formerly occupied by the snake. On your turn, you can mentally command the snake if it is within 60 feet of you and you aren't incapacitated. If the snake is reduced to 0 hit points, it dies and reverts to its staff form. The staff then shatters and is destroyed. If the snake reverts to staff form before losing all its hit points, it regains all of them.`},{id:"si-54",name:"Wand of Web",price:389,requiredStepId:"q54-1",questName:"The Suspicious Ocean House",description:"A wand that casts Web.",stats:`Wand, uncommon (requires attunement by a spellcaster)

This wand has 7 charges. While holding it, you can use an action to expend 1 of its charges to cast the Web spell (save DC 15) from it. The wand regains 1d6 + 1 expended charges daily at dawn. If you expend the wand's last charge, roll a d20. On a 1, the wand crumbles into ashes and is destroyed.`},{id:"si-55",name:"Eyes of Minute Seeing",price:183,requiredStepId:"q55-1",questName:"Spider House Mystery",description:"Lenses that magnify small details.",stats:`Wondrous item, uncommon

These crystal lenses fit over the eyes. While wearing them, you have advantage on Intelligence (Investigation) checks that rely on sight while searching an area or studying an object within 1 foot of you.`},{id:"si-56",name:"Wand of the War Mage (+1)",price:306,requiredStepId:"q56-1",questName:"Gimme a Break",description:"A wand that enhances spell attacks.",stats:`Wand, uncommon (requires attunement by a spellcaster)

While holding this wand, you gain a +1 bonus to spell attack rolls. In addition, you ignore half cover when making a spell attack.`},{id:"si-57-1",name:"Mariner's Armor",price:225,requiredStepId:"q57-1",questName:"Pro Swimmer",description:"Armor that assists in swimming.",stats:`Armor (medium or heavy), uncommon

While wearing this armor, you have a swimming speed equal to your walking speed. In addition, whenever you start your turn underwater with 0 hit points, the armor causes you to rise 60 feet toward the surface. The armor is decorated with fish and shell motifs.`},{id:"si-57-2",name:"Ring of Swimming",price:335,requiredStepId:"q57-2",questName:"Master Swimmer",description:"A ring that grants swimming ability.",stats:`Ring, uncommon

You have a swimming speed of 40 feet while wearing this ring.`},{id:"si-58",name:"Cloak of the Manta Ray",price:197,requiredStepId:"q58-1",questName:"Playing Paparazzi",description:"A cloak that allows breathing and swimming underwater.",stats:`Wondrous item, uncommon

While wearing this cloak with its hood up, you can breathe underwater, and you have a swimming speed of 60 feet. The cloak is made of leather and has a dorsal fin.`},{id:"si-59",name:"Dust of Disappearance",price:371,requiredStepId:"q59-1",questName:"A Zora Swan Song",description:"Dust that turns creatures invisible.",stats:`Wondrous item, uncommon

This small packet contains 2d4 pinches of dust. You can use an action to throw a pinch of it into the air. You and each creature and object within 10 feet of you become invisible for 2d4 minutes. The duration is the same for all subjects, and the dust is consumed when its magic takes effect. If a creature affected by the dust attacks or casts a spell, the invisibility ends for that creature.`},{id:"si-60",name:"Trident of Fish Command",price:109,requiredStepId:"q60-1",questName:"The Seafarer's Challenge",description:"A trident that commands aquatic beasts.",stats:`Weapon (trident), uncommon (requires attunement)

This trident is a magic weapon. It has 3 charges. While you carry it, you can use an action and expend 1 charge to cast Dominate Beast (save DC 15) from it on a beast that has an innate swimming speed. The trident regains 1d3 expended charges daily at dawn.`},{id:"si-61",name:"Dust of Dryness",price:183,requiredStepId:"q61-1",questName:"Racing the Captain",description:"Dust that absorbs water.",stats:`Wondrous item, uncommon

This small packet contains 1d6 + 4 pinches of dust. You can use an action to sprinkle a pinch of it over water. The dust turns a cube of water 15 feet on a side into a marble-sized pellet, which floats or rests near where the dust was sprinkled. The pellet's weight is negligible. Someone can use an action to smash the pellet against a hard surface, causing the pellet to shatter and release the water the dust absorbed. Doing so ends that pellet's magic.`},{id:"si-62-1",name:"Javelin of Lightning",price:365,requiredStepId:"q62-1",questName:"Flat's Last Piece",description:"A javelin that transforms into a lightning bolt.",stats:`Weapon (javelin), uncommon

This javelin is a magic weapon. When you hurl it and speak its command word, it transforms into a bolt of lightning, forming a line 5 feet wide that extends out from you to a target within 120 feet. Each creature in the line excluding you and the target must make a DC 13 Dexterity saving throw, taking 4d6 lightning damage on a failed save, or half as much damage on a successful one. The lightning bolt turns back into a javelin when it reaches the target. Make a ranged weapon attack against the target. On a hit, the target takes damage from the javelin plus 4d6 lightning damage. The javelin's property can't be used again until the next dawn.`},{id:"si-62-2",name:"Adamantine Armor",price:311,requiredStepId:"q62-2",questName:"Iron Coffin",description:"Armor reinforced with adamantine.",stats:`Armor (medium or heavy, but not hide), uncommon

This suit of armor is reinforced with adamantine, one of the hardest substances in existence. While you're wearing it, any critical hit against you becomes a normal hit.`},{id:"si-62-3",name:"Wand of Magic Detection",price:193,requiredStepId:"q62-3",questName:"Gravekeeper's Buried Treasure",description:"A wand that detects magic.",stats:`Wand, uncommon

This wand has 3 charges. While holding it, you can use an action to expend 1 of its charges to cast the Detect Magic spell from it. The wand regains 1d3 expended charges daily at dawn.`},{id:"si-63-1",name:"Pipes of Haunting",price:93,requiredStepId:"q63-1",questName:"The Composer's Ghost",description:"Pipes that can frighten listeners.",stats:`Wondrous item, uncommon (requires attunement)

You must be proficient with wind instruments to use these pipes. They have 3 charges. You can use an action to play them and expend 1 charge to create an eerie, spellbinding tune. Each creature within 30 feet of you that hears you must succeed on a DC 15 Wisdom saving throw or become frightened of you for 1 minute. If you wish, all creatures in the area that aren't hostile toward you automatically succeed on the save. A creature that fails the saving throw can repeat it at the end of each of its turns, ending the effect on itself on a success. A creature that succeeds on its saving throw is immune to the effect of these pipes for 24 hours. The pipes regain 1d3 expended charges daily at dawn.`},{id:"si-63-2",name:"Staff of the Adder",price:139,requiredStepId:"q63-2",questName:"The Mummy's Curse",description:"A staff that transforms into a venomous snake.",stats:`Staff, uncommon (requires attunement by a cleric, druid, or warlock)

You can use a bonus action to speak this staff's command word and make the head of the staff become that of an animate poisonous snake for 1 minute. By using another bonus action to speak the command word again, you return the staff to its normal inanimate form.

You can make a melee attack using the snake head, which has a reach of 5 feet. Your proficiency bonus applies to the attack roll. On a hit, the target takes 1d6 piercing damage and must succeed on a DC 15 Constitution saving throw or take 3d6 poison damage.`},{id:"si-64",name:"Bag of Beans",price:888,requiredStepId:"q64-1",questName:"Beneath the Well",description:"A heavy bag containing magical beans.",stats:`Wondrous item, rare

Inside this heavy cloth bag are 3d4 dry beans. The bag weighs 1/2 pound plus 1/4 pound for each bean it contains.

If you dump the bag's contents out on the ground, they explode in a 10-foot radius. Each creature in the area, including you, must make a DC 15 Dexterity saving throw, taking 5d4 fire damage on a failed save, or half as much damage on a successful one. The fire ignites flammable objects in the area that aren't being worn or carried.

If you remove a bean from the bag, plant it in dirt or sand, and then water it, the bean produces an effect 1 minute later from the ground where it was planted. (See DMG for table of random effects).`},{id:"si-65",name:"Mace of Terror",price:3962,requiredStepId:"q65-1",questName:"Free the Canyon Ghosts",description:"A mace that strikes fear into enemies.",stats:`Weapon (mace), rare (requires attunement)

This magic weapon has 3 charges. While holding it, you can use an action and expend 1 charge to release a wave of terror. Each creature of your choice in a 30-foot radius extending from you must succeed on a DC 15 Wisdom saving throw or become frightened of you for 1 minute. While it is frightened in this way, a creature must spend its turns trying to move as far away from you as it can, and it can't willingly move to a space within 30 feet of you. It also can't take reactions. For its action, it can use only the Dash action or try to escape from an effect that prevents it from moving. If there's nowhere to move, the creature can use the Dodge action. At the end of each of its turns, a creature can repeat the saving throw, ending the effect on itself on a success. The mace regains 1d3 expended charges daily at dawn.`},{id:"si-66",name:"Nine Lives Stealer",price:9712,requiredStepId:"q66-1",questName:"Vanquished Foes Return",description:"A sword that steals the life force of its victims.",stats:`Weapon (any sword), very rare (requires attunement)

You gain a +2 bonus to attack and damage rolls made with this magic weapon.

The sword has 1d8 + 1 charges. If you score a critical hit against a creature that has fewer than 100 hit points, it must succeed on a DC 15 Constitution saving throw or be slain instantly as the sword tears its life force from its body (a construct or an undead is immune). The sword loses 1 charge if the creature is slain. When the sword has no charges remaining, it loses this property.`}],r0=({character:h,onClick:e,allQuests:t})=>{const i=t||cs,r=s0.some(c=>c.relatedId===h.id&&c.condition),a=h.quests.map(c=>i.find(d=>d.id===c||d.steps.some(f=>f.id===c))).filter(Boolean),o=c=>c.scheduleEvents&&c.scheduleEvents.length>0?c.scheduleEvents.map(d=>{const f=d.day==="All"?"Daily":`Day ${d.day}`,p=`${an(d.start)} - ${an(d.end)}`;return`${f} ${p}: ${d.location} (${d.title})`}).join(`
`):c.schedule;return m.jsxs("div",{onClick:()=>e(h),className:`bg-slate-800 border border-slate-700 rounded-lg p-4 hover:border-termina-accent cursor-pointer transition-all shadow-lg hover:shadow-termina-accent/20 relative flex flex-col h-full ${h.isCustom?"border-blue-500/30 bg-blue-900/10":h.isEdited?"border-amber-500/30 bg-amber-900/10":""}`,children:[r&&m.jsxs("div",{className:"absolute top-4 right-4 group",children:[m.jsx("span",{className:"text-xl cursor-help text-purple-400",children:""}),m.jsx("div",{className:"absolute bottom-full right-0 mb-2 w-48 bg-black text-xs text-slate-300 p-2 rounded border border-slate-600 opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none z-10",children:"This character's schedule changes based on quest actions."})]}),m.jsxs("div",{className:"flex items-center justify-between mb-3",children:[m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("h3",{className:"text-xl font-bold text-termina-accent truncate max-w-[180px]",children:h.name}),h.isCustom&&m.jsx("span",{title:"Custom Character",className:"text-xs",children:""}),h.isEdited&&!h.isCustom&&m.jsx("span",{title:"Schedule Modified",className:"text-xs",children:""})]}),h.icon&&m.jsx("img",{src:h.icon,alt:`${h.name} icon`,className:`w-12 h-12 rounded-full border-2 border-termina-accent object-cover ${["kafei","jim","pamela","beavers","goron-child"].includes(h.id)?"scale-125":""}`})]}),m.jsx("p",{className:"text-sm text-termina-gold mb-2",children:h.locationRegion}),m.jsx("p",{className:"text-slate-400 text-sm line-clamp-2 mb-4",children:h.description}),h.defaultActivity&&m.jsxs("div",{className:"mb-3 bg-slate-900/30 p-2 rounded border border-slate-700/50",children:[m.jsx("p",{className:"text-[10px] uppercase tracking-wider text-slate-500 font-bold mb-0.5",children:"Downtime"}),m.jsxs("p",{className:"text-slate-300 text-xs",children:[m.jsx("span",{className:"font-bold text-blue-200",children:h.defaultActivity}),m.jsx("span",{className:"text-slate-500 mx-1",children:"@"}),m.jsx("span",{className:"text-slate-400",children:h.defaultLocation||h.locationSpecific})]})]}),m.jsxs("div",{className:"mb-4",children:[m.jsx("p",{className:"text-[10px] uppercase tracking-wider text-slate-500 font-bold mb-1",children:"Active Schedule"}),m.jsx("p",{className:"text-slate-300 text-xs whitespace-pre-line line-clamp-3",children:o(h)})]}),m.jsxs("div",{className:"mt-auto pt-3 border-t border-slate-700/50",children:[m.jsx("span",{className:"text-[10px] uppercase tracking-wider text-slate-500 font-bold mb-2 block",children:"Involved In:"}),a.length>0?m.jsx("div",{className:"flex flex-wrap gap-1.5",children:a.map((c,d)=>m.jsxs("span",{className:"text-[10px] px-2 py-0.5 bg-slate-900/50 text-purple-300 rounded border border-slate-700/50 truncate max-w-full",children:["Q",c.questNumber]},d))}):m.jsx("span",{className:"text-[10px] text-slate-600 italic",children:"No major quests"})]})]})},a0=({character:h,onClose:e,onOpenPdf:t})=>{if(!h)return null;const i=cs.flatMap(a=>a.steps.filter(o=>o.characterId===h.id).map(o=>({...o,questTitle:a.title,questNumber:a.questNumber}))),r=a=>a.scheduleEvents&&a.scheduleEvents.length>0?a.scheduleEvents.map(o=>{const c=o.day==="All"?"Daily":`Day ${o.day}`,d=`${an(o.start)} - ${an(o.end)}`;return`${c} ${d}: ${o.location} (${o.title})`}).join(`
`):a.schedule;return m.jsx("div",{onClick:e,className:"fixed inset-0 bg-black/80 flex items-center justify-center z-[100] p-4 backdrop-blur-sm",children:m.jsxs("div",{onClick:a=>a.stopPropagation(),className:"bg-slate-900 border-2 border-termina-accent rounded-xl max-w-2xl w-full max-h-[90vh] flex flex-col relative shadow-[0_0_30px_rgba(216,180,254,0.15)] animate-fade-in",children:[m.jsx("button",{onClick:e,className:"absolute top-3 right-3 text-slate-400 hover:text-white bg-slate-900/50 hover:bg-slate-800 rounded-full p-2 z-20 transition-colors",title:"Close",children:m.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),m.jsxs("div",{className:"overflow-y-auto flex-1 p-8 custom-scrollbar",children:[m.jsx("h2",{className:"text-3xl font-serif font-bold text-termina-accent mb-2 pr-10",children:h.name}),m.jsxs("div",{className:"flex flex-wrap gap-2 mb-6",children:[m.jsx("span",{className:"px-3 py-1 rounded-full bg-purple-900/50 text-purple-300 text-xs font-bold border border-purple-700 uppercase tracking-wider",children:h.locationRegion}),m.jsx("span",{className:"px-3 py-1 rounded-full bg-slate-800 text-slate-300 text-xs font-bold border border-slate-700 uppercase tracking-wider",children:h.locationSpecific})]}),m.jsxs("div",{className:"space-y-8",children:[m.jsxs("section",{children:[m.jsx("h3",{className:"text-termina-gold font-bold uppercase tracking-widest text-xs mb-3 border-b border-slate-800 pb-1",children:"Description"}),m.jsx("p",{className:"text-slate-300 leading-relaxed text-sm whitespace-pre-line",children:h.description})]}),m.jsxs("section",{children:[m.jsx("h3",{className:"text-termina-gold font-bold uppercase tracking-widest text-xs mb-3 border-b border-slate-800 pb-1",children:"Schedule & Behavior"}),m.jsx("p",{className:"text-slate-300 text-sm whitespace-pre-line",children:r(h)})]}),i.length>0&&m.jsxs("section",{children:[m.jsx("h3",{className:"text-termina-gold font-bold uppercase tracking-widest text-xs mb-3 border-b border-slate-800 pb-1",children:"Quest Involvement"}),m.jsx("div",{className:"space-y-3",children:i.map((a,o)=>m.jsxs("div",{className:"bg-slate-800/50 p-3 rounded border border-slate-700",children:[m.jsxs("div",{className:"flex justify-between items-center mb-1",children:[m.jsxs("span",{className:"text-[10px] text-purple-300 font-bold uppercase",children:["Quest ",a.questNumber,": ",a.questTitle]}),(a.day||a.time)&&m.jsxs("span",{className:"text-[10px] text-slate-400 font-mono",children:[a.day?`Day ${a.day}`:""," ",a.time]})]}),m.jsx("p",{className:"text-slate-200 text-sm font-medium",children:a.description}),m.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[m.jsxs("p",{className:"text-slate-500 text-xs",children:[" ",a.location]}),a.pageReference&&m.jsxs("button",{onClick:()=>t(a.pageReference),className:"text-[10px] text-termina-accent hover:underline decoration-dotted",children:["(Ref: p.",a.pageReference,")"]})]})]},o))})]}),h.connections.length>0&&m.jsxs("section",{children:[m.jsx("h3",{className:"text-termina-gold font-bold uppercase tracking-widest text-xs mb-3 border-b border-slate-800 pb-1",children:"Connections"}),m.jsx("div",{className:"flex flex-wrap gap-2",children:h.connections.map((a,o)=>m.jsx("span",{className:"bg-slate-800 px-3 py-1 rounded text-xs text-slate-400 border border-slate-700",children:a},o))})]}),m.jsxs("div",{className:"flex justify-between items-center pt-6 border-t border-slate-800 mt-6",children:[m.jsxs("span",{className:"text-slate-600 text-xs flex items-center gap-1",children:["Source:",m.jsxs("button",{onClick:()=>t(h.pages),className:"text-termina-accent hover:underline ml-1",children:["PDF Page ",h.pages]})]}),m.jsx("a",{href:h.wikiLink,target:"_blank",rel:"noopener noreferrer",className:"text-termina-accent hover:text-white text-sm underline decoration-dotted",children:"View on Zelda Wiki "})]})]})]})]})})},pd=({quest:h,globalState:e,setGlobalState:t,onToggleStep:i,onCharacterClick:r,defaultExpanded:a=!1,addNotification:o,onOpenPdf:c,onNavigate:d,gameHistory:f,allQuests:p,onEdit:g})=>{const[w,x]=L.useState(a),[k,v]=L.useState({});L.useEffect(()=>{a&&x(!0)},[a]);const A=(z,K)=>{K.stopPropagation(),i&&i(h.id,z)},C=z=>{v(K=>({...K,[z]:!K[z]}))},T=z=>{const[K,Q]=z.split(":").map(Number);let V=K;return K<6&&(V=K+24),(V-6)*60+Q},R=z=>{const[K,Q]=z.split(":").map(Number),V=K>=12&&K<24?"pm":"am";return`${K%12||12}:${Q.toString().padStart(2,"0")}${V}`},E=z=>{for(const K of p){const Q=K.steps.find(V=>V.id===z);if(Q)return{step:Q,quest:K}}return null},_=h.steps.filter(z=>e.completedSteps.includes(z.id)).length,M=Math.round(_/h.steps.length*100),N=h.isMainQuest,I=_===h.steps.length,G=f?Math.min(...h.steps.map(z=>f.stepCompletionCounts[z.id]||0)):0,F=G>0,B=h.steps.find(z=>!e.completedSteps.includes(z.id));let X=null;if(I)X={label:"Completed",color:"bg-green-900/50 text-green-200 border-green-700 border",icon:""};else if(B){if(h.prerequisiteQuestId){const z=p.find(K=>K.id===h.prerequisiteQuestId);z&&(z.steps.every(Q=>e.completedSteps.includes(Q.id))||(X={label:`Requires Quest ${z.questNumber}`,color:"bg-slate-700 text-slate-400 border-slate-600 border",icon:""}))}if(!X){if(B.prerequisiteStepId&&!e.completedSteps.includes(B.prerequisiteStepId)){const z=E(B.prerequisiteStepId);X={label:z?`Requires: ${z.step.title} ${z.quest.id!==h.id?`(Q${z.quest.questNumber})`:""}`:"Locked",color:"bg-slate-700 text-slate-400 border-slate-600 border",icon:""}}else if(B.days&&B.days.length>0&&!B.days.includes(e.currentDay))X={label:`Available Day ${B.days.join(", ")}`,color:"bg-amber-900/40 text-amber-200 border-amber-800 border",icon:""};else if(B.day&&B.day!==e.currentDay)X={label:`Available Day ${B.day}`,color:"bg-amber-900/40 text-amber-200 border-amber-800 border",icon:""};else if(B.time){const z=T(B.time);let K=z+120;B.endTime&&(K=T(B.endTime));const Q=e.timeOfDayMinutes;(Q<z||Q>K)&&(X={label:`Available ${`${R(B.time)} - ${B.endTime?R(B.endTime):"Later"}`}`,color:"bg-blue-900/40 text-blue-200 border-blue-800 border",icon:""})}}X||(X={label:"Available Now",color:"bg-green-900 text-green-200 border-green-700 border",icon:"!"})}const oe=new Set;h.steps.forEach(z=>{z.characterId&&oe.add(z.characterId),z.secondaryCharacterIds&&z.secondaryCharacterIds.forEach(K=>oe.add(K))});const le=Array.from(oe).map(z=>li.find(K=>K.id===z)).filter(Boolean);return m.jsxs("div",{id:`quest-card-${h.id}`,className:`bg-slate-800 border rounded-lg shadow-lg transition-all ${N?"border-red-900/60 shadow-red-900/10":"border-slate-700"}`,children:[m.jsxs("div",{onClick:()=>x(!w),className:`p-4 border-b flex flex-col gap-3 cursor-pointer hover:bg-slate-700/50 transition-colors rounded-t-lg ${N?"bg-red-950/30 border-red-900/30":"bg-slate-900 border-slate-700"}`,children:[m.jsxs("div",{className:"flex justify-between items-start",children:[m.jsxs("div",{className:"flex items-start gap-4 flex-1",children:[m.jsx("div",{className:`w-2 h-12 rounded-full flex-shrink-0 ${M===100?"bg-green-500":N?"bg-termina-danger":"bg-termina-accent"}`}),m.jsxs("div",{className:"flex-1 min-w-0",children:[m.jsxs("div",{className:"flex items-center gap-2 flex-wrap mb-1",children:[m.jsxs("span",{className:`text-xs font-bold uppercase px-2 py-0.5 rounded ${N?"bg-red-900 text-red-200":"bg-slate-700 text-slate-300"}`,children:["Quest ",h.questNumber]}),X&&m.jsxs("span",{className:`text-[10px] font-bold uppercase px-2 py-0.5 rounded flex items-center gap-1 ${X.color}`,children:[m.jsx("span",{children:X.icon})," ",X.label]}),F&&m.jsxs("span",{className:"text-[10px] font-bold uppercase px-2 py-0.5 rounded bg-purple-900/30 text-purple-300 border border-purple-800/50",title:`Completed ${G} times in previous cycles`,children:["Completed: ",G]})]}),m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("h3",{className:`text-lg font-bold truncate pr-4 ${N?"text-red-200":"text-white"}`,children:h.title}),h.isCustom&&g&&m.jsx("button",{onClick:z=>{z.stopPropagation(),g(h)},className:"text-xs bg-slate-700 hover:bg-blue-600 text-white px-2 py-1 rounded transition-colors",title:"Edit Quest",children:""})]}),m.jsxs("div",{className:"text-xs text-slate-400 flex flex-wrap gap-x-3 gap-y-1 mt-1",children:[m.jsx("span",{className:"uppercase tracking-wider text-termina-gold",children:h.region}),h.pageReference&&m.jsxs("button",{onClick:z=>{z.stopPropagation(),c(h.pageReference)},className:"hover:text-termina-accent underline decoration-dotted transition-colors",children:["Ref: p.",h.pageReference]})]})]})]}),m.jsxs("div",{className:"flex items-center gap-4",children:[m.jsxs("div",{className:"text-right hidden sm:block",children:[m.jsxs("div",{className:"text-xs text-slate-400 mb-1",children:[_,"/",h.steps.length," Steps"]}),m.jsx("div",{className:"w-24 h-1.5 bg-slate-700 rounded-full overflow-hidden",children:m.jsx("div",{className:"h-full bg-green-500 transition-all",style:{width:`${M}%`}})})]}),m.jsx("span",{className:"text-slate-500 transform transition-transform duration-200",style:{transform:w?"rotate(180deg)":"rotate(0deg)"},children:""})]})]}),le.length>0&&m.jsxs("div",{className:"flex items-center gap-2 pl-6 text-xs overflow-x-auto pb-1 scrollbar-hide",children:[m.jsx("span",{className:"text-slate-500 uppercase tracking-wider font-bold text-[10px] shrink-0",children:"Involved:"}),le.map(z=>m.jsxs("button",{onClick:K=>{K.stopPropagation(),r(z.id)},className:"flex items-center gap-1 bg-slate-800 px-2 py-0.5 rounded border border-slate-600 hover:border-termina-accent hover:text-termina-accent transition-colors whitespace-nowrap",children:[m.jsx("span",{className:"text-[10px]",children:""})," ",z.name]},z.id))]})]}),w&&m.jsxs("div",{className:"p-4 bg-slate-800/50 rounded-b-lg",children:[m.jsx("div",{className:"mb-6 text-sm text-slate-300 leading-relaxed border-l-2 border-slate-600 pl-4",children:h.description}),m.jsx("div",{className:"space-y-3 mb-6",children:h.steps.map((z,K)=>{const Q=z.characterId?li.find(se=>se.id===z.characterId):null,V=e.completedSteps.includes(z.id),ce=f?.stepCompletionCounts[z.id]||0,re=k[z.id],j=`${h.questNumber}-${K+1}`;let $=!0;if(z.prerequisiteStepId&&!e.completedSteps.includes(z.prerequisiteStepId)&&($=!1),h.prerequisiteQuestId){const se=p.find(ue=>ue.id===h.prerequisiteQuestId);se&&!se.steps.every(ue=>e.completedSteps.includes(ue.id))&&($=!1)}return m.jsxs("div",{className:`rounded border transition-all ${V?"bg-green-900/10 border-green-800/50":$?"bg-slate-900/50 border-slate-700":"bg-slate-900/80 border-slate-800 opacity-60"}`,children:[m.jsxs("div",{onClick:()=>C(z.id),className:"flex items-center justify-between p-3 cursor-pointer hover:bg-white/5",children:[m.jsxs("div",{className:"flex items-center gap-3",children:[m.jsx("div",{onClick:se=>A(z.id,se),children:m.jsx("input",{type:"checkbox",checked:V,readOnly:!0,disabled:!$,className:`w-5 h-5 rounded border-slate-500 text-termina-accent focus:ring-0 focus:ring-offset-0 cursor-pointer accent-purple-500 ${$?"":"cursor-not-allowed opacity-50"}`})}),m.jsxs("div",{children:[m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("span",{className:"text-xs font-mono text-slate-500",children:j}),m.jsx("span",{className:`font-bold text-sm ${V?"text-slate-400 line-through":"text-slate-200"}`,children:z.title}),ce>0&&!V&&m.jsx("span",{className:"text-[9px] bg-slate-700 text-slate-400 px-1 rounded",title:"Done in previous cycle",children:"Done before"})]}),m.jsxs("div",{className:"text-[10px] text-slate-500 mt-0.5 flex gap-3",children:[m.jsxs("span",{children:[" ",z.location]}),(z.day||z.days||z.time)&&m.jsxs("span",{children:[z.days?`Day ${z.days.join(",")}`:z.day?`Day ${z.day}`:""," ",z.time]})]})]})]}),m.jsxs("div",{className:"flex items-center gap-3",children:[m.jsxs("span",{className:"text-xs font-bold text-termina-gold bg-black/20 px-2 py-1 rounded border border-yellow-900/30",children:[z.xpReward," XP"]}),m.jsx("span",{className:"text-slate-500 transform transition-transform duration-200",style:{transform:re?"rotate(180deg)":"rotate(0deg)"},children:""})]})]}),re&&m.jsxs("div",{className:"p-4 pt-0 border-t border-slate-700/50 text-sm bg-black/20 animate-fade-in",children:[!$&&m.jsxs("div",{className:"mt-2 mb-2 px-3 py-2 bg-slate-800 rounded border border-slate-600 text-xs text-slate-400 flex items-center gap-2",children:[m.jsx("span",{children:" Locked:"}),m.jsx("span",{children:h.prerequisiteQuestId&&!p.find(se=>se.id===h.prerequisiteQuestId)?.steps.every(se=>e.completedSteps.includes(se.id))?"Requires Quest Completion.":"Requires previous step completion."})]}),m.jsx("div",{className:"mt-3 text-slate-300 whitespace-pre-line leading-relaxed",children:z.description}),m.jsxs("div",{className:"mt-4 flex flex-wrap gap-4 pt-3 border-t border-slate-800",children:[z.pageReference&&m.jsxs("div",{className:"text-xs flex items-center gap-1.5 text-slate-500",children:[m.jsx("span",{children:""}),m.jsxs("button",{onClick:()=>c(z.pageReference),className:"hover:text-termina-accent underline decoration-dotted transition-colors",children:["Page ",z.pageReference]})]}),z.curiosityShopUnlock&&m.jsxs("div",{className:"text-xs flex items-center gap-1.5 text-amber-400",children:[m.jsx("span",{children:" Unlocks in Shop:"}),m.jsx("span",{className:"font-bold underline decoration-dotted cursor-help",title:"Visit Curiosity Shop to buy",children:z.curiosityShopUnlock.itemName})]}),z.itemRewards&&z.itemRewards.length>0&&m.jsxs("div",{className:"text-xs flex items-center gap-2",children:[m.jsx("span",{className:"text-purple-400",children:" Rewards:"}),z.itemRewards.map((se,ue)=>m.jsx(Af,{reward:se},ue))]}),(Q||z.secondaryCharacterIds&&z.secondaryCharacterIds.length>0)&&m.jsxs("div",{className:"text-xs flex flex-wrap items-center gap-2 text-slate-400 ml-auto",children:[m.jsx("span",{children:" NPCs:"}),Q&&m.jsx("button",{onClick:se=>{se.stopPropagation(),r(Q.id)},className:"text-blue-400 hover:underline",children:Q.name}),z.secondaryCharacterIds?.map(se=>{const ue=li.find(te=>te.id===se);return ue?m.jsx("button",{onClick:te=>{te.stopPropagation(),r(se)},className:"text-blue-400 hover:underline",children:ue.name},se):null})]})]})]})]},z.id)})}),m.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 pt-4 border-t border-slate-700",children:[m.jsxs("div",{children:[m.jsx("h4",{className:"text-xs font-bold text-green-400 uppercase mb-2",children:"Completion Rewards"}),h.rewards.length>0?m.jsx("div",{className:"flex flex-wrap gap-2",children:h.rewards.map((z,K)=>m.jsx(Af,{reward:z},K))}):m.jsx("span",{className:"text-xs text-slate-500",children:"None"})]}),h.failureConsequence&&m.jsxs("div",{children:[m.jsx("h4",{className:"text-xs font-bold text-red-400 uppercase mb-2",children:"On Failure"}),m.jsxs("div",{className:"group relative inline-block",children:[m.jsx("span",{className:"text-sm text-red-300/80 border-b border-dotted border-red-500/50 cursor-help",children:"View Consequences"}),m.jsx("div",{className:"absolute bottom-full left-0 mb-2 w-64 bg-red-950/90 text-red-100 text-xs p-3 rounded border border-red-800 shadow-xl opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none z-50",children:h.failureConsequence})]})]})]})]})]})},Af=({reward:h})=>m.jsxs("div",{className:"group relative inline-block",children:[m.jsxs("span",{className:`
        text-xs px-2 py-1 rounded border flex items-center gap-1 cursor-help transition-colors
        ${h.type==="Spell"?"bg-blue-900/30 border-blue-700 text-blue-200 hover:bg-blue-900/50":h.type==="Mask"?"bg-purple-900/30 border-purple-700 text-purple-200 hover:bg-purple-900/50":"bg-slate-800 border-slate-600 text-slate-300 hover:bg-slate-700"}
      `,children:[h.type==="Spell"?"":h.type==="Mask"?"":""," ",h.name]}),h.description&&m.jsxs("div",{className:"absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 w-64 bg-slate-900 text-slate-200 text-xs p-3 rounded-lg border border-slate-500 shadow-2xl opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none z-50 whitespace-pre-wrap",children:[m.jsx("div",{className:"font-bold text-termina-gold mb-1 border-b border-slate-700 pb-1",children:h.name}),h.description,m.jsx("div",{className:"absolute top-full left-1/2 transform -translate-x-1/2 -mt-1 border-4 border-transparent border-t-slate-900"})]})]}),o0=({onCharacterClick:h,globalState:e,setGlobalState:t,onToggleStep:i,addNotification:r,onOpenPdf:a,onNavigate:o,gameHistory:c,highlightedQuestId:d,allQuests:f,onCreateQuest:p,onEditQuest:g})=>{const[w,x]=L.useState("All"),[k,v]=L.useState("All"),[A,C]=L.useState("");L.useEffect(()=>{d&&setTimeout(()=>{const _=document.getElementById(`quest-card-${d}`);_&&(_.scrollIntoView({behavior:"smooth",block:"center"}),_.classList.add("ring-2","ring-termina-accent"),setTimeout(()=>_.classList.remove("ring-2","ring-termina-accent"),2e3))},100)},[d]);const T=["All",...Object.values(q)],R=L.useMemo(()=>{const _=new Set;return f.forEach(M=>M.steps.forEach(N=>{N.characterId&&_.add(N.characterId)})),li.filter(M=>_.has(M.id)).sort((M,N)=>M.name.localeCompare(N.name))},[f]),E=L.useMemo(()=>f.filter(_=>{if(d&&_.id===d)return!0;const M=w==="All"||_.region===w,N=A.toLowerCase(),I=_.title.toLowerCase().includes(N)||_.description.toLowerCase().includes(N)||_.questNumber.toString()===N||_.steps.some(F=>F.id.toLowerCase().includes(N));let G=k==="All";return k!=="All"&&(G=_.steps.some(F=>F.characterId===k)),M&&I&&G}).sort((_,M)=>_.questNumber-M.questNumber),[w,k,A,d,f]);return m.jsxs("div",{className:"space-y-4",children:[m.jsxs("div",{className:"bg-slate-900/50 p-6 rounded-lg border border-purple-900/50 mb-6",children:[m.jsxs("div",{className:"flex justify-between items-center mb-2",children:[m.jsx("h2",{className:"text-2xl font-bold text-termina-gold",children:"Questlines"}),p&&m.jsxs("button",{onClick:p,className:"bg-blue-600 hover:bg-blue-500 text-white px-4 py-2 rounded font-bold text-sm shadow-lg transition-colors flex items-center gap-2",children:[m.jsx("span",{children:"+"})," Create Quest"]})]}),m.jsxs("p",{className:"text-slate-400 text-sm mb-4",children:["Track your progress. Checked items may alter the timeline.",m.jsx("br",{}),m.jsx("span",{className:"text-termina-danger font-bold",children:"Red items"})," are Main Quests essential to saving Termina."]}),m.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[m.jsx("input",{type:"text",placeholder:"Search quests (e.g. 'Gold', '1-1')...",value:A,onChange:_=>C(_.target.value),className:"bg-slate-800 border border-slate-700 rounded px-3 py-2 text-sm text-white focus:border-termina-accent outline-none"}),m.jsx("select",{value:w,onChange:_=>x(_.target.value),className:"bg-slate-800 border border-slate-700 rounded px-3 py-2 text-sm text-white focus:border-termina-accent outline-none",children:T.map(_=>m.jsx("option",{value:_,children:_},_))}),m.jsxs("select",{value:k,onChange:_=>v(_.target.value),className:"bg-slate-800 border border-slate-700 rounded px-3 py-2 text-sm text-white focus:border-termina-accent outline-none",children:[m.jsx("option",{value:"All",children:"All Characters"}),R.map(_=>m.jsx("option",{value:_.id,children:_.name},_.id))]})]})]}),m.jsx("div",{className:"grid gap-4",children:E.length>0?E.map(_=>m.jsx(pd,{quest:_,globalState:e,setGlobalState:t,onToggleStep:i,onCharacterClick:h,addNotification:r,onOpenPdf:a,onNavigate:o,gameHistory:c,defaultExpanded:_.id===d,allQuests:f,onEdit:g},_.id)):m.jsx("div",{className:"text-center py-12 text-slate-500 italic",children:"No quests found matching your criteria."})})]})},l0=({onEventClick:h,globalState:e,selectedEventId:t,events:i,allQuests:r,allCharacters:a})=>{const o=L.useRef(null),c=L.useRef(null),[d,f]=L.useState(!1),[p,g]=L.useState(0),[w,x]=L.useState(0),[k,v]=L.useState(1),[A,C]=L.useState(!1),[T,R]=L.useState(0),[E,_]=L.useState(!1),M=Object.values(q).filter(ee=>ee!==q.World),[N,I]=L.useState(q.ClockTown),G=L.useMemo(()=>i&&i.length>0?i:op(lp,li,cs,[]),[i]),F=a||li,B=r||cs;L.useEffect(()=>{if(!o.current)return;const ee=new ResizeObserver(fe=>{for(const pe of fe)R(pe.contentRect.width)});return ee.observe(o.current),()=>ee.disconnect()},[]);const oe=1*L.useMemo(()=>A&&T>0?(T-50)/4560:k,[k,A,T]),le=60*oe,z=24*le,K=z*3+4*le;L.useEffect(()=>{if(o.current&&!A&&!t){const ee=e.totalMinutes*oe,fe=o.current.clientWidth;o.current.scrollLeft=Math.max(0,ee-fe/2+150)}},[e.totalMinutes,A,t]);const Q=L.useRef(null);L.useEffect(()=>{if(t&&t!==Q.current){const ee=G.find(fe=>fe.id===t);ee&&ee.region!==N&&I(ee.region),setTimeout(()=>{if(!o.current)return;const fe=document.getElementById(`timeline-event-${t}`);fe&&(fe.scrollIntoView({behavior:"smooth",block:"center",inline:"center"}),fe.classList.add("ring-4","ring-white","scale-110","z-50"),setTimeout(()=>fe.classList.remove("ring-4","ring-white","scale-110","z-50"),2e3))},100)}Q.current=t},[t]);const V=ee=>{if(ee.condition){const fe=e.completedSteps.includes(ee.condition.stepId);if(ee.condition.type==="requires_step"&&!fe||ee.condition.type==="requires_step_not"&&fe)return!1}if(ee.category==="Main Quest"||ee.category==="Side Quest"){const fe=B.find(pe=>pe.id===ee.relatedId);if(fe&&fe.prerequisiteQuestId){const pe=B.find(Ce=>Ce.id===fe.prerequisiteQuestId);if(pe&&!pe.steps.every(Ce=>e.completedSteps.includes(Ce.id)))return!1}}return!0},ce=L.useMemo(()=>G.filter(ee=>{if(ee.region!==N)return!1;const fe=V(ee);return!(!E&&!fe)}),[e.completedSteps,N,G,B,E]),re=L.useMemo(()=>{const ee={},fe=(pe,Ce,De)=>{ee[pe]||(ee[pe]=[]),ee[pe].push({event:Ce,stackIndex:0,isAvailable:De})};return ce.forEach(pe=>{let Ce=[];const De=V(pe);if(pe.category==="Business")Ce.push("Shops & Services");else if(pe.category==="NPC Schedule"){const Je=F.find(Ke=>Ke.id===pe.relatedId);Ce.push(Je?Je.name:pe.relatedId||"Unknown NPC")}else if((pe.category==="Main Quest"||pe.category==="Side Quest")&&pe.relatedId)if(pe.id.startsWith(pe.relatedId)){const Ke=pe.id.substring(pe.relatedId.length).match(/-step-(\d+)-d/);if(Ke&&Ke[1]){const vt=parseInt(Ke[1],10),Xe=B.find(rt=>rt.id===pe.relatedId);if(Xe&&Xe.steps[vt]){const rt=Xe.steps[vt],$t=new Set;rt.characterId&&$t.add(rt.characterId),rt.secondaryCharacterIds&&rt.secondaryCharacterIds.forEach(pt=>$t.add(pt));const gt=F.filter(pt=>$t.has(pt.id));gt.length>0&&gt.length<=2?gt.forEach(pt=>Ce.push(pt.name)):Ce.push("Area Quests")}else Ce.push("Area Quests")}else Ce.push("Area Quests")}else Ce.push("Area Quests");else Ce.push("Area Quests");Ce.forEach(Je=>fe(Je,pe,De))}),Object.keys(ee).forEach(pe=>{const Ce=ee[pe];Ce.sort((Je,Ke)=>Je.event.sortTime-Ke.event.sortTime);const De=[];Ce.forEach(Je=>{const Ke=Je.event.sortTime,vt=Je.event.endTime?Je.event.endTime-Ke:60,Xe=Ke+vt+15;let rt=0;for(;De[rt]>Ke;)rt++;De[rt]=Xe,Je.stackIndex=rt})}),ee},[ce,F,B,e.completedSteps]),j=L.useMemo(()=>Object.keys(re).sort((fe,pe)=>fe==="Shops & Services"?-1:pe==="Shops & Services"||fe==="Area Quests"?1:pe==="Area Quests"?-1:fe.localeCompare(pe)),[re]),$=L.useMemo(()=>j.map(ee=>{const pe=re[ee].reduce((Ce,De)=>Math.max(Ce,De.stackIndex),0);return Math.max(64,(pe+1)*32+24)}),[j,re]),se=$.reduce((ee,fe)=>ee+fe,0),ue=Math.max(600,se+48),te=()=>{o.current&&c.current&&(c.current.scrollTop=o.current.scrollTop)},xe=ee=>{f(!0),g(ee.pageX-(o.current?.offsetLeft||0)),x(o.current?.scrollLeft||0)},ye=()=>f(!1),_e=()=>f(!1),J=ee=>{if(!d)return;ee.preventDefault();const pe=(ee.pageX-(o.current?.offsetLeft||0)-p)*1.5;o.current&&(o.current.scrollLeft=w-pe)},me=(ee,fe)=>{if(fe)return"bg-slate-800/80 border-slate-700/50 text-slate-500";switch(ee){case"Main Quest":return"bg-red-600 border-red-400";case"Side Quest":return"bg-purple-600 border-purple-400";case"NPC Schedule":return"bg-blue-600 border-blue-400";case"Business":return"bg-emerald-600 border-emerald-400";case"World Event":return"bg-yellow-600 border-yellow-400 text-white";default:return"bg-slate-600 border-slate-400"}},Ve=e.totalMinutes*oe,ft=ee=>{const fe=(ee+6)%24,pe=fe>=12?"pm":"am";return`${fe%12||12}${pe}`};return m.jsxs("div",{className:"flex flex-col h-full bg-slate-900/50 rounded-lg border border-slate-700 overflow-hidden select-none shadow-2xl",children:[m.jsx("div",{className:"bg-slate-900 border-b border-slate-700 z-20",children:m.jsxs("div",{className:"p-4 flex flex-col md:flex-row justify-between items-center gap-4",children:[m.jsxs("div",{className:"flex items-center gap-4",children:[m.jsx("h2",{className:"text-xl font-bold text-termina-gold font-serif",children:"Timeline"}),m.jsxs("div",{className:"flex gap-2 items-center bg-slate-800 rounded px-2 py-1 border border-slate-700",children:[m.jsx("button",{onClick:()=>{v(Math.max(.5,k-.1)),C(!1)},className:"px-2 text-slate-400 hover:text-white font-bold",children:"-"}),m.jsx("span",{className:"text-[10px] uppercase tracking-wider text-slate-500 font-bold",children:"Zoom"}),m.jsx("button",{onClick:()=>{v(Math.min(2,k+.1)),C(!1)},className:"px-2 text-slate-400 hover:text-white font-bold",children:"+"}),m.jsx("div",{className:"w-px h-4 bg-slate-700 mx-1"}),m.jsx("button",{onClick:()=>C(!A),className:`px-2 text-[10px] uppercase font-bold transition-colors rounded ${A?"bg-termina-accent text-black":"text-slate-400 hover:text-white"}`,children:"Fit"}),m.jsx("div",{className:"w-px h-4 bg-slate-700 mx-1"}),m.jsx("button",{onClick:()=>_(!E),className:`px-2 text-[10px] uppercase font-bold transition-colors rounded flex items-center gap-1 ${E?"bg-purple-900/50 text-purple-200 border border-purple-500":"text-slate-400 hover:text-white border border-transparent"}`,title:"Toggle hidden/unavailable events",children:E?"Hide Hidden":"Show Hidden"})]})]}),m.jsx("div",{className:"flex overflow-x-auto max-w-full gap-1 pb-1 scrollbar-hide",children:M.map(ee=>m.jsx("button",{onClick:()=>I(ee),className:`px-3 py-2 text-xs font-bold uppercase tracking-wider whitespace-nowrap transition-all border-b-2 ${N===ee?"text-termina-accent border-termina-accent bg-slate-800/50":"text-slate-500 border-transparent hover:text-slate-300 hover:bg-slate-800/30"}`,children:ee},ee))})]})}),m.jsxs("div",{className:"flex flex-1 overflow-hidden relative",children:[m.jsx("div",{ref:c,className:"w-40 bg-slate-900 border-r border-slate-700 z-10 shrink-0 h-full overflow-hidden shadow-[4px_0_10px_rgba(0,0,0,0.3)]",children:m.jsxs("div",{className:"relative",style:{height:`${ue}px`},children:[m.jsx("div",{className:"h-12 bg-slate-900 border-b border-slate-700 sticky top-0 z-30"}),m.jsx("div",{className:"absolute top-12 left-0 right-0",children:j.map((ee,fe)=>{const pe=$[fe],Ce=ee==="Shops & Services",De=ee==="Area Quests";return m.jsx("div",{className:`border-b border-slate-700 flex items-center px-3 text-xs font-bold transition-colors ${Ce?"bg-emerald-900/20 text-emerald-200 border-emerald-900/30":De?"bg-purple-900/20 text-purple-200 border-purple-900/30":"text-slate-300 bg-slate-800/50"}`,style:{height:`${pe}px`},title:ee,children:m.jsx("span",{className:"line-clamp-2",children:ee})},ee)})})]})}),m.jsx("div",{ref:o,className:"flex-1 overflow-auto relative cursor-grab active:cursor-grabbing bg-[#151019]",onScroll:te,onMouseDown:xe,onMouseLeave:ye,onMouseUp:_e,onMouseMove:J,children:m.jsxs("div",{style:{width:`${K}px`,height:`${ue}px`},className:"relative min-h-full",children:[m.jsxs("div",{className:"absolute top-0 bottom-0 left-0 right-0 z-0",children:[m.jsx("div",{className:"h-12 border-b border-slate-700 flex bg-slate-900/95 sticky top-0 z-20 shadow-sm",children:[1,2,3].map(ee=>m.jsxs("div",{className:"relative h-full border-r border-slate-600",style:{width:`${z}px`},children:[m.jsx("div",{className:"absolute top-0 left-0 right-0 h-5 bg-slate-800 flex items-center px-3 border-b border-slate-700",children:m.jsxs("span",{className:"font-serif font-bold text-termina-gold text-xs tracking-widest",children:["DAY ",ee]})}),Array.from({length:24}).map((fe,pe)=>m.jsx("div",{className:`absolute bottom-0 h-7 border-l ${pe%6===0?"border-slate-500":"border-slate-700"} text-[9px] text-slate-500 pl-1.5 pt-1`,style:{left:`${pe*le}px`},children:ft(pe)},pe))]},ee))}),m.jsx("div",{className:"absolute top-12 bottom-0 left-0 right-0 pointer-events-none",children:[1,2,3].map((ee,fe)=>m.jsx("div",{className:"absolute top-0 bottom-0 border-r border-slate-600",style:{left:`${fe*z}px`,width:`${z}px`},children:Array.from({length:24}).map((pe,Ce)=>m.jsx("div",{className:`absolute top-0 bottom-0 border-l ${Ce%24===0?"border-transparent":Ce%6===0?"border-slate-700/60":"border-slate-800/40"} ${Ce%24===0?"w-0.5 bg-slate-600/10":""}`,style:{left:`${Ce*le}px`}},Ce))},ee))})]}),m.jsx("div",{className:"absolute top-0 bottom-0 w-0.5 bg-red-500 z-30 shadow-[0_0_15px_rgba(239,68,68,0.8)] pointer-events-none transition-all duration-300",style:{left:`${Ve}px`},children:m.jsx("div",{className:"sticky top-10 left-0 -translate-x-1/2 bg-red-600 text-white text-[9px] font-bold px-2 py-0.5 rounded-full shadow-md z-40 whitespace-nowrap uppercase tracking-wider border border-red-400 w-max",children:"Current Time"})}),m.jsx("div",{className:"absolute top-12 left-0 right-0",children:j.map((ee,fe)=>{const pe=re[ee]||[],Ce=$[fe];return m.jsx("div",{className:"border-b border-slate-700/30 relative group/lane hover:bg-white/[0.01] transition-colors",style:{height:`${Ce}px`},children:pe.map(({event:De,stackIndex:Je,isAvailable:Ke})=>{const vt=De.sortTime*oe,Xe=De.endTime?(De.endTime-De.sortTime)*oe:100,rt=12+Je*32,$t=t===De.id;return m.jsxs("div",{id:`timeline-event-${De.id}`,onClick:gt=>{gt.stopPropagation(),h("quest",De.id)},className:`absolute h-7 px-2 rounded shadow-sm border flex items-center gap-2 text-[10px] cursor-pointer transition-all overflow-hidden ring-1 
                             ${me(De.category,De.isDowntime)}
                             ${$t?"ring-white scale-105 shadow-xl z-50":"ring-white/10 hover:z-50 hover:scale-105 hover:shadow-lg"}
                             ${!Ke&&!De.isDowntime?"opacity-80 grayscale border-dashed border-slate-500":""}
                           `,style:{left:`${vt}px`,top:`${rt}px`,width:`${Xe}px`,minWidth:"80px"},title:`${De.timeDisplay} - ${De.title}${Ke?"":" (Unavailable)"}`,children:[!De.isDowntime&&m.jsx("span",{className:"font-mono opacity-75 shrink-0 border-r border-white/20 pr-1.5 mr-0.5",children:De.timeDisplay}),m.jsx("span",{className:"font-bold truncate",children:De.title})]},`${De.id}-${ee}`)})},ee)})})]})})]})]})},c0=({globalState:h,setGlobalState:e,onCycleReset:t,isTrackerMode:i,setIsTrackerMode:r,onSkipDay:a})=>{const o=f=>{const p=f+360;let g=Math.floor(p/60)%24;const w=p%60,x=g>=12?"pm":"am";return`${g%12||12}:${w.toString().padStart(2,"0")} ${x}`},c=f=>{const p=parseInt(f.target.value);i&&p<h.timeOfDayMinutes||e(g=>({...g,timeOfDayMinutes:p,totalMinutes:(g.currentDay-1)*1440+p}))},d=f=>{e(p=>({...p,currentDay:f,totalMinutes:(f-1)*1440+p.timeOfDayMinutes}))};return m.jsxs("div",{className:"bg-slate-900/95 border-b border-purple-500 p-3 fixed top-0 left-0 w-full z-50 shadow-2xl flex flex-col md:flex-row justify-between items-center gap-3 backdrop-blur-sm h-auto md:h-20",children:[m.jsxs("div",{className:"flex items-center gap-4 w-full md:w-auto justify-between md:justify-start",children:[m.jsxs("div",{className:"text-center md:text-left",children:[m.jsxs("div",{className:"text-xs text-purple-400 font-bold uppercase tracking-widest flex items-center gap-2",children:[m.jsx("span",{children:"Current Time"}),i&&m.jsx("span",{className:"text-[10px] text-red-500 animate-pulse",children:" TRACKING"})]}),m.jsx("div",{className:"text-2xl font-bold font-serif text-termina-gold tracking-wider drop-shadow-md min-w-[140px]",children:o(h.timeOfDayMinutes)})]}),i?m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsxs("div",{className:"px-4 py-1 rounded font-bold text-sm bg-termina-accent text-black shadow-lg",children:["Day ",h.currentDay]}),a&&m.jsx("button",{onClick:a,className:"px-2 py-1 rounded border border-slate-600 text-slate-400 text-xs hover:bg-slate-700 hover:text-white transition-colors",title:"Skip to next day",children:" Skip"})]}):m.jsx("div",{className:"flex bg-slate-800 rounded-lg p-1 gap-1",children:[1,2,3].map(f=>m.jsxs("button",{onClick:()=>d(f),className:`px-4 py-1 rounded font-bold text-sm transition-all ${h.currentDay===f?"bg-termina-accent text-black shadow-lg":"text-slate-400 hover:bg-slate-700 hover:text-white"}`,children:["Day ",f]},f))})]}),m.jsxs("div",{className:"flex-1 w-full px-4 relative group",children:[m.jsx("input",{type:"range",min:"0",max:"1440",step:"15",value:h.timeOfDayMinutes,onChange:c,className:`w-full h-2 rounded-lg appearance-none cursor-pointer ${i?"bg-red-900/40 accent-red-500":"bg-slate-700 accent-termina-accent"}`}),m.jsxs("div",{className:"absolute top-3 left-4 right-4 flex justify-between pointer-events-none opacity-50 text-[9px] text-slate-500 font-mono",children:[m.jsx("span",{children:"6am"}),m.jsx("span",{children:"12pm"}),m.jsx("span",{children:"6pm"}),m.jsx("span",{children:"12am"}),m.jsx("span",{children:"6am"})]}),m.jsx("div",{className:"absolute -bottom-6 left-1/2 -translate-x-1/2 text-xs text-slate-400 opacity-0 group-hover:opacity-100 transition-opacity pointer-events-none whitespace-nowrap",children:i?"Drag forward to advance time (Backward disabled)":"Drag to change time"})]}),m.jsxs("div",{className:"flex items-center gap-4",children:[t&&m.jsxs("button",{onClick:t,className:"flex items-center gap-2 bg-slate-800 hover:bg-slate-700 text-termina-gold px-3 py-1.5 rounded-lg border border-slate-700 transition-colors text-xs font-bold uppercase tracking-wider group",title:"Reset to Day 1 (Song of Time)",children:[m.jsx("span",{className:"text-lg group-hover:-rotate-180 transition-transform duration-500",children:""}),m.jsx("span",{className:"hidden sm:inline",children:"Reset Cycle"})]}),m.jsxs("div",{className:"flex items-center gap-2 bg-slate-800 p-1.5 rounded-lg border border-slate-700",children:[m.jsx("span",{className:`text-[10px] font-bold uppercase ${i?"text-white":"text-slate-500"}`,children:"Tracker"}),m.jsx("button",{onClick:()=>r(!i),className:`w-10 h-5 rounded-full relative transition-colors ${i?"bg-red-600":"bg-slate-600"}`,children:m.jsx("div",{className:`absolute top-1 w-3 h-3 bg-white rounded-full transition-all ${i?"left-6":"left-1"}`})})]})]})]})},d0=h=>{if(!h)return{meta:"Unknown",body:"No stats available.",attributes:[]};const e=h.split(`
`).map(o=>o.trim()).filter(Boolean),t=e[0],i=[],r=[],a=/^(Damage|Damage Type|Weight|Properties|Range|Capacity|Speed):(.*)/i;for(let o=1;o<e.length;o++){const c=e[o],d=c.match(a);d?i.push({label:d[1],value:d[2].trim()}):r.push(c)}return{meta:t,body:r.join(`

`),attributes:i}},h0=({globalState:h,gameHistory:e,setGameHistory:t,addNotification:i,onOpenWiki:r})=>{const[a,o]=L.useState(""),[c,d]=L.useState([]),[f,p]=L.useState("available"),[g,w]=L.useState(null),x=L.useMemo(()=>Sf.map(E=>({...E,isUnlocked:h.completedSteps.includes(E.requiredStepId)||e.purchasedItems.includes(E.id),isPurchased:e.purchasedItems.includes(E.id)})).filter(E=>E.name.toLowerCase().includes(a.toLowerCase())||E.description.toLowerCase().includes(a.toLowerCase())).filter(E=>f==="available"?!E.isPurchased:E.isPurchased).sort((E,_)=>{if(f==="available"){if(E.isUnlocked&&!_.isUnlocked)return-1;if(!E.isUnlocked&&_.isUnlocked)return 1}return E.name.localeCompare(_.name)}),[h.completedSteps,a,e.purchasedItems,f]),k=Sf.filter(T=>(h.completedSteps.includes(T.requiredStepId)||e.purchasedItems.includes(T.id))&&!e.purchasedItems.includes(T.id)).length,v=e.purchasedItems.length,A=(T,R)=>{T.stopPropagation(),t(E=>({...E,purchasedItems:[...E.purchasedItems,R.id]})),d(E=>[...E,R.id]),i(`Purchased ${R.name}! Added to Collection.`,"shop")},C=T=>{w(T)};return m.jsxs("div",{className:"space-y-6 relative pb-20",children:[g&&m.jsx("div",{className:"fixed inset-0 bg-black/95 z-[100] flex items-center justify-center p-4 backdrop-blur-sm animate-fade-in",onClick:()=>w(null),children:m.jsxs("div",{className:"bg-[#1a1025] w-full max-w-lg shadow-[0_0_50px_rgba(216,180,254,0.1)] relative overflow-hidden flex flex-col max-h-[90vh]",onClick:T=>T.stopPropagation(),children:[m.jsx("div",{className:"absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-transparent via-termina-gold to-transparent opacity-50"}),m.jsx("div",{className:"absolute bottom-0 left-0 w-full h-1 bg-gradient-to-r from-transparent via-termina-gold to-transparent opacity-50"}),m.jsxs("div",{className:"p-6 pb-4 bg-slate-900/50 border-b border-termina-gold/30",children:[m.jsx("button",{onClick:()=>w(null),className:"absolute top-4 right-4 text-slate-400 hover:text-white bg-black/40 rounded-full p-1.5 transition-colors",children:m.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),m.jsx("h3",{className:"text-3xl font-serif font-bold text-termina-gold tracking-wide uppercase",children:g.name}),m.jsxs("div",{className:"flex justify-between items-end mt-2",children:[m.jsx("div",{className:"text-slate-400 text-sm italic font-serif",children:g.description}),m.jsxs("div",{className:"text-sm font-bold text-amber-400 bg-amber-900/20 px-3 py-1 rounded border border-amber-800/50 whitespace-nowrap ml-4",children:[g.price," Rupees"]})]})]}),m.jsxs("div",{className:"overflow-y-auto p-6 custom-scrollbar space-y-6",children:[m.jsx("div",{className:"bg-[#e3dac9] text-black p-1 shadow-inner",children:m.jsxs("div",{className:"border-2 border-[#922610] p-4",children:[m.jsx("h4",{className:"font-serif font-bold text-2xl text-[#922610] uppercase border-b-2 border-[#922610] pb-1 mb-1",children:g.name}),(()=>{const{meta:T,body:R,attributes:E}=d0(g.stats);return m.jsxs(m.Fragment,{children:[m.jsx("div",{className:"text-sm italic font-serif mb-4 text-black",children:T}),m.jsx("div",{className:"text-sm font-serif leading-relaxed space-y-2 text-black whitespace-pre-wrap",children:R}),E.length>0&&m.jsx("div",{className:"mt-4 pt-2 border-t border-[#922610]",children:E.map((_,M)=>m.jsxs("div",{className:"flex text-sm font-serif",children:[m.jsxs("span",{className:"font-bold text-[#922610] mr-1",children:[_.label,":"]}),m.jsx("span",{className:"text-black",children:_.value})]},M))})]})})()]})}),m.jsxs("div",{className:"pt-4 border-t border-slate-800 flex flex-wrap gap-4 justify-between items-center text-xs text-slate-500",children:[m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("span",{className:"uppercase tracking-wider font-bold",children:"Unlock Requirement:"}),m.jsx("span",{className:"text-slate-300",children:g.questName})]}),g.wikidotUrl&&m.jsxs("button",{onClick:()=>r(g.wikidotUrl,g.name),className:"text-termina-accent hover:text-white underline decoration-dotted flex items-center gap-1",children:[m.jsx("span",{children:"External Wiki"}),m.jsx("span",{children:""})]})]})]})]})}),m.jsxs("div",{className:"bg-slate-900/80 p-6 rounded-lg border border-amber-700/50 shadow-lg bg-[url('https://www.transparenttextures.com/patterns/wood-pattern.png')]",children:[m.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4",children:[m.jsxs("div",{children:[m.jsxs("h2",{className:"text-3xl font-serif font-bold text-amber-500 mb-2 flex items-center gap-3",children:[m.jsx("span",{children:""})," Curiosity Shop"]}),m.jsx("p",{className:"text-amber-200/80 text-sm italic",children:'"We deal in the strange, the lost, and the stolen."'})]}),m.jsxs("div",{className:"flex flex-col items-end gap-2 w-full md:w-auto",children:[m.jsxs("div",{className:"text-xs text-slate-400 font-mono flex gap-3",children:[m.jsxs("span",{children:["AVAILABLE: ",m.jsx("span",{className:"text-green-400 font-bold",children:k})]}),m.jsxs("span",{children:["OWNED: ",m.jsx("span",{className:"text-amber-400 font-bold",children:v})]})]}),m.jsx("input",{type:"text",placeholder:"Search items...",value:a,onChange:T=>o(T.target.value),className:"bg-slate-800/80 border border-slate-600 rounded px-3 py-2 text-sm text-amber-100 focus:border-amber-500 outline-none w-full md:w-64 placeholder-slate-500"})]})]}),m.jsxs("div",{className:"flex gap-1 mt-6 border-b border-amber-900/30",children:[m.jsx("button",{onClick:()=>p("available"),className:`px-6 py-2 text-sm font-bold uppercase tracking-wider rounded-t-lg transition-colors ${f==="available"?"bg-amber-900/20 text-amber-400 border-t border-x border-amber-700/50":"text-slate-500 hover:text-amber-200 hover:bg-slate-800/30"}`,children:"For Sale"}),m.jsx("button",{onClick:()=>p("collection"),className:`px-6 py-2 text-sm font-bold uppercase tracking-wider rounded-t-lg transition-colors ${f==="collection"?"bg-amber-900/20 text-amber-400 border-t border-x border-amber-700/50":"text-slate-500 hover:text-amber-200 hover:bg-slate-800/30"}`,children:"Purchased"})]})]}),m.jsxs("div",{className:"space-y-3 min-h-[300px]",children:[x.map(T=>m.jsx("div",{onClick:()=>C(T),className:`
              relative rounded-lg p-4 border transition-all flex flex-col sm:flex-row sm:items-center gap-4 group cursor-pointer
              ${T.isPurchased?"bg-slate-900 border-amber-900/30 opacity-80 hover:opacity-100":T.isUnlocked?"bg-slate-800 border-slate-700 hover:border-amber-500/50 hover:bg-slate-700/50 shadow-lg":"bg-slate-900/50 border-slate-800 opacity-80 grayscale"}
            `,title:"Click to view Item Stats",children:m.jsxs("div",{className:"flex-1",children:[m.jsxs("div",{className:"flex justify-between items-start",children:[m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("h3",{className:`text-lg font-bold ${T.isPurchased?"text-amber-500":T.isUnlocked?"text-amber-100 group-hover:text-amber-400":"text-slate-500"} transition-colors`,children:T.name}),T.isPurchased&&m.jsx("span",{className:"text-[10px] font-bold text-slate-500 uppercase border border-slate-700 px-2 rounded bg-black/20",children:"In Inventory"})]}),m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsxs("div",{className:`text-xs font-bold px-2 py-1 rounded ${T.isPurchased?"text-slate-500":T.isUnlocked?"bg-amber-900/80 text-amber-200":"bg-slate-800 text-slate-600"}`,children:[T.price," Rupees"]}),T.isUnlocked&&!T.isPurchased&&m.jsx("button",{onClick:R=>A(R,T),className:`text-white text-xs font-bold px-3 py-1 rounded shadow-lg transition-transform hover:scale-105 z-10 relative ${c.includes(T.id)?"bg-amber-600 cursor-default":"bg-green-600 hover:bg-green-500"}`,children:c.includes(T.id)?"BOUGHT!":"BUY"}),m.jsx("span",{className:"text-slate-600 group-hover:text-termina-accent transition-colors ml-2",title:"View Details",children:""})]})]}),m.jsx("p",{className:"text-sm text-slate-400 mt-1",children:T.description}),!T.isPurchased&&m.jsxs("div",{className:"mt-3 flex items-center gap-2 text-xs",children:[m.jsx("span",{className:"text-slate-600 uppercase tracking-wider font-bold",children:"Unlock Requirement:"}),m.jsx("span",{className:`${T.isUnlocked?"text-green-400":"text-red-400/70"}`,children:T.questName})]})]})},T.id)),x.length===0&&m.jsx("div",{className:"text-center py-12 text-slate-500 italic border border-dashed border-slate-800 rounded-lg",children:f==="available"?"No available items found. Complete more quests to unlock stock!":"No items purchased yet. Visit the shop to buy equipment."})]})]})},u0=({quest:h,onClose:e,globalState:t,setGlobalState:i,onToggleStep:r,onCharacterClick:a,addNotification:o,onOpenPdf:c,gameHistory:d,allQuests:f})=>h?m.jsx("div",{className:"fixed inset-0 bg-black/80 z-[60] flex items-center justify-center p-4 backdrop-blur-sm animate-fade-in",onClick:e,children:m.jsxs("div",{className:"w-full max-w-3xl max-h-[90vh] overflow-y-auto bg-slate-900 rounded-xl shadow-2xl relative border border-termina-accent",onClick:p=>p.stopPropagation(),children:[m.jsx("button",{onClick:e,className:"absolute top-2 right-2 z-10 bg-black/50 hover:bg-red-600 text-white w-8 h-8 rounded-full flex items-center justify-center transition-colors border border-white/20",children:""}),m.jsx("div",{className:"p-1",children:m.jsx(pd,{quest:h,globalState:t,setGlobalState:i,onToggleStep:r,onCharacterClick:p=>{e(),a&&a(p)},addNotification:o,onOpenPdf:c,gameHistory:d,defaultExpanded:!0,allQuests:f||cs})})]})}):null,f0=({globalState:h,setGlobalState:e,setSelectedRegion:t,selectedRegion:i,onToggleStep:r,onCharacterClick:a,onNavigate:o,addNotification:c,onOpenPdf:d,gameHistory:f,allQuests:p,timelineEvents:g=[],allCharacters:w})=>{const[x,k]=L.useState(null),v=w||li,A=L.useMemo(()=>x&&p.find(F=>F.id===x)||null,[x,p]),C=h.currentDay,T=h.timeOfDayMinutes,R=F=>{const[B,X]=F.split(":").map(Number);let oe=B;return B<6&&(oe=B+24),(oe-6)*60+X},E=F=>{if(!F)return"";const[B,X]=F.split(":").map(Number),oe=B>=12?"pm":"am";return`${B%12||12}:${X.toString().padStart(2,"0")}${oe}`},_=L.useMemo(()=>g.filter(F=>!(F.category!=="Business"&&F.category!=="World Event"||i!=="All"&&F.region!==i||F.day!==C||h.totalMinutes<F.sortTime||F.endTime&&h.totalMinutes>F.endTime)),[h.totalMinutes,i,C,g]),M=L.useMemo(()=>v.filter(B=>i==="All"||B.locationRegion===i).map(B=>{const X=g.find(le=>le.relatedId===B.id&&le.category==="NPC Schedule"&&le.day===C&&h.totalMinutes>=le.sortTime&&(le.endTime?h.totalMinutes<le.endTime:!0)),oe=X?.title.toLowerCase().includes("sleep")||X?.description.toLowerCase().includes("sleep")||X?.description.toLowerCase().includes("bed");return{id:B.id,name:B.name,location:X?X.location:"Unknown",activity:X?X.title:"Inactive",isSleeping:!!oe,hasEvent:!!X}}).sort((B,X)=>B.hasEvent&&!X.hasEvent?-1:!B.hasEvent&&X.hasEvent?1:!B.isSleeping&&X.isSleeping?-1:B.isSleeping&&!X.isSleeping?1:B.name.localeCompare(X.name)),[h.totalMinutes,i,C,g,v]),N=L.useMemo(()=>{const F=[];return p.forEach(B=>{if(i!=="All"&&B.region!==i)return;const X=B.steps.find(oe=>!h.completedSteps.includes(oe.id));if(X){if(B.prerequisiteQuestId){const le=p.find(z=>z.id===B.prerequisiteQuestId);if(le&&!le.steps.every(z=>h.completedSteps.includes(z.id)))return}if(X.prerequisiteStepId&&!h.completedSteps.includes(X.prerequisiteStepId))return;let oe=!0;if(X.days&&X.days.length>0?X.days.includes(C)||(oe=!1):X.day&&X.day!==C&&(oe=!1),!oe)return;if(X.time){const le=R(X.time);let z=le+180;if(X.endTime&&(z=R(X.endTime)),T<le||T>z)return}F.push({questId:B.id,stepId:X.id,questTitle:B.title,stepTitle:X.title,location:X.location,region:B.region,description:X.description,day:X.day,days:X.days,time:X.time,endTime:X.endTime})}}),F},[h.completedSteps,h.currentDay,h.timeOfDayMinutes,i,p]),I=["All",...Object.values(q)],G=F=>{o&&o("timeline",F)};return m.jsxs("div",{className:"space-y-6 animate-fade-in pb-20",children:[m.jsx(u0,{quest:A,onClose:()=>k(null),globalState:h,setGlobalState:e,onToggleStep:r,onCharacterClick:a,addNotification:c,onOpenPdf:d,gameHistory:f,allQuests:p}),m.jsx("div",{className:"flex flex-wrap gap-2 justify-center md:justify-start bg-slate-900/50 p-4 rounded-lg border border-slate-800",children:I.map(F=>m.jsx("button",{onClick:()=>t(F),className:`px-3 py-1 rounded-full text-[10px] font-bold uppercase tracking-wider transition-all ${i===F?"bg-green-500 text-black shadow-[0_0_10px_rgba(34,197,94,0.4)]":"bg-slate-800 text-slate-400 hover:bg-slate-700 hover:text-white border border-slate-700"}`,children:F},F))}),m.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[m.jsxs("div",{className:"space-y-8",children:[m.jsxs("div",{className:"space-y-4",children:[m.jsxs("h3",{className:"text-xl font-serif text-termina-gold flex items-center gap-2 border-b border-slate-700 pb-2",children:[m.jsx("span",{children:""})," Active Locations"]}),_.length>0?m.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-3",children:_.map(F=>m.jsxs("div",{onClick:()=>G(F.id),className:"bg-slate-800 border border-slate-700 p-3 rounded-lg flex flex-col justify-between items-start hover:border-green-500/50 transition-colors shadow-sm aspect-square cursor-pointer group",title:"Click for details",children:[m.jsxs("div",{className:"w-full",children:[m.jsx("span",{className:`text-[9px] uppercase px-1.5 py-0.5 rounded border font-bold mb-2 inline-block ${F.category==="Business"?"bg-emerald-900/30 text-emerald-400 border-emerald-800":"bg-yellow-900/30 text-yellow-400 border-yellow-800"}`,children:F.category==="Business"?"SHOP":"ACTIVITY"}),m.jsx("h4",{className:"font-bold text-white text-xs leading-tight mb-1 group-hover:text-green-400 transition-colors",children:F.title})]}),m.jsx("div",{className:"w-full pt-2 border-t border-slate-700/50",children:m.jsxs("p",{className:"text-[10px] text-slate-400 truncate",children:[" ",F.location]})})]},F.id))}):m.jsx("div",{className:"bg-slate-800/30 border border-slate-800 rounded-lg p-6 text-center",children:m.jsx("p",{className:"text-slate-500 text-sm italic",children:"No shops or world events active."})})]}),m.jsxs("div",{className:"space-y-4",children:[m.jsxs("h3",{className:"text-xl font-serif text-termina-gold flex items-center gap-2 border-b border-slate-700 pb-2",children:[m.jsx("span",{children:""})," NPC Tracker"]}),m.jsxs("div",{className:"grid gap-2",children:[M.map(F=>m.jsxs("div",{onClick:()=>a&&a(F.id),className:`
                    p-3 rounded border flex items-center justify-between transition-all cursor-pointer group
                    ${F.hasEvent?F.isSleeping?"bg-slate-900/50 border-slate-800 text-slate-500 grayscale hover:grayscale-0":"bg-slate-800 border-slate-700 text-slate-200 hover:border-termina-accent/50 hover:bg-slate-700":"bg-slate-900/30 border-slate-800 text-slate-600 hover:bg-slate-800"}
                  `,children:[m.jsxs("div",{className:"flex items-center gap-3",children:[m.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center text-xs border ${F.isSleeping?"bg-slate-800 border-slate-700 text-slate-600":"bg-purple-900/30 border-purple-700 text-purple-200 group-hover:bg-termina-accent group-hover:text-black"}`,children:F.isSleeping?"":""}),m.jsxs("div",{children:[m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("span",{className:"font-bold text-sm group-hover:text-termina-accent transition-colors",children:F.name}),F.isSleeping&&m.jsx("span",{className:"text-[9px] uppercase border border-slate-700 px-1 rounded",children:"Sleeping"})]}),m.jsx("div",{className:"text-xs opacity-70 flex gap-2",children:m.jsx("span",{children:F.activity})})]})]}),m.jsxs("div",{className:"text-xs font-mono bg-black/20 px-2 py-1 rounded border border-white/5",children:[" ",F.location]})]},F.id)),M.length===0&&m.jsx("p",{className:"text-slate-500 text-sm italic p-4",children:"No NPCs found in this region."})]})]})]}),m.jsxs("div",{className:"space-y-4",children:[m.jsxs("h3",{className:"text-xl font-serif text-termina-gold flex items-center gap-2 border-b border-slate-700 pb-2",children:[m.jsx("span",{children:""})," Available Quest Steps"]}),m.jsx("div",{className:"grid gap-3",children:N.length>0?N.map((F,B)=>m.jsxs("div",{onClick:()=>k(F.questId),className:"bg-slate-800/80 border border-slate-700 p-4 rounded-lg group hover:bg-slate-750 hover:border-termina-accent/50 cursor-pointer transition-all relative overflow-hidden flex flex-col justify-between",title:"Click to view full Quest details",children:[m.jsx("div",{className:"absolute left-0 top-0 bottom-0 w-1 bg-purple-500 group-hover:bg-termina-accent transition-colors"}),m.jsxs("div",{className:"pl-3 mb-4",children:[m.jsxs("div",{className:"flex justify-between items-start mb-1",children:[m.jsxs("h4",{className:"font-bold text-white text-lg flex items-center gap-2 group-hover:text-termina-accent transition-colors",children:[F.stepTitle,F.time&&m.jsx("span",{className:"text-[10px] bg-red-900/50 text-red-200 px-1.5 py-0.5 rounded border border-red-800",children:E(F.time)})]}),r&&m.jsx("button",{onClick:X=>{X.stopPropagation(),r(F.questId,F.stepId)},className:"bg-green-700 hover:bg-green-600 text-white text-xs font-bold px-3 py-1 rounded shadow-lg transition-transform hover:scale-105 uppercase tracking-wider border border-green-500",children:"Complete"})]}),m.jsxs("div",{className:"flex justify-between items-start mb-2",children:[m.jsxs("span",{className:"text-[10px] font-bold text-purple-400 uppercase tracking-wider",children:["in ",F.questTitle]}),m.jsx("span",{className:"text-[10px] text-slate-500",children:F.region})]}),m.jsx("p",{className:"text-xs text-slate-300 line-clamp-2 leading-relaxed",children:F.description})]}),m.jsxs("div",{className:"pl-3 mt-auto text-xs text-termina-gold flex items-center gap-1 pt-2 border-t border-slate-700/50",children:[m.jsx("span",{children:""})," ",F.location,F.time&&m.jsxs("span",{className:"ml-2 text-slate-400 font-mono",children:[F.days?`Day ${F.days.join(",")}`:""," ",E(F.time),F.endTime?` - ${E(F.endTime)}`:""]})]})]},B)):m.jsx("div",{className:"bg-slate-800/30 border border-slate-800 rounded-lg p-8 text-center",children:m.jsx("p",{className:"text-slate-500 text-sm italic",children:"No quest steps available at this specific time."})})})]})]})]})},p0=({event:h,globalState:e,setGlobalState:t,onToggleStep:i,onCharacterClick:r,onClose:a,addNotification:o,onOpenPdf:c,allCharacters:d,customShops:f,allQuests:p})=>{const g=d||li,w=f||[],x=p||cs,k=h.category.includes("Quest")&&h.relatedId?x.find(N=>N.id===h.relatedId):null,v=h.category==="NPC Schedule"&&h.relatedId?g.find(N=>N.id===h.relatedId):null,A=h.id.match(/^shop-(.+)-d\d+$/),C=!!A;let T;if(C&&A){const N=A[1];T=w.find(I=>I.id===N)}let R=[];T?T.relatedCharacters&&(R=T.relatedCharacters.map(N=>g.find(I=>I.id===N.characterId)).filter(Boolean)):h.category==="Business"&&(R=g.filter(N=>N.locationSpecific.includes(h.location)));const E=h.category!=="Business"?g.filter(N=>N.id===v?.id?!1:N.scheduleEvents&&N.scheduleEvents.length>0?N.scheduleEvents.some(I=>{if(I.day!=="All"&&I.day!==h.day)return!1;const[G,F]=I.start.split(":").map(Number),[B,X]=I.end.split(":").map(Number),oe=h.sortTime%1440,le=(Q,V)=>((Q<6?Q+24:Q)-6)*60+V,z=le(G,F),K=le(B,X);return oe>=z&&oe<K?I.location===h.location||I.location.includes(h.location)||h.location.includes(I.location):!1}):N.locationSpecific.includes(h.location)||h.location.includes(N.locationSpecific)):[],_=h.category==="Business",M=v?x.filter(N=>N.steps.some(I=>I.characterId===v.id)):[];return m.jsxs("div",{className:"bg-slate-900/95 flex flex-col h-full overflow-hidden border-r border-slate-700",children:[m.jsxs("div",{className:"p-4 border-b border-slate-700 bg-slate-800/50 flex justify-between items-start shrink-0",children:[m.jsxs("div",{className:"overflow-hidden",children:[m.jsxs("div",{className:"flex flex-wrap items-center gap-2 mb-1",children:[m.jsx("span",{className:`px-2 py-0.5 text-[9px] font-bold uppercase tracking-wider rounded border ${h.category==="Main Quest"?"bg-red-900/30 text-red-200 border-red-800":h.category==="Side Quest"?"bg-purple-900/30 text-purple-200 border-purple-800":h.category==="Business"?"bg-emerald-900/30 text-emerald-200 border-emerald-800":"bg-blue-900/30 text-blue-200 border-blue-800"}`,children:h.category}),m.jsxs("span",{className:"text-termina-gold font-mono text-xs whitespace-nowrap",children:["Day ",h.day,"  ",h.timeDisplay]})]}),m.jsx("h2",{className:"text-lg font-bold text-white truncate pr-2",children:h.title}),m.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-xs text-slate-400 mt-1",children:[m.jsxs("span",{className:"truncate",children:[" ",h.location]}),h.pageReference&&m.jsxs("button",{onClick:()=>c(h.pageReference),className:"text-termina-accent hover:underline decoration-dotted",children:["(Ref: p.",h.pageReference,")"]})]})]}),m.jsx("button",{onClick:a,className:"text-slate-500 hover:text-white p-1 shrink-0",children:m.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),m.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-6",children:[m.jsx("div",{className:"prose prose-invert max-w-none",children:m.jsx("p",{className:"text-slate-300 text-sm leading-relaxed border-l-2 border-slate-600 pl-4 italic",children:h.description})}),_&&m.jsxs("div",{className:"bg-slate-800/50 rounded border border-slate-700 p-3",children:[m.jsx("h3",{className:"text-xs font-bold text-slate-500 uppercase tracking-widest mb-2",children:"Related People"}),R.length>0?m.jsx("div",{className:"grid gap-3",children:R.map(N=>{let I=N.description;if(T&&T.relatedCharacters){const G=T.relatedCharacters.find(F=>F.characterId===N.id);G&&(I=G.role)}return m.jsxs("div",{onClick:()=>r(N.id),className:"flex items-center gap-3 cursor-pointer group",children:[m.jsx("div",{className:"w-8 h-8 rounded-full bg-emerald-900/50 flex items-center justify-center text-sm border border-emerald-500/30 group-hover:border-termina-accent",children:""}),m.jsxs("div",{children:[m.jsx("p",{className:"text-sm font-bold text-emerald-200 group-hover:text-termina-accent transition-colors",children:N.name}),m.jsx("p",{className:"text-xs text-slate-500 line-clamp-1",children:I})]})]},N.id)})}):m.jsx("p",{className:"text-slate-500 text-xs italic",children:"No specific characters mapped to this location."})]}),v&&m.jsxs("div",{className:"bg-slate-800/50 rounded border border-slate-700 p-3",children:[m.jsx("h3",{className:"text-xs font-bold text-slate-500 uppercase tracking-widest mb-2",children:"Key Character"}),m.jsxs("div",{onClick:()=>r(v.id),className:"flex items-center gap-3 cursor-pointer group",children:[m.jsx("div",{className:"w-10 h-10 rounded-full bg-purple-900/50 flex items-center justify-center text-lg border border-purple-500/30 group-hover:border-termina-accent",children:""}),m.jsxs("div",{children:[m.jsx("p",{className:"text-sm font-bold text-purple-200 group-hover:text-termina-accent transition-colors",children:v.name}),m.jsx("p",{className:"text-xs text-slate-500 line-clamp-1",children:v.description})]})]}),M.length>0&&m.jsxs("div",{className:"mt-3 pt-3 border-t border-slate-700/50",children:[m.jsx("p",{className:"text-[10px] text-slate-500 uppercase tracking-wider mb-2",children:"Related Quests"}),m.jsx("div",{className:"flex flex-col gap-2",children:M.map(N=>m.jsxs("div",{className:"text-xs text-slate-300 bg-slate-900/50 px-2 py-1 rounded border border-slate-700/50",children:[m.jsxs("span",{className:"text-termina-gold mr-1",children:["Q",N.questNumber]}),N.title]},N.id))})]})]}),E.length>0&&!_&&m.jsxs("div",{children:[m.jsx("h3",{className:"text-xs font-bold text-slate-500 uppercase tracking-widest mb-3",children:"Also at Location"}),m.jsx("div",{className:"grid grid-cols-1 gap-2",children:E.map(N=>m.jsxs("div",{onClick:()=>r(N.id),className:"flex items-center gap-3 p-2 bg-slate-800/30 border border-slate-700 rounded cursor-pointer hover:border-termina-accent transition-colors",children:[m.jsx("div",{className:"w-6 h-6 rounded-full bg-slate-700 flex items-center justify-center text-[10px] text-slate-400",children:"?"}),m.jsx("div",{children:m.jsx("p",{className:"text-xs font-bold text-slate-200",children:N.name})})]},N.id))})]}),k&&m.jsxs("div",{children:[m.jsx("h3",{className:"text-xs font-bold text-slate-500 uppercase tracking-widest mb-3",children:"Quest Details"}),m.jsx(pd,{quest:k,globalState:e,setGlobalState:t,onToggleStep:i,onCharacterClick:r,defaultExpanded:!0,addNotification:o,onOpenPdf:c,allQuests:x})]})]})]})},m0=({notifications:h,removeNotification:e})=>m.jsx("div",{className:"fixed top-20 right-4 z-50 flex flex-col gap-2 pointer-events-none",children:h.map(t=>m.jsx(g0,{notification:t,onClose:()=>e(t.id)},t.id))}),g0=({notification:h,onClose:e})=>{L.useEffect(()=>{const a=setTimeout(e,7e3);return()=>clearTimeout(a)},[e]);const t=()=>{switch(h.type){case"shop":return"bg-amber-900/95 border-amber-500 text-amber-100";case"timeline":return"bg-purple-900/95 border-purple-500 text-purple-100";default:return"bg-slate-800/95 border-slate-500 text-white"}},i=()=>{switch(h.type){case"shop":return"";case"timeline":return"";default:return""}},r=()=>{h.action&&(h.action(),e())};return m.jsxs("div",{onClick:r,className:`pointer-events-auto flex items-start gap-3 p-4 rounded-lg border shadow-xl backdrop-blur-md animate-slide-in-right w-80 ${t()} ${h.action?"cursor-pointer hover:scale-105 transition-transform":""}`,children:[m.jsx("div",{className:"text-xl",children:i()}),m.jsxs("div",{className:"flex-1",children:[m.jsxs("div",{className:"flex justify-between items-center mb-1",children:[m.jsx("p",{className:"text-xs font-bold uppercase tracking-wider opacity-70",children:h.type==="shop"?"New Item Available":h.type==="timeline"?"Timeline Altered":"Update"}),h.action&&m.jsx("span",{className:"text-[9px] bg-black/20 px-1.5 py-0.5 rounded border border-white/10",children:"CLICK TO VIEW"})]}),m.jsx("p",{className:"text-sm font-medium leading-snug",children:h.message})]}),m.jsx("button",{onClick:a=>{a.stopPropagation(),e()},className:"text-white/50 hover:text-white p-1 hover:bg-black/20 rounded",children:""})]})},zt=typeof process=="object"&&process+""=="[object process]"&&!process.versions.nw&&!(process.versions.electron&&process.type&&process.type!=="browser"),ed=[.001,0,0,.001,0,0],zc=1.35,fn={ANY:1,DISPLAY:2,PRINT:4,ANNOTATIONS_FORMS:16,ANNOTATIONS_STORAGE:32,ANNOTATIONS_DISABLE:64,IS_EDITING:128,OPLIST:256},Yn={DISABLE:0,ENABLE:1,ENABLE_FORMS:2,ENABLE_STORAGE:3},Xr="pdfjs_internal_editor_",Me={DISABLE:-1,NONE:0,FREETEXT:3,HIGHLIGHT:9,STAMP:13,INK:15,POPUP:16,SIGNATURE:101,COMMENT:102},Oe={RESIZE:1,CREATE:2,FREETEXT_SIZE:11,FREETEXT_COLOR:12,FREETEXT_OPACITY:13,INK_COLOR:21,INK_THICKNESS:22,INK_OPACITY:23,HIGHLIGHT_COLOR:31,HIGHLIGHT_THICKNESS:32,HIGHLIGHT_FREE:33,HIGHLIGHT_SHOW_ALL:34,DRAW_STEP:41},cp={PRINT:4,MODIFY_CONTENTS:8,COPY:16,MODIFY_ANNOTATIONS:32,FILL_INTERACTIVE_FORMS:256,COPY_FOR_ACCESSIBILITY:512,ASSEMBLE:1024,PRINT_HIGH_QUALITY:2048},Dt={FILL:0,STROKE:1,FILL_STROKE:2,INVISIBLE:3,FILL_STROKE_MASK:3,ADD_TO_PATH_FLAG:4},Kr={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3},wt={TEXT:1,LINK:2,FREETEXT:3,LINE:4,SQUARE:5,CIRCLE:6,POLYGON:7,POLYLINE:8,HIGHLIGHT:9,UNDERLINE:10,SQUIGGLY:11,STRIKEOUT:12,STAMP:13,CARET:14,INK:15,POPUP:16,FILEATTACHMENT:17,SOUND:18,MOVIE:19,WIDGET:20,SCREEN:21,PRINTERMARK:22,TRAPNET:23,WATERMARK:24,THREED:25,REDACT:26},Hs={SOLID:1,DASHED:2,BEVELED:3,INSET:4,UNDERLINE:5},na={ERRORS:0,WARNINGS:1,INFOS:5},Js={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotation:80,endAnnotation:81,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91,setStrokeTransparent:92,setFillTransparent:93,rawFillPath:94},Co={moveTo:0,lineTo:1,curveTo:2,closePath:3},dp={NEED_PASSWORD:1,INCORRECT_PASSWORD:2};let Ho=na.WARNINGS;function y0(h){Number.isInteger(h)&&(Ho=h)}function w0(){return Ho}function Go(h){Ho>=na.INFOS&&console.info(`Info: ${h}`)}function Ie(h){Ho>=na.WARNINGS&&console.warn(`Warning: ${h}`)}function Ye(h){throw new Error(h)}function Be(h,e){h||Ye(e)}function b0(h){switch(h?.protocol){case"http:":case"https:":case"ftp:":case"mailto:":case"tel:":return!0;default:return!1}}function md(h,e=null,t=null){if(!h)return null;if(t&&typeof h=="string"&&(t.addDefaultProtocol&&h.startsWith("www.")&&h.match(/\./g)?.length>=2&&(h=`http://${h}`),t.tryConvertEncoding))try{h=A0(h)}catch{}const i=e?URL.parse(h,e):URL.parse(h);return b0(i)?i:null}function gd(h,e,t=!1){const i=URL.parse(h);return i?(i.hash=e,i.href):t&&md(h,"http://example.com")?h.split("#",1)[0]+`${e?`#${e}`:""}`:""}function Le(h,e,t,i=!1){return Object.defineProperty(h,e,{value:t,enumerable:!i,configurable:!0,writable:!1}),t}const fs=(function(){function e(t,i){this.message=t,this.name=i}return e.prototype=new Error,e.constructor=e,e})();class Cf extends fs{constructor(e,t){super(e,"PasswordException"),this.code=t}}class Uc extends fs{constructor(e,t){super(e,"UnknownErrorException"),this.details=t}}class Fo extends fs{constructor(e){super(e,"InvalidPDFException")}}class Qr extends fs{constructor(e,t,i){super(e,"ResponseException"),this.status=t,this.missing=i}}class v0 extends fs{constructor(e){super(e,"FormatError")}}class ci extends fs{constructor(e){super(e,"AbortException")}}function hp(h){(typeof h!="object"||h?.length===void 0)&&Ye("Invalid argument for bytesToString");const e=h.length,t=8192;if(e<t)return String.fromCharCode.apply(null,h);const i=[];for(let r=0;r<e;r+=t){const a=Math.min(r+t,e),o=h.subarray(r,a);i.push(String.fromCharCode.apply(null,o))}return i.join("")}function ia(h){typeof h!="string"&&Ye("Invalid argument for stringToBytes");const e=h.length,t=new Uint8Array(e);for(let i=0;i<e;++i)t[i]=h.charCodeAt(i)&255;return t}function x0(h){return String.fromCharCode(h>>24&255,h>>16&255,h>>8&255,h&255)}function k0(){const h=new Uint8Array(4);return h[0]=1,new Uint32Array(h.buffer,0,1)[0]===1}function S0(){try{return new Function(""),!0}catch{return!1}}class Pt{static get isLittleEndian(){return Le(this,"isLittleEndian",k0())}static get isEvalSupported(){return Le(this,"isEvalSupported",S0())}static get isOffscreenCanvasSupported(){return Le(this,"isOffscreenCanvasSupported",typeof OffscreenCanvas<"u")}static get isImageDecoderSupported(){return Le(this,"isImageDecoderSupported",typeof ImageDecoder<"u")}static get platform(){const{platform:e,userAgent:t}=navigator;return Le(this,"platform",{isAndroid:t.includes("Android"),isLinux:e.includes("Linux"),isMac:e.includes("Mac"),isWindows:e.includes("Win"),isFirefox:t.includes("Firefox")})}static get isCSSRoundSupported(){return Le(this,"isCSSRoundSupported",globalThis.CSS?.supports?.("width: round(1.5px, 1px)"))}}const $c=Array.from(Array(256).keys(),h=>h.toString(16).padStart(2,"0"));class ve{static makeHexColor(e,t,i){return`#${$c[e]}${$c[t]}${$c[i]}`}static domMatrixToTransform(e){return[e.a,e.b,e.c,e.d,e.e,e.f]}static scaleMinMax(e,t){let i;e[0]?(e[0]<0&&(i=t[0],t[0]=t[2],t[2]=i),t[0]*=e[0],t[2]*=e[0],e[3]<0&&(i=t[1],t[1]=t[3],t[3]=i),t[1]*=e[3],t[3]*=e[3]):(i=t[0],t[0]=t[1],t[1]=i,i=t[2],t[2]=t[3],t[3]=i,e[1]<0&&(i=t[1],t[1]=t[3],t[3]=i),t[1]*=e[1],t[3]*=e[1],e[2]<0&&(i=t[0],t[0]=t[2],t[2]=i),t[0]*=e[2],t[2]*=e[2]),t[0]+=e[4],t[1]+=e[5],t[2]+=e[4],t[3]+=e[5]}static transform(e,t){return[e[0]*t[0]+e[2]*t[1],e[1]*t[0]+e[3]*t[1],e[0]*t[2]+e[2]*t[3],e[1]*t[2]+e[3]*t[3],e[0]*t[4]+e[2]*t[5]+e[4],e[1]*t[4]+e[3]*t[5]+e[5]]}static multiplyByDOMMatrix(e,t){return[e[0]*t.a+e[2]*t.b,e[1]*t.a+e[3]*t.b,e[0]*t.c+e[2]*t.d,e[1]*t.c+e[3]*t.d,e[0]*t.e+e[2]*t.f+e[4],e[1]*t.e+e[3]*t.f+e[5]]}static applyTransform(e,t,i=0){const r=e[i],a=e[i+1];e[i]=r*t[0]+a*t[2]+t[4],e[i+1]=r*t[1]+a*t[3]+t[5]}static applyTransformToBezier(e,t,i=0){const r=t[0],a=t[1],o=t[2],c=t[3],d=t[4],f=t[5];for(let p=0;p<6;p+=2){const g=e[i+p],w=e[i+p+1];e[i+p]=g*r+w*o+d,e[i+p+1]=g*a+w*c+f}}static applyInverseTransform(e,t){const i=e[0],r=e[1],a=t[0]*t[3]-t[1]*t[2];e[0]=(i*t[3]-r*t[2]+t[2]*t[5]-t[4]*t[3])/a,e[1]=(-i*t[1]+r*t[0]+t[4]*t[1]-t[5]*t[0])/a}static axialAlignedBoundingBox(e,t,i){const r=t[0],a=t[1],o=t[2],c=t[3],d=t[4],f=t[5],p=e[0],g=e[1],w=e[2],x=e[3];let k=r*p+d,v=k,A=r*w+d,C=A,T=c*g+f,R=T,E=c*x+f,_=E;if(a!==0||o!==0){const M=a*p,N=a*w,I=o*g,G=o*x;k+=I,C+=I,A+=G,v+=G,T+=M,_+=M,E+=N,R+=N}i[0]=Math.min(i[0],k,A,v,C),i[1]=Math.min(i[1],T,E,R,_),i[2]=Math.max(i[2],k,A,v,C),i[3]=Math.max(i[3],T,E,R,_)}static inverseTransform(e){const t=e[0]*e[3]-e[1]*e[2];return[e[3]/t,-e[1]/t,-e[2]/t,e[0]/t,(e[2]*e[5]-e[4]*e[3])/t,(e[4]*e[1]-e[5]*e[0])/t]}static singularValueDecompose2dScale(e,t){const i=e[0],r=e[1],a=e[2],o=e[3],c=i**2+r**2,d=i*a+r*o,f=a**2+o**2,p=(c+f)/2,g=Math.sqrt(p**2-(c*f-d**2));t[0]=Math.sqrt(p+g||1),t[1]=Math.sqrt(p-g||1)}static normalizeRect(e){const t=e.slice(0);return e[0]>e[2]&&(t[0]=e[2],t[2]=e[0]),e[1]>e[3]&&(t[1]=e[3],t[3]=e[1]),t}static intersect(e,t){const i=Math.max(Math.min(e[0],e[2]),Math.min(t[0],t[2])),r=Math.min(Math.max(e[0],e[2]),Math.max(t[0],t[2]));if(i>r)return null;const a=Math.max(Math.min(e[1],e[3]),Math.min(t[1],t[3])),o=Math.min(Math.max(e[1],e[3]),Math.max(t[1],t[3]));return a>o?null:[i,a,r,o]}static pointBoundingBox(e,t,i){i[0]=Math.min(i[0],e),i[1]=Math.min(i[1],t),i[2]=Math.max(i[2],e),i[3]=Math.max(i[3],t)}static rectBoundingBox(e,t,i,r,a){a[0]=Math.min(a[0],e,i),a[1]=Math.min(a[1],t,r),a[2]=Math.max(a[2],e,i),a[3]=Math.max(a[3],t,r)}static#e(e,t,i,r,a,o,c,d,f,p){if(f<=0||f>=1)return;const g=1-f,w=f*f,x=w*f,k=g*(g*(g*e+3*f*t)+3*w*i)+x*r,v=g*(g*(g*a+3*f*o)+3*w*c)+x*d;p[0]=Math.min(p[0],k),p[1]=Math.min(p[1],v),p[2]=Math.max(p[2],k),p[3]=Math.max(p[3],v)}static#t(e,t,i,r,a,o,c,d,f,p,g,w){if(Math.abs(f)<1e-12){Math.abs(p)>=1e-12&&this.#e(e,t,i,r,a,o,c,d,-g/p,w);return}const x=p**2-4*g*f;if(x<0)return;const k=Math.sqrt(x),v=2*f;this.#e(e,t,i,r,a,o,c,d,(-p+k)/v,w),this.#e(e,t,i,r,a,o,c,d,(-p-k)/v,w)}static bezierBoundingBox(e,t,i,r,a,o,c,d,f){f[0]=Math.min(f[0],e,c),f[1]=Math.min(f[1],t,d),f[2]=Math.max(f[2],e,c),f[3]=Math.max(f[3],t,d),this.#t(e,i,a,c,t,r,o,d,3*(-e+3*(i-a)+c),6*(e-2*i+a),3*(i-e),f),this.#t(e,i,a,c,t,r,o,d,3*(-t+3*(r-o)+d),6*(t-2*r+o),3*(r-t),f)}}function A0(h){return decodeURIComponent(escape(h))}let Vc=null,Tf=null;function up(h){return Vc||(Vc=/([\u00a0\u00b5\u037e\u0eb3\u2000-\u200a\u202f\u2126\ufb00-\ufb04\ufb06\ufb20-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufba1\ufba4-\ufba9\ufbae-\ufbb1\ufbd3-\ufbdc\ufbde-\ufbe7\ufbea-\ufbf8\ufbfc-\ufbfd\ufc00-\ufc5d\ufc64-\ufcf1\ufcf5-\ufd3d\ufd88\ufdf4\ufdfa-\ufdfb\ufe71\ufe77\ufe79\ufe7b\ufe7d]+)|(\ufb05+)/gu,Tf=new Map([["","t"]])),h.replaceAll(Vc,(e,t,i)=>t?t.normalize("NFKC"):Tf.get(i))}function yd(){if(typeof crypto.randomUUID=="function")return crypto.randomUUID();const h=new Uint8Array(32);return crypto.getRandomValues(h),hp(h)}const wd="pdfjs_internal_id_";function C0(h,e,t){if(!Array.isArray(t)||t.length<2)return!1;const[i,r,...a]=t;if(!h(i)&&!Number.isInteger(i)||!e(r))return!1;const o=a.length;let c=!0;switch(r.name){case"XYZ":if(o<2||o>3)return!1;break;case"Fit":case"FitB":return o===0;case"FitH":case"FitBH":case"FitV":case"FitBV":if(o>1)return!1;break;case"FitR":if(o!==4)return!1;c=!1;break;default:return!1}for(const d of a)if(!(typeof d=="number"||c&&d===null))return!1;return!0}function Wt(h,e,t){return Math.min(Math.max(h,e),t)}function fp(h){return Uint8Array.prototype.toBase64?h.toBase64():btoa(hp(h))}function T0(h){return Uint8Array.fromBase64?Uint8Array.fromBase64(h):ia(atob(h))}typeof Promise.try!="function"&&(Promise.try=function(h,...e){return new Promise(t=>{t(h(...e))})});typeof Math.sumPrecise!="function"&&(Math.sumPrecise=function(h){return h.reduce((e,t)=>e+t,0)});class Jr{static textContent(e){const t=[],i={items:t,styles:Object.create(null)};function r(a){if(!a)return;let o=null;const c=a.name;if(c==="#text")o=a.value;else if(Jr.shouldBuildText(c))a?.attributes?.textContent?o=a.attributes.textContent:a.value&&(o=a.value);else return;if(o!==null&&t.push({str:o}),!!a.children)for(const d of a.children)r(d)}return r(e),i}static shouldBuildText(e){return!(e==="textarea"||e==="input"||e==="option"||e==="select")}}class bd{static setupStorage(e,t,i,r,a){const o=r.getValue(t,{value:null});switch(i.name){case"textarea":if(o.value!==null&&(e.textContent=o.value),a==="print")break;e.addEventListener("input",c=>{r.setValue(t,{value:c.target.value})});break;case"input":if(i.attributes.type==="radio"||i.attributes.type==="checkbox"){if(o.value===i.attributes.xfaOn?e.setAttribute("checked",!0):o.value===i.attributes.xfaOff&&e.removeAttribute("checked"),a==="print")break;e.addEventListener("change",c=>{r.setValue(t,{value:c.target.checked?c.target.getAttribute("xfaOn"):c.target.getAttribute("xfaOff")})})}else{if(o.value!==null&&e.setAttribute("value",o.value),a==="print")break;e.addEventListener("input",c=>{r.setValue(t,{value:c.target.value})})}break;case"select":if(o.value!==null){e.setAttribute("value",o.value);for(const c of i.children)c.attributes.value===o.value?c.attributes.selected=!0:c.attributes.hasOwnProperty("selected")&&delete c.attributes.selected}e.addEventListener("input",c=>{const d=c.target.options,f=d.selectedIndex===-1?"":d[d.selectedIndex].value;r.setValue(t,{value:f})});break}}static setAttributes({html:e,element:t,storage:i=null,intent:r,linkService:a}){const{attributes:o}=t,c=e instanceof HTMLAnchorElement;o.type==="radio"&&(o.name=`${o.name}-${r}`);for(const[d,f]of Object.entries(o))if(f!=null)switch(d){case"class":f.length&&e.setAttribute(d,f.join(" "));break;case"dataId":break;case"id":e.setAttribute("data-element-id",f);break;case"style":Object.assign(e.style,f);break;case"textContent":e.textContent=f;break;default:(!c||d!=="href"&&d!=="newWindow")&&e.setAttribute(d,f)}c&&a.addLinkAttributes(e,o.href,o.newWindow),i&&o.dataId&&this.setupStorage(e,o.dataId,t,i)}static render(e){const t=e.annotationStorage,i=e.linkService,r=e.xfaHtml,a=e.intent||"display",o=document.createElement(r.name);r.attributes&&this.setAttributes({html:o,element:r,intent:a,linkService:i});const c=a!=="richText",d=e.div;if(d.append(o),e.viewport){const g=`matrix(${e.viewport.transform.join(",")})`;d.style.transform=g}c&&d.setAttribute("class","xfaLayer xfaFont");const f=[];if(r.children.length===0){if(r.value){const g=document.createTextNode(r.value);o.append(g),c&&Jr.shouldBuildText(r.name)&&f.push(g)}return{textDivs:f}}const p=[[r,-1,o]];for(;p.length>0;){const[g,w,x]=p.at(-1);if(w+1===g.children.length){p.pop();continue}const k=g.children[++p.at(-1)[1]];if(k===null)continue;const{name:v}=k;if(v==="#text"){const C=document.createTextNode(k.value);f.push(C),x.append(C);continue}const A=k?.attributes?.xmlns?document.createElementNS(k.attributes.xmlns,v):document.createElement(v);if(x.append(A),k.attributes&&this.setAttributes({html:A,element:k,storage:t,intent:a,linkService:i}),k.children?.length>0)p.push([k,-1,A]);else if(k.value){const C=document.createTextNode(k.value);c&&Jr.shouldBuildText(v)&&f.push(C),A.append(C)}}for(const g of d.querySelectorAll(".xfaNonInteractive input, .xfaNonInteractive textarea"))g.setAttribute("readOnly",!0);return{textDivs:f}}static update(e){const t=`matrix(${e.viewport.transform.join(",")})`;e.div.style.transform=t,e.div.hidden=!1}}const ai="http://www.w3.org/2000/svg";class ds{static CSS=96;static PDF=72;static PDF_TO_CSS_UNITS=this.CSS/this.PDF}async function er(h,e="text"){if(Ur(h,document.baseURI)){const t=await fetch(h);if(!t.ok)throw new Error(t.statusText);switch(e){case"arraybuffer":return t.arrayBuffer();case"blob":return t.blob();case"json":return t.json()}return t.text()}return new Promise((t,i)=>{const r=new XMLHttpRequest;r.open("GET",h,!0),r.responseType=e,r.onreadystatechange=()=>{if(r.readyState===XMLHttpRequest.DONE){if(r.status===200||r.status===0){switch(e){case"arraybuffer":case"blob":case"json":t(r.response);return}t(r.responseText);return}i(new Error(r.statusText))}},r.send(null)})}class sa{constructor({viewBox:e,userUnit:t,scale:i,rotation:r,offsetX:a=0,offsetY:o=0,dontFlip:c=!1}){this.viewBox=e,this.userUnit=t,this.scale=i,this.rotation=r,this.offsetX=a,this.offsetY=o,i*=t;const d=(e[2]+e[0])/2,f=(e[3]+e[1])/2;let p,g,w,x;switch(r%=360,r<0&&(r+=360),r){case 180:p=-1,g=0,w=0,x=1;break;case 90:p=0,g=1,w=1,x=0;break;case 270:p=0,g=-1,w=-1,x=0;break;case 0:p=1,g=0,w=0,x=-1;break;default:throw new Error("PageViewport: Invalid rotation, must be a multiple of 90 degrees.")}c&&(w=-w,x=-x);let k,v,A,C;p===0?(k=Math.abs(f-e[1])*i+a,v=Math.abs(d-e[0])*i+o,A=(e[3]-e[1])*i,C=(e[2]-e[0])*i):(k=Math.abs(d-e[0])*i+a,v=Math.abs(f-e[1])*i+o,A=(e[2]-e[0])*i,C=(e[3]-e[1])*i),this.transform=[p*i,g*i,w*i,x*i,k-p*i*d-w*i*f,v-g*i*d-x*i*f],this.width=A,this.height=C}get rawDims(){const e=this.viewBox;return Le(this,"rawDims",{pageWidth:e[2]-e[0],pageHeight:e[3]-e[1],pageX:e[0],pageY:e[1]})}clone({scale:e=this.scale,rotation:t=this.rotation,offsetX:i=this.offsetX,offsetY:r=this.offsetY,dontFlip:a=!1}={}){return new sa({viewBox:this.viewBox.slice(),userUnit:this.userUnit,scale:e,rotation:t,offsetX:i,offsetY:r,dontFlip:a})}convertToViewportPoint(e,t){const i=[e,t];return ve.applyTransform(i,this.transform),i}convertToViewportRectangle(e){const t=[e[0],e[1]];ve.applyTransform(t,this.transform);const i=[e[2],e[3]];return ve.applyTransform(i,this.transform),[t[0],t[1],i[0],i[1]]}convertToPdfPoint(e,t){const i=[e,t];return ve.applyInverseTransform(i,this.transform),i}}class zo extends fs{constructor(e,t=0){super(e,"RenderingCancelledException"),this.extraDelay=t}}function ra(h){const e=h.length;let t=0;for(;t<e&&h[t].trim()==="";)t++;return h.substring(t,t+5).toLowerCase()==="data:"}function Uo(h){return typeof h=="string"&&/\.pdf$/i.test(h)}function pp(h){return[h]=h.split(/[#?]/,1),h.substring(h.lastIndexOf("/")+1)}function mp(h,e="document.pdf"){if(typeof h!="string")return e;if(ra(h))return Ie('getPdfFilenameFromUrl: ignore "data:"-URL for performance reasons.'),e;const i=(c=>{try{return new URL(c)}catch{try{return new URL(decodeURIComponent(c))}catch{try{return new URL(c,"https://foo.bar")}catch{try{return new URL(decodeURIComponent(c),"https://foo.bar")}catch{return null}}}}})(h);if(!i)return e;const r=c=>{try{let d=decodeURIComponent(c);return d.includes("/")?(d=d.split("/").at(-1),d.test(/^\.pdf$/i)?d:c):d}catch{return c}},a=/\.pdf$/i,o=i.pathname.split("/").at(-1);if(a.test(o))return r(o);if(i.searchParams.size>0){const c=Array.from(i.searchParams.values()).reverse();for(const f of c)if(a.test(f))return r(f);const d=Array.from(i.searchParams.keys()).reverse();for(const f of d)if(a.test(f))return r(f)}if(i.hash){const d=/[^/?#=]+\.pdf\b(?!.*\.pdf\b)/i.exec(i.hash);if(d)return r(d[0])}return e}class Ef{started=Object.create(null);times=[];time(e){e in this.started&&Ie(`Timer is already running for ${e}`),this.started[e]=Date.now()}timeEnd(e){e in this.started||Ie(`Timer has not been started for ${e}`),this.times.push({name:e,start:this.started[e],end:Date.now()}),delete this.started[e]}toString(){const e=[];let t=0;for(const{name:i}of this.times)t=Math.max(i.length,t);for(const{name:i,start:r,end:a}of this.times)e.push(`${i.padEnd(t)} ${a-r}ms
`);return e.join("")}}function Ur(h,e){const t=e?URL.parse(h,e):URL.parse(h);return t?.protocol==="http:"||t?.protocol==="https:"}function gn(h){h.preventDefault()}function ht(h){h.preventDefault(),h.stopPropagation()}function E0(h){console.log("Deprecated API usage: "+h)}class Oo{static#e;static toDateObject(e){if(e instanceof Date)return e;if(!e||typeof e!="string")return null;this.#e||=new RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?");const t=this.#e.exec(e);if(!t)return null;const i=parseInt(t[1],10);let r=parseInt(t[2],10);r=r>=1&&r<=12?r-1:0;let a=parseInt(t[3],10);a=a>=1&&a<=31?a:1;let o=parseInt(t[4],10);o=o>=0&&o<=23?o:0;let c=parseInt(t[5],10);c=c>=0&&c<=59?c:0;let d=parseInt(t[6],10);d=d>=0&&d<=59?d:0;const f=t[7]||"Z";let p=parseInt(t[8],10);p=p>=0&&p<=23?p:0;let g=parseInt(t[9],10)||0;return g=g>=0&&g<=59?g:0,f==="-"?(o+=p,c+=g):f==="+"&&(o-=p,c-=g),new Date(Date.UTC(i,r,a,o,c,d))}}function gp(h,{scale:e=1,rotation:t=0}){const{width:i,height:r}=h.attributes.style,a=[0,0,parseInt(i),parseInt(r)];return new sa({viewBox:a,userUnit:1,scale:e,rotation:t})}function tr(h){if(h.startsWith("#")){const e=parseInt(h.slice(1),16);return[(e&16711680)>>16,(e&65280)>>8,e&255]}return h.startsWith("rgb(")?h.slice(4,-1).split(",").map(e=>parseInt(e)):h.startsWith("rgba(")?h.slice(5,-1).split(",").map(e=>parseInt(e)).slice(0,3):(Ie(`Not a valid color format: "${h}"`),[0,0,0])}function R0(h){const e=document.createElement("span");e.style.visibility="hidden",e.style.colorScheme="only light",document.body.append(e);for(const t of h.keys()){e.style.color=t;const i=window.getComputedStyle(e).color;h.set(t,tr(i))}e.remove()}function ct(h){const{a:e,b:t,c:i,d:r,e:a,f:o}=h.getTransform();return[e,t,i,r,a,o]}function zn(h){const{a:e,b:t,c:i,d:r,e:a,f:o}=h.getTransform().invertSelf();return[e,t,i,r,a,o]}function qi(h,e,t=!1,i=!0){if(e instanceof sa){const{pageWidth:r,pageHeight:a}=e.rawDims,{style:o}=h,c=Pt.isCSSRoundSupported,d=`var(--total-scale-factor) * ${r}px`,f=`var(--total-scale-factor) * ${a}px`,p=c?`round(down, ${d}, var(--scale-round-x))`:`calc(${d})`,g=c?`round(down, ${f}, var(--scale-round-y))`:`calc(${f})`;!t||e.rotation%180===0?(o.width=p,o.height=g):(o.width=g,o.height=p)}i&&h.setAttribute("data-main-rotation",e.rotation)}class Ln{constructor(){const{pixelRatio:e}=Ln;this.sx=e,this.sy=e}get scaled(){return this.sx!==1||this.sy!==1}get symmetric(){return this.sx===this.sy}limitCanvas(e,t,i,r,a=-1){let o=1/0,c=1/0,d=1/0;i=Ln.capPixels(i,a),i>0&&(o=Math.sqrt(i/(e*t))),r!==-1&&(c=r/e,d=r/t);const f=Math.min(o,c,d);return this.sx>f||this.sy>f?(this.sx=f,this.sy=f,!0):!1}static get pixelRatio(){return globalThis.devicePixelRatio||1}static capPixels(e,t){if(t>=0){const i=Math.ceil(window.screen.availWidth*window.screen.availHeight*this.pixelRatio**2*(1+t/100));return e>0?Math.min(e,i):i}return e}}const qo=["image/apng","image/avif","image/bmp","image/gif","image/jpeg","image/png","image/svg+xml","image/webp","image/x-icon"];class _0{static get isDarkMode(){return Le(this,"isDarkMode",!!window?.matchMedia?.("(prefers-color-scheme: dark)").matches)}}class yp{static get commentForegroundColor(){const e=document.createElement("span");e.classList.add("comment","sidebar");const{style:t}=e;t.width=t.height="0",t.display="none",t.color="var(--comment-fg-color)",document.body.append(e);const{color:i}=window.getComputedStyle(e);return e.remove(),Le(this,"commentForegroundColor",tr(i))}}function wp(h,e,t,i){i=Math.min(Math.max(i??1,0),1);const r=255*(1-i);return h=Math.round(h*i+r),e=Math.round(e*i+r),t=Math.round(t*i+r),[h,e,t]}function Rf(h,e){const t=h[0]/255,i=h[1]/255,r=h[2]/255,a=Math.max(t,i,r),o=Math.min(t,i,r),c=(a+o)/2;if(a===o)e[0]=e[1]=0;else{const d=a-o;switch(e[1]=c<.5?d/(a+o):d/(2-a-o),a){case t:e[0]=((i-r)/d+(i<r?6:0))*60;break;case i:e[0]=((r-t)/d+2)*60;break;case r:e[0]=((t-i)/d+4)*60;break}}e[2]=c}function td(h,e){const t=h[0],i=h[1],r=h[2],a=(1-Math.abs(2*r-1))*i,o=a*(1-Math.abs(t/60%2-1)),c=r-a/2;switch(Math.floor(t/60)){case 0:e[0]=a+c,e[1]=o+c,e[2]=c;break;case 1:e[0]=o+c,e[1]=a+c,e[2]=c;break;case 2:e[0]=c,e[1]=a+c,e[2]=o+c;break;case 3:e[0]=c,e[1]=o+c,e[2]=a+c;break;case 4:e[0]=o+c,e[1]=c,e[2]=a+c;break;case 5:case 6:e[0]=a+c,e[1]=c,e[2]=o+c;break}}function _f(h){return h<=.03928?h/12.92:((h+.055)/1.055)**2.4}function Nf(h,e,t){td(h,t),t.map(_f);const i=.2126*t[0]+.7152*t[1]+.0722*t[2];td(e,t),t.map(_f);const r=.2126*t[0]+.7152*t[1]+.0722*t[2];return i>r?(i+.05)/(r+.05):(r+.05)/(i+.05)}const Pf=new Map;function bp(h,e){const t=h[0]+h[1]*256+h[2]*65536+e[0]*16777216+e[1]*4294967296+e[2]*1099511627776;let i=Pf.get(t);if(i)return i;const r=new Float32Array(9),a=r.subarray(0,3),o=r.subarray(3,6);Rf(h,o);const c=r.subarray(6,9);Rf(e,c);const d=c[2]<.5,f=d?12:4.5;if(o[2]=d?Math.sqrt(o[2]):1-Math.sqrt(1-o[2]),Nf(o,c,a)<f){let p,g;d?(p=o[2],g=1):(p=0,g=o[2]);const w=.005;for(;g-p>w;){const x=o[2]=(p+g)/2;d===Nf(o,c,a)<f?p=x:g=x}o[2]=d?g:p}return td(o,a),i=ve.makeHexColor(Math.round(a[0]*255),Math.round(a[1]*255),Math.round(a[2]*255)),Pf.set(t,i),i}function vd({html:h,dir:e,className:t},i){const r=document.createDocumentFragment();if(typeof h=="string"){const a=document.createElement("p");a.dir=e||"auto";const o=h.split(/(?:\r\n?|\n)/);for(let c=0,d=o.length;c<d;++c){const f=o[c];a.append(document.createTextNode(f)),c<d-1&&a.append(document.createElement("br"))}r.append(a)}else bd.render({xfaHtml:h,div:r,intent:"richText"});r.firstChild.classList.add("richText",t),i.append(r)}class Yr{#e=null;#t=null;#i;#n=null;#a=null;#s=null;#r=null;#o=null;static#c=null;constructor(e){this.#i=e,Yr.#c||=Object.freeze({freetext:"pdfjs-editor-remove-freetext-button",highlight:"pdfjs-editor-remove-highlight-button",ink:"pdfjs-editor-remove-ink-button",stamp:"pdfjs-editor-remove-stamp-button",signature:"pdfjs-editor-remove-signature-button"})}render(){const e=this.#e=document.createElement("div");e.classList.add("editToolbar","hidden"),e.setAttribute("role","toolbar");const t=this.#i._uiManager._signal;t instanceof AbortSignal&&!t.aborted&&(e.addEventListener("contextmenu",gn,{signal:t}),e.addEventListener("pointerdown",Yr.#l,{signal:t}));const i=this.#n=document.createElement("div");i.className="buttons",e.append(i);const r=this.#i.toolbarPosition;if(r){const{style:a}=e,o=this.#i._uiManager.direction==="ltr"?1-r[0]:r[0];a.insetInlineEnd=`${100*o}%`,a.top=`calc(${100*r[1]}% + var(--editor-toolbar-vert-offset))`}return e}get div(){return this.#e}static#l(e){e.stopPropagation()}#u(e){this.#i._focusEventsAllowed=!1,ht(e)}#h(e){this.#i._focusEventsAllowed=!0,ht(e)}#f(e){const t=this.#i._uiManager._signal;return!(t instanceof AbortSignal)||t.aborted?!1:(e.addEventListener("focusin",this.#u.bind(this),{capture:!0,signal:t}),e.addEventListener("focusout",this.#h.bind(this),{capture:!0,signal:t}),e.addEventListener("contextmenu",gn,{signal:t}),!0)}hide(){this.#e.classList.add("hidden"),this.#t?.hideDropdown()}show(){this.#e.classList.remove("hidden"),this.#a?.shown(),this.#s?.shown()}addDeleteButton(){const{editorType:e,_uiManager:t}=this.#i,i=document.createElement("button");i.classList.add("basic","deleteButton"),i.tabIndex=0,i.setAttribute("data-l10n-id",Yr.#c[e]),this.#f(i)&&i.addEventListener("click",r=>{t.delete()},{signal:t._signal}),this.#n.append(i)}get#g(){const e=document.createElement("div");return e.className="divider",e}async addAltText(e){const t=await e.render();this.#f(t),this.#n.append(t,this.#g),this.#a=e}addComment(e,t=null){if(this.#s)return;const i=e.renderForToolbar();if(!i)return;this.#f(i);const r=this.#r=this.#g;t?(this.#n.insertBefore(i,t),this.#n.insertBefore(r,t)):this.#n.append(i,r),this.#s=e,e.toolbar=this}addColorPicker(e){if(this.#t)return;this.#t=e;const t=e.renderButton();this.#f(t),this.#n.append(t,this.#g)}async addEditSignatureButton(e){const t=this.#o=await e.renderEditButton(this.#i);this.#f(t),this.#n.append(t,this.#g)}removeButton(e){switch(e){case"comment":this.#s?.removeToolbarCommentButton(),this.#s=null,this.#r?.remove(),this.#r=null;break}}async addButton(e,t){switch(e){case"colorPicker":this.addColorPicker(t);break;case"altText":await this.addAltText(t);break;case"editSignature":await this.addEditSignatureButton(t);break;case"delete":this.addDeleteButton();break;case"comment":this.addComment(t);break}}async addButtonBefore(e,t,i){const r=this.#n.querySelector(i);r&&e==="comment"&&this.addComment(t,r)}updateEditSignatureButton(e){this.#o&&(this.#o.title=e)}remove(){this.#e.remove(),this.#t?.destroy(),this.#t=null}}class N0{#e=null;#t=null;#i;constructor(e){this.#i=e}#n(){const e=this.#t=document.createElement("div");e.className="editToolbar",e.setAttribute("role","toolbar");const t=this.#i._signal;t instanceof AbortSignal&&!t.aborted&&e.addEventListener("contextmenu",gn,{signal:t});const i=this.#e=document.createElement("div");return i.className="buttons",e.append(i),this.#i.hasCommentManager()&&this.#s("commentButton","pdfjs-comment-floating-button","pdfjs-comment-floating-button-label",()=>{this.#i.commentSelection("floating_button")}),this.#s("highlightButton","pdfjs-highlight-floating-button1","pdfjs-highlight-floating-button-label",()=>{this.#i.highlightSelection("floating_button")}),e}#a(e,t){let i=0,r=0;for(const a of e){const o=a.y+a.height;if(o<i)continue;const c=a.x+(t?a.width:0);if(o>i){r=c,i=o;continue}t?c>r&&(r=c):c<r&&(r=c)}return[t?1-r:r,i]}show(e,t,i){const[r,a]=this.#a(t,i),{style:o}=this.#t||=this.#n();e.append(this.#t),o.insetInlineEnd=`${100*r}%`,o.top=`calc(${100*a}% + var(--editor-toolbar-vert-offset))`}hide(){this.#t.remove()}#s(e,t,i,r){const a=document.createElement("button");a.classList.add("basic",e),a.tabIndex=0,a.setAttribute("data-l10n-id",t);const o=document.createElement("span");a.append(o),o.className="visuallyHidden",o.setAttribute("data-l10n-id",i);const c=this.#i._signal;c instanceof AbortSignal&&!c.aborted&&(a.addEventListener("contextmenu",gn,{signal:c}),a.addEventListener("click",r,{signal:c})),this.#e.append(a)}}function vp(h,e,t){for(const i of t)e.addEventListener(i,h[i].bind(h))}class P0{#e=0;get id(){return`${Xr}${this.#e++}`}}class xd{#e=yd();#t=0;#i=null;static get _isSVGFittingCanvas(){const e='data:image/svg+xml;charset=UTF-8,<svg viewBox="0 0 1 1" width="1" height="1" xmlns="http://www.w3.org/2000/svg"><rect width="1" height="1" style="fill:red;"/></svg>',i=new OffscreenCanvas(1,3).getContext("2d",{willReadFrequently:!0}),r=new Image;r.src=e;const a=r.decode().then(()=>(i.drawImage(r,0,0,1,1,0,0,1,3),new Uint32Array(i.getImageData(0,0,1,1).data.buffer)[0]===0));return Le(this,"_isSVGFittingCanvas",a)}async#n(e,t){this.#i||=new Map;let i=this.#i.get(e);if(i===null)return null;if(i?.bitmap)return i.refCounter+=1,i;try{i||={bitmap:null,id:`image_${this.#e}_${this.#t++}`,refCounter:0,isSvg:!1};let r;if(typeof t=="string"?(i.url=t,r=await er(t,"blob")):t instanceof File?r=i.file=t:t instanceof Blob&&(r=t),r.type==="image/svg+xml"){const a=xd._isSVGFittingCanvas,o=new FileReader,c=new Image,d=new Promise((f,p)=>{c.onload=()=>{i.bitmap=c,i.isSvg=!0,f()},o.onload=async()=>{const g=i.svgUrl=o.result;c.src=await a?`${g}#svgView(preserveAspectRatio(none))`:g},c.onerror=o.onerror=p});o.readAsDataURL(r),await d}else i.bitmap=await createImageBitmap(r);i.refCounter=1}catch(r){Ie(r),i=null}return this.#i.set(e,i),i&&this.#i.set(i.id,i),i}async getFromFile(e){const{lastModified:t,name:i,size:r,type:a}=e;return this.#n(`${t}_${i}_${r}_${a}`,e)}async getFromUrl(e){return this.#n(e,e)}async getFromBlob(e,t){const i=await t;return this.#n(e,i)}async getFromId(e){this.#i||=new Map;const t=this.#i.get(e);if(!t)return null;if(t.bitmap)return t.refCounter+=1,t;if(t.file)return this.getFromFile(t.file);if(t.blobPromise){const{blobPromise:i}=t;return delete t.blobPromise,this.getFromBlob(t.id,i)}return this.getFromUrl(t.url)}getFromCanvas(e,t){this.#i||=new Map;let i=this.#i.get(e);if(i?.bitmap)return i.refCounter+=1,i;const r=new OffscreenCanvas(t.width,t.height);return r.getContext("2d").drawImage(t,0,0),i={bitmap:r.transferToImageBitmap(),id:`image_${this.#e}_${this.#t++}`,refCounter:1,isSvg:!1},this.#i.set(e,i),this.#i.set(i.id,i),i}getSvgUrl(e){const t=this.#i.get(e);return t?.isSvg?t.svgUrl:null}deleteId(e){this.#i||=new Map;const t=this.#i.get(e);if(!t||(t.refCounter-=1,t.refCounter!==0))return;const{bitmap:i}=t;if(!t.url&&!t.file){const r=new OffscreenCanvas(i.width,i.height);r.getContext("bitmaprenderer").transferFromImageBitmap(i),t.blobPromise=r.convertToBlob()}i.close?.(),t.bitmap=null}isValidId(e){return e.startsWith(`image_${this.#e}_`)}}class M0{#e=[];#t=!1;#i;#n=-1;constructor(e=128){this.#i=e}add({cmd:e,undo:t,post:i,mustExec:r,type:a=NaN,overwriteIfSameType:o=!1,keepUndo:c=!1}){if(r&&e(),this.#t)return;const d={cmd:e,undo:t,post:i,type:a};if(this.#n===-1){this.#e.length>0&&(this.#e.length=0),this.#n=0,this.#e.push(d);return}if(o&&this.#e[this.#n].type===a){c&&(d.undo=this.#e[this.#n].undo),this.#e[this.#n]=d;return}const f=this.#n+1;f===this.#i?this.#e.splice(0,1):(this.#n=f,f<this.#e.length&&this.#e.splice(f)),this.#e.push(d)}undo(){if(this.#n===-1)return;this.#t=!0;const{undo:e,post:t}=this.#e[this.#n];e(),t?.(),this.#t=!1,this.#n-=1}redo(){if(this.#n<this.#e.length-1){this.#n+=1,this.#t=!0;const{cmd:e,post:t}=this.#e[this.#n];e(),t?.(),this.#t=!1}}hasSomethingToUndo(){return this.#n!==-1}hasSomethingToRedo(){return this.#n<this.#e.length-1}cleanType(e){if(this.#n!==-1){for(let t=this.#n;t>=0;t--)if(this.#e[t].type!==e){this.#e.splice(t+1,this.#n-t),this.#n=t;return}this.#e.length=0,this.#n=-1}}destroy(){this.#e=null}}class aa{constructor(e){this.buffer=[],this.callbacks=new Map,this.allKeys=new Set;const{isMac:t}=Pt.platform;for(const[i,r,a={}]of e)for(const o of i){const c=o.startsWith("mac+");t&&c?(this.callbacks.set(o.slice(4),{callback:r,options:a}),this.allKeys.add(o.split("+").at(-1))):!t&&!c&&(this.callbacks.set(o,{callback:r,options:a}),this.allKeys.add(o.split("+").at(-1)))}}#e(e){e.altKey&&this.buffer.push("alt"),e.ctrlKey&&this.buffer.push("ctrl"),e.metaKey&&this.buffer.push("meta"),e.shiftKey&&this.buffer.push("shift"),this.buffer.push(e.key);const t=this.buffer.join("+");return this.buffer.length=0,t}exec(e,t){if(!this.allKeys.has(t.key))return;const i=this.callbacks.get(this.#e(t));if(!i)return;const{callback:r,options:{bubbles:a=!1,args:o=[],checker:c=null}}=i;c&&!c(e,t)||(r.bind(e,...o,t)(),a||ht(t))}}class kd{static _colorsMapping=new Map([["CanvasText",[0,0,0]],["Canvas",[255,255,255]]]);get _colors(){const e=new Map([["CanvasText",null],["Canvas",null]]);return R0(e),Le(this,"_colors",e)}convert(e){const t=tr(e);if(!window.matchMedia("(forced-colors: active)").matches)return t;for(const[i,r]of this._colors)if(r.every((a,o)=>a===t[o]))return kd._colorsMapping.get(i);return t}getHexCode(e){const t=this._colors.get(e);return t?ve.makeHexColor(...t):e}}class di{#e=new AbortController;#t=null;#i=null;#n=new Map;#a=new Map;#s=null;#r=null;#o=null;#c=new M0;#l=null;#u=null;#h=null;#f=0;#g=new Set;#p=null;#d=null;#m=new Set;_editorUndoBar=null;#y=!1;#b=!1;#w=!1;#C=null;#S=null;#v=null;#E=null;#k=!1;#A=null;#N=new P0;#R=!1;#_=!1;#F=!1;#M=null;#D=null;#O=null;#L=null;#z=null;#T=Me.NONE;#x=new Set;#I=null;#q=null;#W=null;#V=null;#$=null;#K={isEditing:!1,isEmpty:!0,hasSomethingToUndo:!1,hasSomethingToRedo:!1,hasSelectedEditor:!1,hasSelectedText:!1};#H=[0,0];#j=null;#U=null;#J=null;#Z=null;#B=null;static TRANSLATE_SMALL=1;static TRANSLATE_BIG=10;static get _keyboardManager(){const e=di.prototype,t=o=>o.#U.contains(document.activeElement)&&document.activeElement.tagName!=="BUTTON"&&o.hasSomethingToControl(),i=(o,{target:c})=>{if(c instanceof HTMLInputElement){const{type:d}=c;return d!=="text"&&d!=="number"}return!0},r=this.TRANSLATE_SMALL,a=this.TRANSLATE_BIG;return Le(this,"_keyboardManager",new aa([[["ctrl+a","mac+meta+a"],e.selectAll,{checker:i}],[["ctrl+z","mac+meta+z"],e.undo,{checker:i}],[["ctrl+y","ctrl+shift+z","mac+meta+shift+z","ctrl+shift+Z","mac+meta+shift+Z"],e.redo,{checker:i}],[["Backspace","alt+Backspace","ctrl+Backspace","shift+Backspace","mac+Backspace","mac+alt+Backspace","mac+ctrl+Backspace","Delete","ctrl+Delete","shift+Delete","mac+Delete"],e.delete,{checker:i}],[["Enter","mac+Enter"],e.addNewEditorFromKeyboard,{checker:(o,{target:c})=>!(c instanceof HTMLButtonElement)&&o.#U.contains(c)&&!o.isEnterHandled}],[[" ","mac+ "],e.addNewEditorFromKeyboard,{checker:(o,{target:c})=>!(c instanceof HTMLButtonElement)&&o.#U.contains(document.activeElement)}],[["Escape","mac+Escape"],e.unselectAll],[["ArrowLeft","mac+ArrowLeft"],e.translateSelectedEditors,{args:[-r,0],checker:t}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],e.translateSelectedEditors,{args:[-a,0],checker:t}],[["ArrowRight","mac+ArrowRight"],e.translateSelectedEditors,{args:[r,0],checker:t}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],e.translateSelectedEditors,{args:[a,0],checker:t}],[["ArrowUp","mac+ArrowUp"],e.translateSelectedEditors,{args:[0,-r],checker:t}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],e.translateSelectedEditors,{args:[0,-a],checker:t}],[["ArrowDown","mac+ArrowDown"],e.translateSelectedEditors,{args:[0,r],checker:t}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],e.translateSelectedEditors,{args:[0,a],checker:t}]]))}constructor(e,t,i,r,a,o,c,d,f,p,g,w,x,k,v,A){const C=this._signal=this.#e.signal;this.#U=e,this.#J=t,this.#Z=i,this.#s=r,this.#l=a,this.#q=o,this.#$=d,this._eventBus=c,c._on("editingaction",this.onEditingAction.bind(this),{signal:C}),c._on("pagechanging",this.onPageChanging.bind(this),{signal:C}),c._on("scalechanging",this.onScaleChanging.bind(this),{signal:C}),c._on("rotationchanging",this.onRotationChanging.bind(this),{signal:C}),c._on("setpreference",this.onSetPreference.bind(this),{signal:C}),c._on("switchannotationeditorparams",T=>this.updateParams(T.type,T.value),{signal:C}),window.addEventListener("pointerdown",()=>{this.#_=!0},{capture:!0,signal:C}),window.addEventListener("pointerup",()=>{this.#_=!1},{capture:!0,signal:C}),this.#le(),this.#ue(),this.#te(),this.#r=d.annotationStorage,this.#C=d.filterFactory,this.#W=f,this.#E=p||null,this.#y=g,this.#b=w,this.#w=x,this.#z=k||null,this.viewParameters={realScale:ds.PDF_TO_CSS_UNITS,rotation:0},this.isShiftKeyDown=!1,this._editorUndoBar=v||null,this._supportsPinchToZoom=A!==!1,a?.setSidebarUiManager(this)}destroy(){this.#B?.resolve(),this.#B=null,this.#e?.abort(),this.#e=null,this._signal=null;for(const e of this.#a.values())e.destroy();this.#a.clear(),this.#n.clear(),this.#m.clear(),this.#L?.clear(),this.#t=null,this.#x.clear(),this.#c.destroy(),this.#s?.destroy(),this.#l?.destroy(),this.#q?.destroy(),this.#A?.hide(),this.#A=null,this.#O?.destroy(),this.#O=null,this.#i=null,this.#S&&(clearTimeout(this.#S),this.#S=null),this.#j&&(clearTimeout(this.#j),this.#j=null),this._editorUndoBar?.destroy(),this.#$=null}combinedSignal(e){return AbortSignal.any([this._signal,e.signal])}get mlManager(){return this.#z}get useNewAltTextFlow(){return this.#b}get useNewAltTextWhenAddingImage(){return this.#w}get hcmFilter(){return Le(this,"hcmFilter",this.#W?this.#C.addHCMFilter(this.#W.foreground,this.#W.background):"none")}get direction(){return Le(this,"direction",getComputedStyle(this.#U).direction)}get _highlightColors(){return Le(this,"_highlightColors",this.#E?new Map(this.#E.split(",").map(e=>(e=e.split("=").map(t=>t.trim()),e[1]=e[1].toUpperCase(),e))):null)}get highlightColors(){const{_highlightColors:e}=this;if(!e)return Le(this,"highlightColors",null);const t=new Map,i=!!this.#W;for(const[r,a]of e){const o=r.endsWith("_HCM");if(i&&o){t.set(r.replace("_HCM",""),a);continue}!i&&!o&&t.set(r,a)}return Le(this,"highlightColors",t)}get highlightColorNames(){return Le(this,"highlightColorNames",this.highlightColors?new Map(Array.from(this.highlightColors,e=>e.reverse())):null)}getNonHCMColor(e){if(!this._highlightColors)return e;const t=this.highlightColorNames.get(e);return this._highlightColors.get(t)||e}getNonHCMColorName(e){return this.highlightColorNames.get(e)||e}setCurrentDrawingSession(e){e?(this.unselectAll(),this.disableUserSelect(!0)):this.disableUserSelect(!1),this.#h=e}setMainHighlightColorPicker(e){this.#O=e}editAltText(e,t=!1){this.#s?.editAltText(this,e,t)}hasCommentManager(){return!!this.#l}editComment(e,t,i,r){this.#l?.showDialog(this,e,t,i,r)}selectComment(e,t){this.#a.get(e)?.getEditorByUID(t)?.toggleComment(!0,!0)}updateComment(e){this.#l?.updateComment(e.getData())}updatePopupColor(e){this.#l?.updatePopupColor(e)}removeComment(e){this.#l?.removeComments([e.uid])}toggleComment(e,t,i=void 0){this.#l?.toggleCommentPopup(e,t,i)}makeCommentColor(e,t){return e&&this.#l?.makeCommentColor(e,t)||null}getCommentDialogElement(){return this.#l?.dialogElement||null}async waitForEditorsRendered(e){if(this.#a.has(e-1))return;const{resolve:t,promise:i}=Promise.withResolvers(),r=a=>{a.pageNumber===e&&(this._eventBus._off("editorsrendered",r),t())};this._eventBus.on("editorsrendered",r),await i}getSignature(e){this.#q?.getSignature({uiManager:this,editor:e})}get signatureManager(){return this.#q}switchToMode(e,t){this._eventBus.on("annotationeditormodechanged",t,{once:!0,signal:this._signal}),this._eventBus.dispatch("showannotationeditorui",{source:this,mode:e})}setPreference(e,t){this._eventBus.dispatch("setpreference",{source:this,name:e,value:t})}onSetPreference({name:e,value:t}){switch(e){case"enableNewAltTextWhenAddingImage":this.#w=t;break}}onPageChanging({pageNumber:e}){this.#f=e-1}focusMainContainer(){this.#U.focus()}findParent(e,t){for(const i of this.#a.values()){const{x:r,y:a,width:o,height:c}=i.div.getBoundingClientRect();if(e>=r&&e<=r+o&&t>=a&&t<=a+c)return i}return null}disableUserSelect(e=!1){this.#J.classList.toggle("noUserSelect",e)}addShouldRescale(e){this.#m.add(e)}removeShouldRescale(e){this.#m.delete(e)}onScaleChanging({scale:e}){this.commitOrRemove(),this.viewParameters.realScale=e*ds.PDF_TO_CSS_UNITS;for(const t of this.#m)t.onScaleChanging();this.#h?.onScaleChanging()}onRotationChanging({pagesRotation:e}){this.commitOrRemove(),this.viewParameters.rotation=e}#Q({anchorNode:e}){return e.nodeType===Node.TEXT_NODE?e.parentElement:e}#ee(e){const{currentLayer:t}=this;if(t.hasTextLayer(e))return t;for(const i of this.#a.values())if(i.hasTextLayer(e))return i;return null}highlightSelection(e="",t=!1){const i=document.getSelection();if(!i||i.isCollapsed)return;const{anchorNode:r,anchorOffset:a,focusNode:o,focusOffset:c}=i,d=i.toString(),p=this.#Q(i).closest(".textLayer"),g=this.getSelectionBoxes(p);if(!g)return;i.empty();const w=this.#ee(p),x=this.#T===Me.NONE,k=()=>{const v=w?.createAndAddNewEditor({x:0,y:0},!1,{methodOfCreation:e,boxes:g,anchorNode:r,anchorOffset:a,focusNode:o,focusOffset:c,text:d});x&&this.showAllEditors("highlight",!0,!0),t&&v?.editComment()};if(x){this.switchToMode(Me.HIGHLIGHT,k);return}k()}commentSelection(e=""){this.highlightSelection(e,!0)}#ae(){const e=document.getSelection();if(!e||e.isCollapsed)return;const i=this.#Q(e).closest(".textLayer"),r=this.getSelectionBoxes(i);r&&(this.#A||=new N0(this),this.#A.show(i,r,this.direction==="ltr"))}getAndRemoveDataFromAnnotationStorage(e){if(!this.#r)return null;const t=`${Xr}${e}`,i=this.#r.getRawValue(t);return i&&this.#r.remove(t),i}addToAnnotationStorage(e){!e.isEmpty()&&this.#r&&!this.#r.has(e.id)&&this.#r.setValue(e.id,e)}a11yAlert(e,t=null){const i=this.#Z;i&&(i.setAttribute("data-l10n-id",e),t?i.setAttribute("data-l10n-args",JSON.stringify(t)):i.removeAttribute("data-l10n-args"))}#oe(){const e=document.getSelection();if(!e||e.isCollapsed){this.#I&&(this.#A?.hide(),this.#I=null,this.#P({hasSelectedText:!1}));return}const{anchorNode:t}=e;if(t===this.#I)return;const r=this.#Q(e).closest(".textLayer");if(!r){this.#I&&(this.#A?.hide(),this.#I=null,this.#P({hasSelectedText:!1}));return}if(this.#A?.hide(),this.#I=t,this.#P({hasSelectedText:!0}),!(this.#T!==Me.HIGHLIGHT&&this.#T!==Me.NONE)&&(this.#T===Me.HIGHLIGHT&&this.showAllEditors("highlight",!0,!0),this.#k=this.isShiftKeyDown,!this.isShiftKeyDown)){const a=this.#T===Me.HIGHLIGHT?this.#ee(r):null;if(a?.toggleDrawing(),this.#_){const o=new AbortController,c=this.combinedSignal(o),d=f=>{f.type==="pointerup"&&f.button!==0||(o.abort(),a?.toggleDrawing(!0),f.type==="pointerup"&&this.#Y("main_toolbar"))};window.addEventListener("pointerup",d,{signal:c}),window.addEventListener("blur",d,{signal:c})}else a?.toggleDrawing(!0),this.#Y("main_toolbar")}}#Y(e=""){this.#T===Me.HIGHLIGHT?this.highlightSelection(e):this.#y&&this.#ae()}#le(){document.addEventListener("selectionchange",this.#oe.bind(this),{signal:this._signal})}#ce(){if(this.#v)return;this.#v=new AbortController;const e=this.combinedSignal(this.#v);window.addEventListener("focus",this.focus.bind(this),{signal:e}),window.addEventListener("blur",this.blur.bind(this),{signal:e})}#de(){this.#v?.abort(),this.#v=null}blur(){if(this.isShiftKeyDown=!1,this.#k&&(this.#k=!1,this.#Y("main_toolbar")),!this.hasSelection)return;const{activeElement:e}=document;for(const t of this.#x)if(t.div.contains(e)){this.#D=[t,e],t._focusEventsAllowed=!1;break}}focus(){if(!this.#D)return;const[e,t]=this.#D;this.#D=null,t.addEventListener("focusin",()=>{e._focusEventsAllowed=!0},{once:!0,signal:this._signal}),t.focus()}#te(){if(this.#M)return;this.#M=new AbortController;const e=this.combinedSignal(this.#M);window.addEventListener("keydown",this.keydown.bind(this),{signal:e}),window.addEventListener("keyup",this.keyup.bind(this),{signal:e})}#he(){this.#M?.abort(),this.#M=null}#ne(){if(this.#u)return;this.#u=new AbortController;const e=this.combinedSignal(this.#u);document.addEventListener("copy",this.copy.bind(this),{signal:e}),document.addEventListener("cut",this.cut.bind(this),{signal:e}),document.addEventListener("paste",this.paste.bind(this),{signal:e})}#ie(){this.#u?.abort(),this.#u=null}#ue(){const e=this._signal;document.addEventListener("dragover",this.dragOver.bind(this),{signal:e}),document.addEventListener("drop",this.drop.bind(this),{signal:e})}addEditListeners(){this.#te(),this.#ne()}removeEditListeners(){this.#he(),this.#ie()}dragOver(e){for(const{type:t}of e.dataTransfer.items)for(const i of this.#d)if(i.isHandlingMimeForPasting(t)){e.dataTransfer.dropEffect="copy",e.preventDefault();return}}drop(e){for(const t of e.dataTransfer.items)for(const i of this.#d)if(i.isHandlingMimeForPasting(t.type)){i.paste(t,this.currentLayer),e.preventDefault();return}}copy(e){if(e.preventDefault(),this.#t?.commitOrRemove(),!this.hasSelection)return;const t=[];for(const i of this.#x){const r=i.serialize(!0);r&&t.push(r)}t.length!==0&&e.clipboardData.setData("application/pdfjs",JSON.stringify(t))}cut(e){this.copy(e),this.delete()}async paste(e){e.preventDefault();const{clipboardData:t}=e;for(const a of t.items)for(const o of this.#d)if(o.isHandlingMimeForPasting(a.type)){o.paste(a,this.currentLayer);return}let i=t.getData("application/pdfjs");if(!i)return;try{i=JSON.parse(i)}catch(a){Ie(`paste: "${a.message}".`);return}if(!Array.isArray(i))return;this.unselectAll();const r=this.currentLayer;try{const a=[];for(const d of i){const f=await r.deserialize(d);if(!f)return;a.push(f)}const o=()=>{for(const d of a)this.#se(d);this.#re(a)},c=()=>{for(const d of a)d.remove()};this.addCommands({cmd:o,undo:c,mustExec:!0})}catch(a){Ie(`paste: "${a.message}".`)}}keydown(e){!this.isShiftKeyDown&&e.key==="Shift"&&(this.isShiftKeyDown=!0),this.#T!==Me.NONE&&!this.isEditorHandlingKeyboard&&di._keyboardManager.exec(this,e)}keyup(e){this.isShiftKeyDown&&e.key==="Shift"&&(this.isShiftKeyDown=!1,this.#k&&(this.#k=!1,this.#Y("main_toolbar")))}onEditingAction({name:e}){switch(e){case"undo":case"redo":case"delete":case"selectAll":this[e]();break;case"highlightSelection":this.highlightSelection("context_menu");break;case"commentSelection":this.commentSelection("context_menu");break}}#P(e){Object.entries(e).some(([i,r])=>this.#K[i]!==r)&&(this._eventBus.dispatch("annotationeditorstateschanged",{source:this,details:Object.assign(this.#K,e)}),this.#T===Me.HIGHLIGHT&&e.hasSelectedEditor===!1&&this.#G([[Oe.HIGHLIGHT_FREE,!0]]))}#G(e){this._eventBus.dispatch("annotationeditorparamschanged",{source:this,details:e})}setEditingState(e){e?(this.#ce(),this.#ne(),this.#P({isEditing:this.#T!==Me.NONE,isEmpty:this.#X(),hasSomethingToUndo:this.#c.hasSomethingToUndo(),hasSomethingToRedo:this.#c.hasSomethingToRedo(),hasSelectedEditor:!1})):(this.#de(),this.#ie(),this.#P({isEditing:!1}),this.disableUserSelect(!1))}registerEditorTypes(e){if(!this.#d){this.#d=e;for(const t of this.#d)this.#G(t.defaultPropertiesToUpdate)}}getId(){return this.#N.id}get currentLayer(){return this.#a.get(this.#f)}getLayer(e){return this.#a.get(e)}get currentPageIndex(){return this.#f}addLayer(e){this.#a.set(e.pageIndex,e),this.#R?e.enable():e.disable()}removeLayer(e){this.#a.delete(e.pageIndex)}async updateMode(e,t=null,i=!1,r=!1,a=!1){if(this.#T!==e&&!(this.#B&&(await this.#B.promise,!this.#B))){if(this.#B=Promise.withResolvers(),this.#h?.commitOrRemove(),this.#T===Me.POPUP&&this.#l?.hideSidebar(),this.#l?.destroyPopup(),this.#T=e,e===Me.NONE){this.setEditingState(!1),this.#pe();for(const o of this.#n.values())o.hideStandaloneCommentButton();this._editorUndoBar?.hide(),this.toggleComment(null),this.#B.resolve();return}for(const o of this.#n.values())o.addStandaloneCommentButton();e===Me.SIGNATURE&&await this.#q?.loadSignatures(),this.setEditingState(!0),await this.#fe(),this.unselectAll();for(const o of this.#a.values())o.updateMode(e);if(e===Me.POPUP){this.#i||=await this.#$.getAnnotationsByType(new Set(this.#d.map(d=>d._editorType)));const o=new Set,c=[];for(const d of this.#n.values()){const{annotationElementId:f,hasComment:p,deleted:g}=d;f&&o.add(f),p&&!g&&c.push(d.getData())}for(const d of this.#i){const{id:f,popupRef:p,contentsObj:g}=d;p&&g?.str&&!o.has(f)&&!this.#g.has(f)&&c.push(d)}this.#l?.showSidebar(c)}if(!t){i&&this.addNewEditorFromKeyboard(),this.#B.resolve();return}for(const o of this.#n.values())o.uid===t?(this.setSelected(o),a?o.editComment():r?o.enterInEditMode():o.focus()):o.unselect();this.#B.resolve()}}addNewEditorFromKeyboard(){this.currentLayer.canCreateNewEmptyEditor()&&this.currentLayer.addNewEditor()}updateToolbar(e){e.mode!==this.#T&&this._eventBus.dispatch("switchannotationeditormode",{source:this,...e})}updateParams(e,t){if(this.#d){switch(e){case Oe.CREATE:this.currentLayer.addNewEditor(t);return;case Oe.HIGHLIGHT_SHOW_ALL:this._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:{type:"highlight",action:"toggle_visibility"}}}),(this.#V||=new Map).set(e,t),this.showAllEditors("highlight",t);break}if(this.hasSelection)for(const i of this.#x)i.updateParams(e,t);else for(const i of this.#d)i.updateDefaultParams(e,t)}}showAllEditors(e,t,i=!1){for(const a of this.#n.values())a.editorType===e&&a.show(t);(this.#V?.get(Oe.HIGHLIGHT_SHOW_ALL)??!0)!==t&&this.#G([[Oe.HIGHLIGHT_SHOW_ALL,t]])}enableWaiting(e=!1){if(this.#F!==e){this.#F=e;for(const t of this.#a.values())e?t.disableClick():t.enableClick(),t.div.classList.toggle("waiting",e)}}async#fe(){if(!this.#R){this.#R=!0;const e=[];for(const t of this.#a.values())e.push(t.enable());await Promise.all(e);for(const t of this.#n.values())t.enable()}}#pe(){if(this.unselectAll(),this.#R){this.#R=!1;for(const e of this.#a.values())e.disable();for(const e of this.#n.values())e.disable()}}*getEditors(e){for(const t of this.#n.values())t.pageIndex===e&&(yield t)}getEditor(e){return this.#n.get(e)}addEditor(e){this.#n.set(e.id,e)}removeEditor(e){e.div.contains(document.activeElement)&&(this.#S&&clearTimeout(this.#S),this.#S=setTimeout(()=>{this.focusMainContainer(),this.#S=null},0)),this.#n.delete(e.id),e.annotationElementId&&this.#L?.delete(e.annotationElementId),this.unselect(e),(!e.annotationElementId||!this.#g.has(e.annotationElementId))&&this.#r?.remove(e.id)}addDeletedAnnotationElement(e){this.#g.add(e.annotationElementId),this.addChangedExistingAnnotation(e),e.deleted=!0}isDeletedAnnotationElement(e){return this.#g.has(e)}removeDeletedAnnotationElement(e){this.#g.delete(e.annotationElementId),this.removeChangedExistingAnnotation(e),e.deleted=!1}#se(e){const t=this.#a.get(e.pageIndex);t?t.addOrRebuild(e):(this.addEditor(e),this.addToAnnotationStorage(e))}setActiveEditor(e){this.#t!==e&&(this.#t=e,e&&this.#G(e.propertiesToUpdate))}get#me(){let e=null;for(e of this.#x);return e}updateUI(e){this.#me===e&&this.#G(e.propertiesToUpdate)}updateUIForDefaultProperties(e){this.#G(e.defaultPropertiesToUpdate)}toggleSelected(e){if(this.#x.has(e)){this.#x.delete(e),e.unselect(),this.#P({hasSelectedEditor:this.hasSelection});return}this.#x.add(e),e.select(),this.#G(e.propertiesToUpdate),this.#P({hasSelectedEditor:!0})}setSelected(e){this.updateToolbar({mode:e.mode,editId:e.id}),this.#h?.commitOrRemove();for(const t of this.#x)t!==e&&t.unselect();this.#x.clear(),this.#x.add(e),e.select(),this.#G(e.propertiesToUpdate),this.#P({hasSelectedEditor:!0})}isSelected(e){return this.#x.has(e)}get firstSelectedEditor(){return this.#x.values().next().value}unselect(e){e.unselect(),this.#x.delete(e),this.#P({hasSelectedEditor:this.hasSelection})}get hasSelection(){return this.#x.size!==0}get isEnterHandled(){return this.#x.size===1&&this.firstSelectedEditor.isEnterHandled}undo(){this.#c.undo(),this.#P({hasSomethingToUndo:this.#c.hasSomethingToUndo(),hasSomethingToRedo:!0,isEmpty:this.#X()}),this._editorUndoBar?.hide()}redo(){this.#c.redo(),this.#P({hasSomethingToUndo:!0,hasSomethingToRedo:this.#c.hasSomethingToRedo(),isEmpty:this.#X()})}addCommands(e){this.#c.add(e),this.#P({hasSomethingToUndo:!0,hasSomethingToRedo:!1,isEmpty:this.#X()})}cleanUndoStack(e){this.#c.cleanType(e)}#X(){if(this.#n.size===0)return!0;if(this.#n.size===1)for(const e of this.#n.values())return e.isEmpty();return!1}delete(){this.commitOrRemove();const e=this.currentLayer?.endDrawingSession(!0);if(!this.hasSelection&&!e)return;const t=e?[e]:[...this.#x],i=()=>{this._editorUndoBar?.show(r,t.length===1?t[0].editorType:t.length);for(const a of t)a.remove()},r=()=>{for(const a of t)this.#se(a)};this.addCommands({cmd:i,undo:r,mustExec:!0})}commitOrRemove(){this.#t?.commitOrRemove()}hasSomethingToControl(){return this.#t||this.hasSelection}#re(e){for(const t of this.#x)t.unselect();this.#x.clear();for(const t of e)t.isEmpty()||(this.#x.add(t),t.select());this.#P({hasSelectedEditor:this.hasSelection})}selectAll(){for(const e of this.#x)e.commit();this.#re(this.#n.values())}unselectAll(){if(!(this.#t&&(this.#t.commitOrRemove(),this.#T!==Me.NONE))&&!this.#h?.commitOrRemove()&&this.hasSelection){for(const e of this.#x)e.unselect();this.#x.clear(),this.#P({hasSelectedEditor:!1})}}translateSelectedEditors(e,t,i=!1){if(i||this.commitOrRemove(),!this.hasSelection)return;this.#H[0]+=e,this.#H[1]+=t;const[r,a]=this.#H,o=[...this.#x],c=1e3;this.#j&&clearTimeout(this.#j),this.#j=setTimeout(()=>{this.#j=null,this.#H[0]=this.#H[1]=0,this.addCommands({cmd:()=>{for(const d of o)this.#n.has(d.id)&&(d.translateInPage(r,a),d.translationDone())},undo:()=>{for(const d of o)this.#n.has(d.id)&&(d.translateInPage(-r,-a),d.translationDone())},mustExec:!1})},c);for(const d of o)d.translateInPage(e,t),d.translationDone()}setUpDragSession(){if(this.hasSelection){this.disableUserSelect(!0),this.#p=new Map;for(const e of this.#x)this.#p.set(e,{savedX:e.x,savedY:e.y,savedPageIndex:e.pageIndex,newX:0,newY:0,newPageIndex:-1})}}endDragSession(){if(!this.#p)return!1;this.disableUserSelect(!1);const e=this.#p;this.#p=null;let t=!1;for(const[{x:r,y:a,pageIndex:o},c]of e)c.newX=r,c.newY=a,c.newPageIndex=o,t||=r!==c.savedX||a!==c.savedY||o!==c.savedPageIndex;if(!t)return!1;const i=(r,a,o,c)=>{if(this.#n.has(r.id)){const d=this.#a.get(c);d?r._setParentAndPosition(d,a,o):(r.pageIndex=c,r.x=a,r.y=o)}};return this.addCommands({cmd:()=>{for(const[r,{newX:a,newY:o,newPageIndex:c}]of e)i(r,a,o,c)},undo:()=>{for(const[r,{savedX:a,savedY:o,savedPageIndex:c}]of e)i(r,a,o,c)},mustExec:!0}),!0}dragSelectedEditors(e,t){if(this.#p)for(const i of this.#p.keys())i.drag(e,t)}rebuild(e){if(e.parent===null){const t=this.getLayer(e.pageIndex);t?(t.changeParent(e),t.addOrRebuild(e)):(this.addEditor(e),this.addToAnnotationStorage(e),e.rebuild())}else e.parent.addOrRebuild(e)}get isEditorHandlingKeyboard(){return this.getActive()?.shouldGetKeyboardEvents()||this.#x.size===1&&this.firstSelectedEditor.shouldGetKeyboardEvents()}isActive(e){return this.#t===e}getActive(){return this.#t}getMode(){return this.#T}isEditingMode(){return this.#T!==Me.NONE}get imageManager(){return Le(this,"imageManager",new xd)}getSelectionBoxes(e){if(!e)return null;const t=document.getSelection();for(let f=0,p=t.rangeCount;f<p;f++)if(!e.contains(t.getRangeAt(f).commonAncestorContainer))return null;const{x:i,y:r,width:a,height:o}=e.getBoundingClientRect();let c;switch(e.getAttribute("data-main-rotation")){case"90":c=(f,p,g,w)=>({x:(p-r)/o,y:1-(f+g-i)/a,width:w/o,height:g/a});break;case"180":c=(f,p,g,w)=>({x:1-(f+g-i)/a,y:1-(p+w-r)/o,width:g/a,height:w/o});break;case"270":c=(f,p,g,w)=>({x:1-(p+w-r)/o,y:(f-i)/a,width:w/o,height:g/a});break;default:c=(f,p,g,w)=>({x:(f-i)/a,y:(p-r)/o,width:g/a,height:w/o});break}const d=[];for(let f=0,p=t.rangeCount;f<p;f++){const g=t.getRangeAt(f);if(!g.collapsed)for(const{x:w,y:x,width:k,height:v}of g.getClientRects())k===0||v===0||d.push(c(w,x,k,v))}return d.length===0?null:d}addChangedExistingAnnotation({annotationElementId:e,id:t}){(this.#o||=new Map).set(e,t)}removeChangedExistingAnnotation({annotationElementId:e}){this.#o?.delete(e)}renderAnnotationElement(e){const t=this.#o?.get(e.data.id);if(!t)return;const i=this.#r.getRawValue(t);i&&(this.#T===Me.NONE&&!i.hasBeenModified||i.renderAnnotationElement(e))}setMissingCanvas(e,t,i){const r=this.#L?.get(e);r&&(r.setCanvas(t,i),this.#L.delete(e))}addMissingCanvas(e,t){(this.#L||=new Map).set(e,t)}}class Vn{#e=null;#t=!1;#i=null;#n=null;#a=null;#s=null;#r=!1;#o=null;#c=null;#l=null;#u=null;#h=!1;static#f=null;static _l10n=null;constructor(e){this.#c=e,this.#h=e._uiManager.useNewAltTextFlow,Vn.#f||=Object.freeze({added:"pdfjs-editor-new-alt-text-added-button","added-label":"pdfjs-editor-new-alt-text-added-button-label",missing:"pdfjs-editor-new-alt-text-missing-button","missing-label":"pdfjs-editor-new-alt-text-missing-button-label",review:"pdfjs-editor-new-alt-text-to-review-button","review-label":"pdfjs-editor-new-alt-text-to-review-button-label"})}static initialize(e){Vn._l10n??=e}async render(){const e=this.#i=document.createElement("button");e.className="altText",e.tabIndex="0";const t=this.#n=document.createElement("span");e.append(t),this.#h?(e.classList.add("new"),e.setAttribute("data-l10n-id",Vn.#f.missing),t.setAttribute("data-l10n-id",Vn.#f["missing-label"])):(e.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button"),t.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button-label"));const i=this.#c._uiManager._signal;e.addEventListener("contextmenu",gn,{signal:i}),e.addEventListener("pointerdown",a=>a.stopPropagation(),{signal:i});const r=a=>{a.preventDefault(),this.#c._uiManager.editAltText(this.#c),this.#h&&this.#c._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_clicked",data:{label:this.#g}})};return e.addEventListener("click",r,{capture:!0,signal:i}),e.addEventListener("keydown",a=>{a.target===e&&a.key==="Enter"&&(this.#r=!0,r(a))},{signal:i}),await this.#p(),e}get#g(){return this.#e&&"added"||this.#e===null&&this.guessedText&&"review"||"missing"}finish(){this.#i&&(this.#i.focus({focusVisible:this.#r}),this.#r=!1)}isEmpty(){return this.#h?this.#e===null:!this.#e&&!this.#t}hasData(){return this.#h?this.#e!==null||!!this.#l:this.isEmpty()}get guessedText(){return this.#l}async setGuessedText(e){this.#e===null&&(this.#l=e,this.#u=await Vn._l10n.get("pdfjs-editor-new-alt-text-generated-alt-text-with-disclaimer",{generatedAltText:e}),this.#p())}toggleAltTextBadge(e=!1){if(!this.#h||this.#e){this.#o?.remove(),this.#o=null;return}if(!this.#o){const t=this.#o=document.createElement("div");t.className="noAltTextBadge",this.#c.div.append(t)}this.#o.classList.toggle("hidden",!e)}serialize(e){let t=this.#e;return!e&&this.#l===t&&(t=this.#u),{altText:t,decorative:this.#t,guessedText:this.#l,textWithDisclaimer:this.#u}}get data(){return{altText:this.#e,decorative:this.#t}}set data({altText:e,decorative:t,guessedText:i,textWithDisclaimer:r,cancel:a=!1}){i&&(this.#l=i,this.#u=r),!(this.#e===e&&this.#t===t)&&(a||(this.#e=e,this.#t=t),this.#p())}toggle(e=!1){this.#i&&(!e&&this.#s&&(clearTimeout(this.#s),this.#s=null),this.#i.disabled=!e)}shown(){this.#c._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_displayed",data:{label:this.#g}})}destroy(){this.#i?.remove(),this.#i=null,this.#n=null,this.#a=null,this.#o?.remove(),this.#o=null}async#p(){const e=this.#i;if(!e)return;if(this.#h){if(e.classList.toggle("done",!!this.#e),e.setAttribute("data-l10n-id",Vn.#f[this.#g]),this.#n?.setAttribute("data-l10n-id",Vn.#f[`${this.#g}-label`]),!this.#e){this.#a?.remove();return}}else{if(!this.#e&&!this.#t){e.classList.remove("done"),this.#a?.remove();return}e.classList.add("done"),e.setAttribute("data-l10n-id","pdfjs-editor-alt-text-edit-button")}let t=this.#a;if(!t){this.#a=t=document.createElement("span"),t.className="tooltip",t.setAttribute("role","tooltip"),t.id=`alt-text-tooltip-${this.#c.id}`;const r=100,a=this.#c._uiManager._signal;a.addEventListener("abort",()=>{clearTimeout(this.#s),this.#s=null},{once:!0}),e.addEventListener("mouseenter",()=>{this.#s=setTimeout(()=>{this.#s=null,this.#a.classList.add("show"),this.#c._reportTelemetry({action:"alt_text_tooltip"})},r)},{signal:a}),e.addEventListener("mouseleave",()=>{this.#s&&(clearTimeout(this.#s),this.#s=null),this.#a?.classList.remove("show")},{signal:a})}this.#t?t.setAttribute("data-l10n-id","pdfjs-editor-alt-text-decorative-tooltip"):(t.removeAttribute("data-l10n-id"),t.textContent=this.#e),t.parentNode||e.append(t),this.#c.getElementForAltText()?.setAttribute("aria-describedby",t.id)}}class To{#e=null;#t=null;#i=!1;#n=null;#a=null;#s=null;#r=null;#o=null;#c=!1;#l=null;constructor(e){this.#n=e}renderForToolbar(){const e=this.#t=document.createElement("button");return e.className="comment",this.#u(e,!1)}renderForStandalone(){const e=this.#e=document.createElement("button");e.className="annotationCommentButton";const t=this.#n.commentButtonPosition;if(t){const{style:i}=e;i.insetInlineEnd=`calc(${100*(this.#n._uiManager.direction==="ltr"?1-t[0]:t[0])}% - var(--comment-button-dim))`,i.top=`calc(${100*t[1]}% - var(--comment-button-dim))`;const r=this.#n.commentButtonColor;r&&(i.backgroundColor=r)}return this.#u(e,!0)}focusButton(){setTimeout(()=>{(this.#e??this.#t)?.focus()},0)}onUpdatedColor(){if(!this.#e)return;const e=this.#n.commentButtonColor;e&&(this.#e.style.backgroundColor=e),this.#n._uiManager.updatePopupColor(this.#n)}get commentButtonWidth(){return(this.#e?.getBoundingClientRect().width??0)/this.#n.parent.boundingClientRect.width}get commentPopupPositionInLayer(){if(this.#l)return this.#l;if(!this.#e)return null;const{x:e,y:t,height:i}=this.#e.getBoundingClientRect(),{x:r,y:a,width:o,height:c}=this.#n.parent.boundingClientRect;return[(e-r)/o,(t+i-a)/c]}set commentPopupPositionInLayer(e){this.#l=e}hasDefaultPopupPosition(){return this.#l===null}removeStandaloneCommentButton(){this.#e?.remove(),this.#e=null}removeToolbarCommentButton(){this.#t?.remove(),this.#t=null}setCommentButtonStates({selected:e,hasPopup:t}){this.#e&&(this.#e.classList.toggle("selected",e),this.#e.ariaExpanded=t)}#u(e,t){if(!this.#n._uiManager.hasCommentManager())return null;e.tabIndex="0",e.ariaHasPopup="dialog",t?(e.ariaControls="commentPopup",e.setAttribute("data-l10n-id","pdfjs-show-comment-button")):(e.ariaControlsElements=[this.#n._uiManager.getCommentDialogElement()],e.setAttribute("data-l10n-id","pdfjs-editor-edit-comment-button"));const i=this.#n._uiManager._signal;if(!(i instanceof AbortSignal)||i.aborted)return e;e.addEventListener("contextmenu",gn,{signal:i}),t&&(e.addEventListener("focusin",a=>{this.#n._focusEventsAllowed=!1,ht(a)},{capture:!0,signal:i}),e.addEventListener("focusout",a=>{this.#n._focusEventsAllowed=!0,ht(a)},{capture:!0,signal:i})),e.addEventListener("pointerdown",a=>a.stopPropagation(),{signal:i});const r=a=>{a.preventDefault(),e===this.#t?this.edit():this.#n.toggleComment(!0)};return e.addEventListener("click",r,{capture:!0,signal:i}),e.addEventListener("keydown",a=>{a.target===e&&a.key==="Enter"&&(this.#i=!0,r(a))},{signal:i}),e.addEventListener("pointerenter",()=>{this.#n.toggleComment(!1,!0)},{signal:i}),e.addEventListener("pointerleave",()=>{this.#n.toggleComment(!1,!1)},{signal:i}),e}edit(e){const t=this.commentPopupPositionInLayer;let i,r;if(t)[i,r]=t;else{[i,r]=this.#n.commentButtonPosition;const{width:p,height:g,x:w,y:x}=this.#n;i=w+i*p,r=x+r*g}const a=this.#n.parent.boundingClientRect,{x:o,y:c,width:d,height:f}=a;this.#n._uiManager.editComment(this.#n,o+i*d,c+r*f,{...e,parentDimensions:a})}finish(){this.#t&&(this.#t.focus({focusVisible:this.#i}),this.#i=!1)}isDeleted(){return this.#c||this.#r===""}isEmpty(){return this.#r===null}hasBeenEdited(){return this.isDeleted()||this.#r!==this.#a}serialize(){return this.data}get data(){return{text:this.#r,richText:this.#s,date:this.#o,deleted:this.isDeleted()}}set data(e){if(e!==this.#r&&(this.#s=null),e===null){this.#r="",this.#c=!0;return}this.#r=e,this.#o=new Date,this.#c=!1}setInitialText(e,t=null){this.#a=e,this.data=e,this.#o=null,this.#s=t}shown(){}destroy(){this.#t?.remove(),this.#t=null,this.#e?.remove(),this.#e=null,this.#r="",this.#s=null,this.#o=null,this.#n=null,this.#i=!1,this.#c=!1}}class oa{#e;#t=!1;#i=null;#n;#a;#s;#r;#o=null;#c;#l=null;#u;#h=null;constructor({container:e,isPinchingDisabled:t=null,isPinchingStopped:i=null,onPinchStart:r=null,onPinching:a=null,onPinchEnd:o=null,signal:c}){this.#e=e,this.#i=i,this.#n=t,this.#a=r,this.#s=a,this.#r=o,this.#u=new AbortController,this.#c=AbortSignal.any([c,this.#u.signal]),e.addEventListener("touchstart",this.#f.bind(this),{passive:!1,signal:this.#c})}get MIN_TOUCH_DISTANCE_TO_PINCH(){return 35/Ln.pixelRatio}#f(e){if(this.#n?.())return;if(e.touches.length===1){if(this.#o)return;const r=this.#o=new AbortController,a=AbortSignal.any([this.#c,r.signal]),o=this.#e,c={capture:!0,signal:a,passive:!1},d=f=>{f.pointerType==="touch"&&(this.#o?.abort(),this.#o=null)};o.addEventListener("pointerdown",f=>{f.pointerType==="touch"&&(ht(f),d(f))},c),o.addEventListener("pointerup",d,c),o.addEventListener("pointercancel",d,c);return}if(!this.#h){this.#h=new AbortController;const r=AbortSignal.any([this.#c,this.#h.signal]),a=this.#e,o={signal:r,capture:!1,passive:!1};a.addEventListener("touchmove",this.#g.bind(this),o);const c=this.#p.bind(this);a.addEventListener("touchend",c,o),a.addEventListener("touchcancel",c,o),o.capture=!0,a.addEventListener("pointerdown",ht,o),a.addEventListener("pointermove",ht,o),a.addEventListener("pointercancel",ht,o),a.addEventListener("pointerup",ht,o),this.#a?.()}if(ht(e),e.touches.length!==2||this.#i?.()){this.#l=null;return}let[t,i]=e.touches;t.identifier>i.identifier&&([t,i]=[i,t]),this.#l={touch0X:t.screenX,touch0Y:t.screenY,touch1X:i.screenX,touch1Y:i.screenY}}#g(e){if(!this.#l||e.touches.length!==2)return;ht(e);let[t,i]=e.touches;t.identifier>i.identifier&&([t,i]=[i,t]);const{screenX:r,screenY:a}=t,{screenX:o,screenY:c}=i,d=this.#l,{touch0X:f,touch0Y:p,touch1X:g,touch1Y:w}=d,x=g-f,k=w-p,v=o-r,A=c-a,C=Math.hypot(v,A)||1,T=Math.hypot(x,k)||1;if(!this.#t&&Math.abs(T-C)<=oa.MIN_TOUCH_DISTANCE_TO_PINCH)return;if(d.touch0X=r,d.touch0Y=a,d.touch1X=o,d.touch1Y=c,!this.#t){this.#t=!0;return}const R=[(r+o)/2,(a+c)/2];this.#s?.(R,T,C)}#p(e){e.touches.length>=2||(this.#h&&(this.#h.abort(),this.#h=null,this.#r?.()),this.#l&&(ht(e),this.#l=null,this.#t=!1))}destroy(){this.#u?.abort(),this.#u=null,this.#o?.abort(),this.#o=null}}class Te{#e=null;#t=null;#i=null;#n=null;#a=null;#s=!1;#r=null;#o="";#c=null;#l=null;#u=null;#h=null;#f=null;#g="";#p=!1;#d=null;#m=!1;#y=!1;#b=!1;#w=null;#C=0;#S=0;#v=null;#E=null;isSelected=!1;_isCopy=!1;_editToolbar=null;_initialOptions=Object.create(null);_initialData=null;_isVisible=!0;_uiManager=null;_focusEventsAllowed=!0;static _l10n=null;static _l10nResizer=null;#k=!1;#A=Te._zIndex++;static _borderLineWidth=-1;static _colorManager=new kd;static _zIndex=1;static _telemetryTimeout=1e3;static get _resizerKeyboardManager(){const e=Te.prototype._resizeWithKeyboard,t=di.TRANSLATE_SMALL,i=di.TRANSLATE_BIG;return Le(this,"_resizerKeyboardManager",new aa([[["ArrowLeft","mac+ArrowLeft"],e,{args:[-t,0]}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],e,{args:[-i,0]}],[["ArrowRight","mac+ArrowRight"],e,{args:[t,0]}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],e,{args:[i,0]}],[["ArrowUp","mac+ArrowUp"],e,{args:[0,-t]}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],e,{args:[0,-i]}],[["ArrowDown","mac+ArrowDown"],e,{args:[0,t]}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],e,{args:[0,i]}],[["Escape","mac+Escape"],Te.prototype._stopResizingWithKeyboard]]))}constructor(e){this.parent=e.parent,this.id=e.id,this.width=this.height=null,this.pageIndex=e.parent.pageIndex,this.name=e.name,this.div=null,this._uiManager=e.uiManager,this.annotationElementId=null,this._willKeepAspectRatio=!1,this._initialOptions.isCentered=e.isCentered,this._structTreeParentId=null,this.annotationElementId=e.annotationElementId||null,this.creationDate=e.creationDate||new Date,this.modificationDate=e.modificationDate||null;const{rotation:t,rawDims:{pageWidth:i,pageHeight:r,pageX:a,pageY:o}}=this.parent.viewport;this.rotation=t,this.pageRotation=(360+t-this._uiManager.viewParameters.rotation)%360,this.pageDimensions=[i,r],this.pageTranslation=[a,o];const[c,d]=this.parentDimensions;this.x=e.x/c,this.y=e.y/d,this.isAttachedToDOM=!1,this.deleted=!1}get editorType(){return Object.getPrototypeOf(this).constructor._type}get mode(){return Object.getPrototypeOf(this).constructor._editorType}static get isDrawer(){return!1}static get _defaultLineColor(){return Le(this,"_defaultLineColor",this._colorManager.getHexCode("CanvasText"))}static deleteAnnotationElement(e){const t=new I0({id:e.parent.getNextId(),parent:e.parent,uiManager:e._uiManager});t.annotationElementId=e.annotationElementId,t.deleted=!0,t._uiManager.addToAnnotationStorage(t)}static initialize(e,t){if(Te._l10n??=e,Te._l10nResizer||=Object.freeze({topLeft:"pdfjs-editor-resizer-top-left",topMiddle:"pdfjs-editor-resizer-top-middle",topRight:"pdfjs-editor-resizer-top-right",middleRight:"pdfjs-editor-resizer-middle-right",bottomRight:"pdfjs-editor-resizer-bottom-right",bottomMiddle:"pdfjs-editor-resizer-bottom-middle",bottomLeft:"pdfjs-editor-resizer-bottom-left",middleLeft:"pdfjs-editor-resizer-middle-left"}),Te._borderLineWidth!==-1)return;const i=getComputedStyle(document.documentElement);Te._borderLineWidth=parseFloat(i.getPropertyValue("--outline-width"))||0}static updateDefaultParams(e,t){}static get defaultPropertiesToUpdate(){return[]}static isHandlingMimeForPasting(e){return!1}static paste(e,t){Ye("Not implemented")}get propertiesToUpdate(){return[]}get _isDraggable(){return this.#k}set _isDraggable(e){this.#k=e,this.div?.classList.toggle("draggable",e)}get uid(){return this.annotationElementId||this.id}get isEnterHandled(){return!0}center(){const[e,t]=this.pageDimensions;switch(this.parentRotation){case 90:this.x-=this.height*t/(e*2),this.y+=this.width*e/(t*2);break;case 180:this.x+=this.width/2,this.y+=this.height/2;break;case 270:this.x+=this.height*t/(e*2),this.y-=this.width*e/(t*2);break;default:this.x-=this.width/2,this.y-=this.height/2;break}this.fixAndSetPosition()}addCommands(e){this._uiManager.addCommands(e)}get currentLayer(){return this._uiManager.currentLayer}setInBackground(){this.div.style.zIndex=0}setInForeground(){this.div.style.zIndex=this.#A}setParent(e){e!==null?(this.pageIndex=e.pageIndex,this.pageDimensions=e.pageDimensions):(this.#j(),this.#h?.remove(),this.#h=null),this.parent=e}focusin(e){this._focusEventsAllowed&&(this.#p?this.#p=!1:this.parent.setSelected(this))}focusout(e){!this._focusEventsAllowed||!this.isAttachedToDOM||e.relatedTarget?.closest(`#${this.id}`)||(e.preventDefault(),this.parent?.isMultipleSelection||this.commitOrRemove())}commitOrRemove(){this.isEmpty()?this.remove():this.commit()}commit(){this.isInEditMode()&&this.addToAnnotationStorage()}addToAnnotationStorage(){this._uiManager.addToAnnotationStorage(this)}setAt(e,t,i,r){const[a,o]=this.parentDimensions;[i,r]=this.screenToPageTranslation(i,r),this.x=(e+i)/a,this.y=(t+r)/o,this.fixAndSetPosition()}_moveAfterPaste(e,t){const[i,r]=this.parentDimensions;this.setAt(e*i,t*r,this.width*i,this.height*r),this._onTranslated()}#N([e,t],i,r){[i,r]=this.screenToPageTranslation(i,r),this.x+=i/e,this.y+=r/t,this._onTranslating(this.x,this.y),this.fixAndSetPosition()}translate(e,t){this.#N(this.parentDimensions,e,t)}translateInPage(e,t){this.#d||=[this.x,this.y,this.width,this.height],this.#N(this.pageDimensions,e,t),this.div.scrollIntoView({block:"nearest"})}translationDone(){this._onTranslated(this.x,this.y)}drag(e,t){this.#d||=[this.x,this.y,this.width,this.height];const{div:i,parentDimensions:[r,a]}=this;if(this.x+=e/r,this.y+=t/a,this.parent&&(this.x<0||this.x>1||this.y<0||this.y>1)){const{x:g,y:w}=this.div.getBoundingClientRect();this.parent.findNewParent(this,g,w)&&(this.x-=Math.floor(this.x),this.y-=Math.floor(this.y))}let{x:o,y:c}=this;const[d,f]=this.getBaseTranslation();o+=d,c+=f;const{style:p}=i;p.left=`${(100*o).toFixed(2)}%`,p.top=`${(100*c).toFixed(2)}%`,this._onTranslating(o,c),i.scrollIntoView({block:"nearest"})}_onTranslating(e,t){}_onTranslated(e,t){}get _hasBeenMoved(){return!!this.#d&&(this.#d[0]!==this.x||this.#d[1]!==this.y)}get _hasBeenResized(){return!!this.#d&&(this.#d[2]!==this.width||this.#d[3]!==this.height)}getBaseTranslation(){const[e,t]=this.parentDimensions,{_borderLineWidth:i}=Te,r=i/e,a=i/t;switch(this.rotation){case 90:return[-r,a];case 180:return[r,a];case 270:return[r,-a];default:return[-r,-a]}}get _mustFixPosition(){return!0}fixAndSetPosition(e=this.rotation){const{div:{style:t},pageDimensions:[i,r]}=this;let{x:a,y:o,width:c,height:d}=this;if(c*=i,d*=r,a*=i,o*=r,this._mustFixPosition)switch(e){case 0:a=Wt(a,0,i-c),o=Wt(o,0,r-d);break;case 90:a=Wt(a,0,i-d),o=Wt(o,c,r);break;case 180:a=Wt(a,c,i),o=Wt(o,d,r);break;case 270:a=Wt(a,d,i),o=Wt(o,0,r-c);break}this.x=a/=i,this.y=o/=r;const[f,p]=this.getBaseTranslation();a+=f,o+=p,t.left=`${(100*a).toFixed(2)}%`,t.top=`${(100*o).toFixed(2)}%`,this.moveInDOM()}static#R(e,t,i){switch(i){case 90:return[t,-e];case 180:return[-e,-t];case 270:return[-t,e];default:return[e,t]}}screenToPageTranslation(e,t){return Te.#R(e,t,this.parentRotation)}pageTranslationToScreen(e,t){return Te.#R(e,t,360-this.parentRotation)}#_(e){switch(e){case 90:{const[t,i]=this.pageDimensions;return[0,-t/i,i/t,0]}case 180:return[-1,0,0,-1];case 270:{const[t,i]=this.pageDimensions;return[0,t/i,-i/t,0]}default:return[1,0,0,1]}}get parentScale(){return this._uiManager.viewParameters.realScale}get parentRotation(){return(this._uiManager.viewParameters.rotation+this.pageRotation)%360}get parentDimensions(){const{parentScale:e,pageDimensions:[t,i]}=this;return[t*e,i*e]}setDims(){const{div:{style:e},width:t,height:i}=this;e.width=`${(100*t).toFixed(2)}%`,e.height=`${(100*i).toFixed(2)}%`}getInitialTranslation(){return[0,0]}#F(){if(this.#c)return;this.#c=document.createElement("div"),this.#c.classList.add("resizers");const e=this._willKeepAspectRatio?["topLeft","topRight","bottomRight","bottomLeft"]:["topLeft","topMiddle","topRight","middleRight","bottomRight","bottomMiddle","bottomLeft","middleLeft"],t=this._uiManager._signal;for(const i of e){const r=document.createElement("div");this.#c.append(r),r.classList.add("resizer",i),r.setAttribute("data-resizer-name",i),r.addEventListener("pointerdown",this.#M.bind(this,i),{signal:t}),r.addEventListener("contextmenu",gn,{signal:t}),r.tabIndex=-1}this.div.prepend(this.#c)}#M(e,t){t.preventDefault();const{isMac:i}=Pt.platform;if(t.button!==0||t.ctrlKey&&i)return;this.#i?.toggle(!1);const r=this._isDraggable;this._isDraggable=!1,this.#l=[t.screenX,t.screenY];const a=new AbortController,o=this._uiManager.combinedSignal(a);this.parent.togglePointerEvents(!1),window.addEventListener("pointermove",this.#L.bind(this,e),{passive:!0,capture:!0,signal:o}),window.addEventListener("touchmove",ht,{passive:!1,signal:o}),window.addEventListener("contextmenu",gn,{signal:o}),this.#u={savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height};const c=this.parent.div.style.cursor,d=this.div.style.cursor;this.div.style.cursor=this.parent.div.style.cursor=window.getComputedStyle(t.target).cursor;const f=()=>{a.abort(),this.parent.togglePointerEvents(!0),this.#i?.toggle(!0),this._isDraggable=r,this.parent.div.style.cursor=c,this.div.style.cursor=d,this.#O()};window.addEventListener("pointerup",f,{signal:o}),window.addEventListener("blur",f,{signal:o})}#D(e,t,i,r){this.width=i,this.height=r,this.x=e,this.y=t,this.setDims(),this.fixAndSetPosition(),this._onResized()}_onResized(){}#O(){if(!this.#u)return;const{savedX:e,savedY:t,savedWidth:i,savedHeight:r}=this.#u;this.#u=null;const a=this.x,o=this.y,c=this.width,d=this.height;a===e&&o===t&&c===i&&d===r||this.addCommands({cmd:this.#D.bind(this,a,o,c,d),undo:this.#D.bind(this,e,t,i,r),mustExec:!0})}static _round(e){return Math.round(e*1e4)/1e4}#L(e,t){const[i,r]=this.parentDimensions,a=this.x,o=this.y,c=this.width,d=this.height,f=Te.MIN_SIZE/i,p=Te.MIN_SIZE/r,g=this.#_(this.rotation),w=(K,Q)=>[g[0]*K+g[2]*Q,g[1]*K+g[3]*Q],x=this.#_(360-this.rotation),k=(K,Q)=>[x[0]*K+x[2]*Q,x[1]*K+x[3]*Q];let v,A,C=!1,T=!1;switch(e){case"topLeft":C=!0,v=(K,Q)=>[0,0],A=(K,Q)=>[K,Q];break;case"topMiddle":v=(K,Q)=>[K/2,0],A=(K,Q)=>[K/2,Q];break;case"topRight":C=!0,v=(K,Q)=>[K,0],A=(K,Q)=>[0,Q];break;case"middleRight":T=!0,v=(K,Q)=>[K,Q/2],A=(K,Q)=>[0,Q/2];break;case"bottomRight":C=!0,v=(K,Q)=>[K,Q],A=(K,Q)=>[0,0];break;case"bottomMiddle":v=(K,Q)=>[K/2,Q],A=(K,Q)=>[K/2,0];break;case"bottomLeft":C=!0,v=(K,Q)=>[0,Q],A=(K,Q)=>[K,0];break;case"middleLeft":T=!0,v=(K,Q)=>[0,Q/2],A=(K,Q)=>[K,Q/2];break}const R=v(c,d),E=A(c,d);let _=w(...E);const M=Te._round(a+_[0]),N=Te._round(o+_[1]);let I=1,G=1,F,B;if(t.fromKeyboard)({deltaX:F,deltaY:B}=t);else{const{screenX:K,screenY:Q}=t,[V,ce]=this.#l;[F,B]=this.screenToPageTranslation(K-V,Q-ce),this.#l[0]=K,this.#l[1]=Q}if([F,B]=k(F/i,B/r),C){const K=Math.hypot(c,d);I=G=Math.max(Math.min(Math.hypot(E[0]-R[0]-F,E[1]-R[1]-B)/K,1/c,1/d),f/c,p/d)}else T?I=Wt(Math.abs(E[0]-R[0]-F),f,1)/c:G=Wt(Math.abs(E[1]-R[1]-B),p,1)/d;const X=Te._round(c*I),oe=Te._round(d*G);_=w(...A(X,oe));const le=M-_[0],z=N-_[1];this.#d||=[this.x,this.y,this.width,this.height],this.width=X,this.height=oe,this.x=le,this.y=z,this.setDims(),this.fixAndSetPosition(),this._onResizing()}_onResizing(){}altTextFinish(){this.#i?.finish()}get toolbarButtons(){return null}async addEditToolbar(){if(this._editToolbar||this.#y)return this._editToolbar;this._editToolbar=new Yr(this),this.div.append(this._editToolbar.render());const{toolbarButtons:e}=this;if(e)for(const[t,i]of e)await this._editToolbar.addButton(t,i);return this.hasComment||this._editToolbar.addButton("comment",this.addCommentButton()),this._editToolbar.addButton("delete"),this._editToolbar}addCommentButtonInToolbar(){this._editToolbar?.addButtonBefore("comment",this.addCommentButton(),".deleteButton")}removeCommentButtonFromToolbar(){this._editToolbar?.removeButton("comment")}removeEditToolbar(){this._editToolbar?.remove(),this._editToolbar=null,this.#i?.destroy()}addContainer(e){const t=this._editToolbar?.div;t?t.before(e):this.div.append(e)}getClientDimensions(){return this.div.getBoundingClientRect()}createAltText(){return this.#i||(Vn.initialize(Te._l10n),this.#i=new Vn(this),this.#e&&(this.#i.data=this.#e,this.#e=null)),this.#i}get altTextData(){return this.#i?.data}set altTextData(e){this.#i&&(this.#i.data=e)}get guessedAltText(){return this.#i?.guessedText}async setGuessedAltText(e){await this.#i?.setGuessedText(e)}serializeAltText(e){return this.#i?.serialize(e)}hasAltText(){return!!this.#i&&!this.#i.isEmpty()}hasAltTextData(){return this.#i?.hasData()??!1}focusCommentButton(){this.#n?.focusButton()}addCommentButton(){return this.#n||=new To(this)}addStandaloneCommentButton(){if(this.#a){this._uiManager.isEditingMode()&&this.#a.classList.remove("hidden");return}this.hasComment&&(this.#a=this.#n.renderForStandalone(),this.div.append(this.#a))}removeStandaloneCommentButton(){this.#n.removeStandaloneCommentButton(),this.#a=null}hideStandaloneCommentButton(){this.#a?.classList.add("hidden")}get comment(){const{data:{richText:e,text:t,date:i,deleted:r}}=this.#n;return{text:t,richText:e,date:i,deleted:r,color:this.getNonHCMColor(),opacity:this.opacity??1}}set comment(e){this.#n||=new To(this),this.#n.data=e,this.hasComment?(this.removeCommentButtonFromToolbar(),this.addStandaloneCommentButton(),this._uiManager.updateComment(this)):(this.addCommentButtonInToolbar(),this.removeStandaloneCommentButton(),this._uiManager.removeComment(this))}setCommentData({comment:e,popupRef:t,richText:i}){if(!t||(this.#n||=new To(this),this.#n.setInitialText(e,i),!this.annotationElementId))return;const r=this._uiManager.getAndRemoveDataFromAnnotationStorage(this.annotationElementId);r&&this.updateFromAnnotationLayer(r)}get hasEditedComment(){return this.#n?.hasBeenEdited()}get hasDeletedComment(){return this.#n?.isDeleted()}get hasComment(){return!!this.#n&&!this.#n.isEmpty()&&!this.#n.isDeleted()}async editComment(e){this.#n||=new To(this),this.#n.edit(e)}toggleComment(e,t=void 0){this.hasComment&&this._uiManager.toggleComment(this,e,t)}setSelectedCommentButton(e){this.#n.setSelectedButton(e)}addComment(e){if(this.hasEditedComment){const[,,,r]=e.rect,[a]=this.pageDimensions,[o]=this.pageTranslation,c=o+a+1,d=r-100,f=c+180;e.popup={contents:this.comment.text,deleted:this.comment.deleted,rect:[c,d,f,r]}}}updateFromAnnotationLayer({popup:{contents:e,deleted:t}}){this.#n.data=t?null:e}get parentBoundingClientRect(){return this.parent.boundingClientRect}render(){const e=this.div=document.createElement("div");e.setAttribute("data-editor-rotation",(360-this.rotation)%360),e.className=this.name,e.setAttribute("id",this.id),e.tabIndex=this.#s?-1:0,e.setAttribute("role","application"),this.defaultL10nId&&e.setAttribute("data-l10n-id",this.defaultL10nId),this._isVisible||e.classList.add("hidden"),this.setInForeground(),this.#W();const[t,i]=this.parentDimensions;this.parentRotation%180!==0&&(e.style.maxWidth=`${(100*i/t).toFixed(2)}%`,e.style.maxHeight=`${(100*t/i).toFixed(2)}%`);const[r,a]=this.getInitialTranslation();return this.translate(r,a),vp(this,e,["keydown","pointerdown","dblclick"]),this.isResizable&&this._uiManager._supportsPinchToZoom&&(this.#E||=new oa({container:e,isPinchingDisabled:()=>!this.isSelected,onPinchStart:this.#z.bind(this),onPinching:this.#T.bind(this),onPinchEnd:this.#x.bind(this),signal:this._uiManager._signal})),this.addStandaloneCommentButton(),this._uiManager._editorUndoBar?.hide(),e}#z(){this.#u={savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height},this.#i?.toggle(!1),this.parent.togglePointerEvents(!1)}#T(e,t,i){let a=.7*(i/t)+1-.7;if(a===1)return;const o=this.#_(this.rotation),c=(M,N)=>[o[0]*M+o[2]*N,o[1]*M+o[3]*N],[d,f]=this.parentDimensions,p=this.x,g=this.y,w=this.width,x=this.height,k=Te.MIN_SIZE/d,v=Te.MIN_SIZE/f;a=Math.max(Math.min(a,1/w,1/x),k/w,v/x);const A=Te._round(w*a),C=Te._round(x*a);if(A===w&&C===x)return;this.#d||=[p,g,w,x];const T=c(w/2,x/2),R=Te._round(p+T[0]),E=Te._round(g+T[1]),_=c(A/2,C/2);this.x=R-_[0],this.y=E-_[1],this.width=A,this.height=C,this.setDims(),this.fixAndSetPosition(),this._onResizing()}#x(){this.#i?.toggle(!0),this.parent.togglePointerEvents(!0),this.#O()}pointerdown(e){const{isMac:t}=Pt.platform;if(e.button!==0||e.ctrlKey&&t){e.preventDefault();return}if(this.#p=!0,this._isDraggable){this.#q(e);return}this.#I(e)}#I(e){const{isMac:t}=Pt.platform;e.ctrlKey&&!t||e.shiftKey||e.metaKey&&t?this.parent.toggleSelected(this):this.parent.setSelected(this)}#q(e){const{isSelected:t}=this;this._uiManager.setUpDragSession();let i=!1;const r=new AbortController,a=this._uiManager.combinedSignal(r),o={capture:!0,passive:!1,signal:a},c=f=>{r.abort(),this.#r=null,this.#p=!1,this._uiManager.endDragSession()||this.#I(f),i&&this._onStopDragging()};t&&(this.#C=e.clientX,this.#S=e.clientY,this.#r=e.pointerId,this.#o=e.pointerType,window.addEventListener("pointermove",f=>{i||(i=!0,this._uiManager.toggleComment(this,!0,!1),this._onStartDragging());const{clientX:p,clientY:g,pointerId:w}=f;if(w!==this.#r){ht(f);return}const[x,k]=this.screenToPageTranslation(p-this.#C,g-this.#S);this.#C=p,this.#S=g,this._uiManager.dragSelectedEditors(x,k)},o),window.addEventListener("touchmove",ht,o),window.addEventListener("pointerdown",f=>{f.pointerType===this.#o&&(this.#E||f.isPrimary)&&c(f),ht(f)},o));const d=f=>{if(!this.#r||this.#r===f.pointerId){c(f);return}ht(f)};window.addEventListener("pointerup",d,{signal:a}),window.addEventListener("blur",d,{signal:a})}_onStartDragging(){}_onStopDragging(){}moveInDOM(){this.#w&&clearTimeout(this.#w),this.#w=setTimeout(()=>{this.#w=null,this.parent?.moveEditorInDOM(this)},0)}_setParentAndPosition(e,t,i){e.changeParent(this),this.x=t,this.y=i,this.fixAndSetPosition(),this._onTranslated()}getRect(e,t,i=this.rotation){const r=this.parentScale,[a,o]=this.pageDimensions,[c,d]=this.pageTranslation,f=e/r,p=t/r,g=this.x*a,w=this.y*o,x=this.width*a,k=this.height*o;switch(i){case 0:return[g+f+c,o-w-p-k+d,g+f+x+c,o-w-p+d];case 90:return[g+p+c,o-w+f+d,g+p+k+c,o-w+f+x+d];case 180:return[g-f-x+c,o-w+p+d,g-f+c,o-w+p+k+d];case 270:return[g-p-k+c,o-w-f-x+d,g-p+c,o-w-f+d];default:throw new Error("Invalid rotation")}}getRectInCurrentCoords(e,t){const[i,r,a,o]=e,c=a-i,d=o-r;switch(this.rotation){case 0:return[i,t-o,c,d];case 90:return[i,t-r,d,c];case 180:return[a,t-r,c,d];case 270:return[a,t-o,d,c];default:throw new Error("Invalid rotation")}}getPDFRect(){return this.getRect(0,0)}getNonHCMColor(){return this.color&&Te._colorManager.convert(this._uiManager.getNonHCMColor(this.color))}onUpdatedColor(){this.#n?.onUpdatedColor()}getData(){const{comment:{text:e,color:t,date:i,opacity:r,deleted:a,richText:o},uid:c,pageIndex:d,creationDate:f,modificationDate:p}=this;return{id:c,pageIndex:d,rect:this.getPDFRect(),richText:o,contentsObj:{str:e},creationDate:f,modificationDate:i||p,popupRef:!a,color:t,opacity:r}}onceAdded(e){}isEmpty(){return!1}enableEditMode(){return this.isInEditMode()?!1:(this.parent.setEditingState(!1),this.#y=!0,!0)}disableEditMode(){return this.isInEditMode()?(this.parent.setEditingState(!0),this.#y=!1,!0):!1}isInEditMode(){return this.#y}shouldGetKeyboardEvents(){return this.#b}needsToBeRebuilt(){return this.div&&!this.isAttachedToDOM}get isOnScreen(){const{top:e,left:t,bottom:i,right:r}=this.getClientDimensions(),{innerHeight:a,innerWidth:o}=window;return t<o&&r>0&&e<a&&i>0}#W(){if(this.#f||!this.div)return;this.#f=new AbortController;const e=this._uiManager.combinedSignal(this.#f);this.div.addEventListener("focusin",this.focusin.bind(this),{signal:e}),this.div.addEventListener("focusout",this.focusout.bind(this),{signal:e})}rebuild(){this.#W()}rotate(e){}resize(){}serializeDeleted(){return{id:this.annotationElementId,deleted:!0,pageIndex:this.pageIndex,popupRef:this._initialData?.popupRef||""}}serialize(e=!1,t=null){return{annotationType:this.mode,pageIndex:this.pageIndex,rect:this.getPDFRect(),rotation:this.rotation,structTreeParentId:this._structTreeParentId,popupRef:this._initialData?.popupRef||""}}static async deserialize(e,t,i){const r=new this.prototype.constructor({parent:t,id:t.getNextId(),uiManager:i,annotationElementId:e.annotationElementId,creationDate:e.creationDate,modificationDate:e.modificationDate});r.rotation=e.rotation,r.#e=e.accessibilityData,r._isCopy=e.isCopy||!1;const[a,o]=r.pageDimensions,[c,d,f,p]=r.getRectInCurrentCoords(e.rect,o);return r.x=c/a,r.y=d/o,r.width=f/a,r.height=p/o,r}get hasBeenModified(){return!!this.annotationElementId&&(this.deleted||this.serialize()!==null)}remove(){if(this.#f?.abort(),this.#f=null,this.isEmpty()||this.commit(),this.parent?this.parent.remove(this):this._uiManager.removeEditor(this),this.#w&&(clearTimeout(this.#w),this.#w=null),this.#j(),this.removeEditToolbar(),this.#v){for(const e of this.#v.values())clearTimeout(e);this.#v=null}this.parent=null,this.#E?.destroy(),this.#E=null}get isResizable(){return!1}makeResizable(){this.isResizable&&(this.#F(),this.#c.classList.remove("hidden"))}get toolbarPosition(){return null}get commentButtonPosition(){return this._uiManager.direction==="ltr"?[1,0]:[0,0]}get commentButtonPositionInPage(){const{commentButtonPosition:[e,t]}=this,[i,r,a,o]=this.getPDFRect();return[Te._round(i+(a-i)*e),Te._round(r+(o-r)*(1-t))]}get commentButtonColor(){return this._uiManager.makeCommentColor(this.getNonHCMColor(),this.opacity)}get commentPopupPosition(){return this.#n.commentPopupPositionInLayer}set commentPopupPosition(e){this.#n.commentPopupPositionInLayer=e}hasDefaultPopupPosition(){return this.#n.hasDefaultPopupPosition()}get commentButtonWidth(){return this.#n.commentButtonWidth}get elementBeforePopup(){return this.div}setCommentButtonStates(e){this.#n.setCommentButtonStates(e)}keydown(e){if(!this.isResizable||e.target!==this.div||e.key!=="Enter")return;this._uiManager.setSelected(this),this.#u={savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height};const t=this.#c.children;if(!this.#t){this.#t=Array.from(t);const o=this.#V.bind(this),c=this.#$.bind(this),d=this._uiManager._signal;for(const f of this.#t){const p=f.getAttribute("data-resizer-name");f.setAttribute("role","spinbutton"),f.addEventListener("keydown",o,{signal:d}),f.addEventListener("blur",c,{signal:d}),f.addEventListener("focus",this.#K.bind(this,p),{signal:d}),f.setAttribute("data-l10n-id",Te._l10nResizer[p])}}const i=this.#t[0];let r=0;for(const o of t){if(o===i)break;r++}const a=(360-this.rotation+this.parentRotation)%360/90*(this.#t.length/4);if(a!==r){if(a<r)for(let c=0;c<r-a;c++)this.#c.append(this.#c.firstChild);else if(a>r)for(let c=0;c<a-r;c++)this.#c.firstChild.before(this.#c.lastChild);let o=0;for(const c of t){const f=this.#t[o++].getAttribute("data-resizer-name");c.setAttribute("data-l10n-id",Te._l10nResizer[f])}}this.#H(0),this.#b=!0,this.#c.firstChild.focus({focusVisible:!0}),e.preventDefault(),e.stopImmediatePropagation()}#V(e){Te._resizerKeyboardManager.exec(this,e)}#$(e){this.#b&&e.relatedTarget?.parentNode!==this.#c&&this.#j()}#K(e){this.#g=this.#b?e:""}#H(e){if(this.#t)for(const t of this.#t)t.tabIndex=e}_resizeWithKeyboard(e,t){this.#b&&this.#L(this.#g,{deltaX:e,deltaY:t,fromKeyboard:!0})}#j(){this.#b=!1,this.#H(-1),this.#O()}_stopResizingWithKeyboard(){this.#j(),this.div.focus()}select(){if(this.isSelected&&this._editToolbar){this._editToolbar.show();return}if(this.isSelected=!0,this.makeResizable(),this.div?.classList.add("selectedEditor"),!this._editToolbar){this.addEditToolbar().then(()=>{this.div?.classList.contains("selectedEditor")&&this._editToolbar?.show()});return}this._editToolbar?.show(),this.#i?.toggleAltTextBadge(!1)}focus(){this.div&&!this.div.contains(document.activeElement)&&setTimeout(()=>this.div?.focus({preventScroll:!0}),0)}unselect(){this.isSelected&&(this.isSelected=!1,this.#c?.classList.add("hidden"),this.div?.classList.remove("selectedEditor"),this.div?.contains(document.activeElement)&&this._uiManager.currentLayer.div.focus({preventScroll:!0}),this._editToolbar?.hide(),this.#i?.toggleAltTextBadge(!0),this.hasComment&&this._uiManager.toggleComment(this,!1,!1))}updateParams(e,t){}disableEditing(){}enableEditing(){}get canChangeContent(){return!1}enterInEditMode(){this.canChangeContent&&(this.enableEditMode(),this.div.focus())}dblclick(e){e.target.nodeName!=="BUTTON"&&(this.enterInEditMode(),this.parent.updateToolbar({mode:this.constructor._editorType,editId:this.id}))}getElementForAltText(){return this.div}get contentDiv(){return this.div}get isEditing(){return this.#m}set isEditing(e){this.#m=e,this.parent&&(e?(this.parent.setSelected(this),this.parent.setActiveEditor(this)):this.parent.setActiveEditor(null))}static get MIN_SIZE(){return 16}static canCreateNewEmptyEditor(){return!0}get telemetryInitialData(){return{action:"added"}}get telemetryFinalData(){return null}_reportTelemetry(e,t=!1){if(t){this.#v||=new Map;const{action:i}=e;let r=this.#v.get(i);r&&clearTimeout(r),r=setTimeout(()=>{this._reportTelemetry(e),this.#v.delete(i),this.#v.size===0&&(this.#v=null)},Te._telemetryTimeout),this.#v.set(i,r);return}e.type||=this.editorType,this._uiManager._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:e}})}show(e=this._isVisible){this.div.classList.toggle("hidden",!e),this._isVisible=e}enable(){this.div&&(this.div.tabIndex=0),this.#s=!1}disable(){this.div&&(this.div.tabIndex=-1),this.#s=!0}updateFakeAnnotationElement(e){if(!this.#h&&!this.deleted){this.#h=e.addFakeAnnotation(this);return}if(this.deleted){this.#h.remove(),this.#h=null;return}(this.hasEditedComment||this._hasBeenMoved||this._hasBeenResized)&&this.#h.updateEdited({rect:this.getPDFRect(),popup:this.comment})}renderAnnotationElement(e){if(this.deleted)return e.hide(),null;let t=e.container.querySelector(".annotationContent");if(!t)t=document.createElement("div"),t.classList.add("annotationContent",this.editorType),e.container.prepend(t);else if(t.nodeName==="CANVAS"){const i=t;t=document.createElement("div"),t.classList.add("annotationContent",this.editorType),i.before(t)}return t}resetAnnotationElement(e){const{firstChild:t}=e.container;t?.nodeName==="DIV"&&t.classList.contains("annotationContent")&&t.remove()}}class I0 extends Te{constructor(e){super(e),this.annotationElementId=e.annotationElementId,this.deleted=!0}serialize(){return this.serializeDeleted()}}const Mf=3285377520,Sn=4294901760,Un=65535;class xp{constructor(e){this.h1=e?e&4294967295:Mf,this.h2=e?e&4294967295:Mf}update(e){let t,i;if(typeof e=="string"){t=new Uint8Array(e.length*2),i=0;for(let v=0,A=e.length;v<A;v++){const C=e.charCodeAt(v);C<=255?t[i++]=C:(t[i++]=C>>>8,t[i++]=C&255)}}else if(ArrayBuffer.isView(e))t=e.slice(),i=t.byteLength;else throw new Error("Invalid data format, must be a string or TypedArray.");const r=i>>2,a=i-r*4,o=new Uint32Array(t.buffer,0,r);let c=0,d=0,f=this.h1,p=this.h2;const g=3432918353,w=461845907,x=g&Un,k=w&Un;for(let v=0;v<r;v++)v&1?(c=o[v],c=c*g&Sn|c*x&Un,c=c<<15|c>>>17,c=c*w&Sn|c*k&Un,f^=c,f=f<<13|f>>>19,f=f*5+3864292196):(d=o[v],d=d*g&Sn|d*x&Un,d=d<<15|d>>>17,d=d*w&Sn|d*k&Un,p^=d,p=p<<13|p>>>19,p=p*5+3864292196);switch(c=0,a){case 3:c^=t[r*4+2]<<16;case 2:c^=t[r*4+1]<<8;case 1:c^=t[r*4],c=c*g&Sn|c*x&Un,c=c<<15|c>>>17,c=c*w&Sn|c*k&Un,r&1?f^=c:p^=c}this.h1=f,this.h2=p}hexdigest(){let e=this.h1,t=this.h2;return e^=t>>>1,e=e*3981806797&Sn|e*36045&Un,t=t*4283543511&Sn|((t<<16|e>>>16)*2950163797&Sn)>>>16,e^=t>>>1,e=e*444984403&Sn|e*60499&Un,t=t*3301882366&Sn|((t<<16|e>>>16)*3120437893&Sn)>>>16,e^=t>>>1,(e>>>0).toString(16).padStart(8,"0")+(t>>>0).toString(16).padStart(8,"0")}}const nd=Object.freeze({map:null,hash:"",transfer:void 0});class Sd{#e=!1;#t=null;#i=null;#n=new Map;constructor(){this.onSetModified=null,this.onResetModified=null,this.onAnnotationEditor=null}getValue(e,t){const i=this.#n.get(e);return i===void 0?t:Object.assign(t,i)}getRawValue(e){return this.#n.get(e)}remove(e){const t=this.#n.get(e);if(t!==void 0&&(t instanceof Te&&this.#i.delete(t.annotationElementId),this.#n.delete(e),this.#n.size===0&&this.resetModified(),typeof this.onAnnotationEditor=="function")){for(const i of this.#n.values())if(i instanceof Te)return;this.onAnnotationEditor(null)}}setValue(e,t){const i=this.#n.get(e);let r=!1;if(i!==void 0)for(const[a,o]of Object.entries(t))i[a]!==o&&(r=!0,i[a]=o);else r=!0,this.#n.set(e,t);r&&this.#a(),t instanceof Te&&((this.#i||=new Map).set(t.annotationElementId,t),typeof this.onAnnotationEditor=="function"&&this.onAnnotationEditor(t.constructor._type))}has(e){return this.#n.has(e)}get size(){return this.#n.size}#a(){this.#e||(this.#e=!0,typeof this.onSetModified=="function"&&this.onSetModified())}resetModified(){this.#e&&(this.#e=!1,typeof this.onResetModified=="function"&&this.onResetModified())}get print(){return new kp(this)}get serializable(){if(this.#n.size===0)return nd;const e=new Map,t=new xp,i=[],r=Object.create(null);let a=!1;for(const[o,c]of this.#n){const d=c instanceof Te?c.serialize(!1,r):c;d&&(e.set(o,d),t.update(`${o}:${JSON.stringify(d)}`),a||=!!d.bitmap)}if(a)for(const o of e.values())o.bitmap&&i.push(o.bitmap);return e.size>0?{map:e,hash:t.hexdigest(),transfer:i}:nd}get editorStats(){let e=null;const t=new Map;let i=0,r=0;for(const a of this.#n.values()){if(!(a instanceof Te)){a.popup&&(a.popup.deleted?r+=1:i+=1);continue}a.isCommentDeleted?r+=1:a.hasEditedComment&&(i+=1);const o=a.telemetryFinalData;if(!o)continue;const{type:c}=o;t.has(c)||t.set(c,Object.getPrototypeOf(a).constructor),e||=Object.create(null);const d=e[c]||=new Map;for(const[f,p]of Object.entries(o)){if(f==="type")continue;let g=d.get(f);g||(g=new Map,d.set(f,g));const w=g.get(p)??0;g.set(p,w+1)}}if((r>0||i>0)&&(e||=Object.create(null),e.comments={deleted:r,edited:i}),!e)return null;for(const[a,o]of t)e[a]=o.computeTelemetryFinalData(e[a]);return e}resetModifiedIds(){this.#t=null}updateEditor(e,t){const i=this.#i?.get(e);return i?(i.updateFromAnnotationLayer(t),!0):!1}getEditor(e){return this.#i?.get(e)||null}get modifiedIds(){if(this.#t)return this.#t;const e=[];if(this.#i)for(const t of this.#i.values())t.serialize()&&e.push(t.annotationElementId);return this.#t={ids:new Set(e),hash:e.join(",")}}[Symbol.iterator](){return this.#n.entries()}}class kp extends Sd{#e;constructor(e){super();const{map:t,hash:i,transfer:r}=e.serializable,a=structuredClone(t,r?{transfer:r}:null);this.#e={map:a,hash:i,transfer:r}}get print(){Ye("Should not call PrintAnnotationStorage.print")}get serializable(){return this.#e}get modifiedIds(){return Le(this,"modifiedIds",{ids:new Set,hash:""})}}class D0{#e=new Set;constructor({ownerDocument:e=globalThis.document,styleElement:t=null}){this._document=e,this.nativeFontFaces=new Set,this.styleElement=null,this.loadingRequests=[],this.loadTestFontId=0}addNativeFontFace(e){this.nativeFontFaces.add(e),this._document.fonts.add(e)}removeNativeFontFace(e){this.nativeFontFaces.delete(e),this._document.fonts.delete(e)}insertRule(e){this.styleElement||(this.styleElement=this._document.createElement("style"),this._document.documentElement.getElementsByTagName("head")[0].append(this.styleElement));const t=this.styleElement.sheet;t.insertRule(e,t.cssRules.length)}clear(){for(const e of this.nativeFontFaces)this._document.fonts.delete(e);this.nativeFontFaces.clear(),this.#e.clear(),this.styleElement&&(this.styleElement.remove(),this.styleElement=null)}async loadSystemFont({systemFontInfo:e,disableFontFace:t,_inspectFont:i}){if(!(!e||this.#e.has(e.loadedName))){if(Be(!t,"loadSystemFont shouldn't be called when `disableFontFace` is set."),this.isFontLoadingAPISupported){const{loadedName:r,src:a,style:o}=e,c=new FontFace(r,a,o);this.addNativeFontFace(c);try{await c.load(),this.#e.add(r),i?.(e)}catch{Ie(`Cannot load system font: ${e.baseFontName}, installing it could help to improve PDF rendering.`),this.removeNativeFontFace(c)}return}Ye("Not implemented: loadSystemFont without the Font Loading API.")}}async bind(e){if(e.attached||e.missingFile&&!e.systemFontInfo)return;if(e.attached=!0,e.systemFontInfo){await this.loadSystemFont(e);return}if(this.isFontLoadingAPISupported){const i=e.createNativeFontFace();if(i){this.addNativeFontFace(i);try{await i.loaded}catch(r){throw Ie(`Failed to load font '${i.family}': '${r}'.`),e.disableFontFace=!0,r}}return}const t=e.createFontFaceRule();if(t){if(this.insertRule(t),this.isSyncFontLoadingSupported)return;await new Promise(i=>{const r=this._queueLoadingCallback(i);this._prepareFontLoadEvent(e,r)})}}get isFontLoadingAPISupported(){const e=!!this._document?.fonts;return Le(this,"isFontLoadingAPISupported",e)}get isSyncFontLoadingSupported(){return Le(this,"isSyncFontLoadingSupported",zt||Pt.platform.isFirefox)}_queueLoadingCallback(e){function t(){for(Be(!r.done,"completeRequest() cannot be called twice."),r.done=!0;i.length>0&&i[0].done;){const a=i.shift();setTimeout(a.callback,0)}}const{loadingRequests:i}=this,r={done:!1,complete:t,callback:e};return i.push(r),r}get _loadTestFont(){const e=atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQAFQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAAALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgAAAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACMAooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4DIP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAAAAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUAAQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgABAAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABYAAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAAAC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAAAAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQACAQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTjFQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA==");return Le(this,"_loadTestFont",e)}_prepareFontLoadEvent(e,t){function i(E,_){return E.charCodeAt(_)<<24|E.charCodeAt(_+1)<<16|E.charCodeAt(_+2)<<8|E.charCodeAt(_+3)&255}function r(E,_,M,N){const I=E.substring(0,_),G=E.substring(_+M);return I+N+G}let a,o;const c=this._document.createElement("canvas");c.width=1,c.height=1;const d=c.getContext("2d");let f=0;function p(E,_){if(++f>30){Ie("Load test font never loaded."),_();return}if(d.font="30px "+E,d.fillText(".",0,20),d.getImageData(0,0,1,1).data[3]>0){_();return}setTimeout(p.bind(null,E,_))}const g=`lt${Date.now()}${this.loadTestFontId++}`;let w=this._loadTestFont;w=r(w,976,g.length,g);const k=16,v=1482184792;let A=i(w,k);for(a=0,o=g.length-3;a<o;a+=4)A=A-v+i(g,a)|0;a<g.length&&(A=A-v+i(g+"XXX",a)|0),w=r(w,k,4,x0(A));const C=`url(data:font/opentype;base64,${btoa(w)});`,T=`@font-face {font-family:"${g}";src:${C}}`;this.insertRule(T);const R=this._document.createElement("div");R.style.visibility="hidden",R.style.width=R.style.height="10px",R.style.position="absolute",R.style.top=R.style.left="0px";for(const E of[e.loadedName,g]){const _=this._document.createElement("span");_.textContent="Hi",_.style.fontFamily=E,R.append(_)}this._document.body.append(R),p(g,()=>{R.remove(),t.complete()})}}class L0{#e;constructor(e,t=null,i,r){this.compiledGlyphs=Object.create(null),this.#e=e,this._inspectFont=t,i&&Object.assign(this,i),r&&(this.charProcOperatorList=r)}createNativeFontFace(){if(!this.data||this.disableFontFace)return null;let e;if(!this.cssFontInfo)e=new FontFace(this.loadedName,this.data,{});else{const t={weight:this.cssFontInfo.fontWeight};this.cssFontInfo.italicAngle&&(t.style=`oblique ${this.cssFontInfo.italicAngle}deg`),e=new FontFace(this.cssFontInfo.fontFamily,this.data,t)}return this._inspectFont?.(this),e}createFontFaceRule(){if(!this.data||this.disableFontFace)return null;const e=`url(data:${this.mimetype};base64,${fp(this.data)});`;let t;if(!this.cssFontInfo)t=`@font-face {font-family:"${this.loadedName}";src:${e}}`;else{let i=`font-weight: ${this.cssFontInfo.fontWeight};`;this.cssFontInfo.italicAngle&&(i+=`font-style: oblique ${this.cssFontInfo.italicAngle}deg;`),t=`@font-face {font-family:"${this.cssFontInfo.fontFamily}";${i}src:${e}}`}return this._inspectFont?.(this,e),t}getPathGenerator(e,t){if(this.compiledGlyphs[t]!==void 0)return this.compiledGlyphs[t];const i=this.loadedName+"_path_"+t;let r;try{r=e.get(i)}catch(o){Ie(`getPathGenerator - ignoring character: "${o}".`)}const a=new Path2D(r||"");return this.fontExtraProperties||e.delete(i),this.compiledGlyphs[t]=a}get black(){return this.#e.black}get bold(){return this.#e.bold}get disableFontFace(){return this.#e.disableFontFace??!1}get fontExtraProperties(){return this.#e.fontExtraProperties??!1}get isInvalidPDFjsFont(){return this.#e.isInvalidPDFjsFont}get isType3Font(){return this.#e.isType3Font}get italic(){return this.#e.italic}get missingFile(){return this.#e.missingFile}get remeasure(){return this.#e.remeasure}get vertical(){return this.#e.vertical}get ascent(){return this.#e.ascent}get defaultWidth(){return this.#e.defaultWidth}get descent(){return this.#e.descent}get bbox(){return this.#e.bbox}get fontMatrix(){return this.#e.fontMatrix}get fallbackName(){return this.#e.fallbackName}get loadedName(){return this.#e.loadedName}get mimetype(){return this.#e.mimetype}get name(){return this.#e.name}get data(){return this.#e.data}clearData(){this.#e.clearData()}get cssFontInfo(){return this.#e.cssFontInfo}get systemFontInfo(){return this.#e.systemFontInfo}get defaultVMetrics(){return this.#e.defaultVMetrics}}function j0(h){if(h instanceof URL)return h.href;if(typeof h=="string"){if(zt)return h;const e=URL.parse(h,window.location);if(e)return e.href}throw new Error("Invalid PDF url data: either string or URL-object is expected in the url property.")}function F0(h){if(zt&&typeof Buffer<"u"&&h instanceof Buffer)throw new Error("Please provide binary data as `Uint8Array`, rather than `Buffer`.");if(h instanceof Uint8Array&&h.byteLength===h.buffer.byteLength)return h;if(typeof h=="string")return ia(h);if(h instanceof ArrayBuffer||ArrayBuffer.isView(h)||typeof h=="object"&&!isNaN(h?.length))return new Uint8Array(h);throw new Error("Invalid PDF binary data: either TypedArray, string, or array-like object is expected in the data property.")}function Eo(h){if(typeof h!="string")return null;if(h.endsWith("/"))return h;throw new Error(`Invalid factory url: "${h}" must include trailing slash.`)}const id=h=>typeof h=="object"&&Number.isInteger(h?.num)&&h.num>=0&&Number.isInteger(h?.gen)&&h.gen>=0,O0=h=>typeof h=="object"&&typeof h?.name=="string",Sp=C0.bind(null,id,O0);class q0{#e=new Map;#t=Promise.resolve();postMessage(e,t){const i={data:structuredClone(e,t?{transfer:t}:null)};this.#t.then(()=>{for(const[r]of this.#e)r.call(this,i)})}addEventListener(e,t,i=null){let r=null;if(i?.signal instanceof AbortSignal){const{signal:a}=i;if(a.aborted){Ie("LoopbackPort - cannot use an `aborted` signal.");return}const o=()=>this.removeEventListener(e,t);r=()=>a.removeEventListener("abort",o),a.addEventListener("abort",o)}this.#e.set(t,r)}removeEventListener(e,t){this.#e.get(t)?.(),this.#e.delete(t)}terminate(){for(const[,e]of this.#e)e?.();this.#e.clear()}}const Ro={DATA:1,ERROR:2},kt={CANCEL:1,CANCEL_COMPLETE:2,CLOSE:3,ENQUEUE:4,ERROR:5,PULL:6,PULL_COMPLETE:7,START_COMPLETE:8};function If(){}function sn(h){if(h instanceof ci||h instanceof Fo||h instanceof Cf||h instanceof Qr||h instanceof Uc)return h;switch(h instanceof Error||typeof h=="object"&&h!==null||Ye('wrapReason: Expected "reason" to be a (possibly cloned) Error.'),h.name){case"AbortException":return new ci(h.message);case"InvalidPDFException":return new Fo(h.message);case"PasswordException":return new Cf(h.message,h.code);case"ResponseException":return new Qr(h.message,h.status,h.missing);case"UnknownErrorException":return new Uc(h.message,h.details)}return new Uc(h.message,h.toString())}class $r{#e=new AbortController;constructor(e,t,i){this.sourceName=e,this.targetName=t,this.comObj=i,this.callbackId=1,this.streamId=1,this.streamSinks=Object.create(null),this.streamControllers=Object.create(null),this.callbackCapabilities=Object.create(null),this.actionHandler=Object.create(null),i.addEventListener("message",this.#t.bind(this),{signal:this.#e.signal})}#t({data:e}){if(e.targetName!==this.sourceName)return;if(e.stream){this.#n(e);return}if(e.callback){const i=e.callbackId,r=this.callbackCapabilities[i];if(!r)throw new Error(`Cannot resolve callback ${i}`);if(delete this.callbackCapabilities[i],e.callback===Ro.DATA)r.resolve(e.data);else if(e.callback===Ro.ERROR)r.reject(sn(e.reason));else throw new Error("Unexpected callback case");return}const t=this.actionHandler[e.action];if(!t)throw new Error(`Unknown action from worker: ${e.action}`);if(e.callbackId){const i=this.sourceName,r=e.sourceName,a=this.comObj;Promise.try(t,e.data).then(function(o){a.postMessage({sourceName:i,targetName:r,callback:Ro.DATA,callbackId:e.callbackId,data:o})},function(o){a.postMessage({sourceName:i,targetName:r,callback:Ro.ERROR,callbackId:e.callbackId,reason:sn(o)})});return}if(e.streamId){this.#i(e);return}t(e.data)}on(e,t){const i=this.actionHandler;if(i[e])throw new Error(`There is already an actionName called "${e}"`);i[e]=t}send(e,t,i){this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:e,data:t},i)}sendWithPromise(e,t,i){const r=this.callbackId++,a=Promise.withResolvers();this.callbackCapabilities[r]=a;try{this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:e,callbackId:r,data:t},i)}catch(o){a.reject(o)}return a.promise}sendWithStream(e,t,i,r){const a=this.streamId++,o=this.sourceName,c=this.targetName,d=this.comObj;return new ReadableStream({start:f=>{const p=Promise.withResolvers();return this.streamControllers[a]={controller:f,startCall:p,pullCall:null,cancelCall:null,isClosed:!1},d.postMessage({sourceName:o,targetName:c,action:e,streamId:a,data:t,desiredSize:f.desiredSize},r),p.promise},pull:f=>{const p=Promise.withResolvers();return this.streamControllers[a].pullCall=p,d.postMessage({sourceName:o,targetName:c,stream:kt.PULL,streamId:a,desiredSize:f.desiredSize}),p.promise},cancel:f=>{Be(f instanceof Error,"cancel must have a valid reason");const p=Promise.withResolvers();return this.streamControllers[a].cancelCall=p,this.streamControllers[a].isClosed=!0,d.postMessage({sourceName:o,targetName:c,stream:kt.CANCEL,streamId:a,reason:sn(f)}),p.promise}},i)}#i(e){const t=e.streamId,i=this.sourceName,r=e.sourceName,a=this.comObj,o=this,c=this.actionHandler[e.action],d={enqueue(f,p=1,g){if(this.isCancelled)return;const w=this.desiredSize;this.desiredSize-=p,w>0&&this.desiredSize<=0&&(this.sinkCapability=Promise.withResolvers(),this.ready=this.sinkCapability.promise),a.postMessage({sourceName:i,targetName:r,stream:kt.ENQUEUE,streamId:t,chunk:f},g)},close(){this.isCancelled||(this.isCancelled=!0,a.postMessage({sourceName:i,targetName:r,stream:kt.CLOSE,streamId:t}),delete o.streamSinks[t])},error(f){Be(f instanceof Error,"error must have a valid reason"),!this.isCancelled&&(this.isCancelled=!0,a.postMessage({sourceName:i,targetName:r,stream:kt.ERROR,streamId:t,reason:sn(f)}))},sinkCapability:Promise.withResolvers(),onPull:null,onCancel:null,isCancelled:!1,desiredSize:e.desiredSize,ready:null};d.sinkCapability.resolve(),d.ready=d.sinkCapability.promise,this.streamSinks[t]=d,Promise.try(c,e.data,d).then(function(){a.postMessage({sourceName:i,targetName:r,stream:kt.START_COMPLETE,streamId:t,success:!0})},function(f){a.postMessage({sourceName:i,targetName:r,stream:kt.START_COMPLETE,streamId:t,reason:sn(f)})})}#n(e){const t=e.streamId,i=this.sourceName,r=e.sourceName,a=this.comObj,o=this.streamControllers[t],c=this.streamSinks[t];switch(e.stream){case kt.START_COMPLETE:e.success?o.startCall.resolve():o.startCall.reject(sn(e.reason));break;case kt.PULL_COMPLETE:e.success?o.pullCall.resolve():o.pullCall.reject(sn(e.reason));break;case kt.PULL:if(!c){a.postMessage({sourceName:i,targetName:r,stream:kt.PULL_COMPLETE,streamId:t,success:!0});break}c.desiredSize<=0&&e.desiredSize>0&&c.sinkCapability.resolve(),c.desiredSize=e.desiredSize,Promise.try(c.onPull||If).then(function(){a.postMessage({sourceName:i,targetName:r,stream:kt.PULL_COMPLETE,streamId:t,success:!0})},function(f){a.postMessage({sourceName:i,targetName:r,stream:kt.PULL_COMPLETE,streamId:t,reason:sn(f)})});break;case kt.ENQUEUE:if(Be(o,"enqueue should have stream controller"),o.isClosed)break;o.controller.enqueue(e.chunk);break;case kt.CLOSE:if(Be(o,"close should have stream controller"),o.isClosed)break;o.isClosed=!0,o.controller.close(),this.#a(o,t);break;case kt.ERROR:Be(o,"error should have stream controller"),o.controller.error(sn(e.reason)),this.#a(o,t);break;case kt.CANCEL_COMPLETE:e.success?o.cancelCall.resolve():o.cancelCall.reject(sn(e.reason)),this.#a(o,t);break;case kt.CANCEL:if(!c)break;const d=sn(e.reason);Promise.try(c.onCancel||If,d).then(function(){a.postMessage({sourceName:i,targetName:r,stream:kt.CANCEL_COMPLETE,streamId:t,success:!0})},function(f){a.postMessage({sourceName:i,targetName:r,stream:kt.CANCEL_COMPLETE,streamId:t,reason:sn(f)})}),c.sinkCapability.reject(d),c.isCancelled=!0,delete this.streamSinks[t];break;default:throw new Error("Unexpected stream case")}}async#a(e,t){await Promise.allSettled([e.startCall?.promise,e.pullCall?.promise,e.cancelCall?.promise]),delete this.streamControllers[t]}destroy(){this.#e?.abort(),this.#e=null}}class Ap{#e=!1;constructor({enableHWA:e=!1}){this.#e=e}create(e,t){if(e<=0||t<=0)throw new Error("Invalid canvas size");const i=this._createCanvas(e,t);return{canvas:i,context:i.getContext("2d",{willReadFrequently:!this.#e})}}reset(e,t,i){if(!e.canvas)throw new Error("Canvas is not specified");if(t<=0||i<=0)throw new Error("Invalid canvas size");e.canvas.width=t,e.canvas.height=i}destroy(e){if(!e.canvas)throw new Error("Canvas is not specified");e.canvas.width=0,e.canvas.height=0,e.canvas=null,e.context=null}_createCanvas(e,t){Ye("Abstract method `_createCanvas` called.")}}class B0 extends Ap{constructor({ownerDocument:e=globalThis.document,enableHWA:t=!1}){super({enableHWA:t}),this._document=e}_createCanvas(e,t){const i=this._document.createElement("canvas");return i.width=e,i.height=t,i}}class Cp{constructor({baseUrl:e=null,isCompressed:t=!0}){this.baseUrl=e,this.isCompressed=t}async fetch({name:e}){if(!this.baseUrl)throw new Error("Ensure that the `cMapUrl` and `cMapPacked` API parameters are provided.");if(!e)throw new Error("CMap name must be specified.");const t=this.baseUrl+e+(this.isCompressed?".bcmap":"");return this._fetch(t).then(i=>({cMapData:i,isCompressed:this.isCompressed})).catch(i=>{throw new Error(`Unable to load ${this.isCompressed?"binary ":""}CMap at: ${t}`)})}async _fetch(e){Ye("Abstract method `_fetch` called.")}}class Df extends Cp{async _fetch(e){const t=await er(e,this.isCompressed?"arraybuffer":"text");return t instanceof ArrayBuffer?new Uint8Array(t):ia(t)}}class Tp{addFilter(e){return"none"}addHCMFilter(e,t){return"none"}addAlphaFilter(e){return"none"}addLuminosityFilter(e){return"none"}addHighlightHCMFilter(e,t,i,r,a){return"none"}destroy(e=!1){}}class W0 extends Tp{#e;#t;#i;#n;#a;#s;#r=0;constructor({docId:e,ownerDocument:t=globalThis.document}){super(),this.#n=e,this.#a=t}get#o(){return this.#t||=new Map}get#c(){return this.#s||=new Map}get#l(){if(!this.#i){const e=this.#a.createElement("div"),{style:t}=e;t.visibility="hidden",t.contain="strict",t.width=t.height=0,t.position="absolute",t.top=t.left=0,t.zIndex=-1;const i=this.#a.createElementNS(ai,"svg");i.setAttribute("width",0),i.setAttribute("height",0),this.#i=this.#a.createElementNS(ai,"defs"),e.append(i),i.append(this.#i),this.#a.body.append(e)}return this.#i}#u(e){if(e.length===1){const d=e[0],f=new Array(256);for(let g=0;g<256;g++)f[g]=d[g]/255;const p=f.join(",");return[p,p,p]}const[t,i,r]=e,a=new Array(256),o=new Array(256),c=new Array(256);for(let d=0;d<256;d++)a[d]=t[d]/255,o[d]=i[d]/255,c[d]=r[d]/255;return[a.join(","),o.join(","),c.join(",")]}#h(e){if(this.#e===void 0){this.#e="";const t=this.#a.URL;t!==this.#a.baseURI&&(ra(t)?Ie('#createUrl: ignore "data:"-URL for performance reasons.'):this.#e=gd(t,""))}return`url(${this.#e}#${e})`}addFilter(e){if(!e)return"none";let t=this.#o.get(e);if(t)return t;const[i,r,a]=this.#u(e),o=e.length===1?i:`${i}${r}${a}`;if(t=this.#o.get(o),t)return this.#o.set(e,t),t;const c=`g_${this.#n}_transfer_map_${this.#r++}`,d=this.#h(c);this.#o.set(e,d),this.#o.set(o,d);const f=this.#p(c);return this.#m(i,r,a,f),d}addHCMFilter(e,t){const i=`${e}-${t}`,r="base";let a=this.#c.get(r);if(a?.key===i||(a?(a.filter?.remove(),a.key=i,a.url="none",a.filter=null):(a={key:i,url:"none",filter:null},this.#c.set(r,a)),!e||!t))return a.url;const o=this.#b(e);e=ve.makeHexColor(...o);const c=this.#b(t);if(t=ve.makeHexColor(...c),this.#l.style.color="",e==="#000000"&&t==="#ffffff"||e===t)return a.url;const d=new Array(256);for(let x=0;x<=255;x++){const k=x/255;d[x]=k<=.03928?k/12.92:((k+.055)/1.055)**2.4}const f=d.join(","),p=`g_${this.#n}_hcm_filter`,g=a.filter=this.#p(p);this.#m(f,f,f,g),this.#g(g);const w=(x,k)=>{const v=o[x]/255,A=c[x]/255,C=new Array(k+1);for(let T=0;T<=k;T++)C[T]=v+T/k*(A-v);return C.join(",")};return this.#m(w(0,5),w(1,5),w(2,5),g),a.url=this.#h(p),a.url}addAlphaFilter(e){let t=this.#o.get(e);if(t)return t;const[i]=this.#u([e]),r=`alpha_${i}`;if(t=this.#o.get(r),t)return this.#o.set(e,t),t;const a=`g_${this.#n}_alpha_map_${this.#r++}`,o=this.#h(a);this.#o.set(e,o),this.#o.set(r,o);const c=this.#p(a);return this.#y(i,c),o}addLuminosityFilter(e){let t=this.#o.get(e||"luminosity");if(t)return t;let i,r;if(e?([i]=this.#u([e]),r=`luminosity_${i}`):r="luminosity",t=this.#o.get(r),t)return this.#o.set(e,t),t;const a=`g_${this.#n}_luminosity_map_${this.#r++}`,o=this.#h(a);this.#o.set(e,o),this.#o.set(r,o);const c=this.#p(a);return this.#f(c),e&&this.#y(i,c),o}addHighlightHCMFilter(e,t,i,r,a){const o=`${t}-${i}-${r}-${a}`;let c=this.#c.get(e);if(c?.key===o||(c?(c.filter?.remove(),c.key=o,c.url="none",c.filter=null):(c={key:o,url:"none",filter:null},this.#c.set(e,c)),!t||!i))return c.url;const[d,f]=[t,i].map(this.#b.bind(this));let p=Math.round(.2126*d[0]+.7152*d[1]+.0722*d[2]),g=Math.round(.2126*f[0]+.7152*f[1]+.0722*f[2]),[w,x]=[r,a].map(this.#b.bind(this));g<p&&([p,g,w,x]=[g,p,x,w]),this.#l.style.color="";const k=(C,T,R)=>{const E=new Array(256),_=(g-p)/R,M=C/255,N=(T-C)/(255*R);let I=0;for(let G=0;G<=R;G++){const F=Math.round(p+G*_),B=M+G*N;for(let X=I;X<=F;X++)E[X]=B;I=F+1}for(let G=I;G<256;G++)E[G]=E[I-1];return E.join(",")},v=`g_${this.#n}_hcm_${e}_filter`,A=c.filter=this.#p(v);return this.#g(A),this.#m(k(w[0],x[0],5),k(w[1],x[1],5),k(w[2],x[2],5),A),c.url=this.#h(v),c.url}destroy(e=!1){e&&this.#s?.size||(this.#i?.parentNode.parentNode.remove(),this.#i=null,this.#t?.clear(),this.#t=null,this.#s?.clear(),this.#s=null,this.#r=0)}#f(e){const t=this.#a.createElementNS(ai,"feColorMatrix");t.setAttribute("type","matrix"),t.setAttribute("values","0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.3 0.59 0.11 0 0"),e.append(t)}#g(e){const t=this.#a.createElementNS(ai,"feColorMatrix");t.setAttribute("type","matrix"),t.setAttribute("values","0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0 0 0 1 0"),e.append(t)}#p(e){const t=this.#a.createElementNS(ai,"filter");return t.setAttribute("color-interpolation-filters","sRGB"),t.setAttribute("id",e),this.#l.append(t),t}#d(e,t,i){const r=this.#a.createElementNS(ai,t);r.setAttribute("type","discrete"),r.setAttribute("tableValues",i),e.append(r)}#m(e,t,i,r){const a=this.#a.createElementNS(ai,"feComponentTransfer");r.append(a),this.#d(a,"feFuncR",e),this.#d(a,"feFuncG",t),this.#d(a,"feFuncB",i)}#y(e,t){const i=this.#a.createElementNS(ai,"feComponentTransfer");t.append(i),this.#d(i,"feFuncA",e)}#b(e){return this.#l.style.color=e,tr(getComputedStyle(this.#l).getPropertyValue("color"))}}class Ep{constructor({baseUrl:e=null}){this.baseUrl=e}async fetch({filename:e}){if(!this.baseUrl)throw new Error("Ensure that the `standardFontDataUrl` API parameter is provided.");if(!e)throw new Error("Font filename must be specified.");const t=`${this.baseUrl}${e}`;return this._fetch(t).catch(i=>{throw new Error(`Unable to load font data at: ${t}`)})}async _fetch(e){Ye("Abstract method `_fetch` called.")}}class Lf extends Ep{async _fetch(e){const t=await er(e,"arraybuffer");return new Uint8Array(t)}}class Rp{constructor({baseUrl:e=null}){this.baseUrl=e}async fetch({filename:e}){if(!this.baseUrl)throw new Error("Ensure that the `wasmUrl` API parameter is provided.");if(!e)throw new Error("Wasm filename must be specified.");const t=`${this.baseUrl}${e}`;return this._fetch(t).catch(i=>{throw new Error(`Unable to load wasm data at: ${t}`)})}async _fetch(e){Ye("Abstract method `_fetch` called.")}}class jf extends Rp{async _fetch(e){const t=await er(e,"arraybuffer");return new Uint8Array(t)}}zt&&Ie("Please use the `legacy` build in Node.js environments.");async function Ad(h){const t=await process.getBuiltinModule("fs").promises.readFile(h);return new Uint8Array(t)}class H0 extends Tp{}class G0 extends Ap{_createCanvas(e,t){return process.getBuiltinModule("module").createRequire(import.meta.url)("@napi-rs/canvas").createCanvas(e,t)}}class z0 extends Cp{async _fetch(e){return Ad(e)}}class U0 extends Ep{async _fetch(e){return Ad(e)}}class $0 extends Rp{async _fetch(e){return Ad(e)}}const Ws="__forcedDependency",{floor:Ff,ceil:Of}=Math;function _o(h,e,t,i,r,a){h[e*4+0]=Math.min(h[e*4+0],t),h[e*4+1]=Math.min(h[e*4+1],i),h[e*4+2]=Math.max(h[e*4+2],r),h[e*4+3]=Math.max(h[e*4+3],a)}const sd=new Uint32Array(new Uint8Array([255,255,0,0]).buffer)[0];class V0{#e;#t;constructor(e,t){this.#e=e,this.#t=t}get length(){return this.#e.length}isEmpty(e){return this.#e[e]===sd}minX(e){return this.#t[e*4+0]/256}minY(e){return this.#t[e*4+1]/256}maxX(e){return(this.#t[e*4+2]+1)/256}maxY(e){return(this.#t[e*4+3]+1)/256}}const No=(h,e)=>{if(!h)return;let t=h.get(e);return t||(t={dependencies:new Set,isRenderingOperation:!1},h.set(e,t)),t};class K0{#e={__proto__:null};#t={__proto__:null,transform:[],moveText:[],sameLineText:[],[Ws]:[]};#i=new Map;#n=[];#a=[];#s=[[1,0,0,1,0,0]];#r=[-1/0,-1/0,1/0,1/0];#o=new Float64Array([1/0,1/0,-1/0,-1/0]);#c=-1;#l=new Set;#u=new Map;#h=new Map;#f;#g;#p;#d;#m;constructor(e,t,i=!1){this.#f=e.width,this.#g=e.height,this.#y(t),i&&(this.#m=new Map)}growOperationsCount(e){e>=this.#d.length&&this.#y(e,this.#d)}#y(e,t){const i=new ArrayBuffer(e*4);this.#p=new Uint8ClampedArray(i),this.#d=new Uint32Array(i),t&&t.length>0?(this.#d.set(t),this.#d.fill(sd,t.length)):this.#d.fill(sd)}save(e){return this.#e={__proto__:this.#e},this.#t={__proto__:this.#t,transform:{__proto__:this.#t.transform},moveText:{__proto__:this.#t.moveText},sameLineText:{__proto__:this.#t.sameLineText},[Ws]:{__proto__:this.#t[Ws]}},this.#r={__proto__:this.#r},this.#n.push(e),this}restore(e){const t=Object.getPrototypeOf(this.#e);if(t===null)return this;this.#e=t,this.#t=Object.getPrototypeOf(this.#t),this.#r=Object.getPrototypeOf(this.#r);const i=this.#n.pop();return i!==void 0&&(No(this.#m,e)?.dependencies.add(i),this.#d[e]=this.#d[i]),this}recordOpenMarker(e){return this.#n.push(e),this}getOpenMarker(){return this.#n.length===0?null:this.#n.at(-1)}recordCloseMarker(e){const t=this.#n.pop();return t!==void 0&&(No(this.#m,e)?.dependencies.add(t),this.#d[e]=this.#d[t]),this}beginMarkedContent(e){return this.#a.push(e),this}endMarkedContent(e){const t=this.#a.pop();return t!==void 0&&(No(this.#m,e)?.dependencies.add(t),this.#d[e]=this.#d[t]),this}pushBaseTransform(e){return this.#s.push(ve.multiplyByDOMMatrix(this.#s.at(-1),e.getTransform())),this}popBaseTransform(){return this.#s.length>1&&this.#s.pop(),this}recordSimpleData(e,t){return this.#e[e]=t,this}recordIncrementalData(e,t){return this.#t[e].push(t),this}resetIncrementalData(e,t){return this.#t[e].length=0,this}recordNamedData(e,t){return this.#i.set(e,t),this}recordSimpleDataFromNamed(e,t,i){this.#e[e]=this.#i.get(t)??i}recordFutureForcedDependency(e,t){return this.recordIncrementalData(Ws,t),this}inheritSimpleDataAsFutureForcedDependencies(e){for(const t of e)t in this.#e&&this.recordFutureForcedDependency(t,this.#e[t]);return this}inheritPendingDependenciesAsFutureForcedDependencies(){for(const e of this.#l)this.recordFutureForcedDependency(Ws,e);return this}resetBBox(e){return this.#c!==e&&(this.#c=e,this.#o[0]=1/0,this.#o[1]=1/0,this.#o[2]=-1/0,this.#o[3]=-1/0),this}recordClipBox(e,t,i,r,a,o){const c=ve.multiplyByDOMMatrix(this.#s.at(-1),t.getTransform()),d=[1/0,1/0,-1/0,-1/0];ve.axialAlignedBoundingBox([i,a,r,o],c,d);const f=ve.intersect(this.#r,d);return f?(this.#r[0]=f[0],this.#r[1]=f[1],this.#r[2]=f[2],this.#r[3]=f[3]):(this.#r[0]=this.#r[1]=1/0,this.#r[2]=this.#r[3]=-1/0),this}recordBBox(e,t,i,r,a,o){const c=this.#r;if(c[0]===1/0)return this;const d=ve.multiplyByDOMMatrix(this.#s.at(-1),t.getTransform());if(c[0]===-1/0)return ve.axialAlignedBoundingBox([i,a,r,o],d,this.#o),this;const f=[1/0,1/0,-1/0,-1/0];return ve.axialAlignedBoundingBox([i,a,r,o],d,f),this.#o[0]=Math.min(this.#o[0],Math.max(f[0],c[0])),this.#o[1]=Math.min(this.#o[1],Math.max(f[1],c[1])),this.#o[2]=Math.max(this.#o[2],Math.min(f[2],c[2])),this.#o[3]=Math.max(this.#o[3],Math.min(f[3],c[3])),this}recordCharacterBBox(e,t,i,r=1,a=0,o=0,c){const d=i.bbox;let f,p;if(d&&(f=d[2]!==d[0]&&d[3]!==d[1]&&this.#h.get(i),f!==!1&&(p=[0,0,0,0],ve.axialAlignedBoundingBox(d,i.fontMatrix,p),(r!==1||a!==0||o!==0)&&ve.scaleMinMax([r,0,0,-r,a,o],p),f)))return this.recordBBox(e,t,p[0],p[2],p[1],p[3]);if(!c)return this.recordFullPageBBox(e);const g=c();return d&&p&&f===void 0&&(f=p[0]<=a-g.actualBoundingBoxLeft&&p[2]>=a+g.actualBoundingBoxRight&&p[1]<=o-g.actualBoundingBoxAscent&&p[3]>=o+g.actualBoundingBoxDescent,this.#h.set(i,f),f)?this.recordBBox(e,t,p[0],p[2],p[1],p[3]):this.recordBBox(e,t,a-g.actualBoundingBoxLeft,a+g.actualBoundingBoxRight,o-g.actualBoundingBoxAscent,o+g.actualBoundingBoxDescent)}recordFullPageBBox(e){return this.#o[0]=Math.max(0,this.#r[0]),this.#o[1]=Math.max(0,this.#r[1]),this.#o[2]=Math.min(this.#f,this.#r[2]),this.#o[3]=Math.min(this.#g,this.#r[3]),this}getSimpleIndex(e){return this.#e[e]}recordDependencies(e,t){const i=this.#l,r=this.#e,a=this.#t;for(const o of t)o in this.#e?i.add(r[o]):o in a&&a[o].forEach(i.add,i);return this}recordNamedDependency(e,t){return this.#i.has(t)&&this.#l.add(this.#i.get(t)),this}recordOperation(e,t=!1){if(this.recordDependencies(e,[Ws]),this.#m){const i=No(this.#m,e),{dependencies:r}=i;this.#l.forEach(r.add,r),this.#n.forEach(r.add,r),this.#a.forEach(r.add,r),r.delete(e),i.isRenderingOperation=!0}if(this.#c===e){const i=Ff(this.#o[0]*256/this.#f),r=Ff(this.#o[1]*256/this.#g),a=Of(this.#o[2]*256/this.#f),o=Of(this.#o[3]*256/this.#g);_o(this.#p,e,i,r,a,o);for(const c of this.#l)c!==e&&_o(this.#p,c,i,r,a,o);for(const c of this.#n)c!==e&&_o(this.#p,c,i,r,a,o);for(const c of this.#a)c!==e&&_o(this.#p,c,i,r,a,o);t||(this.#l.clear(),this.#c=-1)}return this}recordShowTextOperation(e,t=!1){const i=Array.from(this.#l);this.recordOperation(e,t),this.recordIncrementalData("sameLineText",e);for(const r of i)this.recordIncrementalData("sameLineText",r);return this}bboxToClipBoxDropOperation(e,t=!1){return this.#c===e&&(this.#c=-1,this.#r[0]=Math.max(this.#r[0],this.#o[0]),this.#r[1]=Math.max(this.#r[1],this.#o[1]),this.#r[2]=Math.min(this.#r[2],this.#o[2]),this.#r[3]=Math.min(this.#r[3],this.#o[3]),t||this.#l.clear()),this}_takePendingDependencies(){const e=this.#l;return this.#l=new Set,e}_extractOperation(e){const t=this.#u.get(e);return this.#u.delete(e),t}_pushPendingDependencies(e){for(const t of e)this.#l.add(t)}take(){return this.#h.clear(),new V0(this.#d,this.#p)}takeDebugMetadata(){return this.#m}}class Bo{#e;#t;#i;#n=0;#a=0;constructor(e,t,i){if(e instanceof Bo&&e.#i===!!i)return e;this.#e=e,this.#t=t,this.#i=!!i}growOperationsCount(){throw new Error("Unreachable")}save(e){return this.#a++,this.#e.save(this.#t),this}restore(e){return this.#a>0&&(this.#e.restore(this.#t),this.#a--),this}recordOpenMarker(e){return this.#n++,this}getOpenMarker(){return this.#n>0?this.#t:this.#e.getOpenMarker()}recordCloseMarker(e){return this.#n--,this}beginMarkedContent(e){return this}endMarkedContent(e){return this}pushBaseTransform(e){return this.#e.pushBaseTransform(e),this}popBaseTransform(){return this.#e.popBaseTransform(),this}recordSimpleData(e,t){return this.#e.recordSimpleData(e,this.#t),this}recordIncrementalData(e,t){return this.#e.recordIncrementalData(e,this.#t),this}resetIncrementalData(e,t){return this.#e.resetIncrementalData(e,this.#t),this}recordNamedData(e,t){return this}recordSimpleDataFromNamed(e,t,i){return this.#e.recordSimpleDataFromNamed(e,t,this.#t),this}recordFutureForcedDependency(e,t){return this.#e.recordFutureForcedDependency(e,this.#t),this}inheritSimpleDataAsFutureForcedDependencies(e){return this.#e.inheritSimpleDataAsFutureForcedDependencies(e),this}inheritPendingDependenciesAsFutureForcedDependencies(){return this.#e.inheritPendingDependenciesAsFutureForcedDependencies(),this}resetBBox(e){return this.#i||this.#e.resetBBox(this.#t),this}recordClipBox(e,t,i,r,a,o){return this.#i||this.#e.recordClipBox(this.#t,t,i,r,a,o),this}recordBBox(e,t,i,r,a,o){return this.#i||this.#e.recordBBox(this.#t,t,i,r,a,o),this}recordCharacterBBox(e,t,i,r,a,o,c){return this.#i||this.#e.recordCharacterBBox(this.#t,t,i,r,a,o,c),this}recordFullPageBBox(e){return this.#i||this.#e.recordFullPageBBox(this.#t),this}getSimpleIndex(e){return this.#e.getSimpleIndex(e)}recordDependencies(e,t){return this.#e.recordDependencies(this.#t,t),this}recordNamedDependency(e,t){return this.#e.recordNamedDependency(this.#t,t),this}recordOperation(e){return this.#e.recordOperation(this.#t,!0),this}recordShowTextOperation(e){return this.#e.recordShowTextOperation(this.#t,!0),this}bboxToClipBoxDropOperation(e){return this.#i||this.#e.bboxToClipBoxDropOperation(this.#t,!0),this}take(){throw new Error("Unreachable")}takeDebugMetadata(){throw new Error("Unreachable")}}const An={stroke:["path","transform","filter","strokeColor","strokeAlpha","lineWidth","lineCap","lineJoin","miterLimit","dash"],fill:["path","transform","filter","fillColor","fillAlpha","globalCompositeOperation","SMask"],imageXObject:["transform","SMask","filter","fillAlpha","strokeAlpha","globalCompositeOperation"],rawFillPath:["filter","fillColor","fillAlpha"],showText:["transform","leading","charSpacing","wordSpacing","hScale","textRise","moveText","textMatrix","font","fontObj","filter","fillColor","textRenderingMode","SMask","fillAlpha","strokeAlpha","globalCompositeOperation","sameLineText"],transform:["transform"],transformAndFill:["transform","fillColor"]},Lt={FILL:"Fill",STROKE:"Stroke",SHADING:"Shading"};function rd(h,e){if(!e)return;const t=e[2]-e[0],i=e[3]-e[1],r=new Path2D;r.rect(e[0],e[1],t,i),h.clip(r)}class Cd{isModifyingCurrentTransform(){return!1}getPattern(){Ye("Abstract method `getPattern` called.")}}class Y0 extends Cd{constructor(e){super(),this._type=e[1],this._bbox=e[2],this._colorStops=e[3],this._p0=e[4],this._p1=e[5],this._r0=e[6],this._r1=e[7],this.matrix=null}_createGradient(e){let t;this._type==="axial"?t=e.createLinearGradient(this._p0[0],this._p0[1],this._p1[0],this._p1[1]):this._type==="radial"&&(t=e.createRadialGradient(this._p0[0],this._p0[1],this._r0,this._p1[0],this._p1[1],this._r1));for(const i of this._colorStops)t.addColorStop(i[0],i[1]);return t}getPattern(e,t,i,r){let a;if(r===Lt.STROKE||r===Lt.FILL){const o=t.current.getClippedPathBoundingBox(r,ct(e))||[0,0,0,0],c=Math.ceil(o[2]-o[0])||1,d=Math.ceil(o[3]-o[1])||1,f=t.cachedCanvases.getCanvas("pattern",c,d),p=f.context;p.clearRect(0,0,p.canvas.width,p.canvas.height),p.beginPath(),p.rect(0,0,p.canvas.width,p.canvas.height),p.translate(-o[0],-o[1]),i=ve.transform(i,[1,0,0,1,o[0],o[1]]),p.transform(...t.baseTransform),this.matrix&&p.transform(...this.matrix),rd(p,this._bbox),p.fillStyle=this._createGradient(p),p.fill(),a=e.createPattern(f.canvas,"no-repeat");const g=new DOMMatrix(i);a.setTransform(g)}else rd(e,this._bbox),a=this._createGradient(e);return a}}function Kc(h,e,t,i,r,a,o,c){const d=e.coords,f=e.colors,p=h.data,g=h.width*4;let w;d[t+1]>d[i+1]&&(w=t,t=i,i=w,w=a,a=o,o=w),d[i+1]>d[r+1]&&(w=i,i=r,r=w,w=o,o=c,c=w),d[t+1]>d[i+1]&&(w=t,t=i,i=w,w=a,a=o,o=w);const x=(d[t]+e.offsetX)*e.scaleX,k=(d[t+1]+e.offsetY)*e.scaleY,v=(d[i]+e.offsetX)*e.scaleX,A=(d[i+1]+e.offsetY)*e.scaleY,C=(d[r]+e.offsetX)*e.scaleX,T=(d[r+1]+e.offsetY)*e.scaleY;if(k>=T)return;const R=f[a],E=f[a+1],_=f[a+2],M=f[o],N=f[o+1],I=f[o+2],G=f[c],F=f[c+1],B=f[c+2],X=Math.round(k),oe=Math.round(T);let le,z,K,Q,V,ce,re,j;for(let $=X;$<=oe;$++){if($<A){const ye=$<k?0:(k-$)/(k-A);le=x-(x-v)*ye,z=R-(R-M)*ye,K=E-(E-N)*ye,Q=_-(_-I)*ye}else{let ye;$>T?ye=1:A===T?ye=0:ye=(A-$)/(A-T),le=v-(v-C)*ye,z=M-(M-G)*ye,K=N-(N-F)*ye,Q=I-(I-B)*ye}let se;$<k?se=0:$>T?se=1:se=(k-$)/(k-T),V=x-(x-C)*se,ce=R-(R-G)*se,re=E-(E-F)*se,j=_-(_-B)*se;const ue=Math.round(Math.min(le,V)),te=Math.round(Math.max(le,V));let xe=g*$+ue*4;for(let ye=ue;ye<=te;ye++)se=(le-ye)/(le-V),se<0?se=0:se>1&&(se=1),p[xe++]=z-(z-ce)*se|0,p[xe++]=K-(K-re)*se|0,p[xe++]=Q-(Q-j)*se|0,p[xe++]=255}}function X0(h,e,t){const i=e.coords,r=e.colors;let a,o;switch(e.type){case"lattice":const c=e.verticesPerRow,d=Math.floor(i.length/c)-1,f=c-1;for(a=0;a<d;a++){let p=a*c;for(let g=0;g<f;g++,p++)Kc(h,t,i[p],i[p+1],i[p+c],r[p],r[p+1],r[p+c]),Kc(h,t,i[p+c+1],i[p+1],i[p+c],r[p+c+1],r[p+1],r[p+c])}break;case"triangles":for(a=0,o=i.length;a<o;a+=3)Kc(h,t,i[a],i[a+1],i[a+2],r[a],r[a+1],r[a+2]);break;default:throw new Error("illegal figure")}}class Q0 extends Cd{constructor(e){super(),this._coords=e[2],this._colors=e[3],this._figures=e[4],this._bounds=e[5],this._bbox=e[6],this._background=e[7],this.matrix=null}_createMeshCanvas(e,t,i){const c=Math.floor(this._bounds[0]),d=Math.floor(this._bounds[1]),f=Math.ceil(this._bounds[2])-c,p=Math.ceil(this._bounds[3])-d,g=Math.min(Math.ceil(Math.abs(f*e[0]*1.1)),3e3),w=Math.min(Math.ceil(Math.abs(p*e[1]*1.1)),3e3),x=f/g,k=p/w,v={coords:this._coords,colors:this._colors,offsetX:-c,offsetY:-d,scaleX:1/x,scaleY:1/k},A=g+4,C=w+4,T=i.getCanvas("mesh",A,C),R=T.context,E=R.createImageData(g,w);if(t){const M=E.data;for(let N=0,I=M.length;N<I;N+=4)M[N]=t[0],M[N+1]=t[1],M[N+2]=t[2],M[N+3]=255}for(const M of this._figures)X0(E,M,v);return R.putImageData(E,2,2),{canvas:T.canvas,offsetX:c-2*x,offsetY:d-2*k,scaleX:x,scaleY:k}}isModifyingCurrentTransform(){return!0}getPattern(e,t,i,r){rd(e,this._bbox);const a=new Float32Array(2);if(r===Lt.SHADING)ve.singularValueDecompose2dScale(ct(e),a);else if(this.matrix){ve.singularValueDecompose2dScale(this.matrix,a);const[c,d]=a;ve.singularValueDecompose2dScale(t.baseTransform,a),a[0]*=c,a[1]*=d}else ve.singularValueDecompose2dScale(t.baseTransform,a);const o=this._createMeshCanvas(a,r===Lt.SHADING?null:this._background,t.cachedCanvases);return r!==Lt.SHADING&&(e.setTransform(...t.baseTransform),this.matrix&&e.transform(...this.matrix)),e.translate(o.offsetX,o.offsetY),e.scale(o.scaleX,o.scaleY),e.createPattern(o.canvas,"no-repeat")}}class J0 extends Cd{getPattern(){return"hotpink"}}function Z0(h){switch(h[0]){case"RadialAxial":return new Y0(h);case"Mesh":return new Q0(h);case"Dummy":return new J0}throw new Error(`Unknown IR type: ${h[0]}`)}const qf={COLORED:1,UNCOLORED:2};class Td{static MAX_PATTERN_SIZE=3e3;constructor(e,t,i,r){this.color=e[1],this.operatorList=e[2],this.matrix=e[3],this.bbox=e[4],this.xstep=e[5],this.ystep=e[6],this.paintType=e[7],this.tilingType=e[8],this.ctx=t,this.canvasGraphicsFactory=i,this.baseTransform=r}createPatternCanvas(e,t){const{bbox:i,operatorList:r,paintType:a,tilingType:o,color:c,canvasGraphicsFactory:d}=this;let{xstep:f,ystep:p}=this;f=Math.abs(f),p=Math.abs(p),Go("TilingType: "+o);const g=i[0],w=i[1],x=i[2],k=i[3],v=x-g,A=k-w,C=new Float32Array(2);ve.singularValueDecompose2dScale(this.matrix,C);const[T,R]=C;ve.singularValueDecompose2dScale(this.baseTransform,C);const E=T*C[0],_=R*C[1];let M=v,N=A,I=!1,G=!1;const F=Math.ceil(f*E),B=Math.ceil(p*_),X=Math.ceil(v*E),oe=Math.ceil(A*_);F>=X?M=f:I=!0,B>=oe?N=p:G=!0;const le=this.getSizeAndScale(M,this.ctx.canvas.width,E),z=this.getSizeAndScale(N,this.ctx.canvas.height,_),K=e.cachedCanvases.getCanvas("pattern",le.size,z.size),Q=K.context,V=d.createCanvasGraphics(Q,t);if(V.groupLevel=e.groupLevel,this.setFillAndStrokeStyleToContext(V,a,c),Q.translate(-le.scale*g,-z.scale*w),V.transform(0,le.scale,0,0,z.scale,0,0),Q.save(),V.dependencyTracker?.save(),this.clipBbox(V,g,w,x,k),V.baseTransform=ct(V.ctx),V.executeOperatorList(r),V.endDrawing(),V.dependencyTracker?.restore(),Q.restore(),I||G){const ce=K.canvas;I&&(M=f),G&&(N=p);const re=this.getSizeAndScale(M,this.ctx.canvas.width,E),j=this.getSizeAndScale(N,this.ctx.canvas.height,_),$=re.size,se=j.size,ue=e.cachedCanvases.getCanvas("pattern-workaround",$,se),te=ue.context,xe=I?Math.floor(v/f):0,ye=G?Math.floor(A/p):0;for(let _e=0;_e<=xe;_e++)for(let J=0;J<=ye;J++)te.drawImage(ce,$*_e,se*J,$,se,0,0,$,se);return{canvas:ue.canvas,scaleX:re.scale,scaleY:j.scale,offsetX:g,offsetY:w}}return{canvas:K.canvas,scaleX:le.scale,scaleY:z.scale,offsetX:g,offsetY:w}}getSizeAndScale(e,t,i){const r=Math.max(Td.MAX_PATTERN_SIZE,t);let a=Math.ceil(e*i);return a>=r?a=r:i=a/e,{scale:i,size:a}}clipBbox(e,t,i,r,a){const o=r-t,c=a-i;e.ctx.rect(t,i,o,c),ve.axialAlignedBoundingBox([t,i,r,a],ct(e.ctx),e.current.minMax),e.clip(),e.endPath()}setFillAndStrokeStyleToContext(e,t,i){const r=e.ctx,a=e.current;switch(t){case qf.COLORED:const{fillStyle:o,strokeStyle:c}=this.ctx;r.fillStyle=a.fillColor=o,r.strokeStyle=a.strokeColor=c;break;case qf.UNCOLORED:r.fillStyle=r.strokeStyle=i,a.fillColor=a.strokeColor=i;break;default:throw new v0(`Unsupported paint type: ${t}`)}}isModifyingCurrentTransform(){return!1}getPattern(e,t,i,r,a){let o=i;r!==Lt.SHADING&&(o=ve.transform(o,t.baseTransform),this.matrix&&(o=ve.transform(o,this.matrix)));const c=this.createPatternCanvas(t,a);let d=new DOMMatrix(o);d=d.translate(c.offsetX,c.offsetY),d=d.scale(1/c.scaleX,1/c.scaleY);const f=e.createPattern(c.canvas,"repeat");return f.setTransform(d),f}}function ey({src:h,srcPos:e=0,dest:t,width:i,height:r,nonBlackColor:a=4294967295,inverseDecode:o=!1}){const c=Pt.isLittleEndian?4278190080:255,[d,f]=o?[a,c]:[c,a],p=i>>3,g=i&7,w=h.length;t=new Uint32Array(t.buffer);let x=0;for(let k=0;k<r;k++){for(const A=e+p;e<A;e++){const C=e<w?h[e]:255;t[x++]=C&128?f:d,t[x++]=C&64?f:d,t[x++]=C&32?f:d,t[x++]=C&16?f:d,t[x++]=C&8?f:d,t[x++]=C&4?f:d,t[x++]=C&2?f:d,t[x++]=C&1?f:d}if(g===0)continue;const v=e<w?h[e++]:255;for(let A=0;A<g;A++)t[x++]=v&1<<7-A?f:d}return{srcPos:e,destPos:x}}const Bf=16,Wf=100,ty=15,Hf=10,rn=16,Yc=new DOMMatrix,mn=new Float32Array(2),zs=new Float32Array([1/0,1/0,-1/0,-1/0]);function ny(h,e){if(h._removeMirroring)throw new Error("Context is already forwarding operations.");h.__originalSave=h.save,h.__originalRestore=h.restore,h.__originalRotate=h.rotate,h.__originalScale=h.scale,h.__originalTranslate=h.translate,h.__originalTransform=h.transform,h.__originalSetTransform=h.setTransform,h.__originalResetTransform=h.resetTransform,h.__originalClip=h.clip,h.__originalMoveTo=h.moveTo,h.__originalLineTo=h.lineTo,h.__originalBezierCurveTo=h.bezierCurveTo,h.__originalRect=h.rect,h.__originalClosePath=h.closePath,h.__originalBeginPath=h.beginPath,h._removeMirroring=()=>{h.save=h.__originalSave,h.restore=h.__originalRestore,h.rotate=h.__originalRotate,h.scale=h.__originalScale,h.translate=h.__originalTranslate,h.transform=h.__originalTransform,h.setTransform=h.__originalSetTransform,h.resetTransform=h.__originalResetTransform,h.clip=h.__originalClip,h.moveTo=h.__originalMoveTo,h.lineTo=h.__originalLineTo,h.bezierCurveTo=h.__originalBezierCurveTo,h.rect=h.__originalRect,h.closePath=h.__originalClosePath,h.beginPath=h.__originalBeginPath,delete h._removeMirroring},h.save=function(){e.save(),this.__originalSave()},h.restore=function(){e.restore(),this.__originalRestore()},h.translate=function(t,i){e.translate(t,i),this.__originalTranslate(t,i)},h.scale=function(t,i){e.scale(t,i),this.__originalScale(t,i)},h.transform=function(t,i,r,a,o,c){e.transform(t,i,r,a,o,c),this.__originalTransform(t,i,r,a,o,c)},h.setTransform=function(t,i,r,a,o,c){e.setTransform(t,i,r,a,o,c),this.__originalSetTransform(t,i,r,a,o,c)},h.resetTransform=function(){e.resetTransform(),this.__originalResetTransform()},h.rotate=function(t){e.rotate(t),this.__originalRotate(t)},h.clip=function(t){e.clip(t),this.__originalClip(t)},h.moveTo=function(t,i){e.moveTo(t,i),this.__originalMoveTo(t,i)},h.lineTo=function(t,i){e.lineTo(t,i),this.__originalLineTo(t,i)},h.bezierCurveTo=function(t,i,r,a,o,c){e.bezierCurveTo(t,i,r,a,o,c),this.__originalBezierCurveTo(t,i,r,a,o,c)},h.rect=function(t,i,r,a){e.rect(t,i,r,a),this.__originalRect(t,i,r,a)},h.closePath=function(){e.closePath(),this.__originalClosePath()},h.beginPath=function(){e.beginPath(),this.__originalBeginPath()}}class iy{constructor(e){this.canvasFactory=e,this.cache=Object.create(null)}getCanvas(e,t,i){let r;return this.cache[e]!==void 0?(r=this.cache[e],this.canvasFactory.reset(r,t,i)):(r=this.canvasFactory.create(t,i),this.cache[e]=r),r}delete(e){delete this.cache[e]}clear(){for(const e in this.cache){const t=this.cache[e];this.canvasFactory.destroy(t),delete this.cache[e]}}}function Po(h,e,t,i,r,a,o,c,d,f){const[p,g,w,x,k,v]=ct(h);if(g===0&&w===0){const T=o*p+k,R=Math.round(T),E=c*x+v,_=Math.round(E),M=(o+d)*p+k,N=Math.abs(Math.round(M)-R)||1,I=(c+f)*x+v,G=Math.abs(Math.round(I)-_)||1;return h.setTransform(Math.sign(p),0,0,Math.sign(x),R,_),h.drawImage(e,t,i,r,a,0,0,N,G),h.setTransform(p,g,w,x,k,v),[N,G]}if(p===0&&x===0){const T=c*w+k,R=Math.round(T),E=o*g+v,_=Math.round(E),M=(c+f)*w+k,N=Math.abs(Math.round(M)-R)||1,I=(o+d)*g+v,G=Math.abs(Math.round(I)-_)||1;return h.setTransform(0,Math.sign(g),Math.sign(w),0,R,_),h.drawImage(e,t,i,r,a,0,0,G,N),h.setTransform(p,g,w,x,k,v),[G,N]}h.drawImage(e,t,i,r,a,o,c,d,f);const A=Math.hypot(p,g),C=Math.hypot(w,x);return[A*d,C*f]}class Gf{alphaIsShape=!1;fontSize=0;fontSizeScale=1;textMatrix=null;textMatrixScale=1;fontMatrix=ed;leading=0;x=0;y=0;lineX=0;lineY=0;charSpacing=0;wordSpacing=0;textHScale=1;textRenderingMode=Dt.FILL;textRise=0;fillColor="#000000";strokeColor="#000000";patternFill=!1;patternStroke=!1;fillAlpha=1;strokeAlpha=1;lineWidth=1;activeSMask=null;transferMaps="none";constructor(e,t,i){i?.(this),this.clipBox=new Float32Array([0,0,e,t]),this.minMax=zs.slice()}clone(){const e=Object.create(this);return e.clipBox=this.clipBox.slice(),e.minMax=this.minMax.slice(),e}getPathBoundingBox(e=Lt.FILL,t=null){const i=this.minMax.slice();if(e===Lt.STROKE){t||Ye("Stroke bounding box must include transform."),ve.singularValueDecompose2dScale(t,mn);const r=mn[0]*this.lineWidth/2,a=mn[1]*this.lineWidth/2;i[0]-=r,i[1]-=a,i[2]+=r,i[3]+=a}return i}updateClipFromPath(){const e=ve.intersect(this.clipBox,this.getPathBoundingBox());this.startNewPathAndClipBox(e||[0,0,0,0])}isEmptyClip(){return this.minMax[0]===1/0}startNewPathAndClipBox(e){this.clipBox.set(e,0),this.minMax.set(zs,0)}getClippedPathBoundingBox(e=Lt.FILL,t=null){return ve.intersect(this.clipBox,this.getPathBoundingBox(e,t))}}function zf(h,e){if(e instanceof ImageData){h.putImageData(e,0,0);return}const t=e.height,i=e.width,r=t%rn,a=(t-r)/rn,o=r===0?a:a+1,c=h.createImageData(i,rn);let d=0,f;const p=e.data,g=c.data;let w,x,k,v;if(e.kind===Kr.GRAYSCALE_1BPP){const A=p.byteLength,C=new Uint32Array(g.buffer,0,g.byteLength>>2),T=C.length,R=i+7>>3,E=4294967295,_=Pt.isLittleEndian?4278190080:255;for(w=0;w<o;w++){for(k=w<a?rn:r,f=0,x=0;x<k;x++){const M=A-d;let N=0;const I=M>R?i:M*8-7,G=I&-8;let F=0,B=0;for(;N<G;N+=8)B=p[d++],C[f++]=B&128?E:_,C[f++]=B&64?E:_,C[f++]=B&32?E:_,C[f++]=B&16?E:_,C[f++]=B&8?E:_,C[f++]=B&4?E:_,C[f++]=B&2?E:_,C[f++]=B&1?E:_;for(;N<I;N++)F===0&&(B=p[d++],F=128),C[f++]=B&F?E:_,F>>=1}for(;f<T;)C[f++]=0;h.putImageData(c,0,w*rn)}}else if(e.kind===Kr.RGBA_32BPP){for(x=0,v=i*rn*4,w=0;w<a;w++)g.set(p.subarray(d,d+v)),d+=v,h.putImageData(c,0,x),x+=rn;w<o&&(v=i*r*4,g.set(p.subarray(d,d+v)),h.putImageData(c,0,x))}else if(e.kind===Kr.RGB_24BPP)for(k=rn,v=i*k,w=0;w<o;w++){for(w>=a&&(k=r,v=i*k),f=0,x=v;x--;)g[f++]=p[d++],g[f++]=p[d++],g[f++]=p[d++],g[f++]=255;h.putImageData(c,0,w*rn)}else throw new Error(`bad image kind: ${e.kind}`)}function Uf(h,e){if(e.bitmap){h.drawImage(e.bitmap,0,0);return}const t=e.height,i=e.width,r=t%rn,a=(t-r)/rn,o=r===0?a:a+1,c=h.createImageData(i,rn);let d=0;const f=e.data,p=c.data;for(let g=0;g<o;g++){const w=g<a?rn:r;({srcPos:d}=ey({src:f,srcPos:d,dest:p,width:i,height:w,nonBlackColor:0})),h.putImageData(c,0,g*rn)}}function Wr(h,e){const t=["strokeStyle","fillStyle","fillRule","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","globalCompositeOperation","font","filter"];for(const i of t)h[i]!==void 0&&(e[i]=h[i]);h.setLineDash!==void 0&&(e.setLineDash(h.getLineDash()),e.lineDashOffset=h.lineDashOffset)}function Mo(h){h.strokeStyle=h.fillStyle="#000000",h.fillRule="nonzero",h.globalAlpha=1,h.lineWidth=1,h.lineCap="butt",h.lineJoin="miter",h.miterLimit=10,h.globalCompositeOperation="source-over",h.font="10px sans-serif",h.setLineDash!==void 0&&(h.setLineDash([]),h.lineDashOffset=0);const{filter:e}=h;e!=="none"&&e!==""&&(h.filter="none")}function $f(h,e){if(e)return!0;ve.singularValueDecompose2dScale(h,mn);const t=Math.fround(Ln.pixelRatio*ds.PDF_TO_CSS_UNITS);return mn[0]<=t&&mn[1]<=t}const sy=["butt","round","square"],ry=["miter","round","bevel"],ay={},Vf={};class $s{constructor(e,t,i,r,a,{optionalContentConfig:o,markedContentStack:c=null},d,f,p){this.ctx=e,this.current=new Gf(this.ctx.canvas.width,this.ctx.canvas.height),this.stateStack=[],this.pendingClip=null,this.pendingEOFill=!1,this.res=null,this.xobjs=null,this.commonObjs=t,this.objs=i,this.canvasFactory=r,this.filterFactory=a,this.groupStack=[],this.baseTransform=null,this.baseTransformStack=[],this.groupLevel=0,this.smaskStack=[],this.smaskCounter=0,this.tempSMask=null,this.suspendedCtx=null,this.contentVisible=!0,this.markedContentStack=c||[],this.optionalContentConfig=o,this.cachedCanvases=new iy(this.canvasFactory),this.cachedPatterns=new Map,this.annotationCanvasMap=d,this.viewportScale=1,this.outputScaleX=1,this.outputScaleY=1,this.pageColors=f,this._cachedScaleForStroking=[-1,0],this._cachedGetSinglePixelWidth=null,this._cachedBitmapsMap=new Map,this.dependencyTracker=p??null}getObject(e,t,i=null){return typeof t=="string"?(this.dependencyTracker?.recordNamedDependency(e,t),t.startsWith("g_")?this.commonObjs.get(t):this.objs.get(t)):i}beginDrawing({transform:e,viewport:t,transparency:i=!1,background:r=null}){const a=this.ctx.canvas.width,o=this.ctx.canvas.height,c=this.ctx.fillStyle;if(this.ctx.fillStyle=r||"#ffffff",this.ctx.fillRect(0,0,a,o),this.ctx.fillStyle=c,i){const d=this.cachedCanvases.getCanvas("transparent",a,o);this.compositeCtx=this.ctx,this.transparentCanvas=d.canvas,this.ctx=d.context,this.ctx.save(),this.ctx.transform(...ct(this.compositeCtx))}this.ctx.save(),Mo(this.ctx),e&&(this.ctx.transform(...e),this.outputScaleX=e[0],this.outputScaleY=e[0]),this.ctx.transform(...t.transform),this.viewportScale=t.scale,this.baseTransform=ct(this.ctx)}executeOperatorList(e,t,i,r,a){const o=e.argsArray,c=e.fnArray;let d=t||0;const f=o.length;if(f===d)return d;const p=f-d>Hf&&typeof i=="function",g=p?Date.now()+ty:0;let w=0;const x=this.commonObjs,k=this.objs;let v,A;for(;;){if(r!==void 0&&d===r.nextBreakPoint)return r.breakIt(d,i),d;if(!a||a(d))if(v=c[d],A=o[d]??null,v!==Js.dependency)A===null?this[v](d):this[v](d,...A);else for(const C of A){this.dependencyTracker?.recordNamedData(C,d);const T=C.startsWith("g_")?x:k;if(!T.has(C))return T.get(C,i),d}if(d++,d===f)return d;if(p&&++w>Hf){if(Date.now()>g)return i(),d;w=0}}}#e(){for(;this.stateStack.length||this.inSMaskMode;)this.restore();this.current.activeSMask=null,this.ctx.restore(),this.transparentCanvas&&(this.ctx=this.compositeCtx,this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.drawImage(this.transparentCanvas,0,0),this.ctx.restore(),this.transparentCanvas=null)}endDrawing(){this.#e(),this.cachedCanvases.clear(),this.cachedPatterns.clear();for(const e of this._cachedBitmapsMap.values()){for(const t of e.values())typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement&&(t.width=t.height=0);e.clear()}this._cachedBitmapsMap.clear(),this.#t()}#t(){if(this.pageColors){const e=this.filterFactory.addHCMFilter(this.pageColors.foreground,this.pageColors.background);if(e!=="none"){const t=this.ctx.filter;this.ctx.filter=e,this.ctx.drawImage(this.ctx.canvas,0,0),this.ctx.filter=t}}}_scaleImage(e,t){const i=e.width??e.displayWidth,r=e.height??e.displayHeight;let a=Math.max(Math.hypot(t[0],t[1]),1),o=Math.max(Math.hypot(t[2],t[3]),1),c=i,d=r,f="prescale1",p,g;for(;a>2&&c>1||o>2&&d>1;){let w=c,x=d;a>2&&c>1&&(w=c>=16384?Math.floor(c/2)-1||1:Math.ceil(c/2),a/=c/w),o>2&&d>1&&(x=d>=16384?Math.floor(d/2)-1||1:Math.ceil(d)/2,o/=d/x),p=this.cachedCanvases.getCanvas(f,w,x),g=p.context,g.clearRect(0,0,w,x),g.drawImage(e,0,0,c,d,0,0,w,x),e=p.canvas,c=w,d=x,f=f==="prescale1"?"prescale2":"prescale1"}return{img:e,paintWidth:c,paintHeight:d}}_createMaskCanvas(e,t){const i=this.ctx,{width:r,height:a}=t,o=this.current.fillColor,c=this.current.patternFill,d=ct(i);let f,p,g,w;if((t.bitmap||t.data)&&t.count>1){const F=t.bitmap||t.data.buffer;p=JSON.stringify(c?d:[d.slice(0,4),o]),f=this._cachedBitmapsMap.get(F),f||(f=new Map,this._cachedBitmapsMap.set(F,f));const B=f.get(p);if(B&&!c){const X=Math.round(Math.min(d[0],d[2])+d[4]),oe=Math.round(Math.min(d[1],d[3])+d[5]);return this.dependencyTracker?.recordDependencies(e,An.transformAndFill),{canvas:B,offsetX:X,offsetY:oe}}g=B}g||(w=this.cachedCanvases.getCanvas("maskCanvas",r,a),Uf(w.context,t));let x=ve.transform(d,[1/r,0,0,-1/a,0,0]);x=ve.transform(x,[1,0,0,1,0,-a]);const k=zs.slice();ve.axialAlignedBoundingBox([0,0,r,a],x,k);const[v,A,C,T]=k,R=Math.round(C-v)||1,E=Math.round(T-A)||1,_=this.cachedCanvases.getCanvas("fillCanvas",R,E),M=_.context,N=v,I=A;M.translate(-N,-I),M.transform(...x),g||(g=this._scaleImage(w.canvas,zn(M)),g=g.img,f&&c&&f.set(p,g)),M.imageSmoothingEnabled=$f(ct(M),t.interpolate),Po(M,g,0,0,g.width,g.height,0,0,r,a),M.globalCompositeOperation="source-in";const G=ve.transform(zn(M),[1,0,0,1,-N,-I]);return M.fillStyle=c?o.getPattern(i,this,G,Lt.FILL,e):o,M.fillRect(0,0,r,a),f&&!c&&(this.cachedCanvases.delete("fillCanvas"),f.set(p,_.canvas)),this.dependencyTracker?.recordDependencies(e,An.transformAndFill),{canvas:_.canvas,offsetX:Math.round(N),offsetY:Math.round(I)}}setLineWidth(e,t){this.dependencyTracker?.recordSimpleData("lineWidth",e),t!==this.current.lineWidth&&(this._cachedScaleForStroking[0]=-1),this.current.lineWidth=t,this.ctx.lineWidth=t}setLineCap(e,t){this.dependencyTracker?.recordSimpleData("lineCap",e),this.ctx.lineCap=sy[t]}setLineJoin(e,t){this.dependencyTracker?.recordSimpleData("lineJoin",e),this.ctx.lineJoin=ry[t]}setMiterLimit(e,t){this.dependencyTracker?.recordSimpleData("miterLimit",e),this.ctx.miterLimit=t}setDash(e,t,i){this.dependencyTracker?.recordSimpleData("dash",e);const r=this.ctx;r.setLineDash!==void 0&&(r.setLineDash(t),r.lineDashOffset=i)}setRenderingIntent(e,t){}setFlatness(e,t){}setGState(e,t){for(const[i,r]of t)switch(i){case"LW":this.setLineWidth(e,r);break;case"LC":this.setLineCap(e,r);break;case"LJ":this.setLineJoin(e,r);break;case"ML":this.setMiterLimit(e,r);break;case"D":this.setDash(e,r[0],r[1]);break;case"RI":this.setRenderingIntent(e,r);break;case"FL":this.setFlatness(e,r);break;case"Font":this.setFont(e,r[0],r[1]);break;case"CA":this.dependencyTracker?.recordSimpleData("strokeAlpha",e),this.current.strokeAlpha=r;break;case"ca":this.dependencyTracker?.recordSimpleData("fillAlpha",e),this.ctx.globalAlpha=this.current.fillAlpha=r;break;case"BM":this.dependencyTracker?.recordSimpleData("globalCompositeOperation",e),this.ctx.globalCompositeOperation=r;break;case"SMask":this.dependencyTracker?.recordSimpleData("SMask",e),this.current.activeSMask=r?this.tempSMask:null,this.tempSMask=null,this.checkSMaskState();break;case"TR":this.dependencyTracker?.recordSimpleData("filter",e),this.ctx.filter=this.current.transferMaps=this.filterFactory.addFilter(r);break}}get inSMaskMode(){return!!this.suspendedCtx}checkSMaskState(){const e=this.inSMaskMode;this.current.activeSMask&&!e?this.beginSMaskMode():!this.current.activeSMask&&e&&this.endSMaskMode()}beginSMaskMode(e){if(this.inSMaskMode)throw new Error("beginSMaskMode called while already in smask mode");const t=this.ctx.canvas.width,i=this.ctx.canvas.height,r="smaskGroupAt"+this.groupLevel,a=this.cachedCanvases.getCanvas(r,t,i);this.suspendedCtx=this.ctx;const o=this.ctx=a.context;o.setTransform(this.suspendedCtx.getTransform()),Wr(this.suspendedCtx,o),ny(o,this.suspendedCtx),this.setGState(e,[["BM","source-over"]])}endSMaskMode(){if(!this.inSMaskMode)throw new Error("endSMaskMode called while not in smask mode");this.ctx._removeMirroring(),Wr(this.ctx,this.suspendedCtx),this.ctx=this.suspendedCtx,this.suspendedCtx=null}compose(e){if(!this.current.activeSMask)return;e?(e[0]=Math.floor(e[0]),e[1]=Math.floor(e[1]),e[2]=Math.ceil(e[2]),e[3]=Math.ceil(e[3])):e=[0,0,this.ctx.canvas.width,this.ctx.canvas.height];const t=this.current.activeSMask,i=this.suspendedCtx;this.composeSMask(i,t,this.ctx,e),this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore()}composeSMask(e,t,i,r){const a=r[0],o=r[1],c=r[2]-a,d=r[3]-o;c===0||d===0||(this.genericComposeSMask(t.context,i,c,d,t.subtype,t.backdrop,t.transferMap,a,o,t.offsetX,t.offsetY),e.save(),e.globalAlpha=1,e.globalCompositeOperation="source-over",e.setTransform(1,0,0,1,0,0),e.drawImage(i.canvas,0,0),e.restore())}genericComposeSMask(e,t,i,r,a,o,c,d,f,p,g){let w=e.canvas,x=d-p,k=f-g;if(o)if(x<0||k<0||x+i>w.width||k+r>w.height){const A=this.cachedCanvases.getCanvas("maskExtension",i,r),C=A.context;C.drawImage(w,-x,-k),C.globalCompositeOperation="destination-atop",C.fillStyle=o,C.fillRect(0,0,i,r),C.globalCompositeOperation="source-over",w=A.canvas,x=k=0}else{e.save(),e.globalAlpha=1,e.setTransform(1,0,0,1,0,0);const A=new Path2D;A.rect(x,k,i,r),e.clip(A),e.globalCompositeOperation="destination-atop",e.fillStyle=o,e.fillRect(x,k,i,r),e.restore()}t.save(),t.globalAlpha=1,t.setTransform(1,0,0,1,0,0),a==="Alpha"&&c?t.filter=this.filterFactory.addAlphaFilter(c):a==="Luminosity"&&(t.filter=this.filterFactory.addLuminosityFilter(c));const v=new Path2D;v.rect(d,f,i,r),t.clip(v),t.globalCompositeOperation="destination-in",t.drawImage(w,x,k,i,r,d,f,i,r),t.restore()}save(e){this.inSMaskMode&&Wr(this.ctx,this.suspendedCtx),this.ctx.save();const t=this.current;this.stateStack.push(t),this.current=t.clone(),this.dependencyTracker?.save(e)}restore(e){if(this.dependencyTracker?.restore(e),this.stateStack.length===0){this.inSMaskMode&&this.endSMaskMode();return}this.current=this.stateStack.pop(),this.ctx.restore(),this.inSMaskMode&&Wr(this.suspendedCtx,this.ctx),this.checkSMaskState(),this.pendingClip=null,this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}transform(e,t,i,r,a,o,c){this.dependencyTracker?.recordIncrementalData("transform",e),this.ctx.transform(t,i,r,a,o,c),this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}constructPath(e,t,i,r){let[a]=i;if(!r){a||=i[0]=new Path2D,this[t](e,a);return}if(this.dependencyTracker!==null){const o=t===Js.stroke?this.current.lineWidth/2:0;this.dependencyTracker.resetBBox(e).recordBBox(e,this.ctx,r[0]-o,r[2]+o,r[1]-o,r[3]+o).recordDependencies(e,["transform"])}if(!(a instanceof Path2D)){const o=i[0]=new Path2D;for(let c=0,d=a.length;c<d;)switch(a[c++]){case Co.moveTo:o.moveTo(a[c++],a[c++]);break;case Co.lineTo:o.lineTo(a[c++],a[c++]);break;case Co.curveTo:o.bezierCurveTo(a[c++],a[c++],a[c++],a[c++],a[c++],a[c++]);break;case Co.closePath:o.closePath();break;default:Ie(`Unrecognized drawing path operator: ${a[c-1]}`);break}a=o}ve.axialAlignedBoundingBox(r,ct(this.ctx),this.current.minMax),this[t](e,a),this._pathStartIdx=e}closePath(e){this.ctx.closePath()}stroke(e,t,i=!0){const r=this.ctx,a=this.current.strokeColor;if(r.globalAlpha=this.current.strokeAlpha,this.contentVisible)if(typeof a=="object"&&a?.getPattern){const o=a.isModifyingCurrentTransform()?r.getTransform():null;if(r.save(),r.strokeStyle=a.getPattern(r,this,zn(r),Lt.STROKE,e),o){const c=new Path2D;c.addPath(t,r.getTransform().invertSelf().multiplySelf(o)),t=c}this.rescaleAndStroke(t,!1),r.restore()}else this.rescaleAndStroke(t,!0);this.dependencyTracker?.recordDependencies(e,An.stroke),i&&this.consumePath(e,t,this.current.getClippedPathBoundingBox(Lt.STROKE,ct(this.ctx))),r.globalAlpha=this.current.fillAlpha}closeStroke(e,t){this.stroke(e,t)}fill(e,t,i=!0){const r=this.ctx,a=this.current.fillColor,o=this.current.patternFill;let c=!1;if(o){const f=a.isModifyingCurrentTransform()?r.getTransform():null;if(this.dependencyTracker?.save(e),r.save(),r.fillStyle=a.getPattern(r,this,zn(r),Lt.FILL,e),f){const p=new Path2D;p.addPath(t,r.getTransform().invertSelf().multiplySelf(f)),t=p}c=!0}const d=this.current.getClippedPathBoundingBox();this.contentVisible&&d!==null&&(this.pendingEOFill?(r.fill(t,"evenodd"),this.pendingEOFill=!1):r.fill(t)),this.dependencyTracker?.recordDependencies(e,An.fill),c&&(r.restore(),this.dependencyTracker?.restore(e)),i&&this.consumePath(e,t,d)}eoFill(e,t){this.pendingEOFill=!0,this.fill(e,t)}fillStroke(e,t){this.fill(e,t,!1),this.stroke(e,t,!1),this.consumePath(e,t)}eoFillStroke(e,t){this.pendingEOFill=!0,this.fillStroke(e,t)}closeFillStroke(e,t){this.fillStroke(e,t)}closeEOFillStroke(e,t){this.pendingEOFill=!0,this.fillStroke(e,t)}endPath(e,t){this.consumePath(e,t)}rawFillPath(e,t){this.ctx.fill(t),this.dependencyTracker?.recordDependencies(e,An.rawFillPath).recordOperation(e)}clip(e){this.dependencyTracker?.recordFutureForcedDependency("clipMode",e),this.pendingClip=ay}eoClip(e){this.dependencyTracker?.recordFutureForcedDependency("clipMode",e),this.pendingClip=Vf}beginText(e){this.current.textMatrix=null,this.current.textMatrixScale=1,this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0,this.dependencyTracker?.recordOpenMarker(e).resetIncrementalData("sameLineText").resetIncrementalData("moveText",e)}endText(e){const t=this.pendingTextPaths,i=this.ctx;if(this.dependencyTracker){const{dependencyTracker:r}=this;t!==void 0&&r.recordFutureForcedDependency("textClip",r.getOpenMarker()).recordFutureForcedDependency("textClip",e),r.recordCloseMarker(e)}if(t!==void 0){const r=new Path2D,a=i.getTransform().invertSelf();for(const{transform:o,x:c,y:d,fontSize:f,path:p}of t)p&&r.addPath(p,new DOMMatrix(o).preMultiplySelf(a).translate(c,d).scale(f,-f));i.clip(r)}delete this.pendingTextPaths}setCharSpacing(e,t){this.dependencyTracker?.recordSimpleData("charSpacing",e),this.current.charSpacing=t}setWordSpacing(e,t){this.dependencyTracker?.recordSimpleData("wordSpacing",e),this.current.wordSpacing=t}setHScale(e,t){this.dependencyTracker?.recordSimpleData("hScale",e),this.current.textHScale=t/100}setLeading(e,t){this.dependencyTracker?.recordSimpleData("leading",e),this.current.leading=-t}setFont(e,t,i){this.dependencyTracker?.recordSimpleData("font",e).recordSimpleDataFromNamed("fontObj",t,e);const r=this.commonObjs.get(t),a=this.current;if(!r)throw new Error(`Can't find font for ${t}`);if(a.fontMatrix=r.fontMatrix||ed,(a.fontMatrix[0]===0||a.fontMatrix[3]===0)&&Ie("Invalid font matrix for font "+t),i<0?(i=-i,a.fontDirection=-1):a.fontDirection=1,this.current.font=r,this.current.fontSize=i,r.isType3Font)return;const o=r.loadedName||"sans-serif",c=r.systemFontInfo?.css||`"${o}", ${r.fallbackName}`;let d="normal";r.black?d="900":r.bold&&(d="bold");const f=r.italic?"italic":"normal";let p=i;i<Bf?p=Bf:i>Wf&&(p=Wf),this.current.fontSizeScale=i/p,this.ctx.font=`${f} ${d} ${p}px ${c}`}setTextRenderingMode(e,t){this.dependencyTracker?.recordSimpleData("textRenderingMode",e),this.current.textRenderingMode=t}setTextRise(e,t){this.dependencyTracker?.recordSimpleData("textRise",e),this.current.textRise=t}moveText(e,t,i){this.dependencyTracker?.resetIncrementalData("sameLineText").recordIncrementalData("moveText",e),this.current.x=this.current.lineX+=t,this.current.y=this.current.lineY+=i}setLeadingMoveText(e,t,i){this.setLeading(e,-i),this.moveText(e,t,i)}setTextMatrix(e,t){this.dependencyTracker?.recordSimpleData("textMatrix",e);const{current:i}=this;i.textMatrix=t,i.textMatrixScale=Math.hypot(t[0],t[1]),i.x=i.lineX=0,i.y=i.lineY=0}nextLine(e){this.moveText(e,0,this.current.leading),this.dependencyTracker?.recordIncrementalData("moveText",this.dependencyTracker.getSimpleIndex("leading")??e)}#i(e,t,i){const r=new Path2D;return r.addPath(e,new DOMMatrix(i).invertSelf().multiplySelf(t)),r}paintChar(e,t,i,r,a,o){const c=this.ctx,d=this.current,f=d.font,p=d.textRenderingMode,g=d.fontSize/d.fontSizeScale,w=p&Dt.FILL_STROKE_MASK,x=!!(p&Dt.ADD_TO_PATH_FLAG),k=d.patternFill&&!f.missingFile,v=d.patternStroke&&!f.missingFile;let A;if((f.disableFontFace||x||k||v)&&!f.missingFile&&(A=f.getPathGenerator(this.commonObjs,t)),A&&(f.disableFontFace||k||v)){c.save(),c.translate(i,r),c.scale(g,-g),this.dependencyTracker?.recordCharacterBBox(e,c,f);let C;if(w===Dt.FILL||w===Dt.FILL_STROKE)if(a){C=c.getTransform(),c.setTransform(...a);const T=this.#i(A,C,a);c.fill(T)}else c.fill(A);if(w===Dt.STROKE||w===Dt.FILL_STROKE)if(o){C||=c.getTransform(),c.setTransform(...o);const{a:T,b:R,c:E,d:_}=C,M=ve.inverseTransform(o),N=ve.transform([T,R,E,_,0,0],M);ve.singularValueDecompose2dScale(N,mn),c.lineWidth*=Math.max(mn[0],mn[1])/g,c.stroke(this.#i(A,C,o))}else c.lineWidth/=g,c.stroke(A);c.restore()}else(w===Dt.FILL||w===Dt.FILL_STROKE)&&(c.fillText(t,i,r),this.dependencyTracker?.recordCharacterBBox(e,c,f,g,i,r,()=>c.measureText(t))),(w===Dt.STROKE||w===Dt.FILL_STROKE)&&(this.dependencyTracker&&this.dependencyTracker?.recordCharacterBBox(e,c,f,g,i,r,()=>c.measureText(t)).recordDependencies(e,An.stroke),c.strokeText(t,i,r));x&&((this.pendingTextPaths||=[]).push({transform:ct(c),x:i,y:r,fontSize:g,path:A}),this.dependencyTracker?.recordCharacterBBox(e,c,f,g,i,r))}get isFontSubpixelAAEnabled(){const{context:e}=this.cachedCanvases.getCanvas("isFontSubpixelAAEnabled",10,10);e.scale(1.5,1),e.fillText("I",0,10);const t=e.getImageData(0,0,10,10).data;let i=!1;for(let r=3;r<t.length;r+=4)if(t[r]>0&&t[r]<255){i=!0;break}return Le(this,"isFontSubpixelAAEnabled",i)}showText(e,t){this.dependencyTracker&&(this.dependencyTracker.recordDependencies(e,An.showText).resetBBox(e),this.current.textRenderingMode&Dt.ADD_TO_PATH_FLAG&&this.dependencyTracker.recordFutureForcedDependency("textClip",e).inheritPendingDependenciesAsFutureForcedDependencies());const i=this.current,r=i.font;if(r.isType3Font){this.showType3Text(e,t),this.dependencyTracker?.recordShowTextOperation(e);return}const a=i.fontSize;if(a===0){this.dependencyTracker?.recordOperation(e);return}const o=this.ctx,c=i.fontSizeScale,d=i.charSpacing,f=i.wordSpacing,p=i.fontDirection,g=i.textHScale*p,w=t.length,x=r.vertical,k=x?1:-1,v=r.defaultVMetrics,A=a*i.fontMatrix[0],C=i.textRenderingMode===Dt.FILL&&!r.disableFontFace&&!i.patternFill;o.save(),i.textMatrix&&o.transform(...i.textMatrix),o.translate(i.x,i.y+i.textRise),p>0?o.scale(g,-1):o.scale(g,1);let T,R;if(i.patternFill){o.save();const I=i.fillColor.getPattern(o,this,zn(o),Lt.FILL,e);T=ct(o),o.restore(),o.fillStyle=I}if(i.patternStroke){o.save();const I=i.strokeColor.getPattern(o,this,zn(o),Lt.STROKE,e);R=ct(o),o.restore(),o.strokeStyle=I}let E=i.lineWidth;const _=i.textMatrixScale;if(_===0||E===0){const I=i.textRenderingMode&Dt.FILL_STROKE_MASK;(I===Dt.STROKE||I===Dt.FILL_STROKE)&&(E=this.getSinglePixelWidth())}else E/=_;if(c!==1&&(o.scale(c,c),E/=c),o.lineWidth=E,r.isInvalidPDFjsFont){const I=[];let G=0;for(const B of t)I.push(B.unicode),G+=B.width;const F=I.join("");if(o.fillText(F,0,0),this.dependencyTracker!==null){const B=o.measureText(F);this.dependencyTracker.recordBBox(e,this.ctx,-B.actualBoundingBoxLeft,B.actualBoundingBoxRight,-B.actualBoundingBoxAscent,B.actualBoundingBoxDescent).recordShowTextOperation(e)}i.x+=G*A*g,o.restore(),this.compose();return}let M=0,N;for(N=0;N<w;++N){const I=t[N];if(typeof I=="number"){M+=k*I*a/1e3;continue}let G=!1;const F=(I.isSpace?f:0)+d,B=I.fontChar,X=I.accent;let oe,le,z=I.width;if(x){const V=I.vmetric||v,ce=-(I.vmetric?V[1]:z*.5)*A,re=V[2]*A;z=V?-V[0]:z,oe=ce/c,le=(M+re)/c}else oe=M/c,le=0;let K;if(r.remeasure&&z>0){K=o.measureText(B);const V=K.width*1e3/a*c;if(z<V&&this.isFontSubpixelAAEnabled){const ce=z/V;G=!0,o.save(),o.scale(ce,1),oe/=ce}else z!==V&&(oe+=(z-V)/2e3*a/c)}if(this.contentVisible&&(I.isInFont||r.missingFile)){if(C&&!X)o.fillText(B,oe,le),this.dependencyTracker?.recordCharacterBBox(e,o,K?{bbox:null}:r,a/c,oe,le,()=>K??o.measureText(B));else if(this.paintChar(e,B,oe,le,T,R),X){const V=oe+a*X.offset.x/c,ce=le-a*X.offset.y/c;this.paintChar(e,X.fontChar,V,ce,T,R)}}const Q=x?z*A-F*p:z*A+F*p;M+=Q,G&&o.restore()}x?i.y-=M:i.x+=M*g,o.restore(),this.compose(),this.dependencyTracker?.recordShowTextOperation(e)}showType3Text(e,t){const i=this.ctx,r=this.current,a=r.font,o=r.fontSize,c=r.fontDirection,d=a.vertical?1:-1,f=r.charSpacing,p=r.wordSpacing,g=r.textHScale*c,w=r.fontMatrix||ed,x=t.length,k=r.textRenderingMode===Dt.INVISIBLE;let v,A,C,T;if(k||o===0)return;this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null,i.save(),r.textMatrix&&i.transform(...r.textMatrix),i.translate(r.x,r.y+r.textRise),i.scale(g,c);const R=this.dependencyTracker;for(this.dependencyTracker=R?new Bo(R,e):null,v=0;v<x;++v){if(A=t[v],typeof A=="number"){T=d*A*o/1e3,this.ctx.translate(T,0),r.x+=T*g;continue}const E=(A.isSpace?p:0)+f,_=a.charProcOperatorList[A.operatorListId];_?this.contentVisible&&(this.save(),i.scale(o,o),i.transform(...w),this.executeOperatorList(_),this.restore()):Ie(`Type3 character "${A.operatorListId}" is not available.`);const M=[A.width,0];ve.applyTransform(M,w),C=M[0]*o+E,i.translate(C,0),r.x+=C*g}i.restore(),R&&(this.dependencyTracker=R)}setCharWidth(e,t,i){}setCharWidthAndBounds(e,t,i,r,a,o,c){const d=new Path2D;d.rect(r,a,o-r,c-a),this.ctx.clip(d),this.dependencyTracker?.recordBBox(e,this.ctx,r,o,a,c).recordClipBox(e,this.ctx,r,o,a,c),this.endPath(e)}getColorN_Pattern(e,t){let i;if(t[0]==="TilingPattern"){const r=this.baseTransform||ct(this.ctx),a={createCanvasGraphics:(o,c)=>new $s(o,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:this.optionalContentConfig,markedContentStack:this.markedContentStack},void 0,void 0,this.dependencyTracker?new Bo(this.dependencyTracker,c,!0):null)};i=new Td(t,this.ctx,a,r)}else i=this._getPattern(e,t[1],t[2]);return i}setStrokeColorN(e,...t){this.dependencyTracker?.recordSimpleData("strokeColor",e),this.current.strokeColor=this.getColorN_Pattern(e,t),this.current.patternStroke=!0}setFillColorN(e,...t){this.dependencyTracker?.recordSimpleData("fillColor",e),this.current.fillColor=this.getColorN_Pattern(e,t),this.current.patternFill=!0}setStrokeRGBColor(e,t){this.dependencyTracker?.recordSimpleData("strokeColor",e),this.ctx.strokeStyle=this.current.strokeColor=t,this.current.patternStroke=!1}setStrokeTransparent(e){this.dependencyTracker?.recordSimpleData("strokeColor",e),this.ctx.strokeStyle=this.current.strokeColor="transparent",this.current.patternStroke=!1}setFillRGBColor(e,t){this.dependencyTracker?.recordSimpleData("fillColor",e),this.ctx.fillStyle=this.current.fillColor=t,this.current.patternFill=!1}setFillTransparent(e){this.dependencyTracker?.recordSimpleData("fillColor",e),this.ctx.fillStyle=this.current.fillColor="transparent",this.current.patternFill=!1}_getPattern(e,t,i=null){let r;return this.cachedPatterns.has(t)?r=this.cachedPatterns.get(t):(r=Z0(this.getObject(e,t)),this.cachedPatterns.set(t,r)),i&&(r.matrix=i),r}shadingFill(e,t){if(!this.contentVisible)return;const i=this.ctx;this.save(e);const r=this._getPattern(e,t);i.fillStyle=r.getPattern(i,this,zn(i),Lt.SHADING,e);const a=zn(i);if(a){const{width:o,height:c}=i.canvas,d=zs.slice();ve.axialAlignedBoundingBox([0,0,o,c],a,d);const[f,p,g,w]=d;this.ctx.fillRect(f,p,g-f,w-p)}else this.ctx.fillRect(-1e10,-1e10,2e10,2e10);this.dependencyTracker?.resetBBox(e).recordFullPageBBox(e).recordDependencies(e,An.transform).recordDependencies(e,An.fill).recordOperation(e),this.compose(this.current.getClippedPathBoundingBox()),this.restore(e)}beginInlineImage(){Ye("Should not call beginInlineImage")}beginImageData(){Ye("Should not call beginImageData")}paintFormXObjectBegin(e,t,i){if(this.contentVisible&&(this.save(e),this.baseTransformStack.push(this.baseTransform),t&&this.transform(e,...t),this.baseTransform=ct(this.ctx),i)){ve.axialAlignedBoundingBox(i,this.baseTransform,this.current.minMax);const[r,a,o,c]=i,d=new Path2D;d.rect(r,a,o-r,c-a),this.ctx.clip(d),this.dependencyTracker?.recordClipBox(e,this.ctx,r,o,a,c),this.endPath(e)}}paintFormXObjectEnd(e){this.contentVisible&&(this.restore(e),this.baseTransform=this.baseTransformStack.pop())}beginGroup(e,t){if(!this.contentVisible)return;this.save(e),this.inSMaskMode&&(this.endSMaskMode(),this.current.activeSMask=null);const i=this.ctx;t.isolated||Go("TODO: Support non-isolated groups."),t.knockout&&Ie("Knockout groups not supported.");const r=ct(i);if(t.matrix&&i.transform(...t.matrix),!t.bbox)throw new Error("Bounding box is required.");let a=zs.slice();ve.axialAlignedBoundingBox(t.bbox,ct(i),a);const o=[0,0,i.canvas.width,i.canvas.height];a=ve.intersect(a,o)||[0,0,0,0];const c=Math.floor(a[0]),d=Math.floor(a[1]),f=Math.max(Math.ceil(a[2])-c,1),p=Math.max(Math.ceil(a[3])-d,1);this.current.startNewPathAndClipBox([0,0,f,p]);let g="groupAt"+this.groupLevel;t.smask&&(g+="_smask_"+this.smaskCounter++%2);const w=this.cachedCanvases.getCanvas(g,f,p),x=w.context;x.translate(-c,-d),x.transform(...r);let k=new Path2D;const[v,A,C,T]=t.bbox;if(k.rect(v,A,C-v,T-A),t.matrix){const R=new Path2D;R.addPath(k,new DOMMatrix(t.matrix)),k=R}x.clip(k),t.smask&&this.smaskStack.push({canvas:w.canvas,context:x,offsetX:c,offsetY:d,subtype:t.smask.subtype,backdrop:t.smask.backdrop,transferMap:t.smask.transferMap||null,startTransformInverse:null}),(!t.smask||this.dependencyTracker)&&(i.setTransform(1,0,0,1,0,0),i.translate(c,d),i.save()),Wr(i,x),this.ctx=x,this.dependencyTracker?.inheritSimpleDataAsFutureForcedDependencies(["fillAlpha","strokeAlpha","globalCompositeOperation"]).pushBaseTransform(i),this.setGState(e,[["BM","source-over"],["ca",1],["CA",1]]),this.groupStack.push(i),this.groupLevel++}endGroup(e,t){if(!this.contentVisible)return;this.groupLevel--;const i=this.ctx,r=this.groupStack.pop();if(this.ctx=r,this.ctx.imageSmoothingEnabled=!1,this.dependencyTracker?.popBaseTransform(),t.smask)this.tempSMask=this.smaskStack.pop(),this.restore(e),this.dependencyTracker&&this.ctx.restore();else{this.ctx.restore();const a=ct(this.ctx);this.restore(e),this.ctx.save(),this.ctx.setTransform(...a);const o=zs.slice();ve.axialAlignedBoundingBox([0,0,i.canvas.width,i.canvas.height],a,o),this.ctx.drawImage(i.canvas,0,0),this.ctx.restore(),this.compose(o)}}beginAnnotation(e,t,i,r,a,o){if(this.#e(),Mo(this.ctx),this.ctx.save(),this.save(e),this.baseTransform&&this.ctx.setTransform(...this.baseTransform),i){const c=i[2]-i[0],d=i[3]-i[1];if(o&&this.annotationCanvasMap){r=r.slice(),r[4]-=i[0],r[5]-=i[1],i=i.slice(),i[0]=i[1]=0,i[2]=c,i[3]=d,ve.singularValueDecompose2dScale(ct(this.ctx),mn);const{viewportScale:f}=this,p=Math.ceil(c*this.outputScaleX*f),g=Math.ceil(d*this.outputScaleY*f);this.annotationCanvas=this.canvasFactory.create(p,g);const{canvas:w,context:x}=this.annotationCanvas;this.annotationCanvasMap.set(t,w),this.annotationCanvas.savedCtx=this.ctx,this.ctx=x,this.ctx.save(),this.ctx.setTransform(mn[0],0,0,-mn[1],0,d*mn[1]),Mo(this.ctx)}else{Mo(this.ctx),this.endPath(e);const f=new Path2D;f.rect(i[0],i[1],c,d),this.ctx.clip(f)}}this.current=new Gf(this.ctx.canvas.width,this.ctx.canvas.height),this.transform(e,...r),this.transform(e,...a)}endAnnotation(e){this.annotationCanvas&&(this.ctx.restore(),this.#t(),this.ctx=this.annotationCanvas.savedCtx,delete this.annotationCanvas.savedCtx,delete this.annotationCanvas)}paintImageMaskXObject(e,t){if(!this.contentVisible)return;const i=t.count;t=this.getObject(e,t.data,t),t.count=i;const r=this.ctx,a=this._createMaskCanvas(e,t),o=a.canvas;r.save(),r.setTransform(1,0,0,1,0,0),r.drawImage(o,a.offsetX,a.offsetY),this.dependencyTracker?.resetBBox(e).recordBBox(e,this.ctx,a.offsetX,a.offsetX+o.width,a.offsetY,a.offsetY+o.height).recordOperation(e),r.restore(),this.compose()}paintImageMaskXObjectRepeat(e,t,i,r=0,a=0,o,c){if(!this.contentVisible)return;t=this.getObject(e,t.data,t);const d=this.ctx;d.save();const f=ct(d);d.transform(i,r,a,o,0,0);const p=this._createMaskCanvas(e,t);d.setTransform(1,0,0,1,p.offsetX-f[4],p.offsetY-f[5]),this.dependencyTracker?.resetBBox(e);for(let g=0,w=c.length;g<w;g+=2){const x=ve.transform(f,[i,r,a,o,c[g],c[g+1]]);d.drawImage(p.canvas,x[4],x[5]),this.dependencyTracker?.recordBBox(e,this.ctx,x[4],x[4]+p.canvas.width,x[5],x[5]+p.canvas.height)}d.restore(),this.compose(),this.dependencyTracker?.recordOperation(e)}paintImageMaskXObjectGroup(e,t){if(!this.contentVisible)return;const i=this.ctx,r=this.current.fillColor,a=this.current.patternFill;this.dependencyTracker?.resetBBox(e).recordDependencies(e,An.transformAndFill);for(const o of t){const{data:c,width:d,height:f,transform:p}=o,g=this.cachedCanvases.getCanvas("maskCanvas",d,f),w=g.context;w.save();const x=this.getObject(e,c,o);Uf(w,x),w.globalCompositeOperation="source-in",w.fillStyle=a?r.getPattern(w,this,zn(i),Lt.FILL,e):r,w.fillRect(0,0,d,f),w.restore(),i.save(),i.transform(...p),i.scale(1,-1),Po(i,g.canvas,0,0,d,f,0,-1,1,1),this.dependencyTracker?.recordBBox(e,i,0,d,0,f),i.restore()}this.compose(),this.dependencyTracker?.recordOperation(e)}paintImageXObject(e,t){if(!this.contentVisible)return;const i=this.getObject(e,t);if(!i){Ie("Dependent image isn't ready yet");return}this.paintInlineImageXObject(e,i)}paintImageXObjectRepeat(e,t,i,r,a){if(!this.contentVisible)return;const o=this.getObject(e,t);if(!o){Ie("Dependent image isn't ready yet");return}const c=o.width,d=o.height,f=[];for(let p=0,g=a.length;p<g;p+=2)f.push({transform:[i,0,0,r,a[p],a[p+1]],x:0,y:0,w:c,h:d});this.paintInlineImageXObjectGroup(e,o,f)}applyTransferMapsToCanvas(e){return this.current.transferMaps!=="none"&&(e.filter=this.current.transferMaps,e.drawImage(e.canvas,0,0),e.filter="none"),e.canvas}applyTransferMapsToBitmap(e){if(this.current.transferMaps==="none")return e.bitmap;const{bitmap:t,width:i,height:r}=e,a=this.cachedCanvases.getCanvas("inlineImage",i,r),o=a.context;return o.filter=this.current.transferMaps,o.drawImage(t,0,0),o.filter="none",a.canvas}paintInlineImageXObject(e,t){if(!this.contentVisible)return;const i=t.width,r=t.height,a=this.ctx;this.save(e);const{filter:o}=a;o!=="none"&&o!==""&&(a.filter="none"),a.scale(1/i,-1/r);let c;if(t.bitmap)c=this.applyTransferMapsToBitmap(t);else if(typeof HTMLElement=="function"&&t instanceof HTMLElement||!t.data)c=t;else{const p=this.cachedCanvases.getCanvas("inlineImage",i,r).context;zf(p,t),c=this.applyTransferMapsToCanvas(p)}const d=this._scaleImage(c,zn(a));a.imageSmoothingEnabled=$f(ct(a),t.interpolate),this.dependencyTracker?.resetBBox(e).recordBBox(e,a,0,i,-r,0).recordDependencies(e,An.imageXObject).recordOperation(e),Po(a,d.img,0,0,d.paintWidth,d.paintHeight,0,-r,i,r),this.compose(),this.restore(e)}paintInlineImageXObjectGroup(e,t,i){if(!this.contentVisible)return;const r=this.ctx;let a;if(t.bitmap)a=t.bitmap;else{const o=t.width,c=t.height,f=this.cachedCanvases.getCanvas("inlineImage",o,c).context;zf(f,t),a=this.applyTransferMapsToCanvas(f)}this.dependencyTracker?.resetBBox(e);for(const o of i)r.save(),r.transform(...o.transform),r.scale(1,-1),Po(r,a,o.x,o.y,o.w,o.h,0,-1,1,1),this.dependencyTracker?.recordBBox(e,r,0,1,-1,0),r.restore();this.dependencyTracker?.recordOperation(e),this.compose()}paintSolidColorImageMask(e){this.contentVisible&&(this.dependencyTracker?.resetBBox(e).recordBBox(e,this.ctx,0,1,0,1).recordDependencies(e,An.fill).recordOperation(e),this.ctx.fillRect(0,0,1,1),this.compose())}markPoint(e,t){}markPointProps(e,t,i){}beginMarkedContent(e,t){this.dependencyTracker?.beginMarkedContent(e),this.markedContentStack.push({visible:!0})}beginMarkedContentProps(e,t,i){this.dependencyTracker?.beginMarkedContent(e),t==="OC"?this.markedContentStack.push({visible:this.optionalContentConfig.isVisible(i)}):this.markedContentStack.push({visible:!0}),this.contentVisible=this.isContentVisible()}endMarkedContent(e){this.dependencyTracker?.endMarkedContent(e),this.markedContentStack.pop(),this.contentVisible=this.isContentVisible()}beginCompat(e){}endCompat(e){}consumePath(e,t,i){const r=this.current.isEmptyClip();this.pendingClip&&this.current.updateClipFromPath(),this.pendingClip||this.compose(i);const a=this.ctx;this.pendingClip?(r||(this.pendingClip===Vf?a.clip(t,"evenodd"):a.clip(t)),this.pendingClip=null,this.dependencyTracker?.bboxToClipBoxDropOperation(e).recordFutureForcedDependency("clipPath",e)):this.dependencyTracker?.recordOperation(e),this.current.startNewPathAndClipBox(this.current.clipBox)}getSinglePixelWidth(){if(!this._cachedGetSinglePixelWidth){const e=ct(this.ctx);if(e[1]===0&&e[2]===0)this._cachedGetSinglePixelWidth=1/Math.min(Math.abs(e[0]),Math.abs(e[3]));else{const t=Math.abs(e[0]*e[3]-e[2]*e[1]),i=Math.hypot(e[0],e[2]),r=Math.hypot(e[1],e[3]);this._cachedGetSinglePixelWidth=Math.max(i,r)/t}}return this._cachedGetSinglePixelWidth}getScaleForStroking(){if(this._cachedScaleForStroking[0]===-1){const{lineWidth:e}=this.current,{a:t,b:i,c:r,d:a}=this.ctx.getTransform();let o,c;if(i===0&&r===0){const d=Math.abs(t),f=Math.abs(a);if(d===f)if(e===0)o=c=1/d;else{const p=d*e;o=c=p<1?1/p:1}else if(e===0)o=1/d,c=1/f;else{const p=d*e,g=f*e;o=p<1?1/p:1,c=g<1?1/g:1}}else{const d=Math.abs(t*a-i*r),f=Math.hypot(t,i),p=Math.hypot(r,a);if(e===0)o=p/d,c=f/d;else{const g=e*d;o=p>g?p/g:1,c=f>g?f/g:1}}this._cachedScaleForStroking[0]=o,this._cachedScaleForStroking[1]=c}return this._cachedScaleForStroking}rescaleAndStroke(e,t){const{ctx:i,current:{lineWidth:r}}=this,[a,o]=this.getScaleForStroking();if(a===o){i.lineWidth=(r||1)*a,i.stroke(e);return}const c=i.getLineDash();t&&i.save(),i.scale(a,o),Yc.a=1/a,Yc.d=1/o;const d=new Path2D;if(d.addPath(e,Yc),c.length>0){const f=Math.max(a,o);i.setLineDash(c.map(p=>p/f)),i.lineDashOffset/=f}i.lineWidth=r||1,i.stroke(d),t&&i.restore()}isContentVisible(){for(let e=this.markedContentStack.length-1;e>=0;e--)if(!this.markedContentStack[e].visible)return!1;return!0}}for(const h in Js)$s.prototype[h]!==void 0&&($s.prototype[Js[h]]=$s.prototype[h]);class Vs{#e;#t;#i;static strings=["fontFamily","fontWeight","italicAngle"];static write(e){const t=new TextEncoder,i={};let r=0;for(const f of Vs.strings){const p=t.encode(e[f]);i[f]=p,r+=4+p.length}const a=new ArrayBuffer(r),o=new Uint8Array(a),c=new DataView(a);let d=0;for(const f of Vs.strings){const p=i[f],g=p.length;c.setUint32(d,g),o.set(p,d+4),d+=4+g}return Be(d===a.byteLength,"CssFontInfo.write: Buffer overflow"),a}constructor(e){this.#e=e,this.#t=new DataView(this.#e),this.#i=new TextDecoder}#n(e){Be(e<Vs.strings.length,"Invalid string index");let t=0;for(let r=0;r<e;r++)t+=this.#t.getUint32(t)+4;const i=this.#t.getUint32(t);return this.#i.decode(new Uint8Array(this.#e,t+4,i))}get fontFamily(){return this.#n(0)}get fontWeight(){return this.#n(1)}get italicAngle(){return this.#n(2)}}class Ks{#e;#t;#i;static strings=["css","loadedName","baseFontName","src"];static write(e){const t=new TextEncoder,i={};let r=0;for(const w of Ks.strings){const x=t.encode(e[w]);i[w]=x,r+=4+x.length}r+=4;let a,o,c=1+r;e.style&&(a=t.encode(e.style.style),o=t.encode(e.style.weight),c+=4+a.length+4+o.length);const d=new ArrayBuffer(c),f=new Uint8Array(d),p=new DataView(d);let g=0;p.setUint8(g++,e.guessFallback?1:0),p.setUint32(g,0),g+=4,r=0;for(const w of Ks.strings){const x=i[w],k=x.length;r+=4+k,p.setUint32(g,k),f.set(x,g+4),g+=4+k}return p.setUint32(g-r-4,r),e.style&&(p.setUint32(g,a.length),f.set(a,g+4),g+=4+a.length,p.setUint32(g,o.length),f.set(o,g+4),g+=4+o.length),Be(g<=d.byteLength,"SubstitionInfo.write: Buffer overflow"),d.transferToFixedLength(g)}constructor(e){this.#e=e,this.#t=new DataView(this.#e),this.#i=new TextDecoder}get guessFallback(){return this.#t.getUint8(0)!==0}#n(e){Be(e<Ks.strings.length,"Invalid string index");let t=5;for(let r=0;r<e;r++)t+=this.#t.getUint32(t)+4;const i=this.#t.getUint32(t);return this.#i.decode(new Uint8Array(this.#e,t+4,i))}get css(){return this.#n(0)}get loadedName(){return this.#n(1)}get baseFontName(){return this.#n(2)}get src(){return this.#n(3)}get style(){let e=1;e+=4+this.#t.getUint32(e);const t=this.#t.getUint32(e),i=this.#i.decode(new Uint8Array(this.#e,e+4,t));e+=4+t;const r=this.#t.getUint32(e),a=this.#i.decode(new Uint8Array(this.#e,e+4,r));return{style:i,weight:a}}}class $e{static bools=["black","bold","disableFontFace","fontExtraProperties","isInvalidPDFjsFont","isType3Font","italic","missingFile","remeasure","vertical"];static numbers=["ascent","defaultWidth","descent"];static strings=["fallbackName","loadedName","mimetype","name"];static#e=Math.ceil(this.bools.length*2/8);static#t=this.#e+this.numbers.length*8;static#i=this.#t+1+8;static#n=this.#i+1+48;static#a=this.#n+1+6;#s;#r;#o;constructor({data:e,extra:t}){this.#s=e,this.#r=new TextDecoder,this.#o=new DataView(this.#s),t&&Object.assign(this,t)}#c(e){Be(e<$e.bools.length,"Invalid boolean index");const t=Math.floor(e/4),i=e*2%8,r=this.#o.getUint8(t)>>i&3;return r===0?void 0:r===2}get black(){return this.#c(0)}get bold(){return this.#c(1)}get disableFontFace(){return this.#c(2)}get fontExtraProperties(){return this.#c(3)}get isInvalidPDFjsFont(){return this.#c(4)}get isType3Font(){return this.#c(5)}get italic(){return this.#c(6)}get missingFile(){return this.#c(7)}get remeasure(){return this.#c(8)}get vertical(){return this.#c(9)}#l(e){return Be(e<$e.numbers.length,"Invalid number index"),this.#o.getFloat64($e.#e+e*8)}get ascent(){return this.#l(0)}get defaultWidth(){return this.#l(1)}get descent(){return this.#l(2)}get bbox(){let e=$e.#t;if(this.#o.getUint8(e)===0)return;e+=1;const i=[];for(let r=0;r<4;r++)i.push(this.#o.getInt16(e,!0)),e+=2;return i}get fontMatrix(){let e=$e.#i;if(this.#o.getUint8(e)===0)return;e+=1;const i=[];for(let r=0;r<6;r++)i.push(this.#o.getFloat64(e,!0)),e+=8;return i}get defaultVMetrics(){let e=$e.#n;if(this.#o.getUint8(e)===0)return;e+=1;const i=[];for(let r=0;r<3;r++)i.push(this.#o.getInt16(e,!0)),e+=2;return i}#u(e){Be(e<$e.strings.length,"Invalid string index");let t=$e.#a+4;for(let a=0;a<e;a++)t+=this.#o.getUint32(t)+4;const i=this.#o.getUint32(t),r=new Uint8Array(i);return r.set(new Uint8Array(this.#s,t+4,i)),this.#r.decode(r)}get fallbackName(){return this.#u(0)}get loadedName(){return this.#u(1)}get mimetype(){return this.#u(2)}get name(){return this.#u(3)}get data(){let e=$e.#a;const t=this.#o.getUint32(e);e+=4+t;const i=this.#o.getUint32(e);e+=4+i;const r=this.#o.getUint32(e);e+=4+r;const a=this.#o.getUint32(e);if(a!==0)return new Uint8Array(this.#s,e+4,a)}clearData(){let e=$e.#a;const t=this.#o.getUint32(e);e+=4+t;const i=this.#o.getUint32(e);e+=4+i;const r=this.#o.getUint32(e);e+=4+r;const a=this.#o.getUint32(e);new Uint8Array(this.#s,e+4,a).fill(0),this.#o.setUint32(e,0)}get cssFontInfo(){let e=$e.#a;const t=this.#o.getUint32(e);e+=4+t;const i=this.#o.getUint32(e);e+=4+i;const r=this.#o.getUint32(e);if(r===0)return null;const a=new Uint8Array(r);return a.set(new Uint8Array(this.#s,e+4,r)),new Vs(a.buffer)}get systemFontInfo(){let e=$e.#a;const t=this.#o.getUint32(e);e+=4+t;const i=this.#o.getUint32(e);if(i===0)return null;const r=new Uint8Array(i);return r.set(new Uint8Array(this.#s,e+4,i)),new Ks(r.buffer)}static write(e){const t=e.systemFontInfo?Ks.write(e.systemFontInfo):null,i=e.cssFontInfo?Vs.write(e.cssFontInfo):null,r=new TextEncoder,a={};let o=0;for(const v of $e.strings)a[v]=r.encode(e[v]),o+=4+a[v].length;const c=$e.#a+4+o+4+(t?t.byteLength:0)+4+(i?i.byteLength:0)+4+(e.data?e.data.length:0),d=new ArrayBuffer(c),f=new Uint8Array(d),p=new DataView(d);let g=0;const w=$e.bools.length;let x=0,k=0;for(let v=0;v<w;v++){const A=e[$e.bools[v]];x|=(A===void 0?0:A?2:1)<<k,k+=2,(k===8||v===w-1)&&(p.setUint8(g++,x),x=0,k=0)}Be(g===$e.#e,"FontInfo.write: Boolean properties offset mismatch");for(const v of $e.numbers)p.setFloat64(g,e[v]),g+=8;if(Be(g===$e.#t,"FontInfo.write: Number properties offset mismatch"),e.bbox){p.setUint8(g++,4);for(const v of e.bbox)p.setInt16(g,v,!0),g+=2}else p.setUint8(g++,0),g+=8;if(Be(g===$e.#i,"FontInfo.write: BBox properties offset mismatch"),e.fontMatrix){p.setUint8(g++,6);for(const v of e.fontMatrix)p.setFloat64(g,v,!0),g+=8}else p.setUint8(g++,0),g+=48;if(Be(g===$e.#n,"FontInfo.write: FontMatrix properties offset mismatch"),e.defaultVMetrics){p.setUint8(g++,1);for(const v of e.defaultVMetrics)p.setInt16(g,v,!0),g+=2}else p.setUint8(g++,0),g+=6;Be(g===$e.#a,"FontInfo.write: DefaultVMetrics properties offset mismatch"),p.setUint32($e.#a,0),g+=4;for(const v of $e.strings){const A=a[v],C=A.length;p.setUint32(g,C),f.set(A,g+4),g+=4+C}if(p.setUint32($e.#a,g-$e.#a-4),!t)p.setUint32(g,0),g+=4;else{const v=t.byteLength;p.setUint32(g,v),Be(g+4+v<=d.byteLength,"FontInfo.write: Buffer overflow at systemFontInfo"),f.set(new Uint8Array(t),g+4),g+=4+v}if(!i)p.setUint32(g,0),g+=4;else{const v=i.byteLength;p.setUint32(g,v),Be(g+4+v<=d.byteLength,"FontInfo.write: Buffer overflow at cssFontInfo"),f.set(new Uint8Array(i),g+4),g+=4+v}return e.data===void 0?(p.setUint32(g,0),g+=4):(p.setUint32(g,e.data.length),f.set(e.data,g+4),g+=4+e.data.length),Be(g<=d.byteLength,"FontInfo.write: Buffer overflow"),d.transferToFixedLength(g)}}class Oi{static#e=null;static#t="";static get workerPort(){return this.#e}static set workerPort(e){if(!(typeof Worker<"u"&&e instanceof Worker)&&e!==null)throw new Error("Invalid `workerPort` type.");this.#e=e}static get workerSrc(){return this.#t}static set workerSrc(e){if(typeof e!="string")throw new Error("Invalid `workerSrc` type.");this.#t=e}}class oy{#e;#t;constructor({parsedData:e,rawData:t}){this.#e=e,this.#t=t}getRaw(){return this.#t}get(e){return this.#e.get(e)??null}[Symbol.iterator](){return this.#e.entries()}}const Gs=Symbol("INTERNAL");class ly{#e=!1;#t=!1;#i=!1;#n=!0;constructor(e,{name:t,intent:i,usage:r,rbGroups:a}){this.#e=!!(e&fn.DISPLAY),this.#t=!!(e&fn.PRINT),this.name=t,this.intent=i,this.usage=r,this.rbGroups=a}get visible(){if(this.#i)return this.#n;if(!this.#n)return!1;const{print:e,view:t}=this.usage;return this.#e?t?.viewState!=="OFF":this.#t?e?.printState!=="OFF":!0}_setVisible(e,t,i=!1){e!==Gs&&Ye("Internal method `_setVisible` called."),this.#i=i,this.#n=t}}class cy{#e=null;#t=new Map;#i=null;#n=null;constructor(e,t=fn.DISPLAY){if(this.renderingIntent=t,this.name=null,this.creator=null,e!==null){this.name=e.name,this.creator=e.creator,this.#n=e.order;for(const i of e.groups)this.#t.set(i.id,new ly(t,i));if(e.baseState==="OFF")for(const i of this.#t.values())i._setVisible(Gs,!1);for(const i of e.on)this.#t.get(i)._setVisible(Gs,!0);for(const i of e.off)this.#t.get(i)._setVisible(Gs,!1);this.#i=this.getHash()}}#a(e){const t=e.length;if(t<2)return!0;const i=e[0];for(let r=1;r<t;r++){const a=e[r];let o;if(Array.isArray(a))o=this.#a(a);else if(this.#t.has(a))o=this.#t.get(a).visible;else return Ie(`Optional content group not found: ${a}`),!0;switch(i){case"And":if(!o)return!1;break;case"Or":if(o)return!0;break;case"Not":return!o;default:return!0}}return i==="And"}isVisible(e){if(this.#t.size===0)return!0;if(!e)return Go("Optional content group not defined."),!0;if(e.type==="OCG")return this.#t.has(e.id)?this.#t.get(e.id).visible:(Ie(`Optional content group not found: ${e.id}`),!0);if(e.type==="OCMD"){if(e.expression)return this.#a(e.expression);if(!e.policy||e.policy==="AnyOn"){for(const t of e.ids){if(!this.#t.has(t))return Ie(`Optional content group not found: ${t}`),!0;if(this.#t.get(t).visible)return!0}return!1}else if(e.policy==="AllOn"){for(const t of e.ids){if(!this.#t.has(t))return Ie(`Optional content group not found: ${t}`),!0;if(!this.#t.get(t).visible)return!1}return!0}else if(e.policy==="AnyOff"){for(const t of e.ids){if(!this.#t.has(t))return Ie(`Optional content group not found: ${t}`),!0;if(!this.#t.get(t).visible)return!0}return!1}else if(e.policy==="AllOff"){for(const t of e.ids){if(!this.#t.has(t))return Ie(`Optional content group not found: ${t}`),!0;if(this.#t.get(t).visible)return!1}return!0}return Ie(`Unknown optional content policy ${e.policy}.`),!0}return Ie(`Unknown group type ${e.type}.`),!0}setVisibility(e,t=!0,i=!0){const r=this.#t.get(e);if(!r){Ie(`Optional content group not found: ${e}`);return}if(i&&t&&r.rbGroups.length)for(const a of r.rbGroups)for(const o of a)o!==e&&this.#t.get(o)?._setVisible(Gs,!1,!0);r._setVisible(Gs,!!t,!0),this.#e=null}setOCGState({state:e,preserveRB:t}){let i;for(const r of e){switch(r){case"ON":case"OFF":case"Toggle":i=r;continue}const a=this.#t.get(r);if(a)switch(i){case"ON":this.setVisibility(r,!0,t);break;case"OFF":this.setVisibility(r,!1,t);break;case"Toggle":this.setVisibility(r,!a.visible,t);break}}this.#e=null}get hasInitialVisibility(){return this.#i===null||this.getHash()===this.#i}getOrder(){return this.#t.size?this.#n?this.#n.slice():[...this.#t.keys()]:null}getGroup(e){return this.#t.get(e)||null}getHash(){if(this.#e!==null)return this.#e;const e=new xp;for(const[t,i]of this.#t)e.update(`${t}:${i.visible}`);return this.#e=e.hexdigest()}[Symbol.iterator](){return this.#t.entries()}}class dy{constructor(e,{disableRange:t=!1,disableStream:i=!1}){Be(e,'PDFDataTransportStream - missing required "pdfDataRangeTransport" argument.');const{length:r,initialData:a,progressiveDone:o,contentDispositionFilename:c}=e;if(this._queuedChunks=[],this._progressiveDone=o,this._contentDispositionFilename=c,a?.length>0){const d=a instanceof Uint8Array&&a.byteLength===a.buffer.byteLength?a.buffer:new Uint8Array(a).buffer;this._queuedChunks.push(d)}this._pdfDataRangeTransport=e,this._isStreamingSupported=!i,this._isRangeSupported=!t,this._contentLength=r,this._fullRequestReader=null,this._rangeReaders=[],e.addRangeListener((d,f)=>{this._onReceiveData({begin:d,chunk:f})}),e.addProgressListener((d,f)=>{this._onProgress({loaded:d,total:f})}),e.addProgressiveReadListener(d=>{this._onReceiveData({chunk:d})}),e.addProgressiveDoneListener(()=>{this._onProgressiveDone()}),e.transportReady()}_onReceiveData({begin:e,chunk:t}){const i=t instanceof Uint8Array&&t.byteLength===t.buffer.byteLength?t.buffer:new Uint8Array(t).buffer;if(e===void 0)this._fullRequestReader?this._fullRequestReader._enqueue(i):this._queuedChunks.push(i);else{const r=this._rangeReaders.some(function(a){return a._begin!==e?!1:(a._enqueue(i),!0)});Be(r,"_onReceiveData - no `PDFDataTransportStreamRangeReader` instance found.")}}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}_onProgress(e){e.total===void 0?this._rangeReaders[0]?.onProgress?.({loaded:e.loaded}):this._fullRequestReader?.onProgress?.({loaded:e.loaded,total:e.total})}_onProgressiveDone(){this._fullRequestReader?.progressiveDone(),this._progressiveDone=!0}_removeRangeReader(e){const t=this._rangeReaders.indexOf(e);t>=0&&this._rangeReaders.splice(t,1)}getFullReader(){Be(!this._fullRequestReader,"PDFDataTransportStream.getFullReader can only be called once.");const e=this._queuedChunks;return this._queuedChunks=null,new hy(this,e,this._progressiveDone,this._contentDispositionFilename)}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;const i=new uy(this,e,t);return this._pdfDataRangeTransport.requestDataRange(e,t),this._rangeReaders.push(i),i}cancelAllRequests(e){this._fullRequestReader?.cancel(e);for(const t of this._rangeReaders.slice(0))t.cancel(e);this._pdfDataRangeTransport.abort()}}class hy{constructor(e,t,i=!1,r=null){this._stream=e,this._done=i||!1,this._filename=Uo(r)?r:null,this._queuedChunks=t||[],this._loaded=0;for(const a of this._queuedChunks)this._loaded+=a.byteLength;this._requests=[],this._headersReady=Promise.resolve(),e._fullRequestReader=this,this.onProgress=null}_enqueue(e){this._done||(this._requests.length>0?this._requests.shift().resolve({value:e,done:!1}):this._queuedChunks.push(e),this._loaded+=e.byteLength)}get headersReady(){return this._headersReady}get filename(){return this._filename}get isRangeSupported(){return this._stream._isRangeSupported}get isStreamingSupported(){return this._stream._isStreamingSupported}get contentLength(){return this._stream._contentLength}async read(){if(this._queuedChunks.length>0)return{value:this._queuedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0;for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0}progressiveDone(){this._done||(this._done=!0)}}class uy{constructor(e,t,i){this._stream=e,this._begin=t,this._end=i,this._queuedChunk=null,this._requests=[],this._done=!1,this.onProgress=null}_enqueue(e){if(!this._done){if(this._requests.length===0)this._queuedChunk=e;else{this._requests.shift().resolve({value:e,done:!1});for(const i of this._requests)i.resolve({value:void 0,done:!0});this._requests.length=0}this._done=!0,this._stream._removeRangeReader(this)}}get isStreamingSupported(){return!1}async read(){if(this._queuedChunk){const t=this._queuedChunk;return this._queuedChunk=null,{value:t,done:!1}}if(this._done)return{value:void 0,done:!0};const e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0;for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._stream._removeRangeReader(this)}}function fy(h){let e=!0,t=i("filename\\*","i").exec(h);if(t){t=t[1];let p=c(t);return p=unescape(p),p=d(p),p=f(p),a(p)}if(t=o(h),t){const p=f(t);return a(p)}if(t=i("filename","i").exec(h),t){t=t[1];let p=c(t);return p=f(p),a(p)}function i(p,g){return new RegExp("(?:^|;)\\s*"+p+'\\s*=\\s*([^";\\s][^;\\s]*|"(?:[^"\\\\]|\\\\"?)+"?)',g)}function r(p,g){if(p){if(!/^[\x00-\xFF]+$/.test(g))return g;try{const w=new TextDecoder(p,{fatal:!0}),x=ia(g);g=w.decode(x),e=!1}catch{}}return g}function a(p){return e&&/[\x80-\xff]/.test(p)&&(p=r("utf-8",p),e&&(p=r("iso-8859-1",p))),p}function o(p){const g=[];let w;const x=i("filename\\*((?!0\\d)\\d+)(\\*?)","ig");for(;(w=x.exec(p))!==null;){let[,v,A,C]=w;if(v=parseInt(v,10),v in g){if(v===0)break;continue}g[v]=[A,C]}const k=[];for(let v=0;v<g.length&&v in g;++v){let[A,C]=g[v];C=c(C),A&&(C=unescape(C),v===0&&(C=d(C))),k.push(C)}return k.join("")}function c(p){if(p.startsWith('"')){const g=p.slice(1).split('\\"');for(let w=0;w<g.length;++w){const x=g[w].indexOf('"');x!==-1&&(g[w]=g[w].slice(0,x),g.length=w+1),g[w]=g[w].replaceAll(/\\(.)/g,"$1")}p=g.join('"')}return p}function d(p){const g=p.indexOf("'");if(g===-1)return p;const w=p.slice(0,g),k=p.slice(g+1).replace(/^[^']*'/,"");return r(w,k)}function f(p){return!p.startsWith("=?")||/[\x00-\x19\x80-\xff]/.test(p)?p:p.replaceAll(/=\?([\w-]*)\?([QqBb])\?((?:[^?]|\?(?!=))*)\?=/g,function(g,w,x,k){if(x==="q"||x==="Q")return k=k.replaceAll("_"," "),k=k.replaceAll(/=([0-9a-fA-F]{2})/g,function(v,A){return String.fromCharCode(parseInt(A,16))}),r(w,k);try{k=atob(k)}catch{}return r(w,k)})}return""}function _p(h,e){const t=new Headers;if(!h||!e||typeof e!="object")return t;for(const i in e){const r=e[i];r!==void 0&&t.append(i,r)}return t}function $o(h){return URL.parse(h)?.origin??null}function Np({responseHeaders:h,isHttp:e,rangeChunkSize:t,disableRange:i}){const r={allowRangeRequests:!1,suggestedLength:void 0},a=parseInt(h.get("Content-Length"),10);return!Number.isInteger(a)||(r.suggestedLength=a,a<=2*t)||i||!e||h.get("Accept-Ranges")!=="bytes"||(h.get("Content-Encoding")||"identity")!=="identity"||(r.allowRangeRequests=!0),r}function Pp(h){const e=h.get("Content-Disposition");if(e){let t=fy(e);if(t.includes("%"))try{t=decodeURIComponent(t)}catch{}if(Uo(t))return t}return null}function la(h,e){return new Qr(`Unexpected server response (${h}) while retrieving PDF "${e}".`,h,h===404||h===0&&e.startsWith("file:"))}function Mp(h){return h===200||h===206}function Ip(h,e,t){return{method:"GET",headers:h,signal:t.signal,mode:"cors",credentials:e?"include":"same-origin",redirect:"follow"}}function Dp(h){return h instanceof Uint8Array?h.buffer:h instanceof ArrayBuffer?h:(Ie(`getArrayBuffer - unexpected data format: ${h}`),new Uint8Array(h).buffer)}class py{_responseOrigin=null;constructor(e){this.source=e,this.isHttp=/^https?:/i.test(e.url),this.headers=_p(this.isHttp,e.httpHeaders),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}getFullReader(){return Be(!this._fullRequestReader,"PDFFetchStream.getFullReader can only be called once."),this._fullRequestReader=new my(this),this._fullRequestReader}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;const i=new gy(this,e,t);return this._rangeRequestReaders.push(i),i}cancelAllRequests(e){this._fullRequestReader?.cancel(e);for(const t of this._rangeRequestReaders.slice(0))t.cancel(e)}}class my{constructor(e){this._stream=e,this._reader=null,this._loaded=0,this._filename=null;const t=e.source;this._withCredentials=t.withCredentials||!1,this._contentLength=t.length,this._headersCapability=Promise.withResolvers(),this._disableRange=t.disableRange||!1,this._rangeChunkSize=t.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._abortController=new AbortController,this._isStreamingSupported=!t.disableStream,this._isRangeSupported=!t.disableRange;const i=new Headers(e.headers),r=t.url;fetch(r,Ip(i,this._withCredentials,this._abortController)).then(a=>{if(e._responseOrigin=$o(a.url),!Mp(a.status))throw la(a.status,r);this._reader=a.body.getReader(),this._headersCapability.resolve();const o=a.headers,{allowRangeRequests:c,suggestedLength:d}=Np({responseHeaders:o,isHttp:e.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=c,this._contentLength=d||this._contentLength,this._filename=Pp(o),!this._isStreamingSupported&&this._isRangeSupported&&this.cancel(new ci("Streaming is disabled."))}).catch(this._headersCapability.reject),this.onProgress=null}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){await this._headersCapability.promise;const{value:e,done:t}=await this._reader.read();return t?{value:e,done:t}:(this._loaded+=e.byteLength,this.onProgress?.({loaded:this._loaded,total:this._contentLength}),{value:Dp(e),done:!1})}cancel(e){this._reader?.cancel(e),this._abortController.abort()}}class gy{constructor(e,t,i){this._stream=e,this._reader=null,this._loaded=0;const r=e.source;this._withCredentials=r.withCredentials||!1,this._readCapability=Promise.withResolvers(),this._isStreamingSupported=!r.disableStream,this._abortController=new AbortController;const a=new Headers(e.headers);a.append("Range",`bytes=${t}-${i-1}`);const o=r.url;fetch(o,Ip(a,this._withCredentials,this._abortController)).then(c=>{const d=$o(c.url);if(d!==e._responseOrigin)throw new Error(`Expected range response-origin "${d}" to match "${e._responseOrigin}".`);if(!Mp(c.status))throw la(c.status,o);this._readCapability.resolve(),this._reader=c.body.getReader()}).catch(this._readCapability.reject),this.onProgress=null}get isStreamingSupported(){return this._isStreamingSupported}async read(){await this._readCapability.promise;const{value:e,done:t}=await this._reader.read();return t?{value:e,done:t}:(this._loaded+=e.byteLength,this.onProgress?.({loaded:this._loaded}),{value:Dp(e),done:!1})}cancel(e){this._reader?.cancel(e),this._abortController.abort()}}const Xc=200,Qc=206;function yy(h){const e=h.response;return typeof e!="string"?e:ia(e).buffer}class wy{_responseOrigin=null;constructor({url:e,httpHeaders:t,withCredentials:i}){this.url=e,this.isHttp=/^https?:/i.test(e),this.headers=_p(this.isHttp,t),this.withCredentials=i||!1,this.currXhrId=0,this.pendingRequests=Object.create(null)}request(e){const t=new XMLHttpRequest,i=this.currXhrId++,r=this.pendingRequests[i]={xhr:t};t.open("GET",this.url),t.withCredentials=this.withCredentials;for(const[a,o]of this.headers)t.setRequestHeader(a,o);return this.isHttp&&"begin"in e&&"end"in e?(t.setRequestHeader("Range",`bytes=${e.begin}-${e.end-1}`),r.expectedStatus=Qc):r.expectedStatus=Xc,t.responseType="arraybuffer",Be(e.onError,"Expected `onError` callback to be provided."),t.onerror=()=>{e.onError(t.status)},t.onreadystatechange=this.onStateChange.bind(this,i),t.onprogress=this.onProgress.bind(this,i),r.onHeadersReceived=e.onHeadersReceived,r.onDone=e.onDone,r.onError=e.onError,r.onProgress=e.onProgress,t.send(null),i}onProgress(e,t){const i=this.pendingRequests[e];i&&i.onProgress?.(t)}onStateChange(e,t){const i=this.pendingRequests[e];if(!i)return;const r=i.xhr;if(r.readyState>=2&&i.onHeadersReceived&&(i.onHeadersReceived(),delete i.onHeadersReceived),r.readyState!==4||!(e in this.pendingRequests))return;if(delete this.pendingRequests[e],r.status===0&&this.isHttp){i.onError(r.status);return}const a=r.status||Xc;if(!(a===Xc&&i.expectedStatus===Qc)&&a!==i.expectedStatus){i.onError(r.status);return}const c=yy(r);if(a===Qc){const d=r.getResponseHeader("Content-Range"),f=/bytes (\d+)-(\d+)\/(\d+)/.exec(d);f?i.onDone({begin:parseInt(f[1],10),chunk:c}):(Ie('Missing or invalid "Content-Range" header.'),i.onError(0))}else c?i.onDone({begin:0,chunk:c}):i.onError(r.status)}getRequestXhr(e){return this.pendingRequests[e].xhr}isPendingRequest(e){return e in this.pendingRequests}abortRequest(e){const t=this.pendingRequests[e].xhr;delete this.pendingRequests[e],t.abort()}}class by{constructor(e){this._source=e,this._manager=new wy(e),this._rangeChunkSize=e.rangeChunkSize,this._fullRequestReader=null,this._rangeRequestReaders=[]}_onRangeRequestReaderClosed(e){const t=this._rangeRequestReaders.indexOf(e);t>=0&&this._rangeRequestReaders.splice(t,1)}getFullReader(){return Be(!this._fullRequestReader,"PDFNetworkStream.getFullReader can only be called once."),this._fullRequestReader=new vy(this._manager,this._source),this._fullRequestReader}getRangeReader(e,t){const i=new xy(this._manager,e,t);return i.onClosed=this._onRangeRequestReaderClosed.bind(this),this._rangeRequestReaders.push(i),i}cancelAllRequests(e){this._fullRequestReader?.cancel(e);for(const t of this._rangeRequestReaders.slice(0))t.cancel(e)}}class vy{constructor(e,t){this._manager=e,this._url=t.url,this._fullRequestId=e.request({onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)}),this._headersCapability=Promise.withResolvers(),this._disableRange=t.disableRange||!1,this._contentLength=t.length,this._rangeChunkSize=t.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!1,this._isRangeSupported=!1,this._cachedChunks=[],this._requests=[],this._done=!1,this._storedError=void 0,this._filename=null,this.onProgress=null}_onHeadersReceived(){const e=this._fullRequestId,t=this._manager.getRequestXhr(e);this._manager._responseOrigin=$o(t.responseURL);const i=t.getAllResponseHeaders(),r=new Headers(i?i.trimStart().replace(/[^\S ]+$/,"").split(/[\r\n]+/).map(c=>{const[d,...f]=c.split(": ");return[d,f.join(": ")]}):[]),{allowRangeRequests:a,suggestedLength:o}=Np({responseHeaders:r,isHttp:this._manager.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});a&&(this._isRangeSupported=!0),this._contentLength=o||this._contentLength,this._filename=Pp(r),this._isRangeSupported&&this._manager.abortRequest(e),this._headersCapability.resolve()}_onDone(e){if(e&&(this._requests.length>0?this._requests.shift().resolve({value:e.chunk,done:!1}):this._cachedChunks.push(e.chunk)),this._done=!0,!(this._cachedChunks.length>0)){for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0}}_onError(e){this._storedError=la(e,this._url),this._headersCapability.reject(this._storedError);for(const t of this._requests)t.reject(this._storedError);this._requests.length=0,this._cachedChunks.length=0}_onProgress(e){this.onProgress?.({loaded:e.loaded,total:e.lengthComputable?e.total:this._contentLength})}get filename(){return this._filename}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}get contentLength(){return this._contentLength}get headersReady(){return this._headersCapability.promise}async read(){if(await this._headersCapability.promise,this._storedError)throw this._storedError;if(this._cachedChunks.length>0)return{value:this._cachedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0,this._headersCapability.reject(e);for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._fullRequestId)&&this._manager.abortRequest(this._fullRequestId),this._fullRequestReader=null}}class xy{constructor(e,t,i){this._manager=e,this._url=e.url,this._requestId=e.request({begin:t,end:i,onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)}),this._requests=[],this._queuedChunk=null,this._done=!1,this._storedError=void 0,this.onProgress=null,this.onClosed=null}_onHeadersReceived(){const e=$o(this._manager.getRequestXhr(this._requestId)?.responseURL);e!==this._manager._responseOrigin&&(this._storedError=new Error(`Expected range response-origin "${e}" to match "${this._manager._responseOrigin}".`),this._onError(0))}_close(){this.onClosed?.(this)}_onDone(e){const t=e.chunk;this._requests.length>0?this._requests.shift().resolve({value:t,done:!1}):this._queuedChunk=t,this._done=!0;for(const i of this._requests)i.resolve({value:void 0,done:!0});this._requests.length=0,this._close()}_onError(e){this._storedError??=la(e,this._url);for(const t of this._requests)t.reject(this._storedError);this._requests.length=0,this._queuedChunk=null}_onProgress(e){this.isStreamingSupported||this.onProgress?.({loaded:e.loaded})}get isStreamingSupported(){return!1}async read(){if(this._storedError)throw this._storedError;if(this._queuedChunk!==null){const t=this._queuedChunk;return this._queuedChunk=null,{value:t,done:!1}}if(this._done)return{value:void 0,done:!0};const e=Promise.withResolvers();return this._requests.push(e),e.promise}cancel(e){this._done=!0;for(const t of this._requests)t.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._requestId)&&this._manager.abortRequest(this._requestId),this._close()}}const ky=/^[a-z][a-z0-9\-+.]+:/i;function Sy(h){if(ky.test(h))return new URL(h);const e=process.getBuiltinModule("url");return new URL(e.pathToFileURL(h))}class Ay{constructor(e){this.source=e,this.url=Sy(e.url),Be(this.url.protocol==="file:","PDFNodeStream only supports file:// URLs."),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){return this._fullRequestReader?._loaded??0}getFullReader(){return Be(!this._fullRequestReader,"PDFNodeStream.getFullReader can only be called once."),this._fullRequestReader=new Cy(this),this._fullRequestReader}getRangeReader(e,t){if(t<=this._progressiveDataLength)return null;const i=new Ty(this,e,t);return this._rangeRequestReaders.push(i),i}cancelAllRequests(e){this._fullRequestReader?.cancel(e);for(const t of this._rangeRequestReaders.slice(0))t.cancel(e)}}class Cy{constructor(e){this._url=e.url,this._done=!1,this._storedError=null,this.onProgress=null;const t=e.source;this._contentLength=t.length,this._loaded=0,this._filename=null,this._disableRange=t.disableRange||!1,this._rangeChunkSize=t.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!t.disableStream,this._isRangeSupported=!t.disableRange,this._readableStream=null,this._readCapability=Promise.withResolvers(),this._headersCapability=Promise.withResolvers();const i=process.getBuiltinModule("fs");i.promises.lstat(this._url).then(r=>{this._contentLength=r.size,this._setReadableStream(i.createReadStream(this._url)),this._headersCapability.resolve()},r=>{r.code==="ENOENT"&&(r=la(0,this._url.href)),this._storedError=r,this._headersCapability.reject(r)})}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const e=this._readableStream.read();return e===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=e.length,this.onProgress?.({loaded:this._loaded,total:this._contentLength}),{value:new Uint8Array(e).buffer,done:!1})}cancel(e){if(!this._readableStream){this._error(e);return}this._readableStream.destroy(e)}_error(e){this._storedError=e,this._readCapability.resolve()}_setReadableStream(e){this._readableStream=e,e.on("readable",()=>{this._readCapability.resolve()}),e.on("end",()=>{e.destroy(),this._done=!0,this._readCapability.resolve()}),e.on("error",t=>{this._error(t)}),!this._isStreamingSupported&&this._isRangeSupported&&this._error(new ci("streaming is disabled")),this._storedError&&this._readableStream.destroy(this._storedError)}}class Ty{constructor(e,t,i){this._url=e.url,this._done=!1,this._storedError=null,this.onProgress=null,this._loaded=0,this._readableStream=null,this._readCapability=Promise.withResolvers();const r=e.source;this._isStreamingSupported=!r.disableStream;const a=process.getBuiltinModule("fs");this._setReadableStream(a.createReadStream(this._url,{start:t,end:i-1}))}get isStreamingSupported(){return this._isStreamingSupported}async read(){if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const e=this._readableStream.read();return e===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=e.length,this.onProgress?.({loaded:this._loaded}),{value:new Uint8Array(e).buffer,done:!1})}cancel(e){if(!this._readableStream){this._error(e);return}this._readableStream.destroy(e)}_error(e){this._storedError=e,this._readCapability.resolve()}_setReadableStream(e){this._readableStream=e,e.on("readable",()=>{this._readCapability.resolve()}),e.on("end",()=>{e.destroy(),this._done=!0,this._readCapability.resolve()}),e.on("error",t=>{this._error(t)}),this._storedError&&this._readableStream.destroy(this._storedError)}}const Hr=Symbol("INITIAL_DATA");class Lp{#e=Object.create(null);#t(e){return this.#e[e]||={...Promise.withResolvers(),data:Hr}}get(e,t=null){if(t){const r=this.#t(e);return r.promise.then(()=>t(r.data)),null}const i=this.#e[e];if(!i||i.data===Hr)throw new Error(`Requesting object that isn't resolved yet ${e}.`);return i.data}has(e){const t=this.#e[e];return!!t&&t.data!==Hr}delete(e){const t=this.#e[e];return!t||t.data===Hr?!1:(delete this.#e[e],!0)}resolve(e,t=null){const i=this.#t(e);i.data=t,i.resolve()}clear(){for(const e in this.#e){const{data:t}=this.#e[e];t?.bitmap?.close()}this.#e=Object.create(null)}*[Symbol.iterator](){for(const e in this.#e){const{data:t}=this.#e[e];t!==Hr&&(yield[e,t])}}}const Ey=1e5,Kf=30;let Zr=class Cn{#e=Promise.withResolvers();#t=null;#i=!1;#n=!!globalThis.FontInspector?.enabled;#a=null;#s=null;#r=0;#o=0;#c=null;#l=null;#u=0;#h=0;#f=Object.create(null);#g=[];#p=null;#d=[];#m=new WeakMap;#y=null;static#b=new Map;static#w=new Map;static#C=new WeakMap;static#S=null;static#v=new Set;constructor({textContentSource:e,container:t,viewport:i}){if(e instanceof ReadableStream)this.#p=e;else if(typeof e=="object")this.#p=new ReadableStream({start(d){d.enqueue(e),d.close()}});else throw new Error('No "textContentSource" parameter specified.');this.#t=this.#l=t,this.#h=i.scale*Ln.pixelRatio,this.#u=i.rotation,this.#s={div:null,properties:null,ctx:null};const{pageWidth:r,pageHeight:a,pageX:o,pageY:c}=i.rawDims;this.#y=[1,0,0,-1,-o,c+a],this.#o=r,this.#r=a,Cn.#_(),qi(t,i),this.#e.promise.finally(()=>{Cn.#v.delete(this),this.#s=null,this.#f=null}).catch(()=>{})}static get fontFamilyMap(){const{isWindows:e,isFirefox:t}=Pt.platform;return Le(this,"fontFamilyMap",new Map([["sans-serif",`${e&&t?"Calibri, ":""}sans-serif`],["monospace",`${e&&t?"Lucida Console, ":""}monospace`]]))}render(){const e=()=>{this.#c.read().then(({value:t,done:i})=>{if(i){this.#e.resolve();return}this.#a??=t.lang,Object.assign(this.#f,t.styles),this.#E(t.items),e()},this.#e.reject)};return this.#c=this.#p.getReader(),Cn.#v.add(this),e(),this.#e.promise}update({viewport:e,onBefore:t=null}){const i=e.scale*Ln.pixelRatio,r=e.rotation;if(r!==this.#u&&(t?.(),this.#u=r,qi(this.#l,{rotation:r})),i!==this.#h){t?.(),this.#h=i;const a={div:null,properties:null,ctx:Cn.#N(this.#a)};for(const o of this.#d)a.properties=this.#m.get(o),a.div=o,this.#A(a)}}cancel(){const e=new ci("TextLayer task cancelled.");this.#c?.cancel(e).catch(()=>{}),this.#c=null,this.#e.reject(e)}get textDivs(){return this.#d}get textContentItemsStr(){return this.#g}#E(e){if(this.#i)return;this.#s.ctx??=Cn.#N(this.#a);const t=this.#d,i=this.#g;for(const r of e){if(t.length>Ey){Ie("Ignoring additional textDivs for performance reasons."),this.#i=!0;return}if(r.str===void 0){if(r.type==="beginMarkedContentProps"||r.type==="beginMarkedContent"){const a=this.#t;this.#t=document.createElement("span"),this.#t.classList.add("markedContent"),r.id&&this.#t.setAttribute("id",`${r.id}`),a.append(this.#t)}else r.type==="endMarkedContent"&&(this.#t=this.#t.parentNode);continue}i.push(r.str),this.#k(r)}}#k(e){const t=document.createElement("span"),i={angle:0,canvasWidth:0,hasText:e.str!=="",hasEOL:e.hasEOL,fontSize:0};this.#d.push(t);const r=ve.transform(this.#y,e.transform);let a=Math.atan2(r[1],r[0]);const o=this.#f[e.fontName];o.vertical&&(a+=Math.PI/2);let c=this.#n&&o.fontSubstitution||o.fontFamily;c=Cn.fontFamilyMap.get(c)||c;const d=Math.hypot(r[2],r[3]),f=d*Cn.#F(c,o,this.#a);let p,g;a===0?(p=r[4],g=r[5]-f):(p=r[4]+f*Math.sin(a),g=r[5]-f*Math.cos(a));const w="calc(var(--total-scale-factor) *",x=t.style;this.#t===this.#l?(x.left=`${(100*p/this.#o).toFixed(2)}%`,x.top=`${(100*g/this.#r).toFixed(2)}%`):(x.left=`${w}${p.toFixed(2)}px)`,x.top=`${w}${g.toFixed(2)}px)`),x.fontSize=`${w}${(Cn.#S*d).toFixed(2)}px)`,x.fontFamily=c,i.fontSize=d,t.setAttribute("role","presentation"),t.textContent=e.str,t.dir=e.dir,this.#n&&(t.dataset.fontName=o.fontSubstitutionLoadedName||e.fontName),a!==0&&(i.angle=a*(180/Math.PI));let k=!1;if(e.str.length>1)k=!0;else if(e.str!==" "&&e.transform[0]!==e.transform[3]){const v=Math.abs(e.transform[0]),A=Math.abs(e.transform[3]);v!==A&&Math.max(v,A)/Math.min(v,A)>1.5&&(k=!0)}if(k&&(i.canvasWidth=o.vertical?e.height:e.width),this.#m.set(t,i),this.#s.div=t,this.#s.properties=i,this.#A(this.#s),i.hasText&&this.#t.append(t),i.hasEOL){const v=document.createElement("br");v.setAttribute("role","presentation"),this.#t.append(v)}}#A(e){const{div:t,properties:i,ctx:r}=e,{style:a}=t;let o="";if(Cn.#S>1&&(o=`scale(${1/Cn.#S})`),i.canvasWidth!==0&&i.hasText){const{fontFamily:c}=a,{canvasWidth:d,fontSize:f}=i;Cn.#R(r,f*this.#h,c);const{width:p}=r.measureText(t.textContent);p>0&&(o=`scaleX(${d*this.#h/p}) ${o}`)}i.angle!==0&&(o=`rotate(${i.angle}deg) ${o}`),o.length>0&&(a.transform=o)}static cleanup(){if(!(this.#v.size>0)){this.#b.clear();for(const{canvas:e}of this.#w.values())e.remove();this.#w.clear()}}static#N(e=null){let t=this.#w.get(e||="");if(!t){const i=document.createElement("canvas");i.className="hiddenCanvasElement",i.lang=e,document.body.append(i),t=i.getContext("2d",{alpha:!1,willReadFrequently:!0}),this.#w.set(e,t),this.#C.set(t,{size:0,family:""})}return t}static#R(e,t,i){const r=this.#C.get(e);t===r.size&&i===r.family||(e.font=`${t}px ${i}`,r.size=t,r.family=i)}static#_(){if(this.#S!==null)return;const e=document.createElement("div");e.style.opacity=0,e.style.lineHeight=1,e.style.fontSize="1px",e.style.position="absolute",e.textContent="X",document.body.append(e),this.#S=e.getBoundingClientRect().height,e.remove()}static#F(e,t,i){const r=this.#b.get(e);if(r)return r;const a=this.#N(i);a.canvas.width=a.canvas.height=Kf,this.#R(a,Kf,e);const o=a.measureText(""),c=o.fontBoundingBoxAscent,d=Math.abs(o.fontBoundingBoxDescent);a.canvas.width=a.canvas.height=0;let f=.8;return c?f=c/(c+d):(Pt.platform.isFirefox&&Ie("Enable the `dom.textMetrics.fontBoundingBox.enabled` preference in `about:config` to improve TextLayer rendering."),t.ascent?f=t.ascent:t.descent&&(f=1+t.descent)),this.#b.set(e,f),f}};const Ry=100;function Ed(h={}){typeof h=="string"||h instanceof URL?h={url:h}:(h instanceof ArrayBuffer||ArrayBuffer.isView(h))&&(h={data:h});const e=new Rd,{docId:t}=e,i=h.url?j0(h.url):null,r=h.data?F0(h.data):null,a=h.httpHeaders||null,o=h.withCredentials===!0,c=h.password??null,d=h.range instanceof _d?h.range:null,f=Number.isInteger(h.rangeChunkSize)&&h.rangeChunkSize>0?h.rangeChunkSize:2**16;let p=h.worker instanceof Zs?h.worker:null;const g=h.verbosity,w=typeof h.docBaseUrl=="string"&&!ra(h.docBaseUrl)?h.docBaseUrl:null,x=Eo(h.cMapUrl),k=h.cMapPacked!==!1,v=h.CMapReaderFactory||(zt?z0:Df),A=Eo(h.iccUrl),C=Eo(h.standardFontDataUrl),T=h.StandardFontDataFactory||(zt?U0:Lf),R=Eo(h.wasmUrl),E=h.WasmFactory||(zt?$0:jf),_=h.stopAtErrors!==!0,M=Number.isInteger(h.maxImageSize)&&h.maxImageSize>-1?h.maxImageSize:-1,N=h.isEvalSupported!==!1,I=typeof h.isOffscreenCanvasSupported=="boolean"?h.isOffscreenCanvasSupported:!zt,G=typeof h.isImageDecoderSupported=="boolean"?h.isImageDecoderSupported:!zt&&(Pt.platform.isFirefox||!globalThis.chrome),F=Number.isInteger(h.canvasMaxAreaInBytes)?h.canvasMaxAreaInBytes:-1,B=typeof h.disableFontFace=="boolean"?h.disableFontFace:zt,X=h.fontExtraProperties===!0,oe=h.enableXfa===!0,le=h.ownerDocument||globalThis.document,z=h.disableRange===!0,K=h.disableStream===!0,Q=h.disableAutoFetch===!0,V=h.pdfBug===!0,ce=h.CanvasFactory||(zt?G0:B0),re=h.FilterFactory||(zt?H0:W0),j=h.enableHWA===!0,$=h.useWasm!==!1,se=d?d.length:h.length??NaN,ue=typeof h.useSystemFonts=="boolean"?h.useSystemFonts:!zt&&!B,te=typeof h.useWorkerFetch=="boolean"?h.useWorkerFetch:!!(v===Df&&T===Lf&&E===jf&&x&&C&&R&&Ur(x,document.baseURI)&&Ur(C,document.baseURI)&&Ur(R,document.baseURI)),xe=null;y0(g);const ye={canvasFactory:new ce({ownerDocument:le,enableHWA:j}),filterFactory:new re({docId:t,ownerDocument:le}),cMapReaderFactory:te?null:new v({baseUrl:x,isCompressed:k}),standardFontDataFactory:te?null:new T({baseUrl:C}),wasmFactory:te?null:new E({baseUrl:R})};p||(p=Zs.create({verbosity:g,port:Oi.workerPort}),e._worker=p);const _e={docId:t,apiVersion:"5.4.296",data:r,password:c,disableAutoFetch:Q,rangeChunkSize:f,length:se,docBaseUrl:w,enableXfa:oe,evaluatorOptions:{maxImageSize:M,disableFontFace:B,ignoreErrors:_,isEvalSupported:N,isOffscreenCanvasSupported:I,isImageDecoderSupported:G,canvasMaxAreaInBytes:F,fontExtraProperties:X,useSystemFonts:ue,useWasm:$,useWorkerFetch:te,cMapUrl:x,iccUrl:A,standardFontDataUrl:C,wasmUrl:R}},J={ownerDocument:le,pdfBug:V,styleElement:xe,loadingParams:{disableAutoFetch:Q,enableXfa:oe}};return p.promise.then(function(){if(e.destroyed)throw new Error("Loading aborted");if(p.destroyed)throw new Error("Worker was destroyed");const me=p.messageHandler.sendWithPromise("GetDocRequest",_e,r?[r.buffer]:null);let Ve;if(d)Ve=new dy(d,{disableRange:z,disableStream:K});else if(!r){if(!i)throw new Error("getDocument - no `url` parameter provided.");const ft=Ur(i)?py:zt?Ay:by;Ve=new ft({url:i,length:se,httpHeaders:a,withCredentials:o,rangeChunkSize:f,disableRange:z,disableStream:K})}return me.then(ft=>{if(e.destroyed)throw new Error("Loading aborted");if(p.destroyed)throw new Error("Worker was destroyed");const ee=new $r(t,ft,p.port),fe=new Py(ee,e,Ve,J,ye,j);e._transport=fe,ee.send("Ready",null)})}).catch(e._capability.reject),e}class Rd{static#e=0;_capability=Promise.withResolvers();_transport=null;_worker=null;docId=`d${Rd.#e++}`;destroyed=!1;onPassword=null;onProgress=null;get promise(){return this._capability.promise}async destroy(){this.destroyed=!0;try{this._worker?.port&&(this._worker._pendingDestroy=!0),await this._transport?.destroy()}catch(e){throw this._worker?.port&&delete this._worker._pendingDestroy,e}this._transport=null,this._worker?.destroy(),this._worker=null}async getData(){return this._transport.getData()}}let _d=class{#e=Promise.withResolvers();#t=[];#i=[];#n=[];#a=[];constructor(e,t,i=!1,r=null){this.length=e,this.initialData=t,this.progressiveDone=i,this.contentDispositionFilename=r}addRangeListener(e){this.#a.push(e)}addProgressListener(e){this.#n.push(e)}addProgressiveReadListener(e){this.#i.push(e)}addProgressiveDoneListener(e){this.#t.push(e)}onDataRange(e,t){for(const i of this.#a)i(e,t)}onDataProgress(e,t){this.#e.promise.then(()=>{for(const i of this.#n)i(e,t)})}onDataProgressiveRead(e){this.#e.promise.then(()=>{for(const t of this.#i)t(e)})}onDataProgressiveDone(){this.#e.promise.then(()=>{for(const e of this.#t)e()})}transportReady(){this.#e.resolve()}requestDataRange(e,t){Ye("Abstract method PDFDataRangeTransport.requestDataRange")}abort(){}};class _y{constructor(e,t){this._pdfInfo=e,this._transport=t}get annotationStorage(){return this._transport.annotationStorage}get canvasFactory(){return this._transport.canvasFactory}get filterFactory(){return this._transport.filterFactory}get numPages(){return this._pdfInfo.numPages}get fingerprints(){return this._pdfInfo.fingerprints}get isPureXfa(){return Le(this,"isPureXfa",!!this._transport._htmlForXfa)}get allXfaHtml(){return this._transport._htmlForXfa}getPage(e){return this._transport.getPage(e)}getPageIndex(e){return this._transport.getPageIndex(e)}getDestinations(){return this._transport.getDestinations()}getDestination(e){return this._transport.getDestination(e)}getPageLabels(){return this._transport.getPageLabels()}getPageLayout(){return this._transport.getPageLayout()}getPageMode(){return this._transport.getPageMode()}getViewerPreferences(){return this._transport.getViewerPreferences()}getOpenAction(){return this._transport.getOpenAction()}getAttachments(){return this._transport.getAttachments()}getAnnotationsByType(e,t){return this._transport.getAnnotationsByType(e,t)}getJSActions(){return this._transport.getDocJSActions()}getOutline(){return this._transport.getOutline()}getOptionalContentConfig({intent:e="display"}={}){const{renderingIntent:t}=this._transport.getRenderingIntent(e);return this._transport.getOptionalContentConfig(t)}getPermissions(){return this._transport.getPermissions()}getMetadata(){return this._transport.getMetadata()}getMarkInfo(){return this._transport.getMarkInfo()}getData(){return this._transport.getData()}saveDocument(){return this._transport.saveDocument()}getDownloadInfo(){return this._transport.downloadInfoCapability.promise}cleanup(e=!1){return this._transport.startCleanup(e||this.isPureXfa)}destroy(){return this.loadingTask.destroy()}cachedPageNumber(e){return this._transport.cachedPageNumber(e)}get loadingParams(){return this._transport.loadingParams}get loadingTask(){return this._transport.loadingTask}getFieldObjects(){return this._transport.getFieldObjects()}hasJSActions(){return this._transport.hasJSActions()}getCalculationOrderIds(){return this._transport.getCalculationOrderIds()}}class Ny{#e=!1;constructor(e,t,i,r=!1){this._pageIndex=e,this._pageInfo=t,this._transport=i,this._stats=r?new Ef:null,this._pdfBug=r,this.commonObjs=i.commonObjs,this.objs=new Lp,this._intentStates=new Map,this.destroyed=!1,this.recordedBBoxes=null}get pageNumber(){return this._pageIndex+1}get rotate(){return this._pageInfo.rotate}get ref(){return this._pageInfo.ref}get userUnit(){return this._pageInfo.userUnit}get view(){return this._pageInfo.view}getViewport({scale:e,rotation:t=this.rotate,offsetX:i=0,offsetY:r=0,dontFlip:a=!1}={}){return new sa({viewBox:this.view,userUnit:this.userUnit,scale:e,rotation:t,offsetX:i,offsetY:r,dontFlip:a})}getAnnotations({intent:e="display"}={}){const{renderingIntent:t}=this._transport.getRenderingIntent(e);return this._transport.getAnnotations(this._pageIndex,t)}getJSActions(){return this._transport.getPageJSActions(this._pageIndex)}get filterFactory(){return this._transport.filterFactory}get isPureXfa(){return Le(this,"isPureXfa",!!this._transport._htmlForXfa)}async getXfa(){return this._transport._htmlForXfa?.children[this._pageIndex]||null}render({canvasContext:e,canvas:t=e.canvas,viewport:i,intent:r="display",annotationMode:a=Yn.ENABLE,transform:o=null,background:c=null,optionalContentConfigPromise:d=null,annotationCanvasMap:f=null,pageColors:p=null,printAnnotationStorage:g=null,isEditing:w=!1,recordOperations:x=!1,operationsFilter:k=null}){this._stats?.time("Overall");const v=this._transport.getRenderingIntent(r,a,g,w),{renderingIntent:A,cacheKey:C}=v;this.#e=!1,d||=this._transport.getOptionalContentConfig(A);let T=this._intentStates.get(C);T||(T=Object.create(null),this._intentStates.set(C,T)),T.streamReaderCancelTimeout&&(clearTimeout(T.streamReaderCancelTimeout),T.streamReaderCancelTimeout=null);const R=!!(A&fn.PRINT);T.displayReadyCapability||(T.displayReadyCapability=Promise.withResolvers(),T.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},this._stats?.time("Page Request"),this._pumpOperatorList(v));const E=!!(this._pdfBug&&globalThis.StepperManager?.enabled),_=!this.recordedBBoxes&&(x||E),M=G=>{if(T.renderTasks.delete(N),_){const F=N.gfx?.dependencyTracker.take();F&&(N.stepper&&N.stepper.setOperatorBBoxes(F,N.gfx.dependencyTracker.takeDebugMetadata()),x&&(this.recordedBBoxes=F))}R&&(this.#e=!0),this.#t(),G?(N.capability.reject(G),this._abortOperatorList({intentState:T,reason:G instanceof Error?G:new Error(G)})):N.capability.resolve(),this._stats&&(this._stats.timeEnd("Rendering"),this._stats.timeEnd("Overall"),globalThis.Stats?.enabled&&globalThis.Stats.add(this.pageNumber,this._stats))},N=new Us({callback:M,params:{canvas:t,canvasContext:e,dependencyTracker:_?new K0(t,T.operatorList.length,E):null,viewport:i,transform:o,background:c},objs:this.objs,commonObjs:this.commonObjs,annotationCanvasMap:f,operatorList:T.operatorList,pageIndex:this._pageIndex,canvasFactory:this._transport.canvasFactory,filterFactory:this._transport.filterFactory,useRequestAnimationFrame:!R,pdfBug:this._pdfBug,pageColors:p,enableHWA:this._transport.enableHWA,operationsFilter:k});(T.renderTasks||=new Set).add(N);const I=N.task;return Promise.all([T.displayReadyCapability.promise,d]).then(([G,F])=>{if(this.destroyed){M();return}if(this._stats?.time("Rendering"),!(F.renderingIntent&A))throw new Error("Must use the same `intent`-argument when calling the `PDFPageProxy.render` and `PDFDocumentProxy.getOptionalContentConfig` methods.");N.initializeGraphics({transparency:G,optionalContentConfig:F}),N.operatorListChanged()}).catch(M),I}getOperatorList({intent:e="display",annotationMode:t=Yn.ENABLE,printAnnotationStorage:i=null,isEditing:r=!1}={}){function a(){c.operatorList.lastChunk&&(c.opListReadCapability.resolve(c.operatorList),c.renderTasks.delete(d))}const o=this._transport.getRenderingIntent(e,t,i,r,!0);let c=this._intentStates.get(o.cacheKey);c||(c=Object.create(null),this._intentStates.set(o.cacheKey,c));let d;return c.opListReadCapability||(d=Object.create(null),d.operatorListChanged=a,c.opListReadCapability=Promise.withResolvers(),(c.renderTasks||=new Set).add(d),c.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},this._stats?.time("Page Request"),this._pumpOperatorList(o)),c.opListReadCapability.promise}streamTextContent({includeMarkedContent:e=!1,disableNormalization:t=!1}={}){return this._transport.messageHandler.sendWithStream("GetTextContent",{pageIndex:this._pageIndex,includeMarkedContent:e===!0,disableNormalization:t===!0},{highWaterMark:100,size(r){return r.items.length}})}getTextContent(e={}){if(this._transport._htmlForXfa)return this.getXfa().then(i=>Jr.textContent(i));const t=this.streamTextContent(e);return new Promise(function(i,r){function a(){o.read().then(function({value:d,done:f}){if(f){i(c);return}c.lang??=d.lang,Object.assign(c.styles,d.styles),c.items.push(...d.items),a()},r)}const o=t.getReader(),c={items:[],styles:Object.create(null),lang:null};a()})}getStructTree(){return this._transport.getStructTree(this._pageIndex)}_destroy(){this.destroyed=!0;const e=[];for(const t of this._intentStates.values())if(this._abortOperatorList({intentState:t,reason:new Error("Page was destroyed."),force:!0}),!t.opListReadCapability)for(const i of t.renderTasks)e.push(i.completed),i.cancel();return this.objs.clear(),this.#e=!1,Promise.all(e)}cleanup(e=!1){this.#e=!0;const t=this.#t();return e&&t&&(this._stats&&=new Ef),t}#t(){if(!this.#e||this.destroyed)return!1;for(const{renderTasks:e,operatorList:t}of this._intentStates.values())if(e.size>0||!t.lastChunk)return!1;return this._intentStates.clear(),this.objs.clear(),this.#e=!1,!0}_startRenderPage(e,t){const i=this._intentStates.get(t);i&&(this._stats?.timeEnd("Page Request"),i.displayReadyCapability?.resolve(e))}_renderPageChunk(e,t){for(let i=0,r=e.length;i<r;i++)t.operatorList.fnArray.push(e.fnArray[i]),t.operatorList.argsArray.push(e.argsArray[i]);t.operatorList.lastChunk=e.lastChunk,t.operatorList.separateAnnots=e.separateAnnots;for(const i of t.renderTasks)i.operatorListChanged();e.lastChunk&&this.#t()}_pumpOperatorList({renderingIntent:e,cacheKey:t,annotationStorageSerializable:i,modifiedIds:r}){const{map:a,transfer:o}=i,d=this._transport.messageHandler.sendWithStream("GetOperatorList",{pageIndex:this._pageIndex,intent:e,cacheKey:t,annotationStorage:a,modifiedIds:r},o).getReader(),f=this._intentStates.get(t);f.streamReader=d;const p=()=>{d.read().then(({value:g,done:w})=>{if(w){f.streamReader=null;return}this._transport.destroyed||(this._renderPageChunk(g,f),p())},g=>{if(f.streamReader=null,!this._transport.destroyed){if(f.operatorList){f.operatorList.lastChunk=!0;for(const w of f.renderTasks)w.operatorListChanged();this.#t()}if(f.displayReadyCapability)f.displayReadyCapability.reject(g);else if(f.opListReadCapability)f.opListReadCapability.reject(g);else throw g}})};p()}_abortOperatorList({intentState:e,reason:t,force:i=!1}){if(e.streamReader){if(e.streamReaderCancelTimeout&&(clearTimeout(e.streamReaderCancelTimeout),e.streamReaderCancelTimeout=null),!i){if(e.renderTasks.size>0)return;if(t instanceof zo){let r=Ry;t.extraDelay>0&&t.extraDelay<1e3&&(r+=t.extraDelay),e.streamReaderCancelTimeout=setTimeout(()=>{e.streamReaderCancelTimeout=null,this._abortOperatorList({intentState:e,reason:t,force:!0})},r);return}}if(e.streamReader.cancel(new ci(t.message)).catch(()=>{}),e.streamReader=null,!this._transport.destroyed){for(const[r,a]of this._intentStates)if(a===e){this._intentStates.delete(r);break}this.cleanup()}}}get stats(){return this._stats}}var Fi,Dn,oi,as,Wo,os,ls,Ut,Lo,jp,Fp,Vr,Qs,jo;const st=class st{constructor({name:e=null,port:t=null,verbosity:i=w0()}={}){Hn(this,Ut);Hn(this,Fi,Promise.withResolvers());Hn(this,Dn,null);Hn(this,oi,null);Hn(this,as,null);if(this.name=e,this.destroyed=!1,this.verbosity=i,t){if(it(st,ls).has(t))throw new Error("Cannot use more than one PDFWorker per port.");it(st,ls).set(t,this),Gn(this,Ut,jp).call(this,t)}else Gn(this,Ut,Fp).call(this)}get promise(){return it(this,Fi).promise}get port(){return it(this,oi)}get messageHandler(){return it(this,Dn)}destroy(){this.destroyed=!0,it(this,as)?.terminate(),en(this,as,null),it(st,ls).delete(it(this,oi)),en(this,oi,null),it(this,Dn)?.destroy(),en(this,Dn,null)}static create(e){const t=it(this,ls).get(e?.port);if(t){if(t._pendingDestroy)throw new Error("PDFWorker.create - the worker is being destroyed.\nPlease remember to await `PDFDocumentLoadingTask.destroy()`-calls.");return t}return new st(e)}static get workerSrc(){if(Oi.workerSrc)return Oi.workerSrc;throw new Error('No "GlobalWorkerOptions.workerSrc" specified.')}static get _setupFakeWorkerGlobal(){return Le(this,"_setupFakeWorkerGlobal",(async()=>it(this,Qs,jo)?it(this,Qs,jo):(await import(this.workerSrc)).WorkerMessageHandler)())}};Fi=new WeakMap,Dn=new WeakMap,oi=new WeakMap,as=new WeakMap,Wo=new WeakMap,os=new WeakMap,ls=new WeakMap,Ut=new WeakSet,Lo=function(){it(this,Fi).resolve(),it(this,Dn).send("configure",{verbosity:this.verbosity})},jp=function(e){en(this,oi,e),en(this,Dn,new $r("main","worker",e)),it(this,Dn).on("ready",()=>{}),Gn(this,Ut,Lo).call(this)},Fp=function(){if(it(st,os)||it(st,Qs,jo)){Gn(this,Ut,Vr).call(this);return}let{workerSrc:e}=st;try{st._isSameOrigin(window.location,e)||(e=st._createCDNWrapper(new URL(e,window.location).href));const t=new Worker(e,{type:"module"}),i=new $r("main","worker",t),r=()=>{a.abort(),i.destroy(),t.terminate(),this.destroyed?it(this,Fi).reject(new Error("Worker was destroyed")):Gn(this,Ut,Vr).call(this)},a=new AbortController;t.addEventListener("error",()=>{it(this,as)||r()},{signal:a.signal}),i.on("test",c=>{if(a.abort(),this.destroyed||!c){r();return}en(this,Dn,i),en(this,oi,t),en(this,as,t),Gn(this,Ut,Lo).call(this)}),i.on("ready",c=>{if(a.abort(),this.destroyed){r();return}try{o()}catch{Gn(this,Ut,Vr).call(this)}});const o=()=>{const c=new Uint8Array;i.send("test",c,[c.buffer])};o();return}catch{Go("The worker has been disabled.")}Gn(this,Ut,Vr).call(this)},Vr=function(){it(st,os)||(Ie("Setting up fake worker."),en(st,os,!0)),st._setupFakeWorkerGlobal.then(e=>{if(this.destroyed){it(this,Fi).reject(new Error("Worker was destroyed"));return}const t=new q0;en(this,oi,t);const i=`fake${uf(st,Wo)._++}`,r=new $r(i+"_worker",i,t);e.setup(r,t),en(this,Dn,new $r(i,i+"_worker",t)),Gn(this,Ut,Lo).call(this)}).catch(e=>{it(this,Fi).reject(new Error(`Setting up fake worker failed: "${e.message}".`))})},Qs=new WeakSet,jo=function(){try{return globalThis.pdfjsWorker?.WorkerMessageHandler||null}catch{return null}},Hn(st,Qs),Hn(st,Wo,0),Hn(st,os,!1),Hn(st,ls,new WeakMap),zt&&(en(st,os,!0),Oi.workerSrc||="./pdf.worker.mjs"),st._isSameOrigin=(e,t)=>{const i=URL.parse(e);if(!i?.origin||i.origin==="null")return!1;const r=new URL(t,i);return i.origin===r.origin},st._createCDNWrapper=e=>{const t=`await import("${e}");`;return URL.createObjectURL(new Blob([t],{type:"text/javascript"}))},st.fromPort=e=>{if(E0("`PDFWorker.fromPort` - please use `PDFWorker.create` instead."),!e?.port)throw new Error("PDFWorker.fromPort - invalid method signature.");return st.create(e)};let Zs=st;class Py{#e=new Map;#t=new Map;#i=new Map;#n=new Map;#a=null;constructor(e,t,i,r,a,o){this.messageHandler=e,this.loadingTask=t,this.commonObjs=new Lp,this.fontLoader=new D0({ownerDocument:r.ownerDocument,styleElement:r.styleElement}),this.loadingParams=r.loadingParams,this._params=r,this.canvasFactory=a.canvasFactory,this.filterFactory=a.filterFactory,this.cMapReaderFactory=a.cMapReaderFactory,this.standardFontDataFactory=a.standardFontDataFactory,this.wasmFactory=a.wasmFactory,this.destroyed=!1,this.destroyCapability=null,this._networkStream=i,this._fullReader=null,this._lastProgress=null,this.downloadInfoCapability=Promise.withResolvers(),this.enableHWA=o,this.setupMessageHandler()}#s(e,t=null){const i=this.#e.get(e);if(i)return i;const r=this.messageHandler.sendWithPromise(e,t);return this.#e.set(e,r),r}get annotationStorage(){return Le(this,"annotationStorage",new Sd)}getRenderingIntent(e,t=Yn.ENABLE,i=null,r=!1,a=!1){let o=fn.DISPLAY,c=nd;switch(e){case"any":o=fn.ANY;break;case"display":break;case"print":o=fn.PRINT;break;default:Ie(`getRenderingIntent - invalid intent: ${e}`)}const d=o&fn.PRINT&&i instanceof kp?i:this.annotationStorage;switch(t){case Yn.DISABLE:o+=fn.ANNOTATIONS_DISABLE;break;case Yn.ENABLE:break;case Yn.ENABLE_FORMS:o+=fn.ANNOTATIONS_FORMS;break;case Yn.ENABLE_STORAGE:o+=fn.ANNOTATIONS_STORAGE,c=d.serializable;break;default:Ie(`getRenderingIntent - invalid annotationMode: ${t}`)}r&&(o+=fn.IS_EDITING),a&&(o+=fn.OPLIST);const{ids:f,hash:p}=d.modifiedIds,g=[o,c.hash,p];return{renderingIntent:o,cacheKey:g.join("_"),annotationStorageSerializable:c,modifiedIds:f}}destroy(){if(this.destroyCapability)return this.destroyCapability.promise;this.destroyed=!0,this.destroyCapability=Promise.withResolvers(),this.#a?.reject(new Error("Worker was destroyed during onPassword callback"));const e=[];for(const i of this.#t.values())e.push(i._destroy());this.#t.clear(),this.#i.clear(),this.#n.clear(),this.hasOwnProperty("annotationStorage")&&this.annotationStorage.resetModified();const t=this.messageHandler.sendWithPromise("Terminate",null);return e.push(t),Promise.all(e).then(()=>{this.commonObjs.clear(),this.fontLoader.clear(),this.#e.clear(),this.filterFactory.destroy(),Zr.cleanup(),this._networkStream?.cancelAllRequests(new ci("Worker was terminated.")),this.messageHandler?.destroy(),this.messageHandler=null,this.destroyCapability.resolve()},this.destroyCapability.reject),this.destroyCapability.promise}setupMessageHandler(){const{messageHandler:e,loadingTask:t}=this;e.on("GetReader",(i,r)=>{Be(this._networkStream,"GetReader - no `IPDFStream` instance available."),this._fullReader=this._networkStream.getFullReader(),this._fullReader.onProgress=a=>{this._lastProgress={loaded:a.loaded,total:a.total}},r.onPull=()=>{this._fullReader.read().then(function({value:a,done:o}){if(o){r.close();return}Be(a instanceof ArrayBuffer,"GetReader - expected an ArrayBuffer."),r.enqueue(new Uint8Array(a),1,[a])}).catch(a=>{r.error(a)})},r.onCancel=a=>{this._fullReader.cancel(a),r.ready.catch(o=>{if(!this.destroyed)throw o})}}),e.on("ReaderHeadersReady",async i=>{await this._fullReader.headersReady;const{isStreamingSupported:r,isRangeSupported:a,contentLength:o}=this._fullReader;return(!r||!a)&&(this._lastProgress&&t.onProgress?.(this._lastProgress),this._fullReader.onProgress=c=>{t.onProgress?.({loaded:c.loaded,total:c.total})}),{isStreamingSupported:r,isRangeSupported:a,contentLength:o}}),e.on("GetRangeReader",(i,r)=>{Be(this._networkStream,"GetRangeReader - no `IPDFStream` instance available.");const a=this._networkStream.getRangeReader(i.begin,i.end);if(!a){r.close();return}r.onPull=()=>{a.read().then(function({value:o,done:c}){if(c){r.close();return}Be(o instanceof ArrayBuffer,"GetRangeReader - expected an ArrayBuffer."),r.enqueue(new Uint8Array(o),1,[o])}).catch(o=>{r.error(o)})},r.onCancel=o=>{a.cancel(o),r.ready.catch(c=>{if(!this.destroyed)throw c})}}),e.on("GetDoc",({pdfInfo:i})=>{this._numPages=i.numPages,this._htmlForXfa=i.htmlForXfa,delete i.htmlForXfa,t._capability.resolve(new _y(i,this))}),e.on("DocException",i=>{t._capability.reject(sn(i))}),e.on("PasswordRequest",i=>{this.#a=Promise.withResolvers();try{if(!t.onPassword)throw sn(i);const r=a=>{a instanceof Error?this.#a.reject(a):this.#a.resolve({password:a})};t.onPassword(r,i.code)}catch(r){this.#a.reject(r)}return this.#a.promise}),e.on("DataLoaded",i=>{t.onProgress?.({loaded:i.length,total:i.length}),this.downloadInfoCapability.resolve(i)}),e.on("StartRenderPage",i=>{if(this.destroyed)return;this.#t.get(i.pageIndex)._startRenderPage(i.transparency,i.cacheKey)}),e.on("commonobj",([i,r,a])=>{if(this.destroyed||this.commonObjs.has(i))return null;switch(r){case"Font":if("error"in a){const p=a.error;Ie(`Error during font loading: ${p}`),this.commonObjs.resolve(i,p);break}const o=new $e(a),c=this._params.pdfBug&&globalThis.FontInspector?.enabled?(p,g)=>globalThis.FontInspector.fontAdded(p,g):null,d=new L0(o,c,a.extra,a.charProcOperatorList);this.fontLoader.bind(d).catch(()=>e.sendWithPromise("FontFallback",{id:i})).finally(()=>{!d.fontExtraProperties&&d.data&&d.clearData(),this.commonObjs.resolve(i,d)});break;case"CopyLocalImage":const{imageRef:f}=a;Be(f,"The imageRef must be defined.");for(const p of this.#t.values())for(const[,g]of p.objs)if(g?.ref===f)return g.dataLen?(this.commonObjs.resolve(i,structuredClone(g)),g.dataLen):null;break;case"FontPath":case"Image":case"Pattern":this.commonObjs.resolve(i,a);break;default:throw new Error(`Got unknown common object type ${r}`)}return null}),e.on("obj",([i,r,a,o])=>{if(this.destroyed)return;const c=this.#t.get(r);if(!c.objs.has(i)){if(c._intentStates.size===0){o?.bitmap?.close();return}switch(a){case"Image":case"Pattern":c.objs.resolve(i,o);break;default:throw new Error(`Got unknown object type ${a}`)}}}),e.on("DocProgress",i=>{this.destroyed||t.onProgress?.({loaded:i.loaded,total:i.total})}),e.on("FetchBinaryData",async i=>{if(this.destroyed)throw new Error("Worker was destroyed.");const r=this[i.type];if(!r)throw new Error(`${i.type} not initialized, see the \`useWorkerFetch\` parameter.`);return r.fetch(i)})}getData(){return this.messageHandler.sendWithPromise("GetData",null)}saveDocument(){this.annotationStorage.size<=0&&Ie("saveDocument called while `annotationStorage` is empty, please use the getData-method instead.");const{map:e,transfer:t}=this.annotationStorage.serializable;return this.messageHandler.sendWithPromise("SaveDocument",{isPureXfa:!!this._htmlForXfa,numPages:this._numPages,annotationStorage:e,filename:this._fullReader?.filename??null},t).finally(()=>{this.annotationStorage.resetModified()})}getPage(e){if(!Number.isInteger(e)||e<=0||e>this._numPages)return Promise.reject(new Error("Invalid page request."));const t=e-1,i=this.#i.get(t);if(i)return i;const r=this.messageHandler.sendWithPromise("GetPage",{pageIndex:t}).then(a=>{if(this.destroyed)throw new Error("Transport destroyed");a.refStr&&this.#n.set(a.refStr,e);const o=new Ny(t,a,this,this._params.pdfBug);return this.#t.set(t,o),o});return this.#i.set(t,r),r}getPageIndex(e){return id(e)?this.messageHandler.sendWithPromise("GetPageIndex",{num:e.num,gen:e.gen}):Promise.reject(new Error("Invalid pageIndex request."))}getAnnotations(e,t){return this.messageHandler.sendWithPromise("GetAnnotations",{pageIndex:e,intent:t})}getFieldObjects(){return this.#s("GetFieldObjects")}hasJSActions(){return this.#s("HasJSActions")}getCalculationOrderIds(){return this.messageHandler.sendWithPromise("GetCalculationOrderIds",null)}getDestinations(){return this.messageHandler.sendWithPromise("GetDestinations",null)}getDestination(e){return typeof e!="string"?Promise.reject(new Error("Invalid destination request.")):this.messageHandler.sendWithPromise("GetDestination",{id:e})}getPageLabels(){return this.messageHandler.sendWithPromise("GetPageLabels",null)}getPageLayout(){return this.messageHandler.sendWithPromise("GetPageLayout",null)}getPageMode(){return this.messageHandler.sendWithPromise("GetPageMode",null)}getViewerPreferences(){return this.messageHandler.sendWithPromise("GetViewerPreferences",null)}getOpenAction(){return this.messageHandler.sendWithPromise("GetOpenAction",null)}getAttachments(){return this.messageHandler.sendWithPromise("GetAttachments",null)}getAnnotationsByType(e,t){return this.messageHandler.sendWithPromise("GetAnnotationsByType",{types:e,pageIndexesToSkip:t})}getDocJSActions(){return this.#s("GetDocJSActions")}getPageJSActions(e){return this.messageHandler.sendWithPromise("GetPageJSActions",{pageIndex:e})}getStructTree(e){return this.messageHandler.sendWithPromise("GetStructTree",{pageIndex:e})}getOutline(){return this.messageHandler.sendWithPromise("GetOutline",null)}getOptionalContentConfig(e){return this.#s("GetOptionalContentConfig").then(t=>new cy(t,e))}getPermissions(){return this.messageHandler.sendWithPromise("GetPermissions",null)}getMetadata(){const e="GetMetadata",t=this.#e.get(e);if(t)return t;const i=this.messageHandler.sendWithPromise(e,null).then(r=>({info:r[0],metadata:r[1]?new oy(r[1]):null,contentDispositionFilename:this._fullReader?.filename??null,contentLength:this._fullReader?.contentLength??null}));return this.#e.set(e,i),i}getMarkInfo(){return this.messageHandler.sendWithPromise("GetMarkInfo",null)}async startCleanup(e=!1){if(!this.destroyed){await this.messageHandler.sendWithPromise("Cleanup",null);for(const t of this.#t.values())if(!t.cleanup())throw new Error(`startCleanup: Page ${t.pageNumber} is currently rendering.`);this.commonObjs.clear(),e||this.fontLoader.clear(),this.#e.clear(),this.filterFactory.destroy(!0),Zr.cleanup()}}cachedPageNumber(e){if(!id(e))return null;const t=e.gen===0?`${e.num}R`:`${e.num}R${e.gen}`;return this.#n.get(t)??null}}class My{#e=null;onContinue=null;onError=null;constructor(e){this.#e=e}get promise(){return this.#e.capability.promise}cancel(e=0){this.#e.cancel(null,e)}get separateAnnots(){const{separateAnnots:e}=this.#e.operatorList;if(!e)return!1;const{annotationCanvasMap:t}=this.#e;return e.form||e.canvas&&t?.size>0}}class Us{#e=null;static#t=new WeakSet;constructor({callback:e,params:t,objs:i,commonObjs:r,annotationCanvasMap:a,operatorList:o,pageIndex:c,canvasFactory:d,filterFactory:f,useRequestAnimationFrame:p=!1,pdfBug:g=!1,pageColors:w=null,enableHWA:x=!1,operationsFilter:k=null}){this.callback=e,this.params=t,this.objs=i,this.commonObjs=r,this.annotationCanvasMap=a,this.operatorListIdx=null,this.operatorList=o,this._pageIndex=c,this.canvasFactory=d,this.filterFactory=f,this._pdfBug=g,this.pageColors=w,this.running=!1,this.graphicsReadyCallback=null,this.graphicsReady=!1,this._useRequestAnimationFrame=p===!0&&typeof window<"u",this.cancelled=!1,this.capability=Promise.withResolvers(),this.task=new My(this),this._cancelBound=this.cancel.bind(this),this._continueBound=this._continue.bind(this),this._scheduleNextBound=this._scheduleNext.bind(this),this._nextBound=this._next.bind(this),this._canvas=t.canvas,this._canvasContext=t.canvas?null:t.canvasContext,this._enableHWA=x,this._dependencyTracker=t.dependencyTracker,this._operationsFilter=k}get completed(){return this.capability.promise.catch(function(){})}initializeGraphics({transparency:e=!1,optionalContentConfig:t}){if(this.cancelled)return;if(this._canvas){if(Us.#t.has(this._canvas))throw new Error("Cannot use the same canvas during multiple render() operations. Use different canvas or ensure previous operations were cancelled or completed.");Us.#t.add(this._canvas)}this._pdfBug&&globalThis.StepperManager?.enabled&&(this.stepper=globalThis.StepperManager.create(this._pageIndex),this.stepper.init(this.operatorList),this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint());const{viewport:i,transform:r,background:a,dependencyTracker:o}=this.params,c=this._canvasContext||this._canvas.getContext("2d",{alpha:!1,willReadFrequently:!this._enableHWA});this.gfx=new $s(c,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:t},this.annotationCanvasMap,this.pageColors,o),this.gfx.beginDrawing({transform:r,viewport:i,transparency:e,background:a}),this.operatorListIdx=0,this.graphicsReady=!0,this.graphicsReadyCallback?.()}cancel(e=null,t=0){this.running=!1,this.cancelled=!0,this.gfx?.endDrawing(),this.#e&&(window.cancelAnimationFrame(this.#e),this.#e=null),Us.#t.delete(this._canvas),e||=new zo(`Rendering cancelled, page ${this._pageIndex+1}`,t),this.callback(e),this.task.onError?.(e)}operatorListChanged(){if(!this.graphicsReady){this.graphicsReadyCallback||=this._continueBound;return}this.gfx.dependencyTracker?.growOperationsCount(this.operatorList.fnArray.length),this.stepper?.updateOperatorList(this.operatorList),!this.running&&this._continue()}_continue(){this.running=!0,!this.cancelled&&(this.task.onContinue?this.task.onContinue(this._scheduleNextBound):this._scheduleNext())}_scheduleNext(){this._useRequestAnimationFrame?this.#e=window.requestAnimationFrame(()=>{this.#e=null,this._nextBound().catch(this._cancelBound)}):Promise.resolve().then(this._nextBound).catch(this._cancelBound)}async _next(){this.cancelled||(this.operatorListIdx=this.gfx.executeOperatorList(this.operatorList,this.operatorListIdx,this._continueBound,this.stepper,this._operationsFilter),this.operatorListIdx===this.operatorList.argsArray.length&&(this.running=!1,this.operatorList.lastChunk&&(this.gfx.endDrawing(),Us.#t.delete(this._canvas),this.callback())))}}const Nd="5.4.296",Op="f56dc8601";class pn{#e=null;#t=null;#i;#n=null;#a=!1;#s=!1;#r=null;#o;#c=null;#l=null;static#u=null;static get _keyboardManager(){return Le(this,"_keyboardManager",new aa([[["Escape","mac+Escape"],pn.prototype._hideDropdownFromKeyboard],[[" ","mac+ "],pn.prototype._colorSelectFromKeyboard],[["ArrowDown","ArrowRight","mac+ArrowDown","mac+ArrowRight"],pn.prototype._moveToNext],[["ArrowUp","ArrowLeft","mac+ArrowUp","mac+ArrowLeft"],pn.prototype._moveToPrevious],[["Home","mac+Home"],pn.prototype._moveToBeginning],[["End","mac+End"],pn.prototype._moveToEnd]]))}constructor({editor:e=null,uiManager:t=null}){e?(this.#s=!1,this.#r=e):this.#s=!0,this.#l=e?._uiManager||t,this.#o=this.#l._eventBus,this.#i=e?.color?.toUpperCase()||this.#l?.highlightColors.values().next().value||"#FFFF98",pn.#u||=Object.freeze({blue:"pdfjs-editor-colorpicker-blue",green:"pdfjs-editor-colorpicker-green",pink:"pdfjs-editor-colorpicker-pink",red:"pdfjs-editor-colorpicker-red",yellow:"pdfjs-editor-colorpicker-yellow"})}renderButton(){const e=this.#e=document.createElement("button");e.className="colorPicker",e.tabIndex="0",e.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-button"),e.ariaHasPopup="true",this.#r&&(e.ariaControls=`${this.#r.id}_colorpicker_dropdown`);const t=this.#l._signal;e.addEventListener("click",this.#p.bind(this),{signal:t}),e.addEventListener("keydown",this.#g.bind(this),{signal:t});const i=this.#t=document.createElement("span");return i.className="swatch",i.ariaHidden="true",i.style.backgroundColor=this.#i,e.append(i),e}renderMainDropdown(){const e=this.#n=this.#h();return e.ariaOrientation="horizontal",e.ariaLabelledBy="highlightColorPickerLabel",e}#h(){const e=document.createElement("div"),t=this.#l._signal;e.addEventListener("contextmenu",gn,{signal:t}),e.className="dropdown",e.role="listbox",e.ariaMultiSelectable="false",e.ariaOrientation="vertical",e.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-dropdown"),this.#r&&(e.id=`${this.#r.id}_colorpicker_dropdown`);for(const[i,r]of this.#l.highlightColors){const a=document.createElement("button");a.tabIndex="0",a.role="option",a.setAttribute("data-color",r),a.title=i,a.setAttribute("data-l10n-id",pn.#u[i]);const o=document.createElement("span");a.append(o),o.className="swatch",o.style.backgroundColor=r,a.ariaSelected=r===this.#i,a.addEventListener("click",this.#f.bind(this,r),{signal:t}),e.append(a)}return e.addEventListener("keydown",this.#g.bind(this),{signal:t}),e}#f(e,t){t.stopPropagation(),this.#o.dispatch("switchannotationeditorparams",{source:this,type:Oe.HIGHLIGHT_COLOR,value:e}),this.updateColor(e)}_colorSelectFromKeyboard(e){if(e.target===this.#e){this.#p(e);return}const t=e.target.getAttribute("data-color");t&&this.#f(t,e)}_moveToNext(e){if(!this.#m){this.#p(e);return}if(e.target===this.#e){this.#n.firstChild?.focus();return}e.target.nextSibling?.focus()}_moveToPrevious(e){if(e.target===this.#n?.firstChild||e.target===this.#e){this.#m&&this._hideDropdownFromKeyboard();return}this.#m||this.#p(e),e.target.previousSibling?.focus()}_moveToBeginning(e){if(!this.#m){this.#p(e);return}this.#n.firstChild?.focus()}_moveToEnd(e){if(!this.#m){this.#p(e);return}this.#n.lastChild?.focus()}#g(e){pn._keyboardManager.exec(this,e)}#p(e){if(this.#m){this.hideDropdown();return}if(this.#a=e.detail===0,this.#c||(this.#c=new AbortController,window.addEventListener("pointerdown",this.#d.bind(this),{signal:this.#l.combinedSignal(this.#c)})),this.#e.ariaExpanded="true",this.#n){this.#n.classList.remove("hidden");return}const t=this.#n=this.#h();this.#e.append(t)}#d(e){this.#n?.contains(e.target)||this.hideDropdown()}hideDropdown(){this.#n?.classList.add("hidden"),this.#e.ariaExpanded="false",this.#c?.abort(),this.#c=null}get#m(){return this.#n&&!this.#n.classList.contains("hidden")}_hideDropdownFromKeyboard(){if(!this.#s){if(!this.#m){this.#r?.unselect();return}this.hideDropdown(),this.#e.focus({preventScroll:!0,focusVisible:this.#a})}}updateColor(e){if(this.#t&&(this.#t.style.backgroundColor=e),!this.#n)return;const t=this.#l.highlightColors.values();for(const i of this.#n.children)i.ariaSelected=t.next().value===e.toUpperCase()}destroy(){this.#e?.remove(),this.#e=null,this.#t=null,this.#n?.remove(),this.#n=null}}class ea{#e=null;#t=null;#i=null;static#n=null;constructor(e){this.#t=e,this.#i=e._uiManager,ea.#n||=Object.freeze({freetext:"pdfjs-editor-color-picker-free-text-input",ink:"pdfjs-editor-color-picker-ink-input"})}renderButton(){if(this.#e)return this.#e;const{editorType:e,colorType:t,colorValue:i}=this.#t,r=this.#e=document.createElement("input");return r.type="color",r.value=i||"#000000",r.className="basicColorPicker",r.tabIndex=0,r.setAttribute("data-l10n-id",ea.#n[e]),r.addEventListener("input",()=>{this.#i.updateParams(t,r.value)},{signal:this.#i._signal}),r}update(e){this.#e&&(this.#e.value=e)}destroy(){this.#e?.remove(),this.#e=null}hideDropdown(){}}function Yf(h){return Math.floor(Math.max(0,Math.min(1,h))*255).toString(16).padStart(2,"0")}function Gr(h){return Math.max(0,Math.min(255,255*h))}class Xf{static CMYK_G([e,t,i,r]){return["G",1-Math.min(1,.3*e+.59*i+.11*t+r)]}static G_CMYK([e]){return["CMYK",0,0,0,1-e]}static G_RGB([e]){return["RGB",e,e,e]}static G_rgb([e]){return e=Gr(e),[e,e,e]}static G_HTML([e]){const t=Yf(e);return`#${t}${t}${t}`}static RGB_G([e,t,i]){return["G",.3*e+.59*t+.11*i]}static RGB_rgb(e){return e.map(Gr)}static RGB_HTML(e){return`#${e.map(Yf).join("")}`}static T_HTML(){return"#00000000"}static T_rgb(){return[null]}static CMYK_RGB([e,t,i,r]){return["RGB",1-Math.min(1,e+r),1-Math.min(1,i+r),1-Math.min(1,t+r)]}static CMYK_rgb([e,t,i,r]){return[Gr(1-Math.min(1,e+r)),Gr(1-Math.min(1,i+r)),Gr(1-Math.min(1,t+r))]}static CMYK_HTML(e){const t=this.CMYK_RGB(e).slice(1);return this.RGB_HTML(t)}static RGB_CMYK([e,t,i]){const r=1-e,a=1-t,o=1-i,c=Math.min(r,a,o);return["CMYK",r,a,o,c]}}class Iy{create(e,t,i=!1){if(e<=0||t<=0)throw new Error("Invalid SVG dimensions");const r=this._createSVG("svg:svg");return r.setAttribute("version","1.1"),i||(r.setAttribute("width",`${e}px`),r.setAttribute("height",`${t}px`)),r.setAttribute("preserveAspectRatio","none"),r.setAttribute("viewBox",`0 0 ${e} ${t}`),r}createElement(e){if(typeof e!="string")throw new Error("Invalid SVG element type");return this._createSVG(e)}_createSVG(e){Ye("Abstract method `_createSVG` called.")}}class ta extends Iy{_createSVG(e){return document.createElementNS(ai,e)}}const Dy=9,hs=new WeakSet,Ly=new Date().getTimezoneOffset()*60*1e3;class Qf{static create(e){switch(e.data.annotationType){case wt.LINK:return new Pd(e);case wt.TEXT:return new Fy(e);case wt.WIDGET:switch(e.data.fieldType){case"Tx":return new Oy(e);case"Btn":return e.data.radioButton?new qp(e):e.data.checkBox?new By(e):new Wy(e);case"Ch":return new Hy(e);case"Sig":return new qy(e)}return new ps(e);case wt.POPUP:return new ad(e);case wt.FREETEXT:return new Bp(e);case wt.LINE:return new zy(e);case wt.SQUARE:return new Uy(e);case wt.CIRCLE:return new $y(e);case wt.POLYLINE:return new Wp(e);case wt.CARET:return new Ky(e);case wt.INK:return new Md(e);case wt.POLYGON:return new Vy(e);case wt.HIGHLIGHT:return new Hp(e);case wt.UNDERLINE:return new Yy(e);case wt.SQUIGGLY:return new Xy(e);case wt.STRIKEOUT:return new Qy(e);case wt.STAMP:return new Gp(e);case wt.FILEATTACHMENT:return new Jy(e);default:return new ut(e)}}}class ut{#e=null;#t=!1;#i=null;constructor(e,{isRenderable:t=!1,ignoreBorder:i=!1,createQuadrilaterals:r=!1}={}){this.isRenderable=t,this.data=e.data,this.layer=e.layer,this.linkService=e.linkService,this.downloadManager=e.downloadManager,this.imageResourcesPath=e.imageResourcesPath,this.renderForms=e.renderForms,this.svgFactory=e.svgFactory,this.annotationStorage=e.annotationStorage,this.enableComment=e.enableComment,this.enableScripting=e.enableScripting,this.hasJSActions=e.hasJSActions,this._fieldObjects=e.fieldObjects,this.parent=e.parent,t&&(this.container=this._createContainer(i)),r&&this._createQuadrilaterals()}static _hasPopupData({contentsObj:e,richText:t}){return!!(e?.str||t?.str)}get _isEditable(){return this.data.isEditable}get hasPopupData(){return ut._hasPopupData(this.data)||this.enableComment&&!!this.commentText}get commentData(){const{data:e}=this,t=this.annotationStorage?.getEditor(e.id);return t?t.getData():e}get hasCommentButton(){return this.enableComment&&this.hasPopupElement}get commentButtonPosition(){const e=this.annotationStorage?.getEditor(this.data.id);if(e)return e.commentButtonPositionInPage;const{quadPoints:t,inkLists:i,rect:r}=this.data;let a=-1/0,o=-1/0;if(t?.length>=8){for(let c=0;c<t.length;c+=8)t[c+1]>o?(o=t[c+1],a=t[c+2]):t[c+1]===o&&(a=Math.max(a,t[c+2]));return[a,o]}if(i?.length>=1){for(const c of i)for(let d=0,f=c.length;d<f;d+=2)c[d+1]>o?(o=c[d+1],a=c[d]):c[d+1]===o&&(a=Math.max(a,c[d]));if(a!==1/0)return[a,o]}return r?[r[2],r[3]]:null}_normalizePoint(e){const{page:{view:t},viewport:{rawDims:{pageWidth:i,pageHeight:r,pageX:a,pageY:o}}}=this.parent;return e[1]=t[3]-e[1]+t[1],e[0]=100*(e[0]-a)/i,e[1]=100*(e[1]-o)/r,e}get commentText(){const{data:e}=this;return this.annotationStorage.getRawValue(`${Xr}${e.id}`)?.popup?.contents||e.contentsObj?.str||""}set commentText(e){const{data:t}=this,i={deleted:!e,contents:e||""};this.annotationStorage.updateEditor(t.id,{popup:i})||this.annotationStorage.setValue(`${Xr}${t.id}`,{id:t.id,annotationType:t.annotationType,pageIndex:this.parent.page._pageIndex,popup:i,popupRef:t.popupRef,modificationDate:new Date}),e||this.removePopup()}removePopup(){(this.#i?.popup||this.popup)?.remove(),this.#i=this.popup=null}updateEdited(e){if(!this.container)return;e.rect&&(this.#e||={rect:this.data.rect.slice(0)});const{rect:t,popup:i}=e;t&&this.#n(t);let r=this.#i?.popup||this.popup;!r&&i?.text&&(this._createPopup(i),r=this.#i.popup),r&&(r.updateEdited(e),i?.deleted&&(r.remove(),this.#i=null,this.popup=null))}resetEdited(){this.#e&&(this.#n(this.#e.rect),this.#i?.popup.resetEdited(),this.#e=null)}#n(e){const{container:{style:t},data:{rect:i,rotation:r},parent:{viewport:{rawDims:{pageWidth:a,pageHeight:o,pageX:c,pageY:d}}}}=this;i?.splice(0,4,...e),t.left=`${100*(e[0]-c)/a}%`,t.top=`${100*(o-e[3]+d)/o}%`,r===0?(t.width=`${100*(e[2]-e[0])/a}%`,t.height=`${100*(e[3]-e[1])/o}%`):this.setRotation(r)}_createContainer(e){const{data:t,parent:{page:i,viewport:r}}=this,a=document.createElement("section");a.setAttribute("data-annotation-id",t.id),!(this instanceof ps)&&!(this instanceof Pd)&&(a.tabIndex=0);const{style:o}=a;if(o.zIndex=this.parent.zIndex,this.parent.zIndex+=2,t.alternativeText&&(a.title=t.alternativeText),t.noRotate&&a.classList.add("norotate"),!t.rect||this instanceof ad){const{rotation:v}=t;return!t.hasOwnCanvas&&v!==0&&this.setRotation(v,a),a}const{width:c,height:d}=this;if(!e&&t.borderStyle.width>0){o.borderWidth=`${t.borderStyle.width}px`;const v=t.borderStyle.horizontalCornerRadius,A=t.borderStyle.verticalCornerRadius;if(v>0||A>0){const T=`calc(${v}px * var(--total-scale-factor)) / calc(${A}px * var(--total-scale-factor))`;o.borderRadius=T}else if(this instanceof qp){const T=`calc(${c}px * var(--total-scale-factor)) / calc(${d}px * var(--total-scale-factor))`;o.borderRadius=T}switch(t.borderStyle.style){case Hs.SOLID:o.borderStyle="solid";break;case Hs.DASHED:o.borderStyle="dashed";break;case Hs.BEVELED:Ie("Unimplemented border style: beveled");break;case Hs.INSET:Ie("Unimplemented border style: inset");break;case Hs.UNDERLINE:o.borderBottomStyle="solid";break}const C=t.borderColor||null;C?(this.#t=!0,o.borderColor=ve.makeHexColor(C[0]|0,C[1]|0,C[2]|0)):o.borderWidth=0}const f=ve.normalizeRect([t.rect[0],i.view[3]-t.rect[1]+i.view[1],t.rect[2],i.view[3]-t.rect[3]+i.view[1]]),{pageWidth:p,pageHeight:g,pageX:w,pageY:x}=r.rawDims;o.left=`${100*(f[0]-w)/p}%`,o.top=`${100*(f[1]-x)/g}%`;const{rotation:k}=t;return t.hasOwnCanvas||k===0?(o.width=`${100*c/p}%`,o.height=`${100*d/g}%`):this.setRotation(k,a),a}setRotation(e,t=this.container){if(!this.data.rect)return;const{pageWidth:i,pageHeight:r}=this.parent.viewport.rawDims;let{width:a,height:o}=this;e%180!==0&&([a,o]=[o,a]),t.style.width=`${100*a/i}%`,t.style.height=`${100*o/r}%`,t.setAttribute("data-main-rotation",(360-e)%360)}get _commonActions(){const e=(t,i,r)=>{const a=r.detail[t],o=a[0],c=a.slice(1);r.target.style[i]=Xf[`${o}_HTML`](c),this.annotationStorage.setValue(this.data.id,{[i]:Xf[`${o}_rgb`](c)})};return Le(this,"_commonActions",{display:t=>{const{display:i}=t.detail,r=i%2===1;this.container.style.visibility=r?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noView:r,noPrint:i===1||i===2})},print:t=>{this.annotationStorage.setValue(this.data.id,{noPrint:!t.detail.print})},hidden:t=>{const{hidden:i}=t.detail;this.container.style.visibility=i?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noPrint:i,noView:i})},focus:t=>{setTimeout(()=>t.target.focus({preventScroll:!1}),0)},userName:t=>{t.target.title=t.detail.userName},readonly:t=>{t.target.disabled=t.detail.readonly},required:t=>{this._setRequired(t.target,t.detail.required)},bgColor:t=>{e("bgColor","backgroundColor",t)},fillColor:t=>{e("fillColor","backgroundColor",t)},fgColor:t=>{e("fgColor","color",t)},textColor:t=>{e("textColor","color",t)},borderColor:t=>{e("borderColor","borderColor",t)},strokeColor:t=>{e("strokeColor","borderColor",t)},rotation:t=>{const i=t.detail.rotation;this.setRotation(i),this.annotationStorage.setValue(this.data.id,{rotation:i})}})}_dispatchEventFromSandbox(e,t){const i=this._commonActions;for(const r of Object.keys(t.detail))(e[r]||i[r])?.(t)}_setDefaultPropertiesFromJS(e){if(!this.enableScripting)return;const t=this.annotationStorage.getRawValue(this.data.id);if(!t)return;const i=this._commonActions;for(const[r,a]of Object.entries(t)){const o=i[r];if(o){const c={detail:{[r]:a},target:e};o(c),delete t[r]}}}_createQuadrilaterals(){if(!this.container)return;const{quadPoints:e}=this.data;if(!e)return;const[t,i,r,a]=this.data.rect.map(v=>Math.fround(v));if(e.length===8){const[v,A,C,T]=e.subarray(2,6);if(r===v&&a===A&&t===C&&i===T)return}const{style:o}=this.container;let c;if(this.#t){const{borderColor:v,borderWidth:A}=o;o.borderWidth=0,c=["url('data:image/svg+xml;utf8,",'<svg xmlns="http://www.w3.org/2000/svg"',' preserveAspectRatio="none" viewBox="0 0 1 1">',`<g fill="transparent" stroke="${v}" stroke-width="${A}">`],this.container.classList.add("hasBorder")}const d=r-t,f=a-i,{svgFactory:p}=this,g=p.createElement("svg");g.classList.add("quadrilateralsContainer"),g.setAttribute("width",0),g.setAttribute("height",0),g.role="none";const w=p.createElement("defs");g.append(w);const x=p.createElement("clipPath"),k=`clippath_${this.data.id}`;x.setAttribute("id",k),x.setAttribute("clipPathUnits","objectBoundingBox"),w.append(x);for(let v=2,A=e.length;v<A;v+=8){const C=e[v],T=e[v+1],R=e[v+2],E=e[v+3],_=p.createElement("rect"),M=(R-t)/d,N=(a-T)/f,I=(C-R)/d,G=(T-E)/f;_.setAttribute("x",M),_.setAttribute("y",N),_.setAttribute("width",I),_.setAttribute("height",G),x.append(_),c?.push(`<rect vector-effect="non-scaling-stroke" x="${M}" y="${N}" width="${I}" height="${G}"/>`)}this.#t&&(c.push("</g></svg>')"),o.backgroundImage=c.join("")),this.container.append(g),this.container.style.clipPath=`url(#${k})`}_createPopup(e=null){const{data:t}=this;let i,r;e?(i={str:e.text},r=e.date):(i=t.contentsObj,r=t.modificationDate);const a=this.#i=new ad({data:{color:t.color,titleObj:t.titleObj,modificationDate:r,contentsObj:i,richText:t.richText,parentRect:t.rect,borderStyle:0,id:`popup_${t.id}`,rotation:t.rotation,noRotate:!0},linkService:this.linkService,parent:this.parent,elements:[this]});this.parent._commentManager||this.parent.div.append(a.render())}get hasPopupElement(){return!!(this.#i||this.popup||this.data.popupRef)}get extraPopupElement(){return this.#i}render(){Ye("Abstract method `AnnotationElement.render` called")}_getElementsByName(e,t=null){const i=[];if(this._fieldObjects){const r=this._fieldObjects[e];if(r)for(const{page:a,id:o,exportValues:c}of r){if(a===-1||o===t)continue;const d=typeof c=="string"?c:null,f=document.querySelector(`[data-element-id="${o}"]`);if(f&&!hs.has(f)){Ie(`_getElementsByName - element not allowed: ${o}`);continue}i.push({id:o,exportValue:d,domElement:f})}return i}for(const r of document.getElementsByName(e)){const{exportValue:a}=r,o=r.getAttribute("data-element-id");o!==t&&hs.has(r)&&i.push({id:o,exportValue:a,domElement:r})}return i}show(){this.container&&(this.container.hidden=!1),this.popup?.maybeShow()}hide(){this.container&&(this.container.hidden=!0),this.popup?.forceHide()}getElementsToTriggerPopup(){return this.container}addHighlightArea(){const e=this.getElementsToTriggerPopup();if(Array.isArray(e))for(const t of e)t.classList.add("highlightArea");else e.classList.add("highlightArea")}_editOnDoubleClick(){if(!this._isEditable)return;const{annotationEditorType:e,data:{id:t}}=this;this.container.addEventListener("dblclick",()=>{this.linkService.eventBus?.dispatch("switchannotationeditormode",{source:this,mode:e,editId:t,mustEnterInEditMode:!0})})}get width(){return this.data.rect[2]-this.data.rect[0]}get height(){return this.data.rect[3]-this.data.rect[1]}}class jy extends ut{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.editor=e.editor}render(){return this.container.className="editorAnnotation",this.container}createOrUpdatePopup(){const{editor:e}=this;e.hasComment&&(this._createPopup(e.comment),this.extraPopupElement.popup.renderCommentButton())}get hasCommentButton(){return this.enableComment&&this.editor.hasComment}get commentButtonPosition(){return this.editor.commentButtonPositionInPage}get commentText(){return this.editor.comment.text}set commentText(e){this.editor.comment=e,e||this.removePopup()}get commentData(){return this.editor.getData()}remove(){this.container.remove(),this.container=null,this.removePopup()}}class Pd extends ut{constructor(e,t=null){super(e,{isRenderable:!0,ignoreBorder:!!t?.ignoreBorder,createQuadrilaterals:!0}),this.isTooltipOnly=e.data.isTooltipOnly}render(){const{data:e,linkService:t}=this,i=document.createElement("a");i.setAttribute("data-element-id",e.id);let r=!1;return e.url?(t.addLinkAttributes(i,e.url,e.newWindow),r=!0):e.action?(this._bindNamedAction(i,e.action,e.overlaidText),r=!0):e.attachment?(this.#t(i,e.attachment,e.overlaidText,e.attachmentDest),r=!0):e.setOCGState?(this.#i(i,e.setOCGState,e.overlaidText),r=!0):e.dest?(this._bindLink(i,e.dest,e.overlaidText),r=!0):(e.actions&&(e.actions.Action||e.actions["Mouse Up"]||e.actions["Mouse Down"])&&this.enableScripting&&this.hasJSActions&&(this._bindJSAction(i,e),r=!0),e.resetForm?(this._bindResetFormAction(i,e.resetForm),r=!0):this.isTooltipOnly&&!r&&(this._bindLink(i,""),r=!0)),this.container.classList.add("linkAnnotation"),r&&this.container.append(i),this.container}#e(){this.container.setAttribute("data-internal-link","")}_bindLink(e,t,i=""){e.href=this.linkService.getDestinationHash(t),e.onclick=()=>(t&&this.linkService.goToDestination(t),!1),(t||t==="")&&this.#e(),i&&(e.title=i)}_bindNamedAction(e,t,i=""){e.href=this.linkService.getAnchorUrl(""),e.onclick=()=>(this.linkService.executeNamedAction(t),!1),i&&(e.title=i),this.#e()}#t(e,t,i="",r=null){e.href=this.linkService.getAnchorUrl(""),t.description?e.title=t.description:i&&(e.title=i),e.onclick=()=>(this.downloadManager?.openOrDownloadData(t.content,t.filename,r),!1),this.#e()}#i(e,t,i=""){e.href=this.linkService.getAnchorUrl(""),e.onclick=()=>(this.linkService.executeSetOCGState(t),!1),i&&(e.title=i),this.#e()}_bindJSAction(e,t){e.href=this.linkService.getAnchorUrl("");const i=new Map([["Action","onclick"],["Mouse Up","onmouseup"],["Mouse Down","onmousedown"]]);for(const r of Object.keys(t.actions)){const a=i.get(r);a&&(e[a]=()=>(this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t.id,name:r}}),!1))}t.overlaidText&&(e.title=t.overlaidText),e.onclick||(e.onclick=()=>!1),this.#e()}_bindResetFormAction(e,t){const i=e.onclick;if(i||(e.href=this.linkService.getAnchorUrl("")),this.#e(),!this._fieldObjects){Ie('_bindResetFormAction - "resetForm" action not supported, ensure that the `fieldObjects` parameter is provided.'),i||(e.onclick=()=>!1);return}e.onclick=()=>{i?.();const{fields:r,refs:a,include:o}=t,c=[];if(r.length!==0||a.length!==0){const p=new Set(a);for(const g of r){const w=this._fieldObjects[g]||[];for(const{id:x}of w)p.add(x)}for(const g of Object.values(this._fieldObjects))for(const w of g)p.has(w.id)===o&&c.push(w)}else for(const p of Object.values(this._fieldObjects))c.push(...p);const d=this.annotationStorage,f=[];for(const p of c){const{id:g}=p;switch(f.push(g),p.type){case"text":{const x=p.defaultValue||"";d.setValue(g,{value:x});break}case"checkbox":case"radiobutton":{const x=p.defaultValue===p.exportValues;d.setValue(g,{value:x});break}case"combobox":case"listbox":{const x=p.defaultValue||"";d.setValue(g,{value:x});break}default:continue}const w=document.querySelector(`[data-element-id="${g}"]`);if(w){if(!hs.has(w)){Ie(`_bindResetFormAction - element not allowed: ${g}`);continue}}else continue;w.dispatchEvent(new Event("resetform"))}return this.enableScripting&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:"app",ids:f,name:"ResetForm"}}),!1}}}class Fy extends ut{constructor(e){super(e,{isRenderable:!0})}render(){this.container.classList.add("textAnnotation");const e=document.createElement("img");return e.src=this.imageResourcesPath+"annotation-"+this.data.name.toLowerCase()+".svg",e.setAttribute("data-l10n-id","pdfjs-text-annotation-type"),e.setAttribute("data-l10n-args",JSON.stringify({type:this.data.name})),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.append(e),this.container}}class ps extends ut{render(){return this.container}showElementAndHideCanvas(e){this.data.hasOwnCanvas&&(e.previousSibling?.nodeName==="CANVAS"&&(e.previousSibling.hidden=!0),e.hidden=!1)}_getKeyModifier(e){return Pt.platform.isMac?e.metaKey:e.ctrlKey}_setEventListener(e,t,i,r,a){i.includes("mouse")?e.addEventListener(i,o=>{this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:r,value:a(o),shift:o.shiftKey,modifier:this._getKeyModifier(o)}})}):e.addEventListener(i,o=>{if(i==="blur"){if(!t.focused||!o.relatedTarget)return;t.focused=!1}else if(i==="focus"){if(t.focused)return;t.focused=!0}a&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:r,value:a(o)}})})}_setEventListeners(e,t,i,r){for(const[a,o]of i)(o==="Action"||this.data.actions?.[o])&&((o==="Focus"||o==="Blur")&&(t||={focused:!1}),this._setEventListener(e,t,a,o,r),o==="Focus"&&!this.data.actions?.Blur?this._setEventListener(e,t,"blur","Blur",null):o==="Blur"&&!this.data.actions?.Focus&&this._setEventListener(e,t,"focus","Focus",null))}_setBackgroundColor(e){const t=this.data.backgroundColor||null;e.style.backgroundColor=t===null?"transparent":ve.makeHexColor(t[0],t[1],t[2])}_setTextStyle(e){const t=["left","center","right"],{fontColor:i}=this.data.defaultAppearanceData,r=this.data.defaultAppearanceData.fontSize||Dy,a=e.style;let o;const c=2,d=f=>Math.round(10*f)/10;if(this.data.multiLine){const f=Math.abs(this.data.rect[3]-this.data.rect[1]-c),p=Math.round(f/(zc*r))||1,g=f/p;o=Math.min(r,d(g/zc))}else{const f=Math.abs(this.data.rect[3]-this.data.rect[1]-c);o=Math.min(r,d(f/zc))}a.fontSize=`calc(${o}px * var(--total-scale-factor))`,a.color=ve.makeHexColor(i[0],i[1],i[2]),this.data.textAlignment!==null&&(a.textAlign=t[this.data.textAlignment])}_setRequired(e,t){t?e.setAttribute("required",!0):e.removeAttribute("required"),e.setAttribute("aria-required",t)}}class Oy extends ps{constructor(e){const t=e.renderForms||e.data.hasOwnCanvas||!e.data.hasAppearance&&!!e.data.fieldValue;super(e,{isRenderable:t})}setPropertyOnSiblings(e,t,i,r){const a=this.annotationStorage;for(const o of this._getElementsByName(e.name,e.id))o.domElement&&(o.domElement[t]=i),a.setValue(o.id,{[r]:i})}render(){const e=this.annotationStorage,t=this.data.id;this.container.classList.add("textWidgetAnnotation");let i=null;if(this.renderForms){const r=e.getValue(t,{value:this.data.fieldValue});let a=r.value||"";const o=e.getValue(t,{charLimit:this.data.maxLen}).charLimit;o&&a.length>o&&(a=a.slice(0,o));let c=r.formattedValue||this.data.textContent?.join(`
`)||null;c&&this.data.comb&&(c=c.replaceAll(/\s+/g,""));const d={userValue:a,formattedValue:c,lastCommittedValue:null,commitKey:1,focused:!1};this.data.multiLine?(i=document.createElement("textarea"),i.textContent=c??a,this.data.doNotScroll&&(i.style.overflowY="hidden")):(i=document.createElement("input"),i.type=this.data.password?"password":"text",i.setAttribute("value",c??a),this.data.doNotScroll&&(i.style.overflowX="hidden")),this.data.hasOwnCanvas&&(i.hidden=!0),hs.add(i),i.setAttribute("data-element-id",t),i.disabled=this.data.readOnly,i.name=this.data.fieldName,i.tabIndex=0;const{datetimeFormat:f,datetimeType:p,timeStep:g}=this.data,w=!!p&&this.enableScripting;f&&(i.title=f),this._setRequired(i,this.data.required),o&&(i.maxLength=o),i.addEventListener("input",k=>{e.setValue(t,{value:k.target.value}),this.setPropertyOnSiblings(i,"value",k.target.value,"value"),d.formattedValue=null}),i.addEventListener("resetform",k=>{const v=this.data.defaultFieldValue??"";i.value=d.userValue=v,d.formattedValue=null});let x=k=>{const{formattedValue:v}=d;v!=null&&(k.target.value=v),k.target.scrollLeft=0};if(this.enableScripting&&this.hasJSActions){i.addEventListener("focus",v=>{if(d.focused)return;const{target:A}=v;if(w&&(A.type=p,g&&(A.step=g)),d.userValue){const C=d.userValue;if(w)if(p==="time"){const T=new Date(C),R=[T.getHours(),T.getMinutes(),T.getSeconds()];A.value=R.map(E=>E.toString().padStart(2,"0")).join(":")}else A.value=new Date(C-Ly).toISOString().split(p==="date"?"T":".",1)[0];else A.value=C}d.lastCommittedValue=A.value,d.commitKey=1,this.data.actions?.Focus||(d.focused=!0)}),i.addEventListener("updatefromsandbox",v=>{this.showElementAndHideCanvas(v.target);const A={value(C){d.userValue=C.detail.value??"",w||e.setValue(t,{value:d.userValue.toString()}),C.target.value=d.userValue},formattedValue(C){const{formattedValue:T}=C.detail;d.formattedValue=T,T!=null&&C.target!==document.activeElement&&(C.target.value=T);const R={formattedValue:T};w&&(R.value=T),e.setValue(t,R)},selRange(C){C.target.setSelectionRange(...C.detail.selRange)},charLimit:C=>{const{charLimit:T}=C.detail,{target:R}=C;if(T===0){R.removeAttribute("maxLength");return}R.setAttribute("maxLength",T);let E=d.userValue;!E||E.length<=T||(E=E.slice(0,T),R.value=d.userValue=E,e.setValue(t,{value:E}),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:E,willCommit:!0,commitKey:1,selStart:R.selectionStart,selEnd:R.selectionEnd}}))}};this._dispatchEventFromSandbox(A,v)}),i.addEventListener("keydown",v=>{d.commitKey=1;let A=-1;if(v.key==="Escape"?A=0:v.key==="Enter"&&!this.data.multiLine?A=2:v.key==="Tab"&&(d.commitKey=3),A===-1)return;const{value:C}=v.target;d.lastCommittedValue!==C&&(d.lastCommittedValue=C,d.userValue=C,this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:C,willCommit:!0,commitKey:A,selStart:v.target.selectionStart,selEnd:v.target.selectionEnd}}))});const k=x;x=null,i.addEventListener("blur",v=>{if(!d.focused||!v.relatedTarget)return;this.data.actions?.Blur||(d.focused=!1);const{target:A}=v;let{value:C}=A;if(w){if(C&&p==="time"){const T=C.split(":").map(R=>parseInt(R,10));C=new Date(2e3,0,1,T[0],T[1],T[2]||0).valueOf(),A.step=""}else C.includes("T")||(C=`${C}T00:00`),C=new Date(C).valueOf();A.type="text"}d.userValue=C,d.lastCommittedValue!==C&&this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:C,willCommit:!0,commitKey:d.commitKey,selStart:v.target.selectionStart,selEnd:v.target.selectionEnd}}),k(v)}),this.data.actions?.Keystroke&&i.addEventListener("beforeinput",v=>{d.lastCommittedValue=null;const{data:A,target:C}=v,{value:T,selectionStart:R,selectionEnd:E}=C;let _=R,M=E;switch(v.inputType){case"deleteWordBackward":{const N=T.substring(0,R).match(/\w*[^\w]*$/);N&&(_-=N[0].length);break}case"deleteWordForward":{const N=T.substring(R).match(/^[^\w]*\w*/);N&&(M+=N[0].length);break}case"deleteContentBackward":R===E&&(_-=1);break;case"deleteContentForward":R===E&&(M+=1);break}v.preventDefault(),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:T,change:A||"",willCommit:!1,selStart:_,selEnd:M}})}),this._setEventListeners(i,d,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],v=>v.target.value)}if(x&&i.addEventListener("blur",x),this.data.comb){const v=(this.data.rect[2]-this.data.rect[0])/o;i.classList.add("comb"),i.style.letterSpacing=`calc(${v}px * var(--total-scale-factor) - 1ch)`}}else i=document.createElement("div"),i.textContent=this.data.fieldValue,i.style.verticalAlign="middle",i.style.display="table-cell",this.data.hasOwnCanvas&&(i.hidden=!0);return this._setTextStyle(i),this._setBackgroundColor(i),this._setDefaultPropertiesFromJS(i),this.container.append(i),this.container}}class qy extends ps{constructor(e){super(e,{isRenderable:!!e.data.hasOwnCanvas})}}class By extends ps{constructor(e){super(e,{isRenderable:e.renderForms})}render(){const e=this.annotationStorage,t=this.data,i=t.id;let r=e.getValue(i,{value:t.exportValue===t.fieldValue}).value;typeof r=="string"&&(r=r!=="Off",e.setValue(i,{value:r})),this.container.classList.add("buttonWidgetAnnotation","checkBox");const a=document.createElement("input");return hs.add(a),a.setAttribute("data-element-id",i),a.disabled=t.readOnly,this._setRequired(a,this.data.required),a.type="checkbox",a.name=t.fieldName,r&&a.setAttribute("checked",!0),a.setAttribute("exportValue",t.exportValue),a.tabIndex=0,a.addEventListener("change",o=>{const{name:c,checked:d}=o.target;for(const f of this._getElementsByName(c,i)){const p=d&&f.exportValue===t.exportValue;f.domElement&&(f.domElement.checked=p),e.setValue(f.id,{value:p})}e.setValue(i,{value:d})}),a.addEventListener("resetform",o=>{const c=t.defaultFieldValue||"Off";o.target.checked=c===t.exportValue}),this.enableScripting&&this.hasJSActions&&(a.addEventListener("updatefromsandbox",o=>{const c={value(d){d.target.checked=d.detail.value!=="Off",e.setValue(i,{value:d.target.checked})}};this._dispatchEventFromSandbox(c,o)}),this._setEventListeners(a,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],o=>o.target.checked)),this._setBackgroundColor(a),this._setDefaultPropertiesFromJS(a),this.container.append(a),this.container}}class qp extends ps{constructor(e){super(e,{isRenderable:e.renderForms})}render(){this.container.classList.add("buttonWidgetAnnotation","radioButton");const e=this.annotationStorage,t=this.data,i=t.id;let r=e.getValue(i,{value:t.fieldValue===t.buttonValue}).value;if(typeof r=="string"&&(r=r!==t.buttonValue,e.setValue(i,{value:r})),r)for(const o of this._getElementsByName(t.fieldName,i))e.setValue(o.id,{value:!1});const a=document.createElement("input");if(hs.add(a),a.setAttribute("data-element-id",i),a.disabled=t.readOnly,this._setRequired(a,this.data.required),a.type="radio",a.name=t.fieldName,r&&a.setAttribute("checked",!0),a.tabIndex=0,a.addEventListener("change",o=>{const{name:c,checked:d}=o.target;for(const f of this._getElementsByName(c,i))e.setValue(f.id,{value:!1});e.setValue(i,{value:d})}),a.addEventListener("resetform",o=>{const c=t.defaultFieldValue;o.target.checked=c!=null&&c===t.buttonValue}),this.enableScripting&&this.hasJSActions){const o=t.buttonValue;a.addEventListener("updatefromsandbox",c=>{const d={value:f=>{const p=o===f.detail.value;for(const g of this._getElementsByName(f.target.name)){const w=p&&g.id===i;g.domElement&&(g.domElement.checked=w),e.setValue(g.id,{value:w})}}};this._dispatchEventFromSandbox(d,c)}),this._setEventListeners(a,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],c=>c.target.checked)}return this._setBackgroundColor(a),this._setDefaultPropertiesFromJS(a),this.container.append(a),this.container}}class Wy extends Pd{constructor(e){super(e,{ignoreBorder:e.data.hasAppearance})}render(){const e=super.render();e.classList.add("buttonWidgetAnnotation","pushButton");const t=e.lastChild;return this.enableScripting&&this.hasJSActions&&t&&(this._setDefaultPropertiesFromJS(t),t.addEventListener("updatefromsandbox",i=>{this._dispatchEventFromSandbox({},i)})),e}}class Hy extends ps{constructor(e){super(e,{isRenderable:e.renderForms})}render(){this.container.classList.add("choiceWidgetAnnotation");const e=this.annotationStorage,t=this.data.id,i=e.getValue(t,{value:this.data.fieldValue}),r=document.createElement("select");hs.add(r),r.setAttribute("data-element-id",t),r.disabled=this.data.readOnly,this._setRequired(r,this.data.required),r.name=this.data.fieldName,r.tabIndex=0;let a=this.data.combo&&this.data.options.length>0;this.data.combo||(r.size=this.data.options.length,this.data.multiSelect&&(r.multiple=!0)),r.addEventListener("resetform",p=>{const g=this.data.defaultFieldValue;for(const w of r.options)w.selected=w.value===g});for(const p of this.data.options){const g=document.createElement("option");g.textContent=p.displayValue,g.value=p.exportValue,i.value.includes(p.exportValue)&&(g.setAttribute("selected",!0),a=!1),r.append(g)}let o=null;if(a){const p=document.createElement("option");p.value=" ",p.setAttribute("hidden",!0),p.setAttribute("selected",!0),r.prepend(p),o=()=>{p.remove(),r.removeEventListener("input",o),o=null},r.addEventListener("input",o)}const c=p=>{const g=p?"value":"textContent",{options:w,multiple:x}=r;return x?Array.prototype.filter.call(w,k=>k.selected).map(k=>k[g]):w.selectedIndex===-1?null:w[w.selectedIndex][g]};let d=c(!1);const f=p=>{const g=p.target.options;return Array.prototype.map.call(g,w=>({displayValue:w.textContent,exportValue:w.value}))};return this.enableScripting&&this.hasJSActions?(r.addEventListener("updatefromsandbox",p=>{const g={value(w){o?.();const x=w.detail.value,k=new Set(Array.isArray(x)?x:[x]);for(const v of r.options)v.selected=k.has(v.value);e.setValue(t,{value:c(!0)}),d=c(!1)},multipleSelection(w){r.multiple=!0},remove(w){const x=r.options,k=w.detail.remove;x[k].selected=!1,r.remove(k),x.length>0&&Array.prototype.findIndex.call(x,A=>A.selected)===-1&&(x[0].selected=!0),e.setValue(t,{value:c(!0),items:f(w)}),d=c(!1)},clear(w){for(;r.length!==0;)r.remove(0);e.setValue(t,{value:null,items:[]}),d=c(!1)},insert(w){const{index:x,displayValue:k,exportValue:v}=w.detail.insert,A=r.children[x],C=document.createElement("option");C.textContent=k,C.value=v,A?A.before(C):r.append(C),e.setValue(t,{value:c(!0),items:f(w)}),d=c(!1)},items(w){const{items:x}=w.detail;for(;r.length!==0;)r.remove(0);for(const k of x){const{displayValue:v,exportValue:A}=k,C=document.createElement("option");C.textContent=v,C.value=A,r.append(C)}r.options.length>0&&(r.options[0].selected=!0),e.setValue(t,{value:c(!0),items:f(w)}),d=c(!1)},indices(w){const x=new Set(w.detail.indices);for(const k of w.target.options)k.selected=x.has(k.index);e.setValue(t,{value:c(!0)}),d=c(!1)},editable(w){w.target.disabled=!w.detail.editable}};this._dispatchEventFromSandbox(g,p)}),r.addEventListener("input",p=>{const g=c(!0),w=c(!1);e.setValue(t,{value:g}),p.preventDefault(),this.linkService.eventBus?.dispatch("dispatcheventinsandbox",{source:this,detail:{id:t,name:"Keystroke",value:d,change:w,changeEx:g,willCommit:!1,commitKey:1,keyDown:!1}})}),this._setEventListeners(r,null,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"],["input","Action"],["input","Validate"]],p=>p.target.value)):r.addEventListener("input",function(p){e.setValue(t,{value:c(!0)})}),this.data.combo&&this._setTextStyle(r),this._setBackgroundColor(r),this._setDefaultPropertiesFromJS(r),this.container.append(r),this.container}}class ad extends ut{constructor(e){const{data:t,elements:i,parent:r}=e,a=!!r._commentManager;if(super(e,{isRenderable:!a&&ut._hasPopupData(t)}),this.elements=i,a&&ut._hasPopupData(t)){const o=this.popup=this.#e();for(const c of i)c.popup=o}else this.popup=null}#e(){return new Gy({container:this.container,color:this.data.color,titleObj:this.data.titleObj,modificationDate:this.data.modificationDate||this.data.creationDate,contentsObj:this.data.contentsObj,richText:this.data.richText,rect:this.data.rect,parentRect:this.data.parentRect||null,parent:this.parent,elements:this.elements,open:this.data.open,commentManager:this.parent._commentManager})}render(){const{container:e}=this;e.classList.add("popupAnnotation"),e.role="comment";const t=this.popup=this.#e(),i=[];for(const r of this.elements)r.popup=t,r.container.ariaHasPopup="dialog",i.push(r.data.id),r.addHighlightArea();return this.container.setAttribute("aria-controls",i.map(r=>`${wd}${r}`).join(",")),this.container}}class Gy{#e=null;#t=this.#z.bind(this);#i=this.#q.bind(this);#n=this.#I.bind(this);#a=this.#x.bind(this);#s=null;#r=null;#o=null;#c=null;#l=null;#u=null;#h=null;#f=!1;#g=null;#p=null;#d=null;#m=null;#y=null;#b=null;#w=null;#C=null;#S=null;#v=null;#E=!1;#k=null;#A=null;constructor({container:e,color:t,elements:i,titleObj:r,modificationDate:a,contentsObj:o,richText:c,parent:d,rect:f,parentRect:p,open:g,commentManager:w=null}){this.#r=e,this.#S=r,this.#o=o,this.#C=c,this.#u=d,this.#s=t,this.#w=f,this.#h=p,this.#l=i,this.#e=w,this.#k=i[0],this.#c=Oo.toDateObject(a),this.trigger=i.flatMap(x=>x.getElementsToTriggerPopup()),w?this.renderCommentButton():(this.#N(),this.#r.hidden=!0,g&&this.#x())}#N(){if(this.#p)return;this.#p=new AbortController;const{signal:e}=this.#p;for(const t of this.trigger)t.addEventListener("click",this.#a,{signal:e}),t.addEventListener("pointerenter",this.#n,{signal:e}),t.addEventListener("pointerleave",this.#i,{signal:e}),t.classList.add("popupTriggerArea");for(const t of this.#l)t.container?.addEventListener("keydown",this.#t,{signal:e})}#R(){const e=this.#l.find(t=>t.hasCommentButton);e&&(this.#y=e._normalizePoint(e.commentButtonPosition))}renderCommentButton(){if(this.#m||(this.#y||this.#R(),!this.#y))return;const{signal:e}=this.#p=new AbortController,t=!!this.#k.extraPopupElement,i=()=>{this.#e.toggleCommentPopup(this,!0,void 0,!t)},r=()=>{this.#e.toggleCommentPopup(this,!1,!0,!t)},a=()=>{this.#e.toggleCommentPopup(this,!1,!1)};if(t){this.#m=this.#k.container;for(const o of this.trigger)o.ariaHasPopup="dialog",o.ariaControls="commentPopup",o.addEventListener("keydown",this.#t,{signal:e}),o.addEventListener("click",i,{signal:e}),o.addEventListener("pointerenter",r,{signal:e}),o.addEventListener("pointerleave",a,{signal:e}),o.classList.add("popupTriggerArea")}else{const o=this.#m=document.createElement("button");o.className="annotationCommentButton";const c=this.#k.container;o.style.zIndex=c.style.zIndex+1,o.tabIndex=0,o.ariaHasPopup="dialog",o.ariaControls="commentPopup",o.setAttribute("data-l10n-id","pdfjs-show-comment-button"),this.#F(),this.#_(),o.addEventListener("keydown",this.#t,{signal:e}),o.addEventListener("click",i,{signal:e}),o.addEventListener("pointerenter",r,{signal:e}),o.addEventListener("pointerleave",a,{signal:e}),c.after(o)}}#_(){if(this.#k.extraPopupElement&&!this.#k.editor)return;this.renderCommentButton();const[e,t]=this.#y,{style:i}=this.#m;i.left=`calc(${e}%)`,i.top=`calc(${t}% - var(--comment-button-dim))`}#F(){this.#k.extraPopupElement||(this.renderCommentButton(),this.#m.style.backgroundColor=this.commentButtonColor||"")}get commentButtonColor(){const{color:e,opacity:t}=this.#k.commentData;return e?this.#u._commentManager.makeCommentColor(e,t):null}focusCommentButton(){setTimeout(()=>{this.#m?.focus()},0)}getData(){const{richText:e,color:t,opacity:i,creationDate:r,modificationDate:a}=this.#k.commentData;return{contentsObj:{str:this.comment},richText:e,color:t,opacity:i,creationDate:r,modificationDate:a}}get elementBeforePopup(){return this.#m}get comment(){return this.#A||=this.#k.commentText,this.#A}set comment(e){e!==this.comment&&(this.#k.commentText=this.#A=e)}get parentBoundingClientRect(){return this.#k.layer.getBoundingClientRect()}setCommentButtonStates({selected:e,hasPopup:t}){this.#m&&(this.#m.classList.toggle("selected",e),this.#m.ariaExpanded=t)}setSelectedCommentButton(e){this.#m.classList.toggle("selected",e)}get commentPopupPosition(){if(this.#b)return this.#b;const{x:e,y:t,height:i}=this.#m.getBoundingClientRect(),{x:r,y:a,width:o,height:c}=this.#k.layer.getBoundingClientRect();return[(e-r)/o,(t+i-a)/c]}set commentPopupPosition(e){this.#b=e}hasDefaultPopupPosition(){return this.#b===null}get commentButtonPosition(){return this.#y}get commentButtonWidth(){return this.#m.getBoundingClientRect().width/this.parentBoundingClientRect.width}editComment(e){const[t,i]=this.#b||this.commentButtonPosition.map(f=>f/100),r=this.parentBoundingClientRect,{x:a,y:o,width:c,height:d}=r;this.#e.showDialog(null,this,a+t*c,o+i*d,{...e,parentDimensions:r})}render(){if(this.#g)return;const e=this.#g=document.createElement("div");if(e.className="popup",this.#s){const i=e.style.outlineColor=ve.makeHexColor(...this.#s);e.style.backgroundColor=`color-mix(in srgb, ${i} 30%, white)`}const t=document.createElement("span");if(t.className="header",this.#S?.str){const i=document.createElement("span");i.className="title",t.append(i),{dir:i.dir,str:i.textContent}=this.#S}if(e.append(t),this.#c){const i=document.createElement("time");i.className="popupDate",i.setAttribute("data-l10n-id","pdfjs-annotation-date-time-string"),i.setAttribute("data-l10n-args",JSON.stringify({dateObj:this.#c.valueOf()})),i.dateTime=this.#c.toISOString(),t.append(i)}vd({html:this.#M||this.#o.str,dir:this.#o?.dir,className:"popupContent"},e),this.#r.append(e)}get#M(){const e=this.#C,t=this.#o;return e?.str&&(!t?.str||t.str===e.str)&&this.#C.html||null}get#D(){return this.#M?.attributes?.style?.fontSize||0}get#O(){return this.#M?.attributes?.style?.color||null}#L(e){const t=[],i={str:e,html:{name:"div",attributes:{dir:"auto"},children:[{name:"p",children:t}]}},r={style:{color:this.#O,fontSize:this.#D?`calc(${this.#D}px * var(--total-scale-factor))`:""}};for(const a of e.split(`
`))t.push({name:"span",value:a,attributes:r});return i}#z(e){e.altKey||e.shiftKey||e.ctrlKey||e.metaKey||(e.key==="Enter"||e.key==="Escape"&&this.#f)&&this.#x()}updateEdited({rect:e,popup:t,deleted:i}){if(this.#e){i?(this.remove(),this.#A=null):t&&(t.deleted?this.remove():(this.#F(),this.#A=t.text)),e&&(this.#y=null,this.#R(),this.#_());return}if(i||t?.deleted){this.remove();return}this.#N(),this.#v||={contentsObj:this.#o,richText:this.#C},e&&(this.#d=null),t&&t.text&&(this.#C=this.#L(t.text),this.#c=Oo.toDateObject(t.date),this.#o=null),this.#g?.remove(),this.#g=null}resetEdited(){this.#v&&({contentsObj:this.#o,richText:this.#C}=this.#v,this.#v=null,this.#g?.remove(),this.#g=null,this.#d=null)}remove(){if(this.#p?.abort(),this.#p=null,this.#g?.remove(),this.#g=null,this.#E=!1,this.#f=!1,this.#m?.remove(),this.#m=null,this.trigger)for(const e of this.trigger)e.classList.remove("popupTriggerArea")}#T(){if(this.#d!==null)return;const{page:{view:e},viewport:{rawDims:{pageWidth:t,pageHeight:i,pageX:r,pageY:a}}}=this.#u;let o=!!this.#h,c=o?this.#h:this.#w;for(const k of this.#l)if(!c||ve.intersect(k.data.rect,c)!==null){c=k.data.rect,o=!0;break}const d=ve.normalizeRect([c[0],e[3]-c[1]+e[1],c[2],e[3]-c[3]+e[1]]),p=o?c[2]-c[0]+5:0,g=d[0]+p,w=d[1];this.#d=[100*(g-r)/t,100*(w-a)/i];const{style:x}=this.#r;x.left=`${this.#d[0]}%`,x.top=`${this.#d[1]}%`}#x(){if(this.#e){this.#e.toggleCommentPopup(this,!1);return}this.#f=!this.#f,this.#f?(this.#I(),this.#r.addEventListener("click",this.#a),this.#r.addEventListener("keydown",this.#t)):(this.#q(),this.#r.removeEventListener("click",this.#a),this.#r.removeEventListener("keydown",this.#t))}#I(){this.#g||this.render(),this.isVisible?this.#f&&this.#r.classList.add("focused"):(this.#T(),this.#r.hidden=!1,this.#r.style.zIndex=parseInt(this.#r.style.zIndex)+1e3)}#q(){this.#r.classList.remove("focused"),!(this.#f||!this.isVisible)&&(this.#r.hidden=!0,this.#r.style.zIndex=parseInt(this.#r.style.zIndex)-1e3)}forceHide(){this.#E=this.isVisible,this.#E&&(this.#r.hidden=!0)}maybeShow(){this.#e||(this.#N(),this.#E&&(this.#g||this.#I(),this.#E=!1,this.#r.hidden=!1))}get isVisible(){return this.#e?!1:this.#r.hidden===!1}}class Bp extends ut{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.textContent=e.data.textContent,this.textPosition=e.data.textPosition,this.annotationEditorType=Me.FREETEXT}render(){if(this.container.classList.add("freeTextAnnotation"),this.textContent){const e=document.createElement("div");e.classList.add("annotationTextContent"),e.setAttribute("role","comment");for(const t of this.textContent){const i=document.createElement("span");i.textContent=t,e.append(i)}this.container.append(e)}return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}}class zy extends ut{#e=null;constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("lineAnnotation");const{data:e,width:t,height:i}=this,r=this.svgFactory.create(t,i,!0),a=this.#e=this.svgFactory.createElement("svg:line");return a.setAttribute("x1",e.rect[2]-e.lineCoordinates[0]),a.setAttribute("y1",e.rect[3]-e.lineCoordinates[1]),a.setAttribute("x2",e.rect[2]-e.lineCoordinates[2]),a.setAttribute("y2",e.rect[3]-e.lineCoordinates[3]),a.setAttribute("stroke-width",e.borderStyle.width||1),a.setAttribute("stroke","transparent"),a.setAttribute("fill","transparent"),r.append(a),this.container.append(r),!e.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#e}addHighlightArea(){this.container.classList.add("highlightArea")}}class Uy extends ut{#e=null;constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("squareAnnotation");const{data:e,width:t,height:i}=this,r=this.svgFactory.create(t,i,!0),a=e.borderStyle.width,o=this.#e=this.svgFactory.createElement("svg:rect");return o.setAttribute("x",a/2),o.setAttribute("y",a/2),o.setAttribute("width",t-a),o.setAttribute("height",i-a),o.setAttribute("stroke-width",a||1),o.setAttribute("stroke","transparent"),o.setAttribute("fill","transparent"),r.append(o),this.container.append(r),!e.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#e}addHighlightArea(){this.container.classList.add("highlightArea")}}class $y extends ut{#e=null;constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0})}render(){this.container.classList.add("circleAnnotation");const{data:e,width:t,height:i}=this,r=this.svgFactory.create(t,i,!0),a=e.borderStyle.width,o=this.#e=this.svgFactory.createElement("svg:ellipse");return o.setAttribute("cx",t/2),o.setAttribute("cy",i/2),o.setAttribute("rx",t/2-a/2),o.setAttribute("ry",i/2-a/2),o.setAttribute("stroke-width",a||1),o.setAttribute("stroke","transparent"),o.setAttribute("fill","transparent"),r.append(o),this.container.append(r),!e.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#e}addHighlightArea(){this.container.classList.add("highlightArea")}}class Wp extends ut{#e=null;constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.containerClassName="polylineAnnotation",this.svgElementName="svg:polyline"}render(){this.container.classList.add(this.containerClassName);const{data:{rect:e,vertices:t,borderStyle:i,popupRef:r},width:a,height:o}=this;if(!t)return this.container;const c=this.svgFactory.create(a,o,!0);let d=[];for(let p=0,g=t.length;p<g;p+=2){const w=t[p]-e[0],x=e[3]-t[p+1];d.push(`${w},${x}`)}d=d.join(" ");const f=this.#e=this.svgFactory.createElement(this.svgElementName);return f.setAttribute("points",d),f.setAttribute("stroke-width",i.width||1),f.setAttribute("stroke","transparent"),f.setAttribute("fill","transparent"),c.append(f),this.container.append(c),!r&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return this.#e}addHighlightArea(){this.container.classList.add("highlightArea")}}class Vy extends Wp{constructor(e){super(e),this.containerClassName="polygonAnnotation",this.svgElementName="svg:polygon"}}class Ky extends ut{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0})}render(){return this.container.classList.add("caretAnnotation"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container}}class Md extends ut{#e=null;#t=[];constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.containerClassName="inkAnnotation",this.svgElementName="svg:polyline",this.annotationEditorType=this.data.it==="InkHighlight"?Me.HIGHLIGHT:Me.INK}#i(e,t){switch(e){case 90:return{transform:`rotate(90) translate(${-t[0]},${t[1]}) scale(1,-1)`,width:t[3]-t[1],height:t[2]-t[0]};case 180:return{transform:`rotate(180) translate(${-t[2]},${t[1]}) scale(1,-1)`,width:t[2]-t[0],height:t[3]-t[1]};case 270:return{transform:`rotate(270) translate(${-t[2]},${t[3]}) scale(1,-1)`,width:t[3]-t[1],height:t[2]-t[0]};default:return{transform:`translate(${-t[0]},${t[3]}) scale(1,-1)`,width:t[2]-t[0],height:t[3]-t[1]}}}render(){this.container.classList.add(this.containerClassName);const{data:{rect:e,rotation:t,inkLists:i,borderStyle:r,popupRef:a}}=this,{transform:o,width:c,height:d}=this.#i(t,e),f=this.svgFactory.create(c,d,!0),p=this.#e=this.svgFactory.createElement("svg:g");f.append(p),p.setAttribute("stroke-width",r.width||1),p.setAttribute("stroke-linecap","round"),p.setAttribute("stroke-linejoin","round"),p.setAttribute("stroke-miterlimit",10),p.setAttribute("stroke","transparent"),p.setAttribute("fill","transparent"),p.setAttribute("transform",o);for(let g=0,w=i.length;g<w;g++){const x=this.svgFactory.createElement(this.svgElementName);this.#t.push(x),x.setAttribute("points",i[g].join(",")),p.append(x)}return!a&&this.hasPopupData&&this._createPopup(),this.container.append(f),this._editOnDoubleClick(),this.container}updateEdited(e){super.updateEdited(e);const{thickness:t,points:i,rect:r}=e,a=this.#e;if(t>=0&&a.setAttribute("stroke-width",t||1),i)for(let o=0,c=this.#t.length;o<c;o++)this.#t[o].setAttribute("points",i[o].join(","));if(r){const{transform:o,width:c,height:d}=this.#i(this.data.rotation,r);a.parentElement.setAttribute("viewBox",`0 0 ${c} ${d}`),a.setAttribute("transform",o)}}getElementsToTriggerPopup(){return this.#t}addHighlightArea(){this.container.classList.add("highlightArea")}}class Hp extends ut{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0}),this.annotationEditorType=Me.HIGHLIGHT}render(){const{data:{overlaidText:e,popupRef:t}}=this;if(!t&&this.hasPopupData&&this._createPopup(),this.container.classList.add("highlightAnnotation"),this._editOnDoubleClick(),e){const i=document.createElement("mark");i.classList.add("overlaidText"),i.textContent=e,this.container.append(i)}return this.container}}class Yy extends ut{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){const{data:{overlaidText:e,popupRef:t}}=this;if(!t&&this.hasPopupData&&this._createPopup(),this.container.classList.add("underlineAnnotation"),e){const i=document.createElement("u");i.classList.add("overlaidText"),i.textContent=e,this.container.append(i)}return this.container}}class Xy extends ut{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){const{data:{overlaidText:e,popupRef:t}}=this;if(!t&&this.hasPopupData&&this._createPopup(),this.container.classList.add("squigglyAnnotation"),e){const i=document.createElement("u");i.classList.add("overlaidText"),i.textContent=e,this.container.append(i)}return this.container}}class Qy extends ut{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){const{data:{overlaidText:e,popupRef:t}}=this;if(!t&&this.hasPopupData&&this._createPopup(),this.container.classList.add("strikeoutAnnotation"),e){const i=document.createElement("s");i.classList.add("overlaidText"),i.textContent=e,this.container.append(i)}return this.container}}class Gp extends ut{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0}),this.annotationEditorType=Me.STAMP}render(){return this.container.classList.add("stampAnnotation"),this.container.setAttribute("role","img"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}}class Jy extends ut{#e=null;constructor(e){super(e,{isRenderable:!0});const{file:t}=this.data;this.filename=t.filename,this.content=t.content,this.linkService.eventBus?.dispatch("fileattachmentannotation",{source:this,...t})}render(){this.container.classList.add("fileAttachmentAnnotation");const{container:e,data:t}=this;let i;t.hasAppearance||t.fillAlpha===0?i=document.createElement("div"):(i=document.createElement("img"),i.src=`${this.imageResourcesPath}annotation-${/paperclip/i.test(t.name)?"paperclip":"pushpin"}.svg`,t.fillAlpha&&t.fillAlpha<1&&(i.style=`filter: opacity(${Math.round(t.fillAlpha*100)}%);`)),i.addEventListener("dblclick",this.#t.bind(this)),this.#e=i;const{isMac:r}=Pt.platform;return e.addEventListener("keydown",a=>{a.key==="Enter"&&(r?a.metaKey:a.ctrlKey)&&this.#t()}),!t.popupRef&&this.hasPopupData?this._createPopup():i.classList.add("popupTriggerArea"),e.append(i),e}getElementsToTriggerPopup(){return this.#e}addHighlightArea(){this.container.classList.add("highlightArea")}#t(){this.downloadManager?.openOrDownloadData(this.content,this.filename)}}let Id=class zp{#e=null;#t=null;#i=null;#n=new Map;#a=null;#s=null;constructor({div:e,accessibilityManager:t,annotationCanvasMap:i,annotationEditorUIManager:r,page:a,viewport:o,structTreeLayer:c,commentManager:d,linkService:f,annotationStorage:p}){this.div=e,this.#e=t,this.#t=i,this.#a=c||null,this.#s=f||null,this.#i=p||new Sd,this.page=a,this.viewport=o,this.zIndex=0,this._annotationEditorUIManager=r,this._commentManager=d||null}hasEditableAnnotations(){return this.#n.size>0}async#r(e,t,i){const r=e.firstChild||e,a=r.id=`${wd}${t}`,o=await this.#a?.getAriaAttributes(a);if(o)for(const[c,d]of o)r.setAttribute(c,d);i?i.at(-1).container.after(e):(this.div.append(e),this.#e?.moveElementInDOM(this.div,e,r,!1))}async render(e){const{annotations:t}=e,i=this.div;qi(i,this.viewport);const r=new Map,a={data:null,layer:i,linkService:this.#s,downloadManager:e.downloadManager,imageResourcesPath:e.imageResourcesPath||"",renderForms:e.renderForms!==!1,svgFactory:new ta,annotationStorage:this.#i,enableComment:e.enableComment===!0,enableScripting:e.enableScripting===!0,hasJSActions:e.hasJSActions,fieldObjects:e.fieldObjects,parent:this,elements:null};for(const o of t){if(o.noHTML)continue;const c=o.annotationType===wt.POPUP;if(c){const p=r.get(o.id);if(!p)continue;a.elements=p}else if(o.rect[2]===o.rect[0]||o.rect[3]===o.rect[1])continue;a.data=o;const d=Qf.create(a);if(!d.isRenderable)continue;if(!c&&o.popupRef){const p=r.get(o.popupRef);p?p.push(d):r.set(o.popupRef,[d])}const f=d.render();o.hidden&&(f.style.visibility="hidden"),await this.#r(f,o.id,a.elements),d.extraPopupElement?.popup?.renderCommentButton(),d._isEditable&&(this.#n.set(d.data.id,d),this._annotationEditorUIManager?.renderAnnotationElement(d))}this.#o()}async addLinkAnnotations(e){const t={data:null,layer:this.div,linkService:this.#s,svgFactory:new ta,parent:this};for(const i of e){i.borderStyle||=zp._defaultBorderStyle,t.data=i;const r=Qf.create(t);if(!r.isRenderable)continue;const a=r.render();await this.#r(a,i.id,null)}}update({viewport:e}){const t=this.div;this.viewport=e,qi(t,{rotation:e.rotation}),this.#o(),t.hidden=!1}#o(){if(!this.#t)return;const e=this.div;for(const[t,i]of this.#t){const r=e.querySelector(`[data-annotation-id="${t}"]`);if(!r)continue;i.className="annotationContent";const{firstChild:a}=r;a?a.nodeName==="CANVAS"?a.replaceWith(i):a.classList.contains("annotationContent")?a.after(i):a.before(i):r.append(i);const o=this.#n.get(t);o&&(o._hasNoCanvas?(this._annotationEditorUIManager?.setMissingCanvas(t,r.id,i),o._hasNoCanvas=!1):o.canvas=i)}this.#t.clear()}getEditableAnnotations(){return Array.from(this.#n.values())}getEditableAnnotation(e){return this.#n.get(e)}addFakeAnnotation(e){const{div:t}=this,{id:i,rotation:r}=e,a=new jy({data:{id:i,rect:e.getPDFRect(),rotation:r},editor:e,layer:t,parent:this,enableComment:!!this._commentManager,linkService:this.#s,annotationStorage:this.#i}),o=a.render();return t.append(o),this.#e?.moveElementInDOM(t,o,o,!1),a.createOrUpdatePopup(),a}static get _defaultBorderStyle(){return Le(this,"_defaultBorderStyle",Object.freeze({width:1,rawWidth:1,style:Hs.SOLID,dashArray:[3],horizontalCornerRadius:0,verticalCornerRadius:0}))}};const Io=/\r\n?|\n/g;class _t extends Te{#e="";#t=`${this.id}-editor`;#i=null;#n;_colorPicker=null;static _freeTextDefaultContent="";static _internalPadding=0;static _defaultColor=null;static _defaultFontSize=10;static get _keyboardManager(){const e=_t.prototype,t=a=>a.isEmpty(),i=di.TRANSLATE_SMALL,r=di.TRANSLATE_BIG;return Le(this,"_keyboardManager",new aa([[["ctrl+s","mac+meta+s","ctrl+p","mac+meta+p"],e.commitOrRemove,{bubbles:!0}],[["ctrl+Enter","mac+meta+Enter","Escape","mac+Escape"],e.commitOrRemove],[["ArrowLeft","mac+ArrowLeft"],e._translateEmpty,{args:[-i,0],checker:t}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],e._translateEmpty,{args:[-r,0],checker:t}],[["ArrowRight","mac+ArrowRight"],e._translateEmpty,{args:[i,0],checker:t}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],e._translateEmpty,{args:[r,0],checker:t}],[["ArrowUp","mac+ArrowUp"],e._translateEmpty,{args:[0,-i],checker:t}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],e._translateEmpty,{args:[0,-r],checker:t}],[["ArrowDown","mac+ArrowDown"],e._translateEmpty,{args:[0,i],checker:t}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],e._translateEmpty,{args:[0,r],checker:t}]]))}static _type="freetext";static _editorType=Me.FREETEXT;constructor(e){super({...e,name:"freeTextEditor"}),this.color=e.color||_t._defaultColor||Te._defaultLineColor,this.#n=e.fontSize||_t._defaultFontSize,this.annotationElementId||this._uiManager.a11yAlert("pdfjs-editor-freetext-added-alert")}static initialize(e,t){Te.initialize(e,t);const i=getComputedStyle(document.documentElement);this._internalPadding=parseFloat(i.getPropertyValue("--freetext-padding"))}static updateDefaultParams(e,t){switch(e){case Oe.FREETEXT_SIZE:_t._defaultFontSize=t;break;case Oe.FREETEXT_COLOR:_t._defaultColor=t;break}}updateParams(e,t){switch(e){case Oe.FREETEXT_SIZE:this.#a(t);break;case Oe.FREETEXT_COLOR:this.#s(t);break}}static get defaultPropertiesToUpdate(){return[[Oe.FREETEXT_SIZE,_t._defaultFontSize],[Oe.FREETEXT_COLOR,_t._defaultColor||Te._defaultLineColor]]}get propertiesToUpdate(){return[[Oe.FREETEXT_SIZE,this.#n],[Oe.FREETEXT_COLOR,this.color]]}get toolbarButtons(){return this._colorPicker||=new ea(this),[["colorPicker",this._colorPicker]]}get colorType(){return Oe.FREETEXT_COLOR}#a(e){const t=r=>{this.editorDiv.style.fontSize=`calc(${r}px * var(--total-scale-factor))`,this.translate(0,-(r-this.#n)*this.parentScale),this.#n=r,this.#o()},i=this.#n;this.addCommands({cmd:t.bind(this,e),undo:t.bind(this,i),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:Oe.FREETEXT_SIZE,overwriteIfSameType:!0,keepUndo:!0})}onUpdatedColor(){this.editorDiv.style.color=this.color,this._colorPicker?.update(this.color),super.onUpdatedColor()}#s(e){const t=r=>{this.color=r,this.onUpdatedColor()},i=this.color;this.addCommands({cmd:t.bind(this,e),undo:t.bind(this,i),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:Oe.FREETEXT_COLOR,overwriteIfSameType:!0,keepUndo:!0})}_translateEmpty(e,t){this._uiManager.translateSelectedEditors(e,t,!0)}getInitialTranslation(){const e=this.parentScale;return[-_t._internalPadding*e,-(_t._internalPadding+this.#n)*e]}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.isAttachedToDOM||this.parent.add(this)))}enableEditMode(){if(!super.enableEditMode())return!1;this.overlayDiv.classList.remove("enabled"),this.editorDiv.contentEditable=!0,this._isDraggable=!1,this.div.removeAttribute("aria-activedescendant"),this.#i=new AbortController;const e=this._uiManager.combinedSignal(this.#i);return this.editorDiv.addEventListener("keydown",this.editorDivKeydown.bind(this),{signal:e}),this.editorDiv.addEventListener("focus",this.editorDivFocus.bind(this),{signal:e}),this.editorDiv.addEventListener("blur",this.editorDivBlur.bind(this),{signal:e}),this.editorDiv.addEventListener("input",this.editorDivInput.bind(this),{signal:e}),this.editorDiv.addEventListener("paste",this.editorDivPaste.bind(this),{signal:e}),!0}disableEditMode(){return super.disableEditMode()?(this.overlayDiv.classList.add("enabled"),this.editorDiv.contentEditable=!1,this.div.setAttribute("aria-activedescendant",this.#t),this._isDraggable=!0,this.#i?.abort(),this.#i=null,this.div.focus({preventScroll:!0}),this.isEditing=!1,this.parent.div.classList.add("freetextEditing"),!0):!1}focusin(e){this._focusEventsAllowed&&(super.focusin(e),e.target!==this.editorDiv&&this.editorDiv.focus())}onceAdded(e){this.width||(this.enableEditMode(),e&&this.editorDiv.focus(),this._initialOptions?.isCentered&&this.center(),this._initialOptions=null)}isEmpty(){return!this.editorDiv||this.editorDiv.innerText.trim()===""}remove(){this.isEditing=!1,this.parent&&(this.parent.setEditingState(!0),this.parent.div.classList.add("freetextEditing")),super.remove()}#r(){const e=[];this.editorDiv.normalize();let t=null;for(const i of this.editorDiv.childNodes)t?.nodeType===Node.TEXT_NODE&&i.nodeName==="BR"||(e.push(_t.#c(i)),t=i);return e.join(`
`)}#o(){const[e,t]=this.parentDimensions;let i;if(this.isAttachedToDOM)i=this.div.getBoundingClientRect();else{const{currentLayer:r,div:a}=this,o=a.style.display,c=a.classList.contains("hidden");a.classList.remove("hidden"),a.style.display="hidden",r.div.append(this.div),i=a.getBoundingClientRect(),a.remove(),a.style.display=o,a.classList.toggle("hidden",c)}this.rotation%180===this.parentRotation%180?(this.width=i.width/e,this.height=i.height/t):(this.width=i.height/e,this.height=i.width/t),this.fixAndSetPosition()}commit(){if(!this.isInEditMode())return;super.commit(),this.disableEditMode();const e=this.#e,t=this.#e=this.#r().trimEnd();if(e===t)return;const i=r=>{if(this.#e=r,!r){this.remove();return}this.#l(),this._uiManager.rebuild(this),this.#o()};this.addCommands({cmd:()=>{i(t)},undo:()=>{i(e)},mustExec:!1}),this.#o()}shouldGetKeyboardEvents(){return this.isInEditMode()}enterInEditMode(){this.enableEditMode(),this.editorDiv.focus()}keydown(e){e.target===this.div&&e.key==="Enter"&&(this.enterInEditMode(),e.preventDefault())}editorDivKeydown(e){_t._keyboardManager.exec(this,e)}editorDivFocus(e){this.isEditing=!0}editorDivBlur(e){this.isEditing=!1}editorDivInput(e){this.parent.div.classList.toggle("freetextEditing",this.isEmpty())}disableEditing(){this.editorDiv.setAttribute("role","comment"),this.editorDiv.removeAttribute("aria-multiline")}enableEditing(){this.editorDiv.setAttribute("role","textbox"),this.editorDiv.setAttribute("aria-multiline",!0)}get canChangeContent(){return!0}render(){if(this.div)return this.div;let e,t;(this._isCopy||this.annotationElementId)&&(e=this.x,t=this.y),super.render(),this.editorDiv=document.createElement("div"),this.editorDiv.className="internal",this.editorDiv.setAttribute("id",this.#t),this.editorDiv.setAttribute("data-l10n-id","pdfjs-free-text2"),this.editorDiv.setAttribute("data-l10n-attrs","default-content"),this.enableEditing(),this.editorDiv.contentEditable=!0;const{style:i}=this.editorDiv;if(i.fontSize=`calc(${this.#n}px * var(--total-scale-factor))`,i.color=this.color,this.div.append(this.editorDiv),this.overlayDiv=document.createElement("div"),this.overlayDiv.classList.add("overlay","enabled"),this.div.append(this.overlayDiv),this._isCopy||this.annotationElementId){const[r,a]=this.parentDimensions;if(this.annotationElementId){const{position:o}=this._initialData;let[c,d]=this.getInitialTranslation();[c,d]=this.pageTranslationToScreen(c,d);const[f,p]=this.pageDimensions,[g,w]=this.pageTranslation;let x,k;switch(this.rotation){case 0:x=e+(o[0]-g)/f,k=t+this.height-(o[1]-w)/p;break;case 90:x=e+(o[0]-g)/f,k=t-(o[1]-w)/p,[c,d]=[d,-c];break;case 180:x=e-this.width+(o[0]-g)/f,k=t-(o[1]-w)/p,[c,d]=[-c,-d];break;case 270:x=e+(o[0]-g-this.height*p)/f,k=t+(o[1]-w-this.width*f)/p,[c,d]=[-d,c];break}this.setAt(x*r,k*a,c,d)}else this._moveAfterPaste(e,t);this.#l(),this._isDraggable=!0,this.editorDiv.contentEditable=!1}else this._isDraggable=!1,this.editorDiv.contentEditable=!0;return this.div}static#c(e){return(e.nodeType===Node.TEXT_NODE?e.nodeValue:e.innerText).replaceAll(Io,"")}editorDivPaste(e){const t=e.clipboardData||window.clipboardData,{types:i}=t;if(i.length===1&&i[0]==="text/plain")return;e.preventDefault();const r=_t.#h(t.getData("text")||"").replaceAll(Io,`
`);if(!r)return;const a=window.getSelection();if(!a.rangeCount)return;this.editorDiv.normalize(),a.deleteFromDocument();const o=a.getRangeAt(0);if(!r.includes(`
`)){o.insertNode(document.createTextNode(r)),this.editorDiv.normalize(),a.collapseToStart();return}const{startContainer:c,startOffset:d}=o,f=[],p=[];if(c.nodeType===Node.TEXT_NODE){const x=c.parentElement;if(p.push(c.nodeValue.slice(d).replaceAll(Io,"")),x!==this.editorDiv){let k=f;for(const v of this.editorDiv.childNodes){if(v===x){k=p;continue}k.push(_t.#c(v))}}f.push(c.nodeValue.slice(0,d).replaceAll(Io,""))}else if(c===this.editorDiv){let x=f,k=0;for(const v of this.editorDiv.childNodes)k++===d&&(x=p),x.push(_t.#c(v))}this.#e=`${f.join(`
`)}${r}${p.join(`
`)}`,this.#l();const g=new Range;let w=Math.sumPrecise(f.map(x=>x.length));for(const{firstChild:x}of this.editorDiv.childNodes)if(x.nodeType===Node.TEXT_NODE){const k=x.nodeValue.length;if(w<=k){g.setStart(x,w),g.setEnd(x,w);break}w-=k}a.removeAllRanges(),a.addRange(g)}#l(){if(this.editorDiv.replaceChildren(),!!this.#e)for(const e of this.#e.split(`
`)){const t=document.createElement("div");t.append(e?document.createTextNode(e):document.createElement("br")),this.editorDiv.append(t)}}#u(){return this.#e.replaceAll(""," ")}static#h(e){return e.replaceAll(" ","")}get contentDiv(){return this.editorDiv}getPDFRect(){const e=_t._internalPadding*this.parentScale;return this.getRect(e,e)}static async deserialize(e,t,i){let r=null;if(e instanceof Bp){const{data:{defaultAppearanceData:{fontSize:o,fontColor:c},rect:d,rotation:f,id:p,popupRef:g,richText:w,contentsObj:x,creationDate:k,modificationDate:v},textContent:A,textPosition:C,parent:{page:{pageNumber:T}}}=e;if(!A||A.length===0)return null;r=e={annotationType:Me.FREETEXT,color:Array.from(c),fontSize:o,value:A.join(`
`),position:C,pageIndex:T-1,rect:d.slice(0),rotation:f,annotationElementId:p,id:p,deleted:!1,popupRef:g,comment:x?.str||null,richText:w,creationDate:k,modificationDate:v}}const a=await super.deserialize(e,t,i);return a.#n=e.fontSize,a.color=ve.makeHexColor(...e.color),a.#e=_t.#h(e.value),a._initialData=r,e.comment&&a.setCommentData(e),a}serialize(e=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const t=Te._colorManager.convert(this.isAttachedToDOM?getComputedStyle(this.editorDiv).color:this.color),i=Object.assign(super.serialize(e),{color:t,fontSize:this.#n,value:this.#u()});return this.addComment(i),e?(i.isCopy=!0,i):this.annotationElementId&&!this.#f(i)?null:(i.id=this.annotationElementId,i)}#f(e){const{value:t,fontSize:i,color:r,pageIndex:a}=this._initialData;return this.hasEditedComment||this._hasBeenMoved||e.value!==t||e.fontSize!==i||e.color.some((o,c)=>o!==r[c])||e.pageIndex!==a}renderAnnotationElement(e){const t=super.renderAnnotationElement(e);if(!t)return null;const{style:i}=t;i.fontSize=`calc(${this.#n}px * var(--total-scale-factor))`,i.color=this.color,t.replaceChildren();for(const r of this.#e.split(`
`)){const a=document.createElement("div");a.append(r?document.createTextNode(r):document.createElement("br")),t.append(a)}return e.updateEdited({rect:this.getPDFRect(),popup:this._uiManager.hasCommentManager()||this.hasEditedComment?this.comment:{text:this.#e}}),t}resetAnnotationElement(e){super.resetAnnotationElement(e),e.resetEdited()}}let be=class{static PRECISION=1e-4;toSVGPath(){Ye("Abstract method `toSVGPath` must be implemented.")}get box(){Ye("Abstract getter `box` must be implemented.")}serialize(e,t){Ye("Abstract method `serialize` must be implemented.")}static _rescale(e,t,i,r,a,o){o||=new Float32Array(e.length);for(let c=0,d=e.length;c<d;c+=2)o[c]=t+e[c]*r,o[c+1]=i+e[c+1]*a;return o}static _rescaleAndSwap(e,t,i,r,a,o){o||=new Float32Array(e.length);for(let c=0,d=e.length;c<d;c+=2)o[c]=t+e[c+1]*r,o[c+1]=i+e[c]*a;return o}static _translate(e,t,i,r){r||=new Float32Array(e.length);for(let a=0,o=e.length;a<o;a+=2)r[a]=t+e[a],r[a+1]=i+e[a+1];return r}static svgRound(e){return Math.round(e*1e4)}static _normalizePoint(e,t,i,r,a){switch(a){case 90:return[1-t/i,e/r];case 180:return[1-e/i,1-t/r];case 270:return[t/i,1-e/r];default:return[e/i,t/r]}}static _normalizePagePoint(e,t,i){switch(i){case 90:return[1-t,e];case 180:return[1-e,1-t];case 270:return[t,1-e];default:return[e,t]}}static createBezierPoints(e,t,i,r,a,o){return[(e+5*i)/6,(t+5*r)/6,(5*i+a)/6,(5*r+o)/6,(i+a)/2,(r+o)/2]}};class rs{#e;#t=[];#i;#n;#a=[];#s=new Float32Array(18);#r;#o;#c;#l;#u;#h;#f=[];static#g=8;static#p=2;static#d=rs.#g+rs.#p;constructor({x:e,y:t},i,r,a,o,c=0){this.#e=i,this.#h=a*r,this.#n=o,this.#s.set([NaN,NaN,NaN,NaN,e,t],6),this.#i=c,this.#l=rs.#g*r,this.#c=rs.#d*r,this.#u=r,this.#f.push(e,t)}isEmpty(){return isNaN(this.#s[8])}#m(){const e=this.#s.subarray(4,6),t=this.#s.subarray(16,18),[i,r,a,o]=this.#e;return[(this.#r+(e[0]-t[0])/2-i)/a,(this.#o+(e[1]-t[1])/2-r)/o,(this.#r+(t[0]-e[0])/2-i)/a,(this.#o+(t[1]-e[1])/2-r)/o]}add({x:e,y:t}){this.#r=e,this.#o=t;const[i,r,a,o]=this.#e;let[c,d,f,p]=this.#s.subarray(8,12);const g=e-f,w=t-p,x=Math.hypot(g,w);if(x<this.#c)return!1;const k=x-this.#l,v=k/x,A=v*g,C=v*w;let T=c,R=d;c=f,d=p,f+=A,p+=C,this.#f?.push(e,t);const E=-C/k,_=A/k,M=E*this.#h,N=_*this.#h;return this.#s.set(this.#s.subarray(2,8),0),this.#s.set([f+M,p+N],4),this.#s.set(this.#s.subarray(14,18),12),this.#s.set([f-M,p-N],16),isNaN(this.#s[6])?(this.#a.length===0&&(this.#s.set([c+M,d+N],2),this.#a.push(NaN,NaN,NaN,NaN,(c+M-i)/a,(d+N-r)/o),this.#s.set([c-M,d-N],14),this.#t.push(NaN,NaN,NaN,NaN,(c-M-i)/a,(d-N-r)/o)),this.#s.set([T,R,c,d,f,p],6),!this.isEmpty()):(this.#s.set([T,R,c,d,f,p],6),Math.abs(Math.atan2(R-d,T-c)-Math.atan2(C,A))<Math.PI/2?([c,d,f,p]=this.#s.subarray(2,6),this.#a.push(NaN,NaN,NaN,NaN,((c+f)/2-i)/a,((d+p)/2-r)/o),[c,d,T,R]=this.#s.subarray(14,18),this.#t.push(NaN,NaN,NaN,NaN,((T+c)/2-i)/a,((R+d)/2-r)/o),!0):([T,R,c,d,f,p]=this.#s.subarray(0,6),this.#a.push(((T+5*c)/6-i)/a,((R+5*d)/6-r)/o,((5*c+f)/6-i)/a,((5*d+p)/6-r)/o,((c+f)/2-i)/a,((d+p)/2-r)/o),[f,p,c,d,T,R]=this.#s.subarray(12,18),this.#t.push(((T+5*c)/6-i)/a,((R+5*d)/6-r)/o,((5*c+f)/6-i)/a,((5*d+p)/6-r)/o,((c+f)/2-i)/a,((d+p)/2-r)/o),!0))}toSVGPath(){if(this.isEmpty())return"";const e=this.#a,t=this.#t;if(isNaN(this.#s[6])&&!this.isEmpty())return this.#y();const i=[];i.push(`M${e[4]} ${e[5]}`);for(let r=6;r<e.length;r+=6)isNaN(e[r])?i.push(`L${e[r+4]} ${e[r+5]}`):i.push(`C${e[r]} ${e[r+1]} ${e[r+2]} ${e[r+3]} ${e[r+4]} ${e[r+5]}`);this.#w(i);for(let r=t.length-6;r>=6;r-=6)isNaN(t[r])?i.push(`L${t[r+4]} ${t[r+5]}`):i.push(`C${t[r]} ${t[r+1]} ${t[r+2]} ${t[r+3]} ${t[r+4]} ${t[r+5]}`);return this.#b(i),i.join(" ")}#y(){const[e,t,i,r]=this.#e,[a,o,c,d]=this.#m();return`M${(this.#s[2]-e)/i} ${(this.#s[3]-t)/r} L${(this.#s[4]-e)/i} ${(this.#s[5]-t)/r} L${a} ${o} L${c} ${d} L${(this.#s[16]-e)/i} ${(this.#s[17]-t)/r} L${(this.#s[14]-e)/i} ${(this.#s[15]-t)/r} Z`}#b(e){const t=this.#t;e.push(`L${t[4]} ${t[5]} Z`)}#w(e){const[t,i,r,a]=this.#e,o=this.#s.subarray(4,6),c=this.#s.subarray(16,18),[d,f,p,g]=this.#m();e.push(`L${(o[0]-t)/r} ${(o[1]-i)/a} L${d} ${f} L${p} ${g} L${(c[0]-t)/r} ${(c[1]-i)/a}`)}newFreeDrawOutline(e,t,i,r,a,o){return new Up(e,t,i,r,a,o)}getOutlines(){const e=this.#a,t=this.#t,i=this.#s,[r,a,o,c]=this.#e,d=new Float32Array((this.#f?.length??0)+2);for(let g=0,w=d.length-2;g<w;g+=2)d[g]=(this.#f[g]-r)/o,d[g+1]=(this.#f[g+1]-a)/c;if(d[d.length-2]=(this.#r-r)/o,d[d.length-1]=(this.#o-a)/c,isNaN(i[6])&&!this.isEmpty())return this.#C(d);const f=new Float32Array(this.#a.length+24+this.#t.length);let p=e.length;for(let g=0;g<p;g+=2){if(isNaN(e[g])){f[g]=f[g+1]=NaN;continue}f[g]=e[g],f[g+1]=e[g+1]}p=this.#v(f,p);for(let g=t.length-6;g>=6;g-=6)for(let w=0;w<6;w+=2){if(isNaN(t[g+w])){f[p]=f[p+1]=NaN,p+=2;continue}f[p]=t[g+w],f[p+1]=t[g+w+1],p+=2}return this.#S(f,p),this.newFreeDrawOutline(f,d,this.#e,this.#u,this.#i,this.#n)}#C(e){const t=this.#s,[i,r,a,o]=this.#e,[c,d,f,p]=this.#m(),g=new Float32Array(36);return g.set([NaN,NaN,NaN,NaN,(t[2]-i)/a,(t[3]-r)/o,NaN,NaN,NaN,NaN,(t[4]-i)/a,(t[5]-r)/o,NaN,NaN,NaN,NaN,c,d,NaN,NaN,NaN,NaN,f,p,NaN,NaN,NaN,NaN,(t[16]-i)/a,(t[17]-r)/o,NaN,NaN,NaN,NaN,(t[14]-i)/a,(t[15]-r)/o],0),this.newFreeDrawOutline(g,e,this.#e,this.#u,this.#i,this.#n)}#S(e,t){const i=this.#t;return e.set([NaN,NaN,NaN,NaN,i[4],i[5]],t),t+=6}#v(e,t){const i=this.#s.subarray(4,6),r=this.#s.subarray(16,18),[a,o,c,d]=this.#e,[f,p,g,w]=this.#m();return e.set([NaN,NaN,NaN,NaN,(i[0]-a)/c,(i[1]-o)/d,NaN,NaN,NaN,NaN,f,p,NaN,NaN,NaN,NaN,g,w,NaN,NaN,NaN,NaN,(r[0]-a)/c,(r[1]-o)/d],t),t+=24}}class Up extends be{#e;#t=new Float32Array(4);#i;#n;#a;#s;#r;constructor(e,t,i,r,a,o){super(),this.#r=e,this.#a=t,this.#e=i,this.#s=r,this.#i=a,this.#n=o,this.firstPoint=[NaN,NaN],this.lastPoint=[NaN,NaN],this.#o(o);const[c,d,f,p]=this.#t;for(let g=0,w=e.length;g<w;g+=2)e[g]=(e[g]-c)/f,e[g+1]=(e[g+1]-d)/p;for(let g=0,w=t.length;g<w;g+=2)t[g]=(t[g]-c)/f,t[g+1]=(t[g+1]-d)/p}toSVGPath(){const e=[`M${this.#r[4]} ${this.#r[5]}`];for(let t=6,i=this.#r.length;t<i;t+=6){if(isNaN(this.#r[t])){e.push(`L${this.#r[t+4]} ${this.#r[t+5]}`);continue}e.push(`C${this.#r[t]} ${this.#r[t+1]} ${this.#r[t+2]} ${this.#r[t+3]} ${this.#r[t+4]} ${this.#r[t+5]}`)}return e.push("Z"),e.join(" ")}serialize([e,t,i,r],a){const o=i-e,c=r-t;let d,f;switch(a){case 0:d=be._rescale(this.#r,e,r,o,-c),f=be._rescale(this.#a,e,r,o,-c);break;case 90:d=be._rescaleAndSwap(this.#r,e,t,o,c),f=be._rescaleAndSwap(this.#a,e,t,o,c);break;case 180:d=be._rescale(this.#r,i,t,-o,c),f=be._rescale(this.#a,i,t,-o,c);break;case 270:d=be._rescaleAndSwap(this.#r,i,r,-o,-c),f=be._rescaleAndSwap(this.#a,i,r,-o,-c);break}return{outline:Array.from(d),points:[Array.from(f)]}}#o(e){const t=this.#r;let i=t[4],r=t[5];const a=[i,r,i,r];let o=i,c=r,d=i,f=r;const p=e?Math.max:Math.min,g=new Float32Array(4);for(let x=6,k=t.length;x<k;x+=6){const v=t[x+4],A=t[x+5];isNaN(t[x])?(ve.pointBoundingBox(v,A,a),c>A?(o=v,c=A):c===A&&(o=p(o,v)),f<A?(d=v,f=A):f===A&&(d=p(d,v))):(g[0]=g[1]=1/0,g[2]=g[3]=-1/0,ve.bezierBoundingBox(i,r,...t.slice(x,x+6),g),ve.rectBoundingBox(g[0],g[1],g[2],g[3],a),c>g[1]?(o=g[0],c=g[1]):c===g[1]&&(o=p(o,g[0])),f<g[3]?(d=g[2],f=g[3]):f===g[3]&&(d=p(d,g[2]))),i=v,r=A}const w=this.#t;w[0]=a[0]-this.#i,w[1]=a[1]-this.#i,w[2]=a[2]-a[0]+2*this.#i,w[3]=a[3]-a[1]+2*this.#i,this.firstPoint=[o,c],this.lastPoint=[d,f]}get box(){return this.#t}newOutliner(e,t,i,r,a,o=0){return new rs(e,t,i,r,a,o)}getNewOutline(e,t){const[i,r,a,o]=this.#t,[c,d,f,p]=this.#e,g=a*f,w=o*p,x=i*f+c,k=r*p+d,v=this.newOutliner({x:this.#a[0]*g+x,y:this.#a[1]*w+k},this.#e,this.#s,e,this.#n,t??this.#i);for(let A=2;A<this.#a.length;A+=2)v.add({x:this.#a[A]*g+x,y:this.#a[A+1]*w+k});return v.getOutlines()}}class od{#e;#t;#i;#n=[];#a=[];constructor(e,t=0,i=0,r=!0){const a=[1/0,1/0,-1/0,-1/0],o=10**-4;for(const{x:v,y:A,width:C,height:T}of e){const R=Math.floor((v-t)/o)*o,E=Math.ceil((v+C+t)/o)*o,_=Math.floor((A-t)/o)*o,M=Math.ceil((A+T+t)/o)*o,N=[R,_,M,!0],I=[E,_,M,!1];this.#n.push(N,I),ve.rectBoundingBox(R,_,E,M,a)}const c=a[2]-a[0]+2*i,d=a[3]-a[1]+2*i,f=a[0]-i,p=a[1]-i;let g=r?-1/0:1/0,w=1/0;const x=this.#n.at(r?-1:-2),k=[x[0],x[2]];for(const v of this.#n){const[A,C,T,R]=v;!R&&r?C<w?(w=C,g=A):C===w&&(g=Math.max(g,A)):R&&!r&&(C<w?(w=C,g=A):C===w&&(g=Math.min(g,A))),v[0]=(A-f)/c,v[1]=(C-p)/d,v[2]=(T-p)/d}this.#e=new Float32Array([f,p,c,d]),this.#t=[g,w],this.#i=k}getOutlines(){this.#n.sort((t,i)=>t[0]-i[0]||t[1]-i[1]||t[2]-i[2]);const e=[];for(const t of this.#n)t[3]?(e.push(...this.#l(t)),this.#o(t)):(this.#c(t),e.push(...this.#l(t)));return this.#s(e)}#s(e){const t=[],i=new Set;for(const o of e){const[c,d,f]=o;t.push([c,d,o],[c,f,o])}t.sort((o,c)=>o[1]-c[1]||o[0]-c[0]);for(let o=0,c=t.length;o<c;o+=2){const d=t[o][2],f=t[o+1][2];d.push(f),f.push(d),i.add(d),i.add(f)}const r=[];let a;for(;i.size>0;){const o=i.values().next().value;let[c,d,f,p,g]=o;i.delete(o);let w=c,x=d;for(a=[c,f],r.push(a);;){let k;if(i.has(p))k=p;else if(i.has(g))k=g;else break;i.delete(k),[c,d,f,p,g]=k,w!==c&&(a.push(w,x,c,x===d?d:f),w=c),x=x===d?f:d}a.push(w,x)}return new Zy(r,this.#e,this.#t,this.#i)}#r(e){const t=this.#a;let i=0,r=t.length-1;for(;i<=r;){const a=i+r>>1,o=t[a][0];if(o===e)return a;o<e?i=a+1:r=a-1}return r+1}#o([,e,t]){const i=this.#r(e);this.#a.splice(i,0,[e,t])}#c([,e,t]){const i=this.#r(e);for(let r=i;r<this.#a.length;r++){const[a,o]=this.#a[r];if(a!==e)break;if(a===e&&o===t){this.#a.splice(r,1);return}}for(let r=i-1;r>=0;r--){const[a,o]=this.#a[r];if(a!==e)break;if(a===e&&o===t){this.#a.splice(r,1);return}}}#l(e){const[t,i,r]=e,a=[[t,i,r]],o=this.#r(r);for(let c=0;c<o;c++){const[d,f]=this.#a[c];for(let p=0,g=a.length;p<g;p++){const[,w,x]=a[p];if(!(f<=w||x<=d)){if(w>=d){if(x>f)a[p][1]=f;else{if(g===1)return[];a.splice(p,1),p--,g--}continue}a[p][2]=d,x>f&&a.push([t,f,x])}}}return a}}class Zy extends be{#e;#t;constructor(e,t,i,r){super(),this.#t=e,this.#e=t,this.firstPoint=i,this.lastPoint=r}toSVGPath(){const e=[];for(const t of this.#t){let[i,r]=t;e.push(`M${i} ${r}`);for(let a=2;a<t.length;a+=2){const o=t[a],c=t[a+1];o===i?(e.push(`V${c}`),r=c):c===r&&(e.push(`H${o}`),i=o)}e.push("Z")}return e.join(" ")}serialize([e,t,i,r],a){const o=[],c=i-e,d=r-t;for(const f of this.#t){const p=new Array(f.length);for(let g=0;g<f.length;g+=2)p[g]=e+f[g]*c,p[g+1]=r-f[g+1]*d;o.push(p)}return o}get box(){return this.#e}get classNamesForOutlining(){return["highlightOutline"]}}class ld extends rs{newFreeDrawOutline(e,t,i,r,a,o){return new ew(e,t,i,r,a,o)}}class ew extends Up{newOutliner(e,t,i,r,a,o=0){return new ld(e,t,i,r,a,o)}}class bt extends Te{#e=null;#t=0;#i;#n=null;#a=null;#s=null;#r=null;#o=0;#c=null;#l=null;#u=null;#h=!1;#f=null;#g=null;#p=null;#d="";#m;#y="";static _defaultColor=null;static _defaultOpacity=1;static _defaultThickness=12;static _type="highlight";static _editorType=Me.HIGHLIGHT;static _freeHighlightId=-1;static _freeHighlight=null;static _freeHighlightClipId="";static get _keyboardManager(){const e=bt.prototype;return Le(this,"_keyboardManager",new aa([[["ArrowLeft","mac+ArrowLeft"],e._moveCaret,{args:[0]}],[["ArrowRight","mac+ArrowRight"],e._moveCaret,{args:[1]}],[["ArrowUp","mac+ArrowUp"],e._moveCaret,{args:[2]}],[["ArrowDown","mac+ArrowDown"],e._moveCaret,{args:[3]}]]))}constructor(e){super({...e,name:"highlightEditor"}),this.color=e.color||bt._defaultColor,this.#m=e.thickness||bt._defaultThickness,this.opacity=e.opacity||bt._defaultOpacity,this.#i=e.boxes||null,this.#y=e.methodOfCreation||"",this.#d=e.text||"",this._isDraggable=!1,this.defaultL10nId="pdfjs-editor-highlight-editor",e.highlightId>-1?(this.#h=!0,this.#w(e),this.#k()):this.#i&&(this.#e=e.anchorNode,this.#t=e.anchorOffset,this.#r=e.focusNode,this.#o=e.focusOffset,this.#b(),this.#k(),this.rotate(this.rotation)),this.annotationElementId||this._uiManager.a11yAlert("pdfjs-editor-highlight-added-alert")}get telemetryInitialData(){return{action:"added",type:this.#h?"free_highlight":"highlight",color:this._uiManager.getNonHCMColorName(this.color),thickness:this.#m,methodOfCreation:this.#y}}get telemetryFinalData(){return{type:"highlight",color:this._uiManager.getNonHCMColorName(this.color)}}static computeTelemetryFinalData(e){return{numberOfColors:e.get("color").size}}#b(){const e=new od(this.#i,.001);this.#l=e.getOutlines(),[this.x,this.y,this.width,this.height]=this.#l.box;const t=new od(this.#i,.0025,.001,this._uiManager.direction==="ltr");this.#s=t.getOutlines();const{firstPoint:i}=this.#l;this.#f=[(i[0]-this.x)/this.width,(i[1]-this.y)/this.height];const{lastPoint:r}=this.#s;this.#g=[(r[0]-this.x)/this.width,(r[1]-this.y)/this.height]}#w({highlightOutlines:e,highlightId:t,clipPathId:i}){this.#l=e;const r=1.5;if(this.#s=e.getNewOutline(this.#m/2+r,.0025),t>=0)this.#u=t,this.#n=i,this.parent.drawLayer.finalizeDraw(t,{bbox:e.box,path:{d:e.toSVGPath()}}),this.#p=this.parent.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:!0},bbox:this.#s.box,path:{d:this.#s.toSVGPath()}},!0);else if(this.parent){const g=this.parent.viewport.rotation;this.parent.drawLayer.updateProperties(this.#u,{bbox:bt.#A(this.#l.box,(g-this.rotation+360)%360),path:{d:e.toSVGPath()}}),this.parent.drawLayer.updateProperties(this.#p,{bbox:bt.#A(this.#s.box,g),path:{d:this.#s.toSVGPath()}})}const[a,o,c,d]=e.box;switch(this.rotation){case 0:this.x=a,this.y=o,this.width=c,this.height=d;break;case 90:{const[g,w]=this.parentDimensions;this.x=o,this.y=1-a,this.width=c*w/g,this.height=d*g/w;break}case 180:this.x=1-a,this.y=1-o,this.width=c,this.height=d;break;case 270:{const[g,w]=this.parentDimensions;this.x=1-o,this.y=a,this.width=c*w/g,this.height=d*g/w;break}}const{firstPoint:f}=e;this.#f=[(f[0]-a)/c,(f[1]-o)/d];const{lastPoint:p}=this.#s;this.#g=[(p[0]-a)/c,(p[1]-o)/d]}static initialize(e,t){Te.initialize(e,t),bt._defaultColor||=t.highlightColors?.values().next().value||"#fff066"}static updateDefaultParams(e,t){switch(e){case Oe.HIGHLIGHT_COLOR:bt._defaultColor=t;break;case Oe.HIGHLIGHT_THICKNESS:bt._defaultThickness=t;break}}translateInPage(e,t){}get toolbarPosition(){return this.#g}get commentButtonPosition(){return this.#f}updateParams(e,t){switch(e){case Oe.HIGHLIGHT_COLOR:this.#C(t);break;case Oe.HIGHLIGHT_THICKNESS:this.#S(t);break}}static get defaultPropertiesToUpdate(){return[[Oe.HIGHLIGHT_COLOR,bt._defaultColor],[Oe.HIGHLIGHT_THICKNESS,bt._defaultThickness]]}get propertiesToUpdate(){return[[Oe.HIGHLIGHT_COLOR,this.color||bt._defaultColor],[Oe.HIGHLIGHT_THICKNESS,this.#m||bt._defaultThickness],[Oe.HIGHLIGHT_FREE,this.#h]]}onUpdatedColor(){this.parent?.drawLayer.updateProperties(this.#u,{root:{fill:this.color,"fill-opacity":this.opacity}}),this.#a?.updateColor(this.color),super.onUpdatedColor()}#C(e){const t=(a,o)=>{this.color=a,this.opacity=o,this.onUpdatedColor()},i=this.color,r=this.opacity;this.addCommands({cmd:t.bind(this,e,bt._defaultOpacity),undo:t.bind(this,i,r),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:Oe.HIGHLIGHT_COLOR,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"color_changed",color:this._uiManager.getNonHCMColorName(e)},!0)}#S(e){const t=this.#m,i=r=>{this.#m=r,this.#v(r)};this.addCommands({cmd:i.bind(this,e),undo:i.bind(this,t),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:Oe.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"thickness_changed",thickness:e},!0)}get toolbarButtons(){return this._uiManager.highlightColors?[["colorPicker",this.#a=new pn({editor:this})]]:super.toolbarButtons}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}fixAndSetPosition(){return super.fixAndSetPosition(this.#_())}getBaseTranslation(){return[0,0]}getRect(e,t){return super.getRect(e,t,this.#_())}onceAdded(e){this.annotationElementId||this.parent.addUndoableEditor(this),e&&this.div.focus()}remove(){this.#E(),this._reportTelemetry({action:"deleted"}),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.#k(),this.isAttachedToDOM||this.parent.add(this)))}setParent(e){let t=!1;this.parent&&!e?this.#E():e&&(this.#k(e),t=!this.parent&&this.div?.classList.contains("selectedEditor")),super.setParent(e),this.show(this._isVisible),t&&this.select()}#v(e){this.#h&&(this.#w({highlightOutlines:this.#l.getNewOutline(e/2)}),this.fixAndSetPosition(),this.setDims(this.width,this.height))}#E(){this.#u===null||!this.parent||(this.parent.drawLayer.remove(this.#u),this.#u=null,this.parent.drawLayer.remove(this.#p),this.#p=null)}#k(e=this.parent){this.#u===null&&({id:this.#u,clipPathId:this.#n}=e.drawLayer.draw({bbox:this.#l.box,root:{viewBox:"0 0 1 1",fill:this.color,"fill-opacity":this.opacity},rootClass:{highlight:!0,free:this.#h},path:{d:this.#l.toSVGPath()}},!1,!0),this.#p=e.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:this.#h},bbox:this.#s.box,path:{d:this.#s.toSVGPath()}},this.#h),this.#c&&(this.#c.style.clipPath=this.#n))}static#A([e,t,i,r],a){switch(a){case 90:return[1-t-r,e,r,i];case 180:return[1-e-i,1-t-r,i,r];case 270:return[t,1-e-i,r,i]}return[e,t,i,r]}rotate(e){const{drawLayer:t}=this.parent;let i;this.#h?(e=(e-this.rotation+360)%360,i=bt.#A(this.#l.box,e)):i=bt.#A([this.x,this.y,this.width,this.height],e),t.updateProperties(this.#u,{bbox:i,root:{"data-main-rotation":e}}),t.updateProperties(this.#p,{bbox:bt.#A(this.#s.box,e),root:{"data-main-rotation":e}})}render(){if(this.div)return this.div;const e=super.render();this.#d&&(e.setAttribute("aria-label",this.#d),e.setAttribute("role","mark")),this.#h?e.classList.add("free"):this.div.addEventListener("keydown",this.#N.bind(this),{signal:this._uiManager._signal});const t=this.#c=document.createElement("div");return e.append(t),t.setAttribute("aria-hidden","true"),t.className="internal",t.style.clipPath=this.#n,this.setDims(this.width,this.height),vp(this,this.#c,["pointerover","pointerleave"]),this.enableEditing(),e}pointerover(){this.isSelected||this.parent?.drawLayer.updateProperties(this.#p,{rootClass:{hovered:!0}})}pointerleave(){this.isSelected||this.parent?.drawLayer.updateProperties(this.#p,{rootClass:{hovered:!1}})}#N(e){bt._keyboardManager.exec(this,e)}_moveCaret(e){switch(this.parent.unselect(this),e){case 0:case 2:this.#R(!0);break;case 1:case 3:this.#R(!1);break}}#R(e){if(!this.#e)return;const t=window.getSelection();e?t.setPosition(this.#e,this.#t):t.setPosition(this.#r,this.#o)}select(){super.select(),this.#p&&this.parent?.drawLayer.updateProperties(this.#p,{rootClass:{hovered:!1,selected:!0}})}unselect(){super.unselect(),this.#p&&(this.parent?.drawLayer.updateProperties(this.#p,{rootClass:{selected:!1}}),this.#h||this.#R(!1))}get _mustFixPosition(){return!this.#h}show(e=this._isVisible){super.show(e),this.parent&&(this.parent.drawLayer.updateProperties(this.#u,{rootClass:{hidden:!e}}),this.parent.drawLayer.updateProperties(this.#p,{rootClass:{hidden:!e}}))}#_(){return this.#h?this.rotation:0}#F(){if(this.#h)return null;const[e,t]=this.pageDimensions,[i,r]=this.pageTranslation,a=this.#i,o=new Float32Array(a.length*8);let c=0;for(const{x:d,y:f,width:p,height:g}of a){const w=d*e+i,x=(1-f)*t+r;o[c]=o[c+4]=w,o[c+1]=o[c+3]=x,o[c+2]=o[c+6]=w+p*e,o[c+5]=o[c+7]=x-g*t,c+=8}return o}#M(e){return this.#l.serialize(e,this.#_())}static startHighlighting(e,t,{target:i,x:r,y:a}){const{x:o,y:c,width:d,height:f}=i.getBoundingClientRect(),p=new AbortController,g=e.combinedSignal(p),w=x=>{p.abort(),this.#O(e,x)};window.addEventListener("blur",w,{signal:g}),window.addEventListener("pointerup",w,{signal:g}),window.addEventListener("pointerdown",ht,{capture:!0,passive:!1,signal:g}),window.addEventListener("contextmenu",gn,{signal:g}),i.addEventListener("pointermove",this.#D.bind(this,e),{signal:g}),this._freeHighlight=new ld({x:r,y:a},[o,c,d,f],e.scale,this._defaultThickness/2,t,.001),{id:this._freeHighlightId,clipPathId:this._freeHighlightClipId}=e.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:this._defaultColor,"fill-opacity":this._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:this._freeHighlight.toSVGPath()}},!0,!0)}static#D(e,t){this._freeHighlight.add(t)&&e.drawLayer.updateProperties(this._freeHighlightId,{path:{d:this._freeHighlight.toSVGPath()}})}static#O(e,t){this._freeHighlight.isEmpty()?e.drawLayer.remove(this._freeHighlightId):e.createAndAddNewEditor(t,!1,{highlightId:this._freeHighlightId,highlightOutlines:this._freeHighlight.getOutlines(),clipPathId:this._freeHighlightClipId,methodOfCreation:"main_toolbar"}),this._freeHighlightId=-1,this._freeHighlight=null,this._freeHighlightClipId=""}static async deserialize(e,t,i){let r=null;if(e instanceof Hp){const{data:{quadPoints:k,rect:v,rotation:A,id:C,color:T,opacity:R,popupRef:E,richText:_,contentsObj:M,creationDate:N,modificationDate:I},parent:{page:{pageNumber:G}}}=e;r=e={annotationType:Me.HIGHLIGHT,color:Array.from(T),opacity:R,quadPoints:k,boxes:null,pageIndex:G-1,rect:v.slice(0),rotation:A,annotationElementId:C,id:C,deleted:!1,popupRef:E,richText:_,comment:M?.str||null,creationDate:N,modificationDate:I}}else if(e instanceof Md){const{data:{inkLists:k,rect:v,rotation:A,id:C,color:T,borderStyle:{rawWidth:R},popupRef:E,richText:_,contentsObj:M,creationDate:N,modificationDate:I},parent:{page:{pageNumber:G}}}=e;r=e={annotationType:Me.HIGHLIGHT,color:Array.from(T),thickness:R,inkLists:k,boxes:null,pageIndex:G-1,rect:v.slice(0),rotation:A,annotationElementId:C,id:C,deleted:!1,popupRef:E,richText:_,comment:M?.str||null,creationDate:N,modificationDate:I}}const{color:a,quadPoints:o,inkLists:c,opacity:d}=e,f=await super.deserialize(e,t,i);f.color=ve.makeHexColor(...a),f.opacity=d||1,c&&(f.#m=e.thickness),f._initialData=r,e.comment&&f.setCommentData(e);const[p,g]=f.pageDimensions,[w,x]=f.pageTranslation;if(o){const k=f.#i=[];for(let v=0;v<o.length;v+=8)k.push({x:(o[v]-w)/p,y:1-(o[v+1]-x)/g,width:(o[v+2]-o[v])/p,height:(o[v+1]-o[v+5])/g});f.#b(),f.#k(),f.rotate(f.rotation)}else if(c){f.#h=!0;const k=c[0],v={x:k[0]-w,y:g-(k[1]-x)},A=new ld(v,[0,0,p,g],1,f.#m/2,!0,.001);for(let R=0,E=k.length;R<E;R+=2)v.x=k[R]-w,v.y=g-(k[R+1]-x),A.add(v);const{id:C,clipPathId:T}=t.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:f.color,"fill-opacity":f._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:A.toSVGPath()}},!0,!0);f.#w({highlightOutlines:A.getOutlines(),highlightId:C,clipPathId:T}),f.#k(),f.rotate(f.parentRotation)}return f}serialize(e=!1){if(this.isEmpty()||e)return null;if(this.deleted)return this.serializeDeleted();const t=Te._colorManager.convert(this._uiManager.getNonHCMColor(this.color)),i=super.serialize(e);return Object.assign(i,{color:t,opacity:this.opacity,thickness:this.#m,quadPoints:this.#F(),outlines:this.#M(i.rect)}),this.addComment(i),this.annotationElementId&&!this.#L(i)?null:(i.id=this.annotationElementId,i)}#L(e){const{color:t}=this._initialData;return this.hasEditedComment||e.color.some((i,r)=>i!==t[r])}renderAnnotationElement(e){return this.deleted?(e.hide(),null):(e.updateEdited({rect:this.getPDFRect(),popup:this.comment}),null)}static canCreateNewEmptyEditor(){return!1}}class $p{#e=Object.create(null);updateProperty(e,t){this[e]=t,this.updateSVGProperty(e,t)}updateProperties(e){if(e)for(const[t,i]of Object.entries(e))t.startsWith("_")||this.updateProperty(t,i)}updateSVGProperty(e,t){this.#e[e]=t}toSVGProperties(){const e=this.#e;return this.#e=Object.create(null),{root:e}}reset(){this.#e=Object.create(null)}updateAll(e=this){this.updateProperties(e)}clone(){Ye("Not implemented")}}class Ne extends Te{#e=null;#t;_colorPicker=null;_drawId=null;static _currentDrawId=-1;static _currentParent=null;static#i=null;static#n=null;static#a=null;static#s=NaN;static#r=null;static#o=null;static#c=NaN;static _INNER_MARGIN=3;constructor(e){super(e),this.#t=e.mustBeCommitted||!1,this._addOutlines(e)}onUpdatedColor(){this._colorPicker?.update(this.color),super.onUpdatedColor()}_addOutlines(e){e.drawOutlines&&(this.#l(e),this.#f())}#l({drawOutlines:e,drawId:t,drawingOptions:i}){this.#e=e,this._drawingOptions||=i,this.annotationElementId||this._uiManager.a11yAlert(`pdfjs-editor-${this.editorType}-added-alert`),t>=0?(this._drawId=t,this.parent.drawLayer.finalizeDraw(t,e.defaultProperties)):this._drawId=this.#u(e,this.parent),this.#d(e.box)}#u(e,t){const{id:i}=t.drawLayer.draw(Ne._mergeSVGProperties(this._drawingOptions.toSVGProperties(),e.defaultSVGProperties),!1,!1);return i}static _mergeSVGProperties(e,t){const i=new Set(Object.keys(e));for(const[r,a]of Object.entries(t))i.has(r)?Object.assign(e[r],a):e[r]=a;return e}static getDefaultDrawingOptions(e){Ye("Not implemented")}static get typesMap(){Ye("Not implemented")}static get isDrawer(){return!0}static get supportMultipleDrawings(){return!1}static updateDefaultParams(e,t){const i=this.typesMap.get(e);i&&this._defaultDrawingOptions.updateProperty(i,t),this._currentParent&&(Ne.#i.updateProperty(i,t),this._currentParent.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}updateParams(e,t){const i=this.constructor.typesMap.get(e);i&&this._updateProperty(e,i,t)}static get defaultPropertiesToUpdate(){const e=[],t=this._defaultDrawingOptions;for(const[i,r]of this.typesMap)e.push([i,t[r]]);return e}get propertiesToUpdate(){const e=[],{_drawingOptions:t}=this;for(const[i,r]of this.constructor.typesMap)e.push([i,t[r]]);return e}_updateProperty(e,t,i){const r=this._drawingOptions,a=r[t],o=c=>{r.updateProperty(t,c);const d=this.#e.updateProperty(t,c);d&&this.#d(d),this.parent?.drawLayer.updateProperties(this._drawId,r.toSVGProperties()),e===this.colorType&&this.onUpdatedColor()};this.addCommands({cmd:o.bind(this,i),undo:o.bind(this,a),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:e,overwriteIfSameType:!0,keepUndo:!0})}_onResizing(){this.parent?.drawLayer.updateProperties(this._drawId,Ne._mergeSVGProperties(this.#e.getPathResizingSVGProperties(this.#p()),{bbox:this.#m()}))}_onResized(){this.parent?.drawLayer.updateProperties(this._drawId,Ne._mergeSVGProperties(this.#e.getPathResizedSVGProperties(this.#p()),{bbox:this.#m()}))}_onTranslating(e,t){this.parent?.drawLayer.updateProperties(this._drawId,{bbox:this.#m()})}_onTranslated(){this.parent?.drawLayer.updateProperties(this._drawId,Ne._mergeSVGProperties(this.#e.getPathTranslatedSVGProperties(this.#p(),this.parentDimensions),{bbox:this.#m()}))}_onStartDragging(){this.parent?.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!0}})}_onStopDragging(){this.parent?.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!1}})}commit(){super.commit(),this.disableEditMode(),this.disableEditing()}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}getBaseTranslation(){return[0,0]}get isResizable(){return!0}onceAdded(e){this.annotationElementId||this.parent.addUndoableEditor(this),this._isDraggable=!0,this.#t&&(this.#t=!1,this.commit(),this.parent.setSelected(this),e&&this.isOnScreen&&this.div.focus())}remove(){this.#h(),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.#f(),this.#d(this.#e.box),this.isAttachedToDOM||this.parent.add(this)))}setParent(e){let t=!1;this.parent&&!e?(this._uiManager.removeShouldRescale(this),this.#h()):e&&(this._uiManager.addShouldRescale(this),this.#f(e),t=!this.parent&&this.div?.classList.contains("selectedEditor")),super.setParent(e),t&&this.select()}#h(){this._drawId===null||!this.parent||(this.parent.drawLayer.remove(this._drawId),this._drawId=null,this._drawingOptions.reset())}#f(e=this.parent){if(!(this._drawId!==null&&this.parent===e)){if(this._drawId!==null){this.parent.drawLayer.updateParent(this._drawId,e.drawLayer);return}this._drawingOptions.updateAll(),this._drawId=this.#u(this.#e,e)}}#g([e,t,i,r]){const{parentDimensions:[a,o],rotation:c}=this;switch(c){case 90:return[t,1-e,i*(o/a),r*(a/o)];case 180:return[1-e,1-t,i,r];case 270:return[1-t,e,i*(o/a),r*(a/o)];default:return[e,t,i,r]}}#p(){const{x:e,y:t,width:i,height:r,parentDimensions:[a,o],rotation:c}=this;switch(c){case 90:return[1-t,e,i*(a/o),r*(o/a)];case 180:return[1-e,1-t,i,r];case 270:return[t,1-e,i*(a/o),r*(o/a)];default:return[e,t,i,r]}}#d(e){[this.x,this.y,this.width,this.height]=this.#g(e),this.div&&(this.fixAndSetPosition(),this.setDims()),this._onResized()}#m(){const{x:e,y:t,width:i,height:r,rotation:a,parentRotation:o,parentDimensions:[c,d]}=this;switch((a*4+o)/90){case 1:return[1-t-r,e,r,i];case 2:return[1-e-i,1-t-r,i,r];case 3:return[t,1-e-i,r,i];case 4:return[e,t-i*(c/d),r*(d/c),i*(c/d)];case 5:return[1-t,e,i*(c/d),r*(d/c)];case 6:return[1-e-r*(d/c),1-t,r*(d/c),i*(c/d)];case 7:return[t-i*(c/d),1-e-r*(d/c),i*(c/d),r*(d/c)];case 8:return[e-i,t-r,i,r];case 9:return[1-t,e-i,r,i];case 10:return[1-e,1-t,i,r];case 11:return[t-r,1-e,r,i];case 12:return[e-r*(d/c),t,r*(d/c),i*(c/d)];case 13:return[1-t-i*(c/d),e-r*(d/c),i*(c/d),r*(d/c)];case 14:return[1-e,1-t-i*(c/d),r*(d/c),i*(c/d)];case 15:return[t,1-e,i*(c/d),r*(d/c)];default:return[e,t,i,r]}}rotate(){this.parent&&this.parent.drawLayer.updateProperties(this._drawId,Ne._mergeSVGProperties({bbox:this.#m()},this.#e.updateRotation((this.parentRotation-this.rotation+360)%360)))}onScaleChanging(){this.parent&&this.#d(this.#e.updateParentDimensions(this.parentDimensions,this.parent.scale))}static onScaleChangingWhenDrawing(){}render(){if(this.div)return this.div;let e,t;this._isCopy&&(e=this.x,t=this.y);const i=super.render();i.classList.add("draw");const r=document.createElement("div");return i.append(r),r.setAttribute("aria-hidden","true"),r.className="internal",this.setDims(),this._uiManager.addShouldRescale(this),this.disableEditing(),this._isCopy&&this._moveAfterPaste(e,t),i}static createDrawerInstance(e,t,i,r,a){Ye("Not implemented")}static startDrawing(e,t,i,r){const{target:a,offsetX:o,offsetY:c,pointerId:d,pointerType:f}=r;if(Ne.#r&&Ne.#r!==f)return;const{viewport:{rotation:p}}=e,{width:g,height:w}=a.getBoundingClientRect(),x=Ne.#n=new AbortController,k=e.combinedSignal(x);if(Ne.#s||=d,Ne.#r??=f,window.addEventListener("pointerup",v=>{Ne.#s===v.pointerId?this._endDraw(v):Ne.#o?.delete(v.pointerId)},{signal:k}),window.addEventListener("pointercancel",v=>{Ne.#s===v.pointerId?this._currentParent.endDrawingSession():Ne.#o?.delete(v.pointerId)},{signal:k}),window.addEventListener("pointerdown",v=>{Ne.#r===v.pointerType&&((Ne.#o||=new Set).add(v.pointerId),Ne.#i.isCancellable()&&(Ne.#i.removeLastElement(),Ne.#i.isEmpty()?this._currentParent.endDrawingSession(!0):this._endDraw(null)))},{capture:!0,passive:!1,signal:k}),window.addEventListener("contextmenu",gn,{signal:k}),a.addEventListener("pointermove",this._drawMove.bind(this),{signal:k}),a.addEventListener("touchmove",v=>{v.timeStamp===Ne.#c&&ht(v)},{signal:k}),e.toggleDrawing(),t._editorUndoBar?.hide(),Ne.#i){e.drawLayer.updateProperties(this._currentDrawId,Ne.#i.startNew(o,c,g,w,p));return}t.updateUIForDefaultProperties(this),Ne.#i=this.createDrawerInstance(o,c,g,w,p),Ne.#a=this.getDefaultDrawingOptions(),this._currentParent=e,{id:this._currentDrawId}=e.drawLayer.draw(this._mergeSVGProperties(Ne.#a.toSVGProperties(),Ne.#i.defaultSVGProperties),!0,!1)}static _drawMove(e){if(Ne.#c=-1,!Ne.#i)return;const{offsetX:t,offsetY:i,pointerId:r}=e;if(Ne.#s===r){if(Ne.#o?.size>=1){this._endDraw(e);return}this._currentParent.drawLayer.updateProperties(this._currentDrawId,Ne.#i.add(t,i)),Ne.#c=e.timeStamp,ht(e)}}static _cleanup(e){e&&(this._currentDrawId=-1,this._currentParent=null,Ne.#i=null,Ne.#a=null,Ne.#r=null,Ne.#c=NaN),Ne.#n&&(Ne.#n.abort(),Ne.#n=null,Ne.#s=NaN,Ne.#o=null)}static _endDraw(e){const t=this._currentParent;if(t){if(t.toggleDrawing(!0),this._cleanup(!1),e?.target===t.div&&t.drawLayer.updateProperties(this._currentDrawId,Ne.#i.end(e.offsetX,e.offsetY)),this.supportMultipleDrawings){const i=Ne.#i,r=this._currentDrawId,a=i.getLastElement();t.addCommands({cmd:()=>{t.drawLayer.updateProperties(r,i.setLastElement(a))},undo:()=>{t.drawLayer.updateProperties(r,i.removeLastElement())},mustExec:!1,type:Oe.DRAW_STEP});return}this.endDrawing(!1)}}static endDrawing(e){const t=this._currentParent;if(!t)return null;if(t.toggleDrawing(!0),t.cleanUndoStack(Oe.DRAW_STEP),!Ne.#i.isEmpty()){const{pageDimensions:[i,r],scale:a}=t,o=t.createAndAddNewEditor({offsetX:0,offsetY:0},!1,{drawId:this._currentDrawId,drawOutlines:Ne.#i.getOutlines(i*a,r*a,a,this._INNER_MARGIN),drawingOptions:Ne.#a,mustBeCommitted:!e});return this._cleanup(!0),o}return t.drawLayer.remove(this._currentDrawId),this._cleanup(!0),null}createDrawingOptions(e){}static deserializeDraw(e,t,i,r,a,o){Ye("Not implemented")}static async deserialize(e,t,i){const{rawDims:{pageWidth:r,pageHeight:a,pageX:o,pageY:c}}=t.viewport,d=this.deserializeDraw(o,c,r,a,this._INNER_MARGIN,e),f=await super.deserialize(e,t,i);return f.createDrawingOptions(e),f.#l({drawOutlines:d}),f.#f(),f.onScaleChanging(),f.rotate(),f}serializeDraw(e){const[t,i]=this.pageTranslation,[r,a]=this.pageDimensions;return this.#e.serialize([t,i,r,a],e)}renderAnnotationElement(e){return e.updateEdited({rect:this.getPDFRect()}),null}static canCreateNewEmptyEditor(){return!1}}class tw{#e=new Float64Array(6);#t;#i;#n;#a;#s;#r="";#o=0;#c=new ca;#l;#u;constructor(e,t,i,r,a,o){this.#l=i,this.#u=r,this.#n=a,this.#a=o,[e,t]=this.#h(e,t);const c=this.#t=[NaN,NaN,NaN,NaN,e,t];this.#s=[e,t],this.#i=[{line:c,points:this.#s}],this.#e.set(c,0)}updateProperty(e,t){e==="stroke-width"&&(this.#a=t)}#h(e,t){return be._normalizePoint(e,t,this.#l,this.#u,this.#n)}isEmpty(){return!this.#i||this.#i.length===0}isCancellable(){return this.#s.length<=10}add(e,t){[e,t]=this.#h(e,t);const[i,r,a,o]=this.#e.subarray(2,6),c=e-a,d=t-o;return Math.hypot(this.#l*c,this.#u*d)<=2?null:(this.#s.push(e,t),isNaN(i)?(this.#e.set([a,o,e,t],2),this.#t.push(NaN,NaN,NaN,NaN,e,t),{path:{d:this.toSVGPath()}}):(isNaN(this.#e[0])&&this.#t.splice(6,6),this.#e.set([i,r,a,o,e,t],0),this.#t.push(...be.createBezierPoints(i,r,a,o,e,t)),{path:{d:this.toSVGPath()}}))}end(e,t){const i=this.add(e,t);return i||(this.#s.length===2?{path:{d:this.toSVGPath()}}:null)}startNew(e,t,i,r,a){this.#l=i,this.#u=r,this.#n=a,[e,t]=this.#h(e,t);const o=this.#t=[NaN,NaN,NaN,NaN,e,t];this.#s=[e,t];const c=this.#i.at(-1);return c&&(c.line=new Float32Array(c.line),c.points=new Float32Array(c.points)),this.#i.push({line:o,points:this.#s}),this.#e.set(o,0),this.#o=0,this.toSVGPath(),null}getLastElement(){return this.#i.at(-1)}setLastElement(e){return this.#i?(this.#i.push(e),this.#t=e.line,this.#s=e.points,this.#o=0,{path:{d:this.toSVGPath()}}):this.#c.setLastElement(e)}removeLastElement(){if(!this.#i)return this.#c.removeLastElement();this.#i.pop(),this.#r="";for(let e=0,t=this.#i.length;e<t;e++){const{line:i,points:r}=this.#i[e];this.#t=i,this.#s=r,this.#o=0,this.toSVGPath()}return{path:{d:this.#r}}}toSVGPath(){const e=be.svgRound(this.#t[4]),t=be.svgRound(this.#t[5]);if(this.#s.length===2)return this.#r=`${this.#r} M ${e} ${t} Z`,this.#r;if(this.#s.length<=6){const r=this.#r.lastIndexOf("M");this.#r=`${this.#r.slice(0,r)} M ${e} ${t}`,this.#o=6}if(this.#s.length===4){const r=be.svgRound(this.#t[10]),a=be.svgRound(this.#t[11]);return this.#r=`${this.#r} L ${r} ${a}`,this.#o=12,this.#r}const i=[];this.#o===0&&(i.push(`M ${e} ${t}`),this.#o=6);for(let r=this.#o,a=this.#t.length;r<a;r+=6){const[o,c,d,f,p,g]=this.#t.slice(r,r+6).map(be.svgRound);i.push(`C${o} ${c} ${d} ${f} ${p} ${g}`)}return this.#r+=i.join(" "),this.#o=this.#t.length,this.#r}getOutlines(e,t,i,r){const a=this.#i.at(-1);return a.line=new Float32Array(a.line),a.points=new Float32Array(a.points),this.#c.build(this.#i,e,t,i,this.#n,this.#a,r),this.#e=null,this.#t=null,this.#i=null,this.#r=null,this.#c}get defaultSVGProperties(){return{root:{viewBox:"0 0 10000 10000"},rootClass:{draw:!0},bbox:[0,0,1,1]}}}class ca extends be{#e;#t=0;#i;#n;#a;#s;#r;#o;#c;build(e,t,i,r,a,o,c){this.#a=t,this.#s=i,this.#r=r,this.#o=a,this.#c=o,this.#i=c??0,this.#n=e,this.#h()}get thickness(){return this.#c}setLastElement(e){return this.#n.push(e),{path:{d:this.toSVGPath()}}}removeLastElement(){return this.#n.pop(),{path:{d:this.toSVGPath()}}}toSVGPath(){const e=[];for(const{line:t}of this.#n){if(e.push(`M${be.svgRound(t[4])} ${be.svgRound(t[5])}`),t.length===6){e.push("Z");continue}if(t.length===12&&isNaN(t[6])){e.push(`L${be.svgRound(t[10])} ${be.svgRound(t[11])}`);continue}for(let i=6,r=t.length;i<r;i+=6){const[a,o,c,d,f,p]=t.subarray(i,i+6).map(be.svgRound);e.push(`C${a} ${o} ${c} ${d} ${f} ${p}`)}}return e.join("")}serialize([e,t,i,r],a){const o=[],c=[],[d,f,p,g]=this.#u();let w,x,k,v,A,C,T,R,E;switch(this.#o){case 0:E=be._rescale,w=e,x=t+r,k=i,v=-r,A=e+d*i,C=t+(1-f-g)*r,T=e+(d+p)*i,R=t+(1-f)*r;break;case 90:E=be._rescaleAndSwap,w=e,x=t,k=i,v=r,A=e+f*i,C=t+d*r,T=e+(f+g)*i,R=t+(d+p)*r;break;case 180:E=be._rescale,w=e+i,x=t,k=-i,v=r,A=e+(1-d-p)*i,C=t+f*r,T=e+(1-d)*i,R=t+(f+g)*r;break;case 270:E=be._rescaleAndSwap,w=e+i,x=t+r,k=-i,v=-r,A=e+(1-f-g)*i,C=t+(1-d-p)*r,T=e+(1-f)*i,R=t+(1-d)*r;break}for(const{line:_,points:M}of this.#n)o.push(E(_,w,x,k,v,a?new Array(_.length):null)),c.push(E(M,w,x,k,v,a?new Array(M.length):null));return{lines:o,points:c,rect:[A,C,T,R]}}static deserialize(e,t,i,r,a,{paths:{lines:o,points:c},rotation:d,thickness:f}){const p=[];let g,w,x,k,v;switch(d){case 0:v=be._rescale,g=-e/i,w=t/r+1,x=1/i,k=-1/r;break;case 90:v=be._rescaleAndSwap,g=-t/r,w=-e/i,x=1/r,k=1/i;break;case 180:v=be._rescale,g=e/i+1,w=-t/r,x=-1/i,k=1/r;break;case 270:v=be._rescaleAndSwap,g=t/r+1,w=e/i+1,x=-1/r,k=-1/i;break}if(!o){o=[];for(const C of c){const T=C.length;if(T===2){o.push(new Float32Array([NaN,NaN,NaN,NaN,C[0],C[1]]));continue}if(T===4){o.push(new Float32Array([NaN,NaN,NaN,NaN,C[0],C[1],NaN,NaN,NaN,NaN,C[2],C[3]]));continue}const R=new Float32Array(3*(T-2));o.push(R);let[E,_,M,N]=C.subarray(0,4);R.set([NaN,NaN,NaN,NaN,E,_],0);for(let I=4;I<T;I+=2){const G=C[I],F=C[I+1];R.set(be.createBezierPoints(E,_,M,N,G,F),(I-2)*3),[E,_,M,N]=[M,N,G,F]}}}for(let C=0,T=o.length;C<T;C++)p.push({line:v(o[C].map(R=>R??NaN),g,w,x,k),points:v(c[C].map(R=>R??NaN),g,w,x,k)});const A=new this.prototype.constructor;return A.build(p,i,r,1,d,f,a),A}#l(e=this.#c){const t=this.#i+e/2*this.#r;return this.#o%180===0?[t/this.#a,t/this.#s]:[t/this.#s,t/this.#a]}#u(){const[e,t,i,r]=this.#e,[a,o]=this.#l(0);return[e+a,t+o,i-2*a,r-2*o]}#h(){const e=this.#e=new Float32Array([1/0,1/0,-1/0,-1/0]);for(const{line:r}of this.#n){if(r.length<=12){for(let c=4,d=r.length;c<d;c+=6)ve.pointBoundingBox(r[c],r[c+1],e);continue}let a=r[4],o=r[5];for(let c=6,d=r.length;c<d;c+=6){const[f,p,g,w,x,k]=r.subarray(c,c+6);ve.bezierBoundingBox(a,o,f,p,g,w,x,k,e),a=x,o=k}}const[t,i]=this.#l();e[0]=Wt(e[0]-t,0,1),e[1]=Wt(e[1]-i,0,1),e[2]=Wt(e[2]+t,0,1),e[3]=Wt(e[3]+i,0,1),e[2]-=e[0],e[3]-=e[1]}get box(){return this.#e}updateProperty(e,t){return e==="stroke-width"?this.#f(t):null}#f(e){const[t,i]=this.#l();this.#c=e;const[r,a]=this.#l(),[o,c]=[r-t,a-i],d=this.#e;return d[0]-=o,d[1]-=c,d[2]+=2*o,d[3]+=2*c,d}updateParentDimensions([e,t],i){const[r,a]=this.#l();this.#a=e,this.#s=t,this.#r=i;const[o,c]=this.#l(),d=o-r,f=c-a,p=this.#e;return p[0]-=d,p[1]-=f,p[2]+=2*d,p[3]+=2*f,p}updateRotation(e){return this.#t=e,{path:{transform:this.rotationTransform}}}get viewBox(){return this.#e.map(be.svgRound).join(" ")}get defaultProperties(){const[e,t]=this.#e;return{root:{viewBox:this.viewBox},path:{"transform-origin":`${be.svgRound(e)} ${be.svgRound(t)}`}}}get rotationTransform(){const[,,e,t]=this.#e;let i=0,r=0,a=0,o=0,c=0,d=0;switch(this.#t){case 90:r=t/e,a=-e/t,c=e;break;case 180:i=-1,o=-1,c=e,d=t;break;case 270:r=-t/e,a=e/t,d=t;break;default:return""}return`matrix(${i} ${r} ${a} ${o} ${be.svgRound(c)} ${be.svgRound(d)})`}getPathResizingSVGProperties([e,t,i,r]){const[a,o]=this.#l(),[c,d,f,p]=this.#e;if(Math.abs(f-a)<=be.PRECISION||Math.abs(p-o)<=be.PRECISION){const v=e+i/2-(c+f/2),A=t+r/2-(d+p/2);return{path:{"transform-origin":`${be.svgRound(e)} ${be.svgRound(t)}`,transform:`${this.rotationTransform} translate(${v} ${A})`}}}const g=(i-2*a)/(f-2*a),w=(r-2*o)/(p-2*o),x=f/i,k=p/r;return{path:{"transform-origin":`${be.svgRound(c)} ${be.svgRound(d)}`,transform:`${this.rotationTransform} scale(${x} ${k}) translate(${be.svgRound(a)} ${be.svgRound(o)}) scale(${g} ${w}) translate(${be.svgRound(-a)} ${be.svgRound(-o)})`}}}getPathResizedSVGProperties([e,t,i,r]){const[a,o]=this.#l(),c=this.#e,[d,f,p,g]=c;if(c[0]=e,c[1]=t,c[2]=i,c[3]=r,Math.abs(p-a)<=be.PRECISION||Math.abs(g-o)<=be.PRECISION){const A=e+i/2-(d+p/2),C=t+r/2-(f+g/2);for(const{line:T,points:R}of this.#n)be._translate(T,A,C,T),be._translate(R,A,C,R);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${be.svgRound(e)} ${be.svgRound(t)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}const w=(i-2*a)/(p-2*a),x=(r-2*o)/(g-2*o),k=-w*(d+a)+e+a,v=-x*(f+o)+t+o;if(w!==1||x!==1||k!==0||v!==0)for(const{line:A,points:C}of this.#n)be._rescale(A,k,v,w,x,A),be._rescale(C,k,v,w,x,C);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${be.svgRound(e)} ${be.svgRound(t)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}getPathTranslatedSVGProperties([e,t],i){const[r,a]=i,o=this.#e,c=e-o[0],d=t-o[1];if(this.#a===r&&this.#s===a)for(const{line:f,points:p}of this.#n)be._translate(f,c,d,f),be._translate(p,c,d,p);else{const f=this.#a/r,p=this.#s/a;this.#a=r,this.#s=a;for(const{line:g,points:w}of this.#n)be._rescale(g,c,d,f,p,g),be._rescale(w,c,d,f,p,w);o[2]*=f,o[3]*=p}return o[0]=e,o[1]=t,{root:{viewBox:this.viewBox},path:{d:this.toSVGPath(),"transform-origin":`${be.svgRound(e)} ${be.svgRound(t)}`}}}get defaultSVGProperties(){const e=this.#e;return{root:{viewBox:this.viewBox},rootClass:{draw:!0},path:{d:this.toSVGPath(),"transform-origin":`${be.svgRound(e[0])} ${be.svgRound(e[1])}`,transform:this.rotationTransform||null},bbox:e}}}class Vo extends $p{constructor(e){super(),this._viewParameters=e,super.updateProperties({fill:"none",stroke:Te._defaultLineColor,"stroke-opacity":1,"stroke-width":1,"stroke-linecap":"round","stroke-linejoin":"round","stroke-miterlimit":10})}updateSVGProperty(e,t){e==="stroke-width"&&(t??=this["stroke-width"],t*=this._viewParameters.realScale),super.updateSVGProperty(e,t)}clone(){const e=new Vo(this._viewParameters);return e.updateAll(this),e}}class Dd extends Ne{static _type="ink";static _editorType=Me.INK;static _defaultDrawingOptions=null;constructor(e){super({...e,name:"inkEditor"}),this._willKeepAspectRatio=!0,this.defaultL10nId="pdfjs-editor-ink-editor"}static initialize(e,t){Te.initialize(e,t),this._defaultDrawingOptions=new Vo(t.viewParameters)}static getDefaultDrawingOptions(e){const t=this._defaultDrawingOptions.clone();return t.updateProperties(e),t}static get supportMultipleDrawings(){return!0}static get typesMap(){return Le(this,"typesMap",new Map([[Oe.INK_THICKNESS,"stroke-width"],[Oe.INK_COLOR,"stroke"],[Oe.INK_OPACITY,"stroke-opacity"]]))}static createDrawerInstance(e,t,i,r,a){return new tw(e,t,i,r,a,this._defaultDrawingOptions["stroke-width"])}static deserializeDraw(e,t,i,r,a,o){return ca.deserialize(e,t,i,r,a,o)}static async deserialize(e,t,i){let r=null;if(e instanceof Md){const{data:{inkLists:o,rect:c,rotation:d,id:f,color:p,opacity:g,borderStyle:{rawWidth:w},popupRef:x,richText:k,contentsObj:v,creationDate:A,modificationDate:C},parent:{page:{pageNumber:T}}}=e;r=e={annotationType:Me.INK,color:Array.from(p),thickness:w,opacity:g,paths:{points:o},boxes:null,pageIndex:T-1,rect:c.slice(0),rotation:d,annotationElementId:f,id:f,deleted:!1,popupRef:x,richText:k,comment:v?.str||null,creationDate:A,modificationDate:C}}const a=await super.deserialize(e,t,i);return a._initialData=r,e.comment&&a.setCommentData(e),a}get toolbarButtons(){return this._colorPicker||=new ea(this),[["colorPicker",this._colorPicker]]}get colorType(){return Oe.INK_COLOR}get color(){return this._drawingOptions.stroke}get opacity(){return this._drawingOptions["stroke-opacity"]}onScaleChanging(){if(!this.parent)return;super.onScaleChanging();const{_drawId:e,_drawingOptions:t,parent:i}=this;t.updateSVGProperty("stroke-width"),i.drawLayer.updateProperties(e,t.toSVGProperties())}static onScaleChangingWhenDrawing(){const e=this._currentParent;e&&(super.onScaleChangingWhenDrawing(),this._defaultDrawingOptions.updateSVGProperty("stroke-width"),e.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}createDrawingOptions({color:e,thickness:t,opacity:i}){this._drawingOptions=Dd.getDefaultDrawingOptions({stroke:ve.makeHexColor(...e),"stroke-width":t,"stroke-opacity":i})}serialize(e=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const{lines:t,points:i}=this.serializeDraw(e),{_drawingOptions:{stroke:r,"stroke-opacity":a,"stroke-width":o}}=this,c=Object.assign(super.serialize(e),{color:Te._colorManager.convert(r),opacity:a,thickness:o,paths:{lines:t,points:i}});return this.addComment(c),e?(c.isCopy=!0,c):this.annotationElementId&&!this.#e(c)?null:(c.id=this.annotationElementId,c)}#e(e){const{color:t,thickness:i,opacity:r,pageIndex:a}=this._initialData;return this.hasEditedComment||this._hasBeenMoved||this._hasBeenResized||e.color.some((o,c)=>o!==t[c])||e.thickness!==i||e.opacity!==r||e.pageIndex!==a}renderAnnotationElement(e){if(this.deleted)return e.hide(),null;const{points:t,rect:i}=this.serializeDraw(!1);return e.updateEdited({rect:i,thickness:this._drawingOptions["stroke-width"],points:t,popup:this.comment}),null}}class cd extends ca{toSVGPath(){let e=super.toSVGPath();return e.endsWith("Z")||(e+="Z"),e}}const Do=8,zr=3;class ss{static#e={maxDim:512,sigmaSFactor:.02,sigmaR:25,kernelSize:16};static#t(e,t,i,r){return i-=e,r-=t,i===0?r>0?0:4:i===1?r+6:2-r}static#i=new Int32Array([0,1,-1,1,-1,0,-1,-1,0,-1,1,-1,1,0,1,1]);static#n(e,t,i,r,a,o,c){const d=this.#t(i,r,a,o);for(let f=0;f<8;f++){const p=(-f+d-c+16)%8,g=this.#i[2*p],w=this.#i[2*p+1];if(e[(i+g)*t+(r+w)]!==0)return p}return-1}static#a(e,t,i,r,a,o,c){const d=this.#t(i,r,a,o);for(let f=0;f<8;f++){const p=(f+d+c+16)%8,g=this.#i[2*p],w=this.#i[2*p+1];if(e[(i+g)*t+(r+w)]!==0)return p}return-1}static#s(e,t,i,r){const a=e.length,o=new Int32Array(a);for(let p=0;p<a;p++)o[p]=e[p]<=r?1:0;for(let p=1;p<i-1;p++)o[p*t]=o[p*t+t-1]=0;for(let p=0;p<t;p++)o[p]=o[t*i-1-p]=0;let c=1,d;const f=[];for(let p=1;p<i-1;p++){d=1;for(let g=1;g<t-1;g++){const w=p*t+g,x=o[w];if(x===0)continue;let k=p,v=g;if(x===1&&o[w-1]===0)c+=1,v-=1;else if(x>=1&&o[w+1]===0)c+=1,v+=1,x>1&&(d=x);else{x!==1&&(d=Math.abs(x));continue}const A=[g,p],C=v===g+1,T={isHole:C,points:A,id:c,parent:0};f.push(T);let R;for(const B of f)if(B.id===d){R=B;break}R?R.isHole?T.parent=C?R.parent:d:T.parent=C?d:R.parent:T.parent=C?d:0;const E=this.#n(o,t,p,g,k,v,0);if(E===-1){o[w]=-c,o[w]!==1&&(d=Math.abs(o[w]));continue}let _=this.#i[2*E],M=this.#i[2*E+1];const N=p+_,I=g+M;k=N,v=I;let G=p,F=g;for(;;){const B=this.#a(o,t,G,F,k,v,1);_=this.#i[2*B],M=this.#i[2*B+1];const X=G+_,oe=F+M;A.push(oe,X);const le=G*t+F;if(o[le+1]===0?o[le]=-c:o[le]===1&&(o[le]=c),X===p&&oe===g&&G===N&&F===I){o[w]!==1&&(d=Math.abs(o[w]));break}else k=G,v=F,G=X,F=oe}}}return f}static#r(e,t,i,r){if(i-t<=4){for(let N=t;N<i-2;N+=2)r.push(e[N],e[N+1]);return}const a=e[t],o=e[t+1],c=e[i-4]-a,d=e[i-3]-o,f=Math.hypot(c,d),p=c/f,g=d/f,w=p*o-g*a,x=d/c,k=1/f,v=Math.atan(x),A=Math.cos(v),C=Math.sin(v),T=k*(Math.abs(A)+Math.abs(C)),R=k*(1-T+T**2),E=Math.max(Math.atan(Math.abs(C+A)*R),Math.atan(Math.abs(C-A)*R));let _=0,M=t;for(let N=t+2;N<i-2;N+=2){const I=Math.abs(w-p*e[N+1]+g*e[N]);I>_&&(M=N,_=I)}_>(f*E)**2?(this.#r(e,t,M+2,r),this.#r(e,M,i,r)):r.push(a,o)}static#o(e){const t=[],i=e.length;return this.#r(e,0,i,t),t.push(e[i-2],e[i-1]),t.length<=4?null:t}static#c(e,t,i,r,a,o){const c=new Float32Array(o**2),d=-2*r**2,f=o>>1;for(let v=0;v<o;v++){const A=(v-f)**2;for(let C=0;C<o;C++)c[v*o+C]=Math.exp((A+(C-f)**2)/d)}const p=new Float32Array(256),g=-2*a**2;for(let v=0;v<256;v++)p[v]=Math.exp(v**2/g);const w=e.length,x=new Uint8Array(w),k=new Uint32Array(256);for(let v=0;v<i;v++)for(let A=0;A<t;A++){const C=v*t+A,T=e[C];let R=0,E=0;for(let M=0;M<o;M++){const N=v+M-f;if(!(N<0||N>=i))for(let I=0;I<o;I++){const G=A+I-f;if(G<0||G>=t)continue;const F=e[N*t+G],B=c[M*o+I]*p[Math.abs(F-T)];R+=F*B,E+=B}}const _=x[C]=Math.round(R/E);k[_]++}return[x,k]}static#l(e){const t=new Uint32Array(256);for(const i of e)t[i]++;return t}static#u(e){const t=e.length,i=new Uint8ClampedArray(t>>2);let r=-1/0,a=1/0;for(let c=0,d=i.length;c<d;c++){const f=i[c]=e[c<<2];r=Math.max(r,f),a=Math.min(a,f)}const o=255/(r-a);for(let c=0,d=i.length;c<d;c++)i[c]=(i[c]-a)*o;return i}static#h(e){let t,i=-1/0,r=-1/0;const a=e.findIndex(d=>d!==0);let o=a,c=a;for(t=a;t<256;t++){const d=e[t];d>i&&(t-o>r&&(r=t-o,c=t-1),i=d,o=t)}for(t=c-1;t>=0&&!(e[t]>e[t+1]);t--);return t}static#f(e){const t=e,{width:i,height:r}=e,{maxDim:a}=this.#e;let o=i,c=r;if(i>a||r>a){let w=i,x=r,k=Math.log2(Math.max(i,r)/a);const v=Math.floor(k);k=k===v?v-1:v;for(let C=0;C<k;C++){o=Math.ceil(w/2),c=Math.ceil(x/2);const T=new OffscreenCanvas(o,c);T.getContext("2d").drawImage(e,0,0,w,x,0,0,o,c),w=o,x=c,e!==t&&e.close(),e=T.transferToImageBitmap()}const A=Math.min(a/o,a/c);o=Math.round(o*A),c=Math.round(c*A)}const f=new OffscreenCanvas(o,c).getContext("2d",{willReadFrequently:!0});f.fillStyle="white",f.fillRect(0,0,o,c),f.filter="grayscale(1)",f.drawImage(e,0,0,e.width,e.height,0,0,o,c);const p=f.getImageData(0,0,o,c).data;return[this.#u(p),o,c]}static extractContoursFromText(e,{fontFamily:t,fontStyle:i,fontWeight:r},a,o,c,d){let f=new OffscreenCanvas(1,1),p=f.getContext("2d",{alpha:!1});const g=200,w=p.font=`${i} ${r} ${g}px ${t}`,{actualBoundingBoxLeft:x,actualBoundingBoxRight:k,actualBoundingBoxAscent:v,actualBoundingBoxDescent:A,fontBoundingBoxAscent:C,fontBoundingBoxDescent:T,width:R}=p.measureText(e),E=1.5,_=Math.ceil(Math.max(Math.abs(x)+Math.abs(k)||0,R)*E),M=Math.ceil(Math.max(Math.abs(v)+Math.abs(A)||g,Math.abs(C)+Math.abs(T)||g)*E);f=new OffscreenCanvas(_,M),p=f.getContext("2d",{alpha:!0,willReadFrequently:!0}),p.font=w,p.filter="grayscale(1)",p.fillStyle="white",p.fillRect(0,0,_,M),p.fillStyle="black",p.fillText(e,_*(E-1)/2,M*(3-E)/2);const N=this.#u(p.getImageData(0,0,_,M).data),I=this.#l(N),G=this.#h(I),F=this.#s(N,_,M,G);return this.processDrawnLines({lines:{curves:F,width:_,height:M},pageWidth:a,pageHeight:o,rotation:c,innerMargin:d,mustSmooth:!0,areContours:!0})}static process(e,t,i,r,a){const[o,c,d]=this.#f(e),[f,p]=this.#c(o,c,d,Math.hypot(c,d)*this.#e.sigmaSFactor,this.#e.sigmaR,this.#e.kernelSize),g=this.#h(p),w=this.#s(f,c,d,g);return this.processDrawnLines({lines:{curves:w,width:c,height:d},pageWidth:t,pageHeight:i,rotation:r,innerMargin:a,mustSmooth:!0,areContours:!0})}static processDrawnLines({lines:e,pageWidth:t,pageHeight:i,rotation:r,innerMargin:a,mustSmooth:o,areContours:c}){r%180!==0&&([t,i]=[i,t]);const{curves:d,width:f,height:p}=e,g=e.thickness??0,w=[],x=Math.min(t/f,i/p),k=x/t,v=x/i,A=[];for(const{points:T}of d){const R=o?this.#o(T):T;if(!R)continue;A.push(R);const E=R.length,_=new Float32Array(E),M=new Float32Array(3*(E===2?2:E-2));if(w.push({line:M,points:_}),E===2){_[0]=R[0]*k,_[1]=R[1]*v,M.set([NaN,NaN,NaN,NaN,_[0],_[1]],0);continue}let[N,I,G,F]=R;N*=k,I*=v,G*=k,F*=v,_.set([N,I,G,F],0),M.set([NaN,NaN,NaN,NaN,N,I],0);for(let B=4;B<E;B+=2){const X=_[B]=R[B]*k,oe=_[B+1]=R[B+1]*v;M.set(be.createBezierPoints(N,I,G,F,X,oe),(B-2)*3),[N,I,G,F]=[G,F,X,oe]}}if(w.length===0)return null;const C=c?new cd:new ca;return C.build(w,t,i,1,r,c?0:g,a),{outline:C,newCurves:A,areContours:c,thickness:g,width:f,height:p}}static async compressSignature({outlines:e,areContours:t,thickness:i,width:r,height:a}){let o=1/0,c=-1/0,d=0;for(const R of e){d+=R.length;for(let E=2,_=R.length;E<_;E++){const M=R[E]-R[E-2];o=Math.min(o,M),c=Math.max(c,M)}}let f;o>=-128&&c<=127?f=Int8Array:o>=-32768&&c<=32767?f=Int16Array:f=Int32Array;const p=e.length,g=Do+zr*p,w=new Uint32Array(g);let x=0;w[x++]=g*Uint32Array.BYTES_PER_ELEMENT+(d-2*p)*f.BYTES_PER_ELEMENT,w[x++]=0,w[x++]=r,w[x++]=a,w[x++]=t?0:1,w[x++]=Math.max(0,Math.floor(i??0)),w[x++]=p,w[x++]=f.BYTES_PER_ELEMENT;for(const R of e)w[x++]=R.length-2,w[x++]=R[0],w[x++]=R[1];const k=new CompressionStream("deflate-raw"),v=k.writable.getWriter();await v.ready,v.write(w);const A=f.prototype.constructor;for(const R of e){const E=new A(R.length-2);for(let _=2,M=R.length;_<M;_++)E[_-2]=R[_]-R[_-2];v.write(E)}v.close();const C=await new Response(k.readable).arrayBuffer(),T=new Uint8Array(C);return fp(T)}static async decompressSignature(e){try{const t=T0(e),{readable:i,writable:r}=new DecompressionStream("deflate-raw"),a=r.getWriter();await a.ready,a.write(t).then(async()=>{await a.ready,await a.close()}).catch(()=>{});let o=null,c=0;for await(const R of i)o||=new Uint8Array(new Uint32Array(R.buffer,0,4)[0]),o.set(R,c),c+=R.length;const d=new Uint32Array(o.buffer,0,o.length>>2),f=d[1];if(f!==0)throw new Error(`Invalid version: ${f}`);const p=d[2],g=d[3],w=d[4]===0,x=d[5],k=d[6],v=d[7],A=[],C=(Do+zr*k)*Uint32Array.BYTES_PER_ELEMENT;let T;switch(v){case Int8Array.BYTES_PER_ELEMENT:T=new Int8Array(o.buffer,C);break;case Int16Array.BYTES_PER_ELEMENT:T=new Int16Array(o.buffer,C);break;case Int32Array.BYTES_PER_ELEMENT:T=new Int32Array(o.buffer,C);break}c=0;for(let R=0;R<k;R++){const E=d[zr*R+Do],_=new Float32Array(E+2);A.push(_);for(let M=0;M<zr-1;M++)_[M]=d[zr*R+Do+M+1];for(let M=0;M<E;M++)_[M+2]=_[M]+T[c++]}return{areContours:w,thickness:x,outlines:A,width:p,height:g}}catch(t){return Ie(`decompressSignature: ${t}`),null}}}class Ld extends $p{constructor(){super(),super.updateProperties({fill:Te._defaultLineColor,"stroke-width":0})}clone(){const e=new Ld;return e.updateAll(this),e}}class jd extends Vo{constructor(e){super(e),super.updateProperties({stroke:Te._defaultLineColor,"stroke-width":1})}clone(){const e=new jd(this._viewParameters);return e.updateAll(this),e}}class $n extends Ne{#e=!1;#t=null;#i=null;#n=null;static _type="signature";static _editorType=Me.SIGNATURE;static _defaultDrawingOptions=null;constructor(e){super({...e,mustBeCommitted:!0,name:"signatureEditor"}),this._willKeepAspectRatio=!0,this.#i=e.signatureData||null,this.#t=null,this.defaultL10nId="pdfjs-editor-signature-editor1"}static initialize(e,t){Te.initialize(e,t),this._defaultDrawingOptions=new Ld,this._defaultDrawnSignatureOptions=new jd(t.viewParameters)}static getDefaultDrawingOptions(e){const t=this._defaultDrawingOptions.clone();return t.updateProperties(e),t}static get supportMultipleDrawings(){return!1}static get typesMap(){return Le(this,"typesMap",new Map)}static get isDrawer(){return!1}get telemetryFinalData(){return{type:"signature",hasDescription:!!this.#t}}static computeTelemetryFinalData(e){const t=e.get("hasDescription");return{hasAltText:t.get(!0)??0,hasNoAltText:t.get(!1)??0}}get isResizable(){return!0}onScaleChanging(){this._drawId!==null&&super.onScaleChanging()}render(){if(this.div)return this.div;let e,t;const{_isCopy:i}=this;if(i&&(this._isCopy=!1,e=this.x,t=this.y),super.render(),this._drawId===null)if(this.#i){const{lines:r,mustSmooth:a,areContours:o,description:c,uuid:d,heightInPage:f}=this.#i,{rawDims:{pageWidth:p,pageHeight:g},rotation:w}=this.parent.viewport,x=ss.processDrawnLines({lines:r,pageWidth:p,pageHeight:g,rotation:w,innerMargin:$n._INNER_MARGIN,mustSmooth:a,areContours:o});this.addSignature(x,f,c,d)}else this.div.setAttribute("data-l10n-args",JSON.stringify({description:""})),this.div.hidden=!0,this._uiManager.getSignature(this);else this.div.setAttribute("data-l10n-args",JSON.stringify({description:this.#t||""}));return i&&(this._isCopy=!0,this._moveAfterPaste(e,t)),this.div}setUuid(e){this.#n=e,this.addEditToolbar()}getUuid(){return this.#n}get description(){return this.#t}set description(e){this.#t=e,this.div&&(this.div.setAttribute("data-l10n-args",JSON.stringify({description:e})),super.addEditToolbar().then(t=>{t?.updateEditSignatureButton(e)}))}getSignaturePreview(){const{newCurves:e,areContours:t,thickness:i,width:r,height:a}=this.#i,o=Math.max(r,a),c=ss.processDrawnLines({lines:{curves:e.map(d=>({points:d})),thickness:i,width:r,height:a},pageWidth:o,pageHeight:o,rotation:0,innerMargin:0,mustSmooth:!1,areContours:t});return{areContours:t,outline:c.outline}}get toolbarButtons(){return this._uiManager.signatureManager?[["editSignature",this._uiManager.signatureManager]]:super.toolbarButtons}addSignature(e,t,i,r){const{x:a,y:o}=this,{outline:c}=this.#i=e;this.#e=c instanceof cd,this.description=i;let d;this.#e?d=$n.getDefaultDrawingOptions():(d=$n._defaultDrawnSignatureOptions.clone(),d.updateProperties({"stroke-width":c.thickness})),this._addOutlines({drawOutlines:c,drawingOptions:d});const[,f]=this.pageDimensions;let p=t/f;p=p>=1?.5:p,this.width*=p/this.height,this.width>=1&&(p*=.9/this.width,this.width=.9),this.height=p,this.setDims(),this.x=a,this.y=o,this.center(),this._onResized(),this.onScaleChanging(),this.rotate(),this._uiManager.addToAnnotationStorage(this),this.setUuid(r),this._reportTelemetry({action:"pdfjs.signature.inserted",data:{hasBeenSaved:!!r,hasDescription:!!i}}),this.div.hidden=!1}getFromImage(e){const{rawDims:{pageWidth:t,pageHeight:i},rotation:r}=this.parent.viewport;return ss.process(e,t,i,r,$n._INNER_MARGIN)}getFromText(e,t){const{rawDims:{pageWidth:i,pageHeight:r},rotation:a}=this.parent.viewport;return ss.extractContoursFromText(e,t,i,r,a,$n._INNER_MARGIN)}getDrawnSignature(e){const{rawDims:{pageWidth:t,pageHeight:i},rotation:r}=this.parent.viewport;return ss.processDrawnLines({lines:e,pageWidth:t,pageHeight:i,rotation:r,innerMargin:$n._INNER_MARGIN,mustSmooth:!1,areContours:!1})}createDrawingOptions({areContours:e,thickness:t}){e?this._drawingOptions=$n.getDefaultDrawingOptions():(this._drawingOptions=$n._defaultDrawnSignatureOptions.clone(),this._drawingOptions.updateProperties({"stroke-width":t}))}serialize(e=!1){if(this.isEmpty())return null;const{lines:t,points:i}=this.serializeDraw(e),{_drawingOptions:{"stroke-width":r}}=this,a=Object.assign(super.serialize(e),{isSignature:!0,areContours:this.#e,color:[0,0,0],thickness:this.#e?0:r});return this.addComment(a),e?(a.paths={lines:t,points:i},a.uuid=this.#n,a.isCopy=!0):a.lines=t,this.#t&&(a.accessibilityData={type:"Figure",alt:this.#t}),a}static deserializeDraw(e,t,i,r,a,o){return o.areContours?cd.deserialize(e,t,i,r,a,o):ca.deserialize(e,t,i,r,a,o)}static async deserialize(e,t,i){const r=await super.deserialize(e,t,i);return r.#e=e.areContours,r.description=e.accessibilityData?.alt||"",r.#n=e.uuid,r}}class nw extends Te{#e=null;#t=null;#i=null;#n=null;#a=null;#s="";#r=null;#o=!1;#c=null;#l=!1;#u=!1;static _type="stamp";static _editorType=Me.STAMP;constructor(e){super({...e,name:"stampEditor"}),this.#n=e.bitmapUrl,this.#a=e.bitmapFile,this.defaultL10nId="pdfjs-editor-stamp-editor"}static initialize(e,t){Te.initialize(e,t)}static isHandlingMimeForPasting(e){return qo.includes(e)}static paste(e,t){t.pasteEditor({mode:Me.STAMP},{bitmapFile:e.getAsFile()})}altTextFinish(){this._uiManager.useNewAltTextFlow&&(this.div.hidden=!1),super.altTextFinish()}get telemetryFinalData(){return{type:"stamp",hasAltText:!!this.altTextData?.altText}}static computeTelemetryFinalData(e){const t=e.get("hasAltText");return{hasAltText:t.get(!0)??0,hasNoAltText:t.get(!1)??0}}#h(e,t=!1){if(!e){this.remove();return}this.#e=e.bitmap,t||(this.#t=e.id,this.#l=e.isSvg),e.file&&(this.#s=e.file.name),this.#p()}#f(){if(this.#i=null,this._uiManager.enableWaiting(!1),!!this.#r){if(this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&this.#e){this.addEditToolbar().then(()=>{this._editToolbar.hide(),this._uiManager.editAltText(this,!0)});return}if(!this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&this.#e){this._reportTelemetry({action:"pdfjs.image.image_added",data:{alt_text_modal:!1,alt_text_type:"empty"}});try{this.mlGuessAltText()}catch{}}this.div.focus()}}async mlGuessAltText(e=null,t=!0){if(this.hasAltTextData())return null;const{mlManager:i}=this._uiManager;if(!i)throw new Error("No ML.");if(!await i.isEnabledFor("altText"))throw new Error("ML isn't enabled for alt text.");const{data:r,width:a,height:o}=e||this.copyCanvas(null,null,!0).imageData,c=await i.guess({name:"altText",request:{data:r,width:a,height:o,channels:r.length/(a*o)}});if(!c)throw new Error("No response from the AI service.");if(c.error)throw new Error("Error from the AI service.");if(c.cancel)return null;if(!c.output)throw new Error("No valid response from the AI service.");const d=c.output;return await this.setGuessedAltText(d),t&&!this.hasAltTextData()&&(this.altTextData={alt:d,decorative:!1}),d}#g(){if(this.#t){this._uiManager.enableWaiting(!0),this._uiManager.imageManager.getFromId(this.#t).then(i=>this.#h(i,!0)).finally(()=>this.#f());return}if(this.#n){const i=this.#n;this.#n=null,this._uiManager.enableWaiting(!0),this.#i=this._uiManager.imageManager.getFromUrl(i).then(r=>this.#h(r)).finally(()=>this.#f());return}if(this.#a){const i=this.#a;this.#a=null,this._uiManager.enableWaiting(!0),this.#i=this._uiManager.imageManager.getFromFile(i).then(r=>this.#h(r)).finally(()=>this.#f());return}const e=document.createElement("input");e.type="file",e.accept=qo.join(",");const t=this._uiManager._signal;this.#i=new Promise(i=>{e.addEventListener("change",async()=>{if(!e.files||e.files.length===0)this.remove();else{this._uiManager.enableWaiting(!0);const r=await this._uiManager.imageManager.getFromFile(e.files[0]);this._reportTelemetry({action:"pdfjs.image.image_selected",data:{alt_text_modal:this._uiManager.useNewAltTextFlow}}),this.#h(r)}i()},{signal:t}),e.addEventListener("cancel",()=>{this.remove(),i()},{signal:t})}).finally(()=>this.#f()),e.click()}remove(){this.#t&&(this.#e=null,this._uiManager.imageManager.deleteId(this.#t),this.#r?.remove(),this.#r=null,this.#c&&(clearTimeout(this.#c),this.#c=null)),super.remove()}rebuild(){if(!this.parent){this.#t&&this.#g();return}super.rebuild(),this.div!==null&&(this.#t&&this.#r===null&&this.#g(),this.isAttachedToDOM||this.parent.add(this))}onceAdded(e){this._isDraggable=!0,e&&this.div.focus()}isEmpty(){return!(this.#i||this.#e||this.#n||this.#a||this.#t||this.#o)}get toolbarButtons(){return[["altText",this.createAltText()]]}get isResizable(){return!0}render(){if(this.div)return this.div;let e,t;return this._isCopy&&(e=this.x,t=this.y),super.render(),this.div.hidden=!0,this.createAltText(),this.#o||(this.#e?this.#p():this.#g()),this._isCopy&&this._moveAfterPaste(e,t),this._uiManager.addShouldRescale(this),this.div}setCanvas(e,t){const{id:i,bitmap:r}=this._uiManager.imageManager.getFromCanvas(e,t);t.remove(),i&&this._uiManager.imageManager.isValidId(i)&&(this.#t=i,r&&(this.#e=r),this.#o=!1,this.#p())}_onResized(){this.onScaleChanging()}onScaleChanging(){if(!this.parent)return;this.#c!==null&&clearTimeout(this.#c);const e=200;this.#c=setTimeout(()=>{this.#c=null,this.#m()},e)}#p(){const{div:e}=this;let{width:t,height:i}=this.#e;const[r,a]=this.pageDimensions,o=.75;if(this.width)t=this.width*r,i=this.height*a;else if(t>o*r||i>o*a){const d=Math.min(o*r/t,o*a/i);t*=d,i*=d}this._uiManager.enableWaiting(!1);const c=this.#r=document.createElement("canvas");c.setAttribute("role","img"),this.addContainer(c),this.width=t/r,this.height=i/a,this.setDims(),this._initialOptions?.isCentered?this.center():this.fixAndSetPosition(),this._initialOptions=null,(!this._uiManager.useNewAltTextWhenAddingImage||!this._uiManager.useNewAltTextFlow||this.annotationElementId)&&(e.hidden=!1),this.#m(),this.#u||(this.parent.addUndoableEditor(this),this.#u=!0),this._reportTelemetry({action:"inserted_image"}),this.#s&&this.div.setAttribute("aria-description",this.#s),this.annotationElementId||this._uiManager.a11yAlert("pdfjs-editor-stamp-added-alert")}copyCanvas(e,t,i=!1){e||(e=224);const{width:r,height:a}=this.#e,o=new Ln;let c=this.#e,d=r,f=a,p=null;if(t){if(r>t||a>t){const M=Math.min(t/r,t/a);d=Math.floor(r*M),f=Math.floor(a*M)}p=document.createElement("canvas");const w=p.width=Math.ceil(d*o.sx),x=p.height=Math.ceil(f*o.sy);this.#l||(c=this.#d(w,x));const k=p.getContext("2d");k.filter=this._uiManager.hcmFilter;let v="white",A="#cfcfd8";this._uiManager.hcmFilter!=="none"?A="black":_0.isDarkMode&&(v="#8f8f9d",A="#42414d");const C=15,T=C*o.sx,R=C*o.sy,E=new OffscreenCanvas(T*2,R*2),_=E.getContext("2d");_.fillStyle=v,_.fillRect(0,0,T*2,R*2),_.fillStyle=A,_.fillRect(0,0,T,R),_.fillRect(T,R,T,R),k.fillStyle=k.createPattern(E,"repeat"),k.fillRect(0,0,w,x),k.drawImage(c,0,0,c.width,c.height,0,0,w,x)}let g=null;if(i){let w,x;if(o.symmetric&&c.width<e&&c.height<e)w=c.width,x=c.height;else if(c=this.#e,r>e||a>e){const A=Math.min(e/r,e/a);w=Math.floor(r*A),x=Math.floor(a*A),this.#l||(c=this.#d(w,x))}const v=new OffscreenCanvas(w,x).getContext("2d",{willReadFrequently:!0});v.drawImage(c,0,0,c.width,c.height,0,0,w,x),g={width:w,height:x,data:v.getImageData(0,0,w,x).data}}return{canvas:p,width:d,height:f,imageData:g}}#d(e,t){const{width:i,height:r}=this.#e;let a=i,o=r,c=this.#e;for(;a>2*e||o>2*t;){const d=a,f=o;a>2*e&&(a=a>=16384?Math.floor(a/2)-1:Math.ceil(a/2)),o>2*t&&(o=o>=16384?Math.floor(o/2)-1:Math.ceil(o/2));const p=new OffscreenCanvas(a,o);p.getContext("2d").drawImage(c,0,0,d,f,0,0,a,o),c=p.transferToImageBitmap()}return c}#m(){const[e,t]=this.parentDimensions,{width:i,height:r}=this,a=new Ln,o=Math.ceil(i*e*a.sx),c=Math.ceil(r*t*a.sy),d=this.#r;if(!d||d.width===o&&d.height===c)return;d.width=o,d.height=c;const f=this.#l?this.#e:this.#d(o,c),p=d.getContext("2d");p.filter=this._uiManager.hcmFilter,p.drawImage(f,0,0,f.width,f.height,0,0,o,c)}#y(e){if(e){if(this.#l){const r=this._uiManager.imageManager.getSvgUrl(this.#t);if(r)return r}const t=document.createElement("canvas");return{width:t.width,height:t.height}=this.#e,t.getContext("2d").drawImage(this.#e,0,0),t.toDataURL()}if(this.#l){const[t,i]=this.pageDimensions,r=Math.round(this.width*t*ds.PDF_TO_CSS_UNITS),a=Math.round(this.height*i*ds.PDF_TO_CSS_UNITS),o=new OffscreenCanvas(r,a);return o.getContext("2d").drawImage(this.#e,0,0,this.#e.width,this.#e.height,0,0,r,a),o.transferToImageBitmap()}return structuredClone(this.#e)}static async deserialize(e,t,i){let r=null,a=!1;if(e instanceof Gp){const{data:{rect:v,rotation:A,id:C,structParent:T,popupRef:R,richText:E,contentsObj:_,creationDate:M,modificationDate:N},container:I,parent:{page:{pageNumber:G}},canvas:F}=e;let B,X;F?(delete e.canvas,{id:B,bitmap:X}=i.imageManager.getFromCanvas(I.id,F),F.remove()):(a=!0,e._hasNoCanvas=!0);const oe=(await t._structTree.getAriaAttributes(`${wd}${C}`))?.get("aria-label")||"";r=e={annotationType:Me.STAMP,bitmapId:B,bitmap:X,pageIndex:G-1,rect:v.slice(0),rotation:A,annotationElementId:C,id:C,deleted:!1,accessibilityData:{decorative:!1,altText:oe},isSvg:!1,structParent:T,popupRef:R,richText:E,comment:_?.str||null,creationDate:M,modificationDate:N}}const o=await super.deserialize(e,t,i),{rect:c,bitmap:d,bitmapUrl:f,bitmapId:p,isSvg:g,accessibilityData:w}=e;a?(i.addMissingCanvas(e.id,o),o.#o=!0):p&&i.imageManager.isValidId(p)?(o.#t=p,d&&(o.#e=d)):o.#n=f,o.#l=g;const[x,k]=o.pageDimensions;return o.width=(c[2]-c[0])/x,o.height=(c[3]-c[1])/k,w&&(o.altTextData=w),o._initialData=r,e.comment&&o.setCommentData(e),o.#u=!!r,o}serialize(e=!1,t=null){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const i=Object.assign(super.serialize(e),{bitmapId:this.#t,isSvg:this.#l});if(this.addComment(i),e)return i.bitmapUrl=this.#y(!0),i.accessibilityData=this.serializeAltText(!0),i.isCopy=!0,i;const{decorative:r,altText:a}=this.serializeAltText(!1);if(!r&&a&&(i.accessibilityData={type:"Figure",alt:a}),this.annotationElementId){const c=this.#b(i);return c.isSame?null:(c.isSameAltText?delete i.accessibilityData:i.accessibilityData.structParent=this._initialData.structParent??-1,i.id=this.annotationElementId,delete i.bitmapId,i)}if(t===null)return i;t.stamps||=new Map;const o=this.#l?(i.rect[2]-i.rect[0])*(i.rect[3]-i.rect[1]):null;if(!t.stamps.has(this.#t))t.stamps.set(this.#t,{area:o,serialized:i}),i.bitmap=this.#y(!1);else if(this.#l){const c=t.stamps.get(this.#t);o>c.area&&(c.area=o,c.serialized.bitmap.close(),c.serialized.bitmap=this.#y(!1))}return i}#b(e){const{pageIndex:t,accessibilityData:{altText:i}}=this._initialData,r=e.pageIndex===t,a=(e.accessibilityData?.alt||"")===i;return{isSame:!this.hasEditedComment&&!this._hasBeenMoved&&!this._hasBeenResized&&r&&a,isSameAltText:a}}renderAnnotationElement(e){return this.deleted?(e.hide(),null):(e.updateEdited({rect:this.getPDFRect(),popup:this.comment}),null)}}class Kn{#e;#t=!1;#i=null;#n=null;#a=null;#s=new Map;#r=!1;#o=!1;#c=!1;#l=null;#u=null;#h=null;#f=null;#g=null;#p=-1;#d;static _initialized=!1;static#m=new Map([_t,Dd,nw,bt,$n].map(e=>[e._editorType,e]));constructor({uiManager:e,pageIndex:t,div:i,structTreeLayer:r,accessibilityManager:a,annotationLayer:o,drawLayer:c,textLayer:d,viewport:f,l10n:p}){const g=[...Kn.#m.values()];if(!Kn._initialized){Kn._initialized=!0;for(const w of g)w.initialize(p,e)}e.registerEditorTypes(g),this.#d=e,this.pageIndex=t,this.div=i,this.#e=a,this.#i=o,this.viewport=f,this.#h=d,this.drawLayer=c,this._structTree=r,this.#d.addLayer(this)}get isEmpty(){return this.#s.size===0}get isInvisible(){return this.isEmpty&&this.#d.getMode()===Me.NONE}updateToolbar(e){this.#d.updateToolbar(e)}updateMode(e=this.#d.getMode()){switch(this.#v(),e){case Me.NONE:this.div.classList.toggle("nonEditing",!0),this.disableTextSelection(),this.togglePointerEvents(!1),this.toggleAnnotationLayerPointerEvents(!0),this.disableClick();return;case Me.INK:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick();break;case Me.HIGHLIGHT:this.enableTextSelection(),this.togglePointerEvents(!1),this.disableClick();break;default:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick()}this.toggleAnnotationLayerPointerEvents(!1);const{classList:t}=this.div;if(t.toggle("nonEditing",!1),e===Me.POPUP)t.toggle("commentEditing",!0);else{t.toggle("commentEditing",!1);for(const i of Kn.#m.values())t.toggle(`${i._type}Editing`,e===i._editorType)}this.div.hidden=!1}hasTextLayer(e){return e===this.#h?.div}setEditingState(e){this.#d.setEditingState(e)}addCommands(e){this.#d.addCommands(e)}cleanUndoStack(e){this.#d.cleanUndoStack(e)}toggleDrawing(e=!1){this.div.classList.toggle("drawing",!e)}togglePointerEvents(e=!1){this.div.classList.toggle("disabled",!e)}toggleAnnotationLayerPointerEvents(e=!1){this.#i?.div.classList.toggle("disabled",!e)}get#y(){return this.#s.size!==0?this.#s.values():this.#d.getEditors(this.pageIndex)}async enable(){this.#c=!0,this.div.tabIndex=0,this.togglePointerEvents(!0),this.div.classList.toggle("nonEditing",!1),this.#g?.abort(),this.#g=null;const e=new Set;for(const i of this.#y)i.enableEditing(),i.show(!0),i.annotationElementId&&(this.#d.removeChangedExistingAnnotation(i),e.add(i.annotationElementId));const t=this.#i;if(t)for(const i of t.getEditableAnnotations()){if(i.hide(),this.#d.isDeletedAnnotationElement(i.data.id)||e.has(i.data.id))continue;const r=await this.deserialize(i);r&&(this.addOrRebuild(r),r.enableEditing())}this.#c=!1,this.#d._eventBus.dispatch("editorsrendered",{source:this,pageNumber:this.pageIndex+1})}disable(){if(this.#o=!0,this.div.tabIndex=-1,this.togglePointerEvents(!1),this.div.classList.toggle("nonEditing",!0),this.#h&&!this.#g){this.#g=new AbortController;const i=this.#d.combinedSignal(this.#g);this.#h.div.addEventListener("pointerdown",r=>{const{clientX:o,clientY:c,timeStamp:d}=r,f=this.#p;if(d-f>500){this.#p=d;return}this.#p=-1;const{classList:p}=this.div;p.toggle("getElements",!0);const g=document.elementsFromPoint(o,c);if(p.toggle("getElements",!1),!this.div.contains(g[0]))return;let w;const x=new RegExp(`^${Xr}[0-9]+$`);for(const v of g)if(x.test(v.id)){w=v.id;break}if(!w)return;const k=this.#s.get(w);k?.annotationElementId===null&&(r.stopPropagation(),r.preventDefault(),k.dblclick(r))},{signal:i,capture:!0})}const e=this.#i;if(e){const i=new Map,r=new Map;for(const o of this.#y){if(o.disableEditing(),!o.annotationElementId){o.updateFakeAnnotationElement(e);continue}if(o.serialize()!==null){i.set(o.annotationElementId,o);continue}else r.set(o.annotationElementId,o);this.getEditableAnnotation(o.annotationElementId)?.show(),o.remove()}const a=e.getEditableAnnotations();for(const o of a){const{id:c}=o.data;if(this.#d.isDeletedAnnotationElement(c)){o.updateEdited({deleted:!0});continue}let d=r.get(c);if(d){d.resetAnnotationElement(o),d.show(!1),o.show();continue}d=i.get(c),d&&(this.#d.addChangedExistingAnnotation(d),d.renderAnnotationElement(o)&&d.show(!1)),o.show()}}this.#v(),this.isEmpty&&(this.div.hidden=!0);const{classList:t}=this.div;for(const i of Kn.#m.values())t.remove(`${i._type}Editing`);this.disableTextSelection(),this.toggleAnnotationLayerPointerEvents(!0),this.#o=!1}getEditableAnnotation(e){return this.#i?.getEditableAnnotation(e)||null}setActiveEditor(e){this.#d.getActive()!==e&&this.#d.setActiveEditor(e)}enableTextSelection(){if(this.div.tabIndex=-1,this.#h?.div&&!this.#f){this.#f=new AbortController;const e=this.#d.combinedSignal(this.#f);this.#h.div.addEventListener("pointerdown",this.#b.bind(this),{signal:e}),this.#h.div.classList.add("highlighting")}}disableTextSelection(){this.div.tabIndex=0,this.#h?.div&&this.#f&&(this.#f.abort(),this.#f=null,this.#h.div.classList.remove("highlighting"))}#b(e){this.#d.unselectAll();const{target:t}=e;if(t===this.#h.div||(t.getAttribute("role")==="img"||t.classList.contains("endOfContent"))&&this.#h.div.contains(t)){const{isMac:i}=Pt.platform;if(e.button!==0||e.ctrlKey&&i)return;this.#d.showAllEditors("highlight",!0,!0),this.#h.div.classList.add("free"),this.toggleDrawing(),bt.startHighlighting(this,this.#d.direction==="ltr",{target:this.#h.div,x:e.x,y:e.y}),this.#h.div.addEventListener("pointerup",()=>{this.#h.div.classList.remove("free"),this.toggleDrawing(!0)},{once:!0,signal:this.#d._signal}),e.preventDefault()}}enableClick(){if(this.#n)return;this.#n=new AbortController;const e=this.#d.combinedSignal(this.#n);this.div.addEventListener("pointerdown",this.pointerdown.bind(this),{signal:e});const t=this.pointerup.bind(this);this.div.addEventListener("pointerup",t,{signal:e}),this.div.addEventListener("pointercancel",t,{signal:e})}disableClick(){this.#n?.abort(),this.#n=null}attach(e){this.#s.set(e.id,e);const{annotationElementId:t}=e;t&&this.#d.isDeletedAnnotationElement(t)&&this.#d.removeDeletedAnnotationElement(e)}detach(e){this.#s.delete(e.id),this.#e?.removePointerInTextLayer(e.contentDiv),!this.#o&&e.annotationElementId&&this.#d.addDeletedAnnotationElement(e)}remove(e){this.detach(e),this.#d.removeEditor(e),e.div.remove(),e.isAttachedToDOM=!1}changeParent(e){e.parent!==this&&(e.parent&&e.annotationElementId&&(this.#d.addDeletedAnnotationElement(e.annotationElementId),Te.deleteAnnotationElement(e),e.annotationElementId=null),this.attach(e),e.parent?.detach(e),e.setParent(this),e.div&&e.isAttachedToDOM&&(e.div.remove(),this.div.append(e.div)))}add(e){if(!(e.parent===this&&e.isAttachedToDOM)){if(this.changeParent(e),this.#d.addEditor(e),this.attach(e),!e.isAttachedToDOM){const t=e.render();this.div.append(t),e.isAttachedToDOM=!0}e.fixAndSetPosition(),e.onceAdded(!this.#c),this.#d.addToAnnotationStorage(e),e._reportTelemetry(e.telemetryInitialData)}}moveEditorInDOM(e){if(!e.isAttachedToDOM)return;const{activeElement:t}=document;e.div.contains(t)&&!this.#a&&(e._focusEventsAllowed=!1,this.#a=setTimeout(()=>{this.#a=null,e.div.contains(document.activeElement)?e._focusEventsAllowed=!0:(e.div.addEventListener("focusin",()=>{e._focusEventsAllowed=!0},{once:!0,signal:this.#d._signal}),t.focus())},0)),e._structTreeParentId=this.#e?.moveElementInDOM(this.div,e.div,e.contentDiv,!0)}addOrRebuild(e){e.needsToBeRebuilt()?(e.parent||=this,e.rebuild(),e.show()):this.add(e)}addUndoableEditor(e){const t=()=>e._uiManager.rebuild(e),i=()=>{e.remove()};this.addCommands({cmd:t,undo:i,mustExec:!1})}getEditorByUID(e){for(const t of this.#s.values())if(t.uid===e)return t;return null}getNextId(){return this.#d.getId()}get#w(){return Kn.#m.get(this.#d.getMode())}combinedSignal(e){return this.#d.combinedSignal(e)}#C(e){const t=this.#w;return t?new t.prototype.constructor(e):null}canCreateNewEmptyEditor(){return this.#w?.canCreateNewEmptyEditor()}async pasteEditor(e,t){this.updateToolbar(e),await this.#d.updateMode(e.mode);const{offsetX:i,offsetY:r}=this.#S(),a=this.getNextId(),o=this.#C({parent:this,id:a,x:i,y:r,uiManager:this.#d,isCentered:!0,...t});o&&this.add(o)}async deserialize(e){return await Kn.#m.get(e.annotationType??e.annotationEditorType)?.deserialize(e,this,this.#d)||null}createAndAddNewEditor(e,t,i={}){const r=this.getNextId(),a=this.#C({parent:this,id:r,x:e.offsetX,y:e.offsetY,uiManager:this.#d,isCentered:t,...i});return a&&this.add(a),a}get boundingClientRect(){return this.div.getBoundingClientRect()}#S(){const{x:e,y:t,width:i,height:r}=this.boundingClientRect,a=Math.max(0,e),o=Math.max(0,t),c=Math.min(window.innerWidth,e+i),d=Math.min(window.innerHeight,t+r),f=(a+c)/2-e,p=(o+d)/2-t,[g,w]=this.viewport.rotation%180===0?[f,p]:[p,f];return{offsetX:g,offsetY:w}}addNewEditor(e={}){this.createAndAddNewEditor(this.#S(),!0,e)}setSelected(e){this.#d.setSelected(e)}toggleSelected(e){this.#d.toggleSelected(e)}unselect(e){this.#d.unselect(e)}pointerup(e){const{isMac:t}=Pt.platform;if(e.button!==0||e.ctrlKey&&t||e.target!==this.div||!this.#r||(this.#r=!1,this.#w?.isDrawer&&this.#w.supportMultipleDrawings))return;if(!this.#t){this.#t=!0;return}const i=this.#d.getMode();if(i===Me.STAMP||i===Me.SIGNATURE){this.#d.unselectAll();return}this.createAndAddNewEditor(e,!1)}pointerdown(e){if(this.#d.getMode()===Me.HIGHLIGHT&&this.enableTextSelection(),this.#r){this.#r=!1;return}const{isMac:t}=Pt.platform;if(e.button!==0||e.ctrlKey&&t||e.target!==this.div)return;if(this.#r=!0,this.#w?.isDrawer){this.startDrawingSession(e);return}const i=this.#d.getActive();this.#t=!i||i.isEmpty()}startDrawingSession(e){if(this.div.focus({preventScroll:!0}),this.#l){this.#w.startDrawing(this,this.#d,!1,e);return}this.#d.setCurrentDrawingSession(this),this.#l=new AbortController;const t=this.#d.combinedSignal(this.#l);this.div.addEventListener("blur",({relatedTarget:i})=>{i&&!this.div.contains(i)&&(this.#u=null,this.commitOrRemove())},{signal:t}),this.#w.startDrawing(this,this.#d,!1,e)}pause(e){if(e){const{activeElement:t}=document;this.div.contains(t)&&(this.#u=t);return}this.#u&&setTimeout(()=>{this.#u?.focus(),this.#u=null},0)}endDrawingSession(e=!1){return this.#l?(this.#d.setCurrentDrawingSession(null),this.#l.abort(),this.#l=null,this.#u=null,this.#w.endDrawing(e)):null}findNewParent(e,t,i){const r=this.#d.findParent(t,i);return r===null||r===this?!1:(r.changeParent(e),!0)}commitOrRemove(){return this.#l?(this.endDrawingSession(),!0):!1}onScaleChanging(){this.#l&&this.#w.onScaleChangingWhenDrawing(this)}destroy(){this.commitOrRemove(),this.#d.getActive()?.parent===this&&(this.#d.commitOrRemove(),this.#d.setActiveEditor(null)),this.#a&&(clearTimeout(this.#a),this.#a=null);for(const e of this.#s.values())this.#e?.removePointerInTextLayer(e.contentDiv),e.setParent(null),e.isAttachedToDOM=!1,e.div.remove();this.div=null,this.#s.clear(),this.#d.removeLayer(this)}#v(){for(const e of this.#s.values())e.isEmpty()&&e.remove()}render({viewport:e}){this.viewport=e,qi(this.div,e);for(const t of this.#d.getEditors(this.pageIndex))this.add(t),t.rebuild();this.updateMode()}update({viewport:e}){this.#d.commitOrRemove(),this.#v();const t=this.viewport.rotation,i=e.rotation;if(this.viewport=e,qi(this.div,{rotation:i}),t!==i)for(const r of this.#s.values())r.rotate(i)}get pageDimensions(){const{pageWidth:e,pageHeight:t}=this.viewport.rawDims;return[e,t]}get scale(){return this.#d.viewParameters.realScale}}class Nt{#e=null;#t=new Map;#i=new Map;static#n=0;constructor({pageIndex:e}){this.pageIndex=e}setParent(e){if(!this.#e){this.#e=e;return}if(this.#e!==e){if(this.#t.size>0)for(const t of this.#t.values())t.remove(),e.append(t);this.#e=e}}static get _svgFactory(){return Le(this,"_svgFactory",new ta)}static#a(e,[t,i,r,a]){const{style:o}=e;o.top=`${100*i}%`,o.left=`${100*t}%`,o.width=`${100*r}%`,o.height=`${100*a}%`}#s(){const e=Nt._svgFactory.create(1,1,!0);return this.#e.append(e),e.setAttribute("aria-hidden",!0),e}#r(e,t){const i=Nt._svgFactory.createElement("clipPath");e.append(i);const r=`clip_${t}`;i.setAttribute("id",r),i.setAttribute("clipPathUnits","objectBoundingBox");const a=Nt._svgFactory.createElement("use");return i.append(a),a.setAttribute("href",`#${t}`),a.classList.add("clip"),r}#o(e,t){for(const[i,r]of Object.entries(t))r===null?e.removeAttribute(i):e.setAttribute(i,r)}draw(e,t=!1,i=!1){const r=Nt.#n++,a=this.#s(),o=Nt._svgFactory.createElement("defs");a.append(o);const c=Nt._svgFactory.createElement("path");o.append(c);const d=`path_p${this.pageIndex}_${r}`;c.setAttribute("id",d),c.setAttribute("vector-effect","non-scaling-stroke"),t&&this.#i.set(r,c);const f=i?this.#r(o,d):null,p=Nt._svgFactory.createElement("use");return a.append(p),p.setAttribute("href",`#${d}`),this.updateProperties(a,e),this.#t.set(r,a),{id:r,clipPathId:`url(#${f})`}}drawOutline(e,t){const i=Nt.#n++,r=this.#s(),a=Nt._svgFactory.createElement("defs");r.append(a);const o=Nt._svgFactory.createElement("path");a.append(o);const c=`path_p${this.pageIndex}_${i}`;o.setAttribute("id",c),o.setAttribute("vector-effect","non-scaling-stroke");let d;if(t){const g=Nt._svgFactory.createElement("mask");a.append(g),d=`mask_p${this.pageIndex}_${i}`,g.setAttribute("id",d),g.setAttribute("maskUnits","objectBoundingBox");const w=Nt._svgFactory.createElement("rect");g.append(w),w.setAttribute("width","1"),w.setAttribute("height","1"),w.setAttribute("fill","white");const x=Nt._svgFactory.createElement("use");g.append(x),x.setAttribute("href",`#${c}`),x.setAttribute("stroke","none"),x.setAttribute("fill","black"),x.setAttribute("fill-rule","nonzero"),x.classList.add("mask")}const f=Nt._svgFactory.createElement("use");r.append(f),f.setAttribute("href",`#${c}`),d&&f.setAttribute("mask",`url(#${d})`);const p=f.cloneNode();return r.append(p),f.classList.add("mainOutline"),p.classList.add("secondaryOutline"),this.updateProperties(r,e),this.#t.set(i,r),i}finalizeDraw(e,t){this.#i.delete(e),this.updateProperties(e,t)}updateProperties(e,t){if(!t)return;const{root:i,bbox:r,rootClass:a,path:o}=t,c=typeof e=="number"?this.#t.get(e):e;if(c){if(i&&this.#o(c,i),r&&Nt.#a(c,r),a){const{classList:d}=c;for(const[f,p]of Object.entries(a))d.toggle(f,p)}if(o){const f=c.firstChild.firstChild;this.#o(f,o)}}}updateParent(e,t){if(t===this)return;const i=this.#t.get(e);i&&(t.#e.append(i),this.#t.delete(e),t.#t.set(e,i))}remove(e){this.#i.delete(e),this.#e!==null&&(this.#t.get(e).remove(),this.#t.delete(e))}destroy(){this.#e=null;for(const e of this.#t.values())e.remove();this.#t.clear(),this.#i.clear()}}globalThis._pdfjsTestingUtils={HighlightOutliner:od};globalThis.pdfjsLib={AbortException:ci,AnnotationEditorLayer:Kn,AnnotationEditorParamsType:Oe,AnnotationEditorType:Me,AnnotationEditorUIManager:di,AnnotationLayer:Id,AnnotationMode:Yn,AnnotationType:wt,applyOpacity:wp,build:Op,ColorPicker:pn,createValidAbsoluteUrl:md,CSSConstants:yp,DOMSVGFactory:ta,DrawLayer:Nt,FeatureTest:Pt,fetchData:er,findContrastColor:bp,getDocument:Ed,getFilenameFromUrl:pp,getPdfFilenameFromUrl:mp,getRGB:tr,getUuid:yd,getXfaPageViewport:gp,GlobalWorkerOptions:Oi,ImageKind:Kr,InvalidPDFException:Fo,isDataScheme:ra,isPdfFile:Uo,isValidExplicitDest:Sp,MathClamp:Wt,noContextMenu:gn,normalizeUnicode:up,OPS:Js,OutputScale:Ln,PasswordResponses:dp,PDFDataRangeTransport:_d,PDFDateString:Oo,PDFWorker:Zs,PermissionFlag:cp,PixelsPerInch:ds,RenderingCancelledException:zo,renderRichText:vd,ResponseException:Qr,setLayerDimensions:qi,shadow:Le,SignatureExtractor:ss,stopEvent:ht,SupportedImageMimeTypes:qo,TextLayer:Zr,TouchManager:oa,updateUrlHash:gd,Util:ve,VerbosityLevel:na,version:Nd,XfaLayer:bd};const iw=Object.freeze(Object.defineProperty({__proto__:null,AbortException:ci,AnnotationEditorLayer:Kn,AnnotationEditorParamsType:Oe,AnnotationEditorType:Me,AnnotationEditorUIManager:di,AnnotationLayer:Id,AnnotationMode:Yn,AnnotationType:wt,CSSConstants:yp,ColorPicker:pn,DOMSVGFactory:ta,DrawLayer:Nt,FeatureTest:Pt,GlobalWorkerOptions:Oi,ImageKind:Kr,InvalidPDFException:Fo,MathClamp:Wt,OPS:Js,OutputScale:Ln,PDFDataRangeTransport:_d,PDFDateString:Oo,PDFWorker:Zs,PasswordResponses:dp,PermissionFlag:cp,PixelsPerInch:ds,RenderingCancelledException:zo,ResponseException:Qr,SignatureExtractor:ss,SupportedImageMimeTypes:qo,TextLayer:Zr,TouchManager:oa,Util:ve,VerbosityLevel:na,XfaLayer:bd,applyOpacity:wp,build:Op,createValidAbsoluteUrl:md,fetchData:er,findContrastColor:bp,getDocument:Ed,getFilenameFromUrl:pp,getPdfFilenameFromUrl:mp,getRGB:tr,getUuid:yd,getXfaPageViewport:gp,isDataScheme:ra,isPdfFile:Uo,isValidExplicitDest:Sp,noContextMenu:gn,normalizeUnicode:up,renderRichText:vd,setLayerDimensions:qi,shadow:Le,stopEvent:ht,updateUrlHash:gd,version:Nd},Symbol.toStringTag,{value:"Module"}));function Vp(h){var e,t,i="";if(typeof h=="string"||typeof h=="number")i+=h;else if(typeof h=="object")if(Array.isArray(h)){var r=h.length;for(e=0;e<r;e++)h[e]&&(t=Vp(h[e]))&&(i&&(i+=" "),i+=t)}else for(t in h)h[t]&&(i&&(i+=" "),i+=t);return i}function da(){for(var h,e,t=0,i="",r=arguments.length;t<r;t++)(h=arguments[t])&&(e=Vp(h))&&(i&&(i+=" "),i+=e);return i}var Jf=Object.prototype.hasOwnProperty;function Zf(h,e,t){for(t of h.keys())if(Ys(t,e))return t}function Ys(h,e){var t,i,r;if(h===e)return!0;if(h&&e&&(t=h.constructor)===e.constructor){if(t===Date)return h.getTime()===e.getTime();if(t===RegExp)return h.toString()===e.toString();if(t===Array){if((i=h.length)===e.length)for(;i--&&Ys(h[i],e[i]););return i===-1}if(t===Set){if(h.size!==e.size)return!1;for(i of h)if(r=i,r&&typeof r=="object"&&(r=Zf(e,r),!r)||!e.has(r))return!1;return!0}if(t===Map){if(h.size!==e.size)return!1;for(i of h)if(r=i[0],r&&typeof r=="object"&&(r=Zf(e,r),!r)||!Ys(i[1],e.get(r)))return!1;return!0}if(t===ArrayBuffer)h=new Uint8Array(h),e=new Uint8Array(e);else if(t===DataView){if((i=h.byteLength)===e.byteLength)for(;i--&&h.getInt8(i)===e.getInt8(i););return i===-1}if(ArrayBuffer.isView(h)){if((i=h.byteLength)===e.byteLength)for(;i--&&h[i]===e[i];);return i===-1}if(!t||typeof h=="object"){i=0;for(t in h)if(Jf.call(h,t)&&++i&&!Jf.call(e,t)||!(t in e)||!Ys(h[t],e[t]))return!1;return Object.keys(e).length===i}}return h!==h&&e!==e}function nr(h){let e=!1;return{promise:new Promise((i,r)=>{h.then(a=>!e&&i(a)).catch(a=>!e&&r(a))}),cancel(){e=!0}}}const sw=["onCopy","onCut","onPaste"],rw=["onCompositionEnd","onCompositionStart","onCompositionUpdate"],aw=["onFocus","onBlur"],ow=["onInput","onInvalid","onReset","onSubmit"],lw=["onLoad","onError"],cw=["onKeyDown","onKeyPress","onKeyUp"],dw=["onAbort","onCanPlay","onCanPlayThrough","onDurationChange","onEmptied","onEncrypted","onEnded","onError","onLoadedData","onLoadedMetadata","onLoadStart","onPause","onPlay","onPlaying","onProgress","onRateChange","onSeeked","onSeeking","onStalled","onSuspend","onTimeUpdate","onVolumeChange","onWaiting"],hw=["onClick","onContextMenu","onDoubleClick","onMouseDown","onMouseEnter","onMouseLeave","onMouseMove","onMouseOut","onMouseOver","onMouseUp"],uw=["onDrag","onDragEnd","onDragEnter","onDragExit","onDragLeave","onDragOver","onDragStart","onDrop"],fw=["onSelect"],pw=["onTouchCancel","onTouchEnd","onTouchMove","onTouchStart"],mw=["onPointerDown","onPointerMove","onPointerUp","onPointerCancel","onGotPointerCapture","onLostPointerCapture","onPointerEnter","onPointerLeave","onPointerOver","onPointerOut"],gw=["onScroll"],yw=["onWheel"],ww=["onAnimationStart","onAnimationEnd","onAnimationIteration"],bw=["onTransitionEnd"],vw=["onToggle"],xw=["onChange"],kw=[...sw,...rw,...aw,...ow,...lw,...cw,...dw,...hw,...uw,...fw,...pw,...mw,...gw,...yw,...ww,...bw,...xw,...vw];function Fd(h,e){const t={};for(const i of kw){const r=h[i];r&&(e?t[i]=(a=>r(a,e(i))):t[i]=r)}return t}var Sw="Invariant failed";function ze(h,e){if(!h)throw new Error(Sw)}var Jc,ep;function Aw(){if(ep)return Jc;ep=1;var h=function(){};return Jc=h,Jc}var Cw=Aw();const jt=ud(Cw),Kp=L.createContext(null),Tw="noopener noreferrer nofollow";class Ew{constructor(){this.externalLinkEnabled=!0,this.externalLinkRel=void 0,this.externalLinkTarget=void 0,this.isInPresentationMode=!1,this.pdfDocument=void 0,this.pdfViewer=void 0}setDocument(e){this.pdfDocument=e}setViewer(e){this.pdfViewer=e}setExternalLinkRel(e){this.externalLinkRel=e}setExternalLinkTarget(e){this.externalLinkTarget=e}setHash(){}setHistory(){}get pagesCount(){return this.pdfDocument?this.pdfDocument.numPages:0}get page(){return ze(this.pdfViewer),this.pdfViewer.currentPageNumber||0}set page(e){ze(this.pdfViewer),this.pdfViewer.currentPageNumber=e}get rotation(){return 0}set rotation(e){}addLinkAttributes(e,t,i){e.href=t,e.rel=this.externalLinkRel||Tw,e.target=i?"_blank":this.externalLinkTarget||""}goToDestination(e){return new Promise(t=>{ze(this.pdfDocument),ze(e),typeof e=="string"?this.pdfDocument.getDestination(e).then(t):Array.isArray(e)?t(e):e.then(t)}).then(t=>{ze(Array.isArray(t));const i=t[0];new Promise(r=>{ze(this.pdfDocument),i instanceof Object?this.pdfDocument.getPageIndex(i).then(a=>{r(a)}).catch(()=>{ze(!1)}):typeof i=="number"?r(i):ze(!1)}).then(r=>{const a=r+1;ze(this.pdfViewer),ze(a>=1&&a<=this.pagesCount),this.pdfViewer.scrollPageIntoView({dest:t,pageIndex:r,pageNumber:a})})})}goToPage(e){const t=e-1;ze(this.pdfViewer),ze(e>=1&&e<=this.pagesCount),this.pdfViewer.scrollPageIntoView({pageIndex:t,pageNumber:e})}goToXY(){}cachePageRef(){}getDestinationHash(){return"#"}getAnchorUrl(){return"#"}executeNamedAction(){}executeSetOCGState(){}isPageVisible(){return!0}isPageCached(){return!0}navigateTo(e){this.goToDestination(e)}}function Xs({children:h,type:e}){return m.jsx("div",{className:`react-pdf__message react-pdf__message--${e}`,children:h})}const tp={NEED_PASSWORD:1,INCORRECT_PASSWORD:2};function Rw(h,e){switch(e.type){case"RESOLVE":return{value:e.value,error:void 0};case"REJECT":return{value:!1,error:e.error};case"RESET":return{value:void 0,error:void 0};default:return h}}function us(){return L.useReducer(Rw,{value:void 0,error:void 0})}const Ko=typeof window<"u",Yp=Ko&&window.location.protocol==="file:";function Xp(h){return typeof h<"u"}function is(h){return Xp(h)&&h!==null}function _w(h){return typeof h=="string"}function Nw(h){return h instanceof ArrayBuffer}function Pw(h){return ze(Ko),h instanceof Blob}function dd(h){return _w(h)&&/^data:/.test(h)}function np(h){ze(dd(h));const[e="",t=""]=h.split(",");return e.split(";").indexOf("base64")!==-1?atob(t):unescape(t)}function Mw(){return Ko&&window.devicePixelRatio||1}const Qp="On Chromium based browsers, you can use --allow-file-access-from-files flag for debugging purposes.";function ip(){jt(!Yp,`Loading PDF as base64 strings/URLs may not work on protocols other than HTTP/HTTPS. ${Qp}`)}function Iw(){jt(!Yp,`Loading PDF.js worker may not work on protocols other than HTTP/HTTPS. ${Qp}`)}function Bi(h){h?.cancel&&h.cancel()}function hd(h,e){return Object.defineProperty(h,"width",{get(){return this.view[2]*e},configurable:!0}),Object.defineProperty(h,"height",{get(){return this.view[3]*e},configurable:!0}),Object.defineProperty(h,"originalWidth",{get(){return this.view[2]},configurable:!0}),Object.defineProperty(h,"originalHeight",{get(){return this.view[3]},configurable:!0}),h}function Dw(h){return h.name==="RenderingCancelledException"}function Lw(h){return new Promise((e,t)=>{const i=new FileReader;i.onload=()=>{if(!i.result)return t(new Error("Error while reading a file."));e(i.result)},i.onerror=r=>{if(!r.target)return t(new Error("Error while reading a file."));const{error:a}=r.target;if(!a)return t(new Error("Error while reading a file."));switch(a.code){case a.NOT_FOUND_ERR:return t(new Error("Error while reading a file: File not found."));case a.SECURITY_ERR:return t(new Error("Error while reading a file: Security error."));case a.ABORT_ERR:return t(new Error("Error while reading a file: Aborted."));default:return t(new Error("Error while reading a file."))}},i.readAsArrayBuffer(h)})}const{PDFDataRangeTransport:jw}=iw,Fw=(h,e)=>{switch(e){case tp.NEED_PASSWORD:{const t=prompt("Enter the password to open this PDF file.");h(t);break}case tp.INCORRECT_PASSWORD:{const t=prompt("Invalid password. Please try again.");h(t);break}}};function sp(h){return typeof h=="object"&&h!==null&&("data"in h||"range"in h||"url"in h)}const Ow=L.forwardRef(function({children:e,className:t,error:i="Failed to load PDF file.",externalLinkRel:r,externalLinkTarget:a,file:o,inputRef:c,imageResourcesPath:d,loading:f="Loading PDF",noData:p="No PDF file specified.",onItemClick:g,onLoadError:w,onLoadProgress:x,onLoadSuccess:k,onPassword:v=Fw,onSourceError:A,onSourceSuccess:C,options:T,renderMode:R,rotate:E,scale:_,...M},N){const[I,G]=us(),{value:F,error:B}=I,[X,oe]=us(),{value:le,error:z}=X,K=L.useRef(new Ew),Q=L.useRef([]),V=L.useRef(void 0),ce=L.useRef(void 0);o&&o!==V.current&&sp(o)&&(jt(!Ys(o,V.current),`File prop passed to <Document /> changed, but it's equal to previous one. This might result in unnecessary reloads. Consider memoizing the value passed to "file" prop.`),V.current=o),T&&T!==ce.current&&(jt(!Ys(T,ce.current),`Options prop passed to <Document /> changed, but it's equal to previous one. This might result in unnecessary reloads. Consider memoizing the value passed to "options" prop.`),ce.current=T);const re=L.useRef({scrollPageIntoView:ee=>{const{dest:fe,pageNumber:pe,pageIndex:Ce=pe-1}=ee;if(g){g({dest:fe,pageIndex:Ce,pageNumber:pe});return}const De=Q.current[Ce];if(De){De.scrollIntoView();return}jt(!1,`An internal link leading to page ${pe} was clicked, but neither <Document> was provided with onItemClick nor it was able to find the page within itself. Either provide onItemClick to <Document> and handle navigating by yourself or ensure that all pages are rendered within <Document>.`)}});L.useImperativeHandle(N,()=>({linkService:K,pages:Q,viewer:re}),[]);function j(){C&&C()}function $(){B&&(jt(!1,B.toString()),A&&A(B))}function se(){G({type:"RESET"})}L.useEffect(se,[o,G]);const ue=L.useCallback(async()=>{if(!o)return null;if(typeof o=="string")return dd(o)?{data:np(o)}:(ip(),{url:o});if(o instanceof jw)return{range:o};if(Nw(o))return{data:o};if(Ko&&Pw(o))return{data:await Lw(o)};if(ze(typeof o=="object"),ze(sp(o)),"url"in o&&typeof o.url=="string"){if(dd(o.url)){const{url:ee,...fe}=o;return{data:np(ee),...fe}}ip()}return o},[o]);L.useEffect(()=>{const ee=nr(ue());return ee.promise.then(fe=>{G({type:"RESOLVE",value:fe})}).catch(fe=>{G({type:"REJECT",error:fe})}),()=>{Bi(ee)}},[ue,G]),L.useEffect(()=>{if(!(typeof F>"u")){if(F===!1){$();return}j()}},[F]);function te(){le&&(k&&k(le),Q.current=new Array(le.numPages),K.current.setDocument(le))}function xe(){z&&(jt(!1,z.toString()),w&&w(z))}L.useEffect(function(){oe({type:"RESET"})},[oe,F]),L.useEffect(function(){if(!F)return;const fe=T?{...F,...T}:F,pe=Ed(fe);x&&(pe.onProgress=x),v&&(pe.onPassword=v);const Ce=pe,De=Ce.promise.then(Je=>{oe({type:"RESOLVE",value:Je})}).catch(Je=>{Ce.destroyed||oe({type:"REJECT",error:Je})});return()=>{De.finally(()=>Ce.destroy())}},[T,oe,F]),L.useEffect(()=>{if(!(typeof le>"u")){if(le===!1){xe();return}te()}},[le]),L.useEffect(function(){K.current.setViewer(re.current),K.current.setExternalLinkRel(r),K.current.setExternalLinkTarget(a)},[r,a]);const ye=L.useCallback((ee,fe)=>{Q.current[ee]=fe},[]),_e=L.useCallback(ee=>{delete Q.current[ee]},[]),J=L.useMemo(()=>({imageResourcesPath:d,linkService:K.current,onItemClick:g,pdf:le,registerPage:ye,renderMode:R,rotate:E,scale:_,unregisterPage:_e}),[d,g,le,ye,R,E,_,_e]),me=L.useMemo(()=>Fd(M,()=>le),[M,le]);function Ve(){function ee(pe){return!!pe?.pdf}if(!ee(J))throw new Error("pdf is undefined");const fe=typeof e=="function"?e(J):e;return m.jsx(Kp.Provider,{value:J,children:fe})}function ft(){return o?le==null?m.jsx(Xs,{type:"loading",children:typeof f=="function"?f():f}):le===!1?m.jsx(Xs,{type:"error",children:typeof i=="function"?i():i}):Ve():m.jsx(Xs,{type:"no-data",children:typeof p=="function"?p():p})}return m.jsx("div",{className:da("react-pdf__Document",t),ref:c,...me,children:ft()})}),Jp=L.createContext(null);class qw{constructor({num:e,gen:t}){this.num=e,this.gen=t}toString(){let e=`${this.num}R`;return this.gen!==0&&(e+=this.gen),e}}function Zc(h){const e=L.useRef(void 0),t=e.current;return Xp(t)?()=>t:()=>{const i=h();return e.current=i,i}}function Yo(){return L.useContext(Kp)}function Bw(){return L.useContext(Jp)}function Zp(h){const e=Yo(),t=Bw();ze(t);const i={...e,...t,...h},{item:r,linkService:a,onItemClick:o,pdf:c,...d}=i;ze(c);const f=Zc(()=>typeof r.dest=="string"?c.getDestination(r.dest):r.dest),p=Zc(async()=>{const k=await f();if(!k)throw new Error("Destination not found.");const[v]=k;return c.getPageIndex(new qw(v))}),g=Zc(async()=>await p()+1);function w(k){k.preventDefault(),ze(o||a),o?Promise.all([f(),p(),g()]).then(([v,A,C])=>{o({dest:v,pageIndex:A,pageNumber:C})}):a&&a.goToDestination(r.dest)}function x(){if(!r.items||!r.items.length)return null;const{items:k}=r;return m.jsx("ul",{children:k.map((v,A)=>m.jsx(Zp,{item:v,pdf:c,...d},typeof v.dest=="string"?v.dest:A))})}return m.jsxs("li",{children:[m.jsx("a",{href:"#",onClick:w,children:r.title}),x()]})}function Ww(h){const t={...Yo(),...h},{className:i,inputRef:r,onItemClick:a,onLoadError:o,onLoadSuccess:c,pdf:d,...f}=t;ze(d);const[p,g]=us(),{value:w,error:x}=p;function k(){typeof w>"u"||w===!1||c&&c(w)}function v(){x&&(jt(!1,x.toString()),o&&o(x))}L.useEffect(function(){g({type:"RESET"})},[g,d]),L.useEffect(function(){if(!d)return;const E=nr(d.getOutline()),_=E;return E.promise.then(M=>{g({type:"RESOLVE",value:M})}).catch(M=>{g({type:"REJECT",error:M})}),()=>Bi(_)},[g,d]),L.useEffect(()=>{if(w!==void 0){if(w===!1){v();return}k()}},[w]);const A=L.useMemo(()=>({onItemClick:a}),[a]),C=L.useMemo(()=>Fd(f,()=>w),[f,w]);if(!w)return null;function T(){return w?m.jsx("ul",{children:w.map((R,E)=>m.jsx(Zp,{item:R,pdf:d},typeof R.dest=="string"?R.dest:E))}):null}return m.jsx("div",{className:da("react-pdf__Outline",i),ref:r,...C,children:m.jsx(Jp.Provider,{value:A,children:T()})})}function em(){for(var h=[],e=0;e<arguments.length;e++)h[e]=arguments[e];var t=h.filter(Boolean);if(t.length<=1){var i=t[0];return i||null}return function(a){for(var o=0,c=t;o<c.length;o++){var d=c[o];typeof d=="function"?d(a):d&&(d.current=a)}}}const tm=L.createContext(null);function Xo(){return L.useContext(tm)}function Hw(){const h=Yo(),e=Xo();ze(e);const t={...h,...e},{imageResourcesPath:i,linkService:r,onGetAnnotationsError:a,onGetAnnotationsSuccess:o,onRenderAnnotationLayerError:c,onRenderAnnotationLayerSuccess:d,page:f,pdf:p,renderForms:g,rotate:w,scale:x=1}=t;ze(p),ze(f),ze(r);const[k,v]=us(),{value:A,error:C}=k,T=L.useRef(null);jt(Number.parseInt(window.getComputedStyle(document.body).getPropertyValue("--react-pdf-annotation-layer"),10)===1,"AnnotationLayer styles not found. Read more: https://github.com/wojtekmaj/react-pdf#support-for-annotations");function R(){A&&o&&o(A)}function E(){C&&(jt(!1,C.toString()),a&&a(C))}L.useEffect(function(){v({type:"RESET"})},[v,f]),L.useEffect(function(){if(!f)return;const G=nr(f.getAnnotations()),F=G;return G.promise.then(B=>{v({type:"RESOLVE",value:B})}).catch(B=>{v({type:"REJECT",error:B})}),()=>{Bi(F)}},[v,f]),L.useEffect(()=>{if(A!==void 0){if(A===!1){E();return}R()}},[A]);function _(){d&&d()}function M(I){jt(!1,`${I}`),c&&c(I)}const N=L.useMemo(()=>f.getViewport({scale:x,rotation:w}),[f,w,x]);return L.useEffect(function(){if(!p||!f||!r||!A)return;const{current:G}=T;if(!G)return;const F=N.clone({dontFlip:!0}),B={accessibilityManager:null,annotationCanvasMap:null,annotationEditorUIManager:null,annotationStorage:p.annotationStorage,commentManager:null,div:G,l10n:null,linkService:r,page:f,structTreeLayer:null,viewport:F},X={annotations:A,annotationStorage:p.annotationStorage,div:G,imageResourcesPath:i,linkService:r,page:f,renderForms:g,viewport:F};G.innerHTML="";try{new Id(B).render(X),_()}catch(oe){M(oe)}return()=>{}},[A,i,r,f,p,g,N]),m.jsx("div",{className:da("react-pdf__Page__annotations","annotationLayer"),ref:T})}const nm={Document:null,DocumentFragment:null,Part:"group",Sect:"group",Div:"group",Aside:"note",NonStruct:"none",P:null,H:"heading",Title:null,FENote:"note",Sub:"group",Lbl:null,Span:null,Em:null,Strong:null,Link:"link",Annot:"note",Form:"form",Ruby:null,RB:null,RT:null,RP:null,Warichu:null,WT:null,WP:null,L:"list",LI:"listitem",LBody:null,Table:"table",TR:"row",TH:"columnheader",TD:"cell",THead:"columnheader",TBody:null,TFoot:null,Caption:null,Figure:"figure",Formula:null,Artifact:null},Gw=/^H(\d+)$/;function zw(h){return h in nm}function Qo(h){return"children"in h}function im(h){return Qo(h)?h.children.length===1&&0 in h.children&&"id"in h.children[0]:!1}function Uw(h){const e={};if(Qo(h)){const{role:t}=h,i=t.match(Gw);if(i)e.role="heading",e["aria-level"]=Number(i[1]);else if(zw(t)){const r=nm[t];r&&(e.role=r)}}return e}function sm(h){const e={};if(Qo(h)){if(h.alt!==void 0&&(e["aria-label"]=h.alt),h.lang!==void 0&&(e.lang=h.lang),im(h)){const[t]=h.children;if(t){const i=sm(t);return{...e,...i}}}}else"id"in h&&(e["aria-owns"]=h.id);return e}function $w(h){return h?{...Uw(h),...sm(h)}:null}function rm({className:h,node:e}){const t=L.useMemo(()=>$w(e),[e]),i=L.useMemo(()=>!Qo(e)||im(e)?null:e.children.map((r,a)=>m.jsx(rm,{node:r},a)),[e]);return m.jsx("span",{className:h,...t,children:i})}function Vw(){const h=Xo();ze(h);const{onGetStructTreeError:e,onGetStructTreeSuccess:t}=h,[i,r]=us(),{value:a,error:o}=i,{customTextRenderer:c,page:d}=h;function f(){a&&t&&t(a)}function p(){o&&(jt(!1,o.toString()),e&&e(o))}return L.useEffect(function(){r({type:"RESET"})},[r,d]),L.useEffect(function(){if(c||!d)return;const w=nr(d.getStructTree()),x=w;return w.promise.then(k=>{r({type:"RESOLVE",value:k})}).catch(k=>{r({type:"REJECT",error:k})}),()=>Bi(x)},[c,d,r]),L.useEffect(()=>{if(a!==void 0){if(a===!1){p();return}f()}},[a]),a?m.jsx(rm,{className:"react-pdf__Page__structTree structTree",node:a}):null}const rp=Yn;function Kw(h){const e=Xo();ze(e);const t={...e,...h},{_className:i,canvasBackground:r,devicePixelRatio:a=Mw(),onRenderError:o,onRenderSuccess:c,page:d,renderForms:f,renderTextLayer:p,rotate:g,scale:w}=t,{canvasRef:x}=h;ze(d);const k=L.useRef(null);function v(){d&&c&&c(hd(d,w))}function A(E){Dw(E)||(jt(!1,E.toString()),o&&o(E))}const C=L.useMemo(()=>d.getViewport({scale:w*a,rotation:g}),[a,d,g,w]),T=L.useMemo(()=>d.getViewport({scale:w,rotation:g}),[d,g,w]);L.useEffect(function(){if(!d)return;d.cleanup();const{current:_}=k;if(!_)return;_.width=C.width,_.height=C.height,_.style.width=`${Math.floor(T.width)}px`,_.style.height=`${Math.floor(T.height)}px`,_.style.visibility="hidden";const M={annotationMode:f?rp.ENABLE_FORMS:rp.ENABLE,canvas:_,canvasContext:_.getContext("2d",{alpha:!1}),viewport:C};r&&(M.background=r);const N=d.render(M),I=N;return N.promise.then(()=>{_.style.visibility="",v()}).catch(A),()=>Bi(I)},[r,d,f,C,T]);const R=L.useCallback(()=>{const{current:E}=k;E&&(E.width=0,E.height=0)},[]);return L.useEffect(()=>R,[R]),m.jsx("canvas",{className:`${i}__canvas`,dir:"ltr",ref:em(x,k),style:{display:"block",userSelect:"none"},children:p?m.jsx(Vw,{}):null})}function Yw(h){return"str"in h}function Xw(){const h=Xo();ze(h);const{customTextRenderer:e,onGetTextError:t,onGetTextSuccess:i,onRenderTextLayerError:r,onRenderTextLayerSuccess:a,page:o,pageIndex:c,pageNumber:d,rotate:f,scale:p}=h;ze(o);const[g,w]=us(),{value:x,error:k}=g,v=L.useRef(null);jt(Number.parseInt(window.getComputedStyle(document.body).getPropertyValue("--react-pdf-text-layer"),10)===1,"TextLayer styles not found. Read more: https://github.com/wojtekmaj/react-pdf#support-for-text-layer");function A(){x&&i&&i(x)}function C(){k&&(jt(!1,k.toString()),t&&t(k))}L.useEffect(function(){w({type:"RESET"})},[o,w]),L.useEffect(function(){if(!o)return;const I=nr(o.getTextContent()),G=I;return I.promise.then(F=>{w({type:"RESOLVE",value:F})}).catch(F=>{w({type:"REJECT",error:F})}),()=>Bi(G)},[o,w]),L.useEffect(()=>{if(x!==void 0){if(x===!1){C();return}A()}},[x]);const T=L.useCallback(()=>{a&&a()},[a]),R=L.useCallback(N=>{jt(!1,N.toString()),r&&r(N)},[r]);function E(){const N=v.current;N&&N.classList.add("selecting")}function _(){const N=v.current;N&&N.classList.remove("selecting")}const M=L.useMemo(()=>o.getViewport({scale:p,rotation:f}),[o,f,p]);return L.useLayoutEffect(function(){if(!o||!x)return;const{current:I}=v;if(!I)return;I.innerHTML="";const G=o.streamTextContent({includeMarkedContent:!0}),F={container:I,textContentSource:G,viewport:M},B=new Zr(F),X=B;return B.render().then(()=>{const oe=document.createElement("div");oe.className="endOfContent",I.append(oe);const le=I.querySelectorAll('[role="presentation"]');if(e){let z=0;x.items.forEach((K,Q)=>{if(!Yw(K))return;const V=le[z];if(!V)return;const ce=e({pageIndex:c,pageNumber:d,itemIndex:Q,...K});V.innerHTML=ce,z+=K.str&&K.hasEOL?2:1})}T()}).catch(R),()=>Bi(X)},[e,R,T,o,c,d,x,M]),m.jsx("div",{className:da("react-pdf__Page__textContent","textLayer"),onMouseUp:_,onMouseDown:E,ref:v})}const ap=1;function Qw(h){const t={...Yo(),...h},{_className:i="react-pdf__Page",_enableRegisterUnregisterPage:r=!0,canvasBackground:a,canvasRef:o,children:c,className:d,customRenderer:f,customTextRenderer:p,devicePixelRatio:g,error:w="Failed to load the page.",height:x,inputRef:k,loading:v="Loading page",noData:A="No page specified.",onGetAnnotationsError:C,onGetAnnotationsSuccess:T,onGetStructTreeError:R,onGetStructTreeSuccess:E,onGetTextError:_,onGetTextSuccess:M,onLoadError:N,onLoadSuccess:I,onRenderAnnotationLayerError:G,onRenderAnnotationLayerSuccess:F,onRenderError:B,onRenderSuccess:X,onRenderTextLayerError:oe,onRenderTextLayerSuccess:le,pageIndex:z,pageNumber:K,pdf:Q,registerPage:V,renderAnnotationLayer:ce=!0,renderForms:re=!1,renderMode:j="canvas",renderTextLayer:$=!0,rotate:se,scale:ue=ap,unregisterPage:te,width:xe,...ye}=t,[_e,J]=us(),{value:me,error:Ve}=_e,ft=L.useRef(null);ze(Q);const ee=is(K)?K-1:z??null,fe=K??(is(z)?z+1:null),pe=se??(me?me.rotate:null),Ce=L.useMemo(()=>{if(!me)return null;let Vt=1;const on=ue??ap;if(xe||x){const Ge=me.getViewport({scale:1,rotation:pe});xe?Vt=xe/Ge.width:x&&(Vt=x/Ge.height)}return on*Vt},[x,me,pe,ue,xe]);L.useEffect(function(){return()=>{is(ee)&&r&&te&&te(ee)}},[r,Q,ee,te]);function De(){if(I){if(!me||!Ce)return;I(hd(me,Ce))}if(r&&V){if(!is(ee)||!ft.current)return;V(ee,ft.current)}}function Je(){Ve&&(jt(!1,Ve.toString()),N&&N(Ve))}L.useEffect(function(){J({type:"RESET"})},[J,Q,ee]),L.useEffect(function(){if(!Q||!fe)return;const on=nr(Q.getPage(fe)),Ge=on;return on.promise.then(Tn=>{J({type:"RESOLVE",value:Tn})}).catch(Tn=>{J({type:"REJECT",error:Tn})}),()=>Bi(Ge)},[J,Q,fe]),L.useEffect(()=>{if(me!==void 0){if(me===!1){Je();return}De()}},[me,Ce]);const Ke=L.useMemo(()=>is(ee)&&fe&&is(pe)&&is(Ce)?{_className:i,canvasBackground:a,customTextRenderer:p,devicePixelRatio:g,onGetAnnotationsError:C,onGetAnnotationsSuccess:T,onGetStructTreeError:R,onGetStructTreeSuccess:E,onGetTextError:_,onGetTextSuccess:M,onRenderAnnotationLayerError:G,onRenderAnnotationLayerSuccess:F,onRenderError:B,onRenderSuccess:X,onRenderTextLayerError:oe,onRenderTextLayerSuccess:le,page:me,pageIndex:ee,pageNumber:fe,renderForms:re,renderTextLayer:$,rotate:pe,scale:Ce}:null,[i,a,p,g,C,T,R,E,_,M,G,F,B,X,oe,le,me,ee,fe,re,$,pe,Ce]),vt=L.useMemo(()=>Fd(ye,()=>me&&(Ce?hd(me,Ce):void 0)),[ye,me,Ce]),Xe=`${ee}@${Ce}/${pe}`;function rt(){switch(j){case"custom":return ze(f),m.jsx(f,{},`${Xe}_custom`);case"none":return null;case"canvas":default:return m.jsx(Kw,{canvasRef:o},`${Xe}_canvas`)}}function $t(){return $?m.jsx(Xw,{},`${Xe}_text`):null}function gt(){return ce?m.jsx(Hw,{},`${Xe}_annotations`):null}function pt(){function Vt(Ge){return!!Ge?.page}if(!Vt(Ke))throw new Error("page is undefined");const on=typeof c=="function"?c(Ke):c;return m.jsxs(tm.Provider,{value:Ke,children:[rt(),$t(),gt(),on]})}function Xn(){return fe?Q===null||me===void 0||me===null?m.jsx(Xs,{type:"loading",children:typeof v=="function"?v():v}):Q===!1||me===!1?m.jsx(Xs,{type:"error",children:typeof w=="function"?w():w}):pt():m.jsx(Xs,{type:"no-data",children:typeof A=="function"?A():A})}return m.jsx("div",{className:da(i,d),"data-page-number":fe,ref:em(k,ft),style:{"--scale-round-x":"1px","--scale-round-y":"1px","--scale-factor":"1","--user-unit":`${Ce}`,"--total-scale-factor":"calc(var(--scale-factor) * var(--user-unit))",backgroundColor:a||"white",position:"relative",minWidth:"min-content",minHeight:"min-content"},...vt,children:Xn()})}Iw();Oi.workerSrc="pdf.worker.mjs";Oi.workerSrc=`https://unpkg.com/pdfjs-dist@${Nd}/build/pdf.worker.min.mjs`;const Jw=({isOpen:h,onClose:e,pageNumber:t,pdfUrl:i,onFilePathChange:r,onPageChange:a,numPages:o,setNumPages:c,onWidthChange:d})=>{const f=L.useRef(null),[p,g]=L.useState(null),[w,x]=L.useState(!1),k=L.useRef(null),[v,A]=L.useState(800),[C,T]=L.useState(null);L.useEffect(()=>{d&&d(v)},[]);const R=M=>{M.preventDefault();const N=M.clientX,I=v,G=B=>{const X=I-(B.clientX-N);X>400&&X<window.innerWidth-200&&(A(X),d&&d(X))},F=()=>{window.removeEventListener("mousemove",G),window.removeEventListener("mouseup",F),f.current&&g(f.current.clientWidth)};window.addEventListener("mousemove",G),window.addEventListener("mouseup",F)};L.useEffect(()=>{const M=()=>{f.current&&g(f.current.clientWidth)};return M(),h&&setTimeout(M,300),window.addEventListener("resize",M),()=>window.removeEventListener("resize",M)},[h,v]);const E=async()=>{const M=await window.electron.openFileDialog();M&&(r(M),x(!1))},_=M=>{T(M),c(M.numPages),o||a(1)};return m.jsxs("div",{ref:k,style:{width:h?`${v}px`:"0px"},className:`fixed top-20 right-0 bottom-0 z-40 bg-slate-900 border-l-2 border-termina-accent shadow-2xl transition-all duration-300 ease-in-out flex flex-col overflow-hidden ${h?"translate-x-0":"translate-x-full opacity-0"}`,children:[m.jsx("div",{onMouseDown:R,className:"absolute top-0 left-0 w-2 h-full bg-transparent cursor-col-resize z-10 hover:bg-termina-accent/10 transition-colors"}),m.jsxs("div",{className:"p-3 bg-slate-900 border-b border-slate-700 flex justify-between items-center shrink-0 min-w-[300px]",children:[m.jsxs("div",{className:"flex items-center gap-4",children:[m.jsx("h3",{className:"font-serif font-bold text-termina-gold text-lg whitespace-nowrap",children:"Adventure Book"}),m.jsx("button",{onClick:E,className:"text-xs bg-slate-800 hover:bg-slate-700 text-slate-300 px-2 py-1 rounded border border-slate-600 transition-colors whitespace-nowrap",children:i?"Change PDF":"Import PDF"})]}),m.jsxs("div",{className:"flex items-center gap-3",children:[!w&&m.jsxs(m.Fragment,{children:[m.jsx("span",{className:"text-xs font-mono text-slate-400 whitespace-nowrap",children:i?`Page ${t} / ${o||"--"}`:"No File"}),o&&o>1&&m.jsxs(m.Fragment,{children:[m.jsx("button",{onClick:()=>a(Math.max(1,t-1)),disabled:t<=1,className:"bg-slate-800 hover:bg-slate-700 text-slate-400 p-1 rounded border border-slate-600 text-xs transition-colors disabled:opacity-50",children:"Prev"}),m.jsx("button",{onClick:()=>a(Math.min(o,t+1)),disabled:t>=o,className:"bg-slate-800 hover:bg-slate-700 text-slate-400 p-1 rounded border border-slate-600 text-xs transition-colors disabled:opacity-50",children:"Next"})]})]}),C&&m.jsx("button",{onClick:()=>x(!w),className:`px-2 py-1 rounded border text-xs transition-colors whitespace-nowrap flex items-center gap-1 ${w?"bg-termina-accent text-black border-termina-accent hover:bg-white":"bg-slate-800 hover:bg-slate-700 text-termina-accent border-slate-600"}`,children:w?m.jsxs(m.Fragment,{children:[m.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"})}),m.jsx("span",{children:"Page"})]}):m.jsxs(m.Fragment,{children:[m.jsx("svg",{xmlns:"http://www.w3.000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M4 6h16M4 10h16M4 14h16M4 18h16"})}),m.jsx("span",{children:"Contents"})]})}),m.jsx("button",{onClick:e,className:"bg-slate-800 hover:bg-red-900/50 text-slate-400 hover:text-red-200 p-1 rounded transition-colors",children:m.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})]}),m.jsx("div",{ref:f,className:"flex-1 bg-slate-800 w-full h-full overflow-auto pdf-panel-content relative",children:i?m.jsx(Ow,{file:i,onLoadSuccess:_,className:"react-pdf__Document flex flex-col items-center min-h-full",loading:m.jsx("div",{className:"flex items-center justify-center h-64 text-termina-accent",children:m.jsx("span",{className:"animate-pulse",children:"Loading PDF..."})}),children:w?m.jsxs("div",{className:"w-full text-left bg-slate-900 min-h-full toc-outline",children:[m.jsx("h4",{className:"text-termina-gold font-serif font-bold text-xl mb-4 px-2",children:"Table of Contents"}),m.jsx(Ww,{onItemClick:({pageNumber:M})=>{a(M),x(!1)}})]}):m.jsx(Qw,{pageNumber:t,width:p?p-2:void 0,renderTextLayer:!1,renderAnnotationLayer:!0,className:"shadow-lg"})}):m.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center text-slate-500 p-8 text-center min-w-[300px]",children:[m.jsx("p",{className:"mb-4",children:"Please import the PDF to view the guide."}),m.jsx("button",{onClick:E,className:"bg-termina-accent text-black px-6 py-2 rounded font-bold hover:bg-white transition-colors shadow-[0_0_15px_rgba(216,180,254,0.3)]",children:"Select PDF File"})]})})]})},Zw=({isOpen:h,onClose:e,url:t,title:i="Wiki Reference"})=>m.jsxs("div",{className:`fixed top-20 left-0 bottom-0 z-[50] bg-slate-900 border-r-2 border-termina-accent shadow-2xl transition-all duration-300 ease-in-out flex flex-col overflow-hidden ${h?"w-full md:w-[600px] lg:w-[800px] translate-x-0":"w-0 -translate-x-full opacity-0"}`,children:[m.jsxs("div",{className:"p-3 bg-slate-900 border-b border-slate-700 flex justify-between items-center shrink-0 min-w-[300px]",children:[m.jsx("div",{className:"flex items-center gap-3",children:m.jsx("h3",{className:"font-serif font-bold text-termina-gold text-lg whitespace-nowrap overflow-hidden text-ellipsis max-w-[200px] md:max-w-md",children:i})}),m.jsxs("div",{className:"flex items-center gap-2",children:[t&&m.jsxs("a",{href:t,target:"_blank",rel:"noopener noreferrer",className:"bg-slate-800 hover:bg-slate-700 text-termina-accent px-3 py-1 rounded border border-slate-600 text-xs transition-colors whitespace-nowrap flex items-center gap-1",title:"Open in new tab (if blocked)",children:[m.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"})}),m.jsx("span",{children:"Open Tab"})]}),m.jsx("button",{onClick:e,className:"bg-slate-800 hover:bg-red-900/50 text-slate-400 hover:text-red-200 p-1 rounded transition-colors",children:m.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]})]}),m.jsx("div",{className:"flex-1 bg-white relative w-full h-full",children:t?m.jsxs(m.Fragment,{children:[m.jsx("div",{className:"absolute inset-0 flex items-center justify-center z-0",children:m.jsx("span",{className:"text-slate-400 animate-pulse",children:"Loading Scroll..."})}),m.jsx("iframe",{src:t,className:"w-full h-full border-none relative z-10 bg-white",title:"Wiki Viewer",sandbox:"allow-scripts allow-same-origin allow-popups allow-forms"})]}):m.jsx("div",{className:"flex items-center justify-center h-full text-slate-500",children:"No URL selected."})}),m.jsx("div",{className:"bg-slate-900 text-slate-500 text-[10px] p-1 text-center border-t border-slate-800",children:'If content does not load, use the "Open Tab" button above. Some scrolls are protected by ancient magic (X-Frame-Options).'})]}),eb=({globalState:h,gameHistory:e,onSave:t,onLoad:i,onNewGame:r,allQuests:a})=>{const o=L.useRef(null),[c,d]=L.useState("Campaign"),f=v=>{const A=Math.floor(v/3600),C=Math.floor(v%3600/60);return`${A}h ${C}m`},p=v=>v.toFixed(1),g=L.useMemo(()=>{let v=0;Object.entries(e.stepCompletionCounts).forEach(([T,R])=>{for(const E of a){const _=E.steps.find(M=>M.id===T);if(_){v+=_.xpReward*R;break}}}),h.completedSteps.forEach(T=>{for(const R of a){const E=R.steps.find(_=>_.id===T);if(E){v+=E.xpReward;break}}});const A=new Set;e.purchasedItems.forEach(T=>A.add(T)),Object.keys(e.stepCompletionCounts).forEach(T=>{a.forEach(R=>{const E=R.steps.find(_=>_.id===T);E&&E.itemRewards&&E.itemRewards.forEach(_=>A.add(_.name))})}),h.completedSteps.forEach(T=>{a.forEach(R=>{const E=R.steps.find(_=>_.id===T);E&&E.itemRewards&&E.itemRewards.forEach(_=>A.add(_.name))})});const C=e.questLog.length+a.filter(T=>T.steps.every(R=>h.completedSteps.includes(R.id))&&!e.questLog.some(R=>R.questId===T.id&&R.cycle===e.cyclesCompleted+1)).length;return{xp:v,distance:e.totalDistanceTravelled,items:A.size,questCount:C,time:e.totalPlayTimeSeconds,cycles:e.cyclesCompleted}},[e,h.completedSteps,a]),w=L.useMemo(()=>{let v=0;h.completedSteps.forEach(T=>{for(const R of a){const E=R.steps.find(_=>_.id===T);if(E){v+=E.xpReward;break}}});const A=a.filter(T=>T.steps.every(R=>h.completedSteps.includes(R.id)));let C=0;return h.completedSteps.forEach(T=>{a.forEach(R=>{const E=R.steps.find(_=>_.id===T);E&&E.itemRewards&&(C+=E.itemRewards.length)})}),{xp:v,distance:h.cycleDistance,items:C,questCount:A.length,quests:A}},[h,a]),x=L.useMemo(()=>{const A=(h.dayCompletedSteps||[]).map(C=>{for(const T of a){const R=T.steps.find(E=>E.id===C);if(R)return{...R,questTitle:T.title}}return null}).filter(Boolean);return{xp:h.dayXp,distance:h.dayDistance,steps:A}},[h,a]),k=(v,A,C="text-white")=>m.jsxs("div",{className:"bg-slate-800/50 p-4 rounded-lg border border-slate-700 flex flex-col items-center justify-center text-center",children:[m.jsx("p",{className:"text-xs uppercase text-slate-400 font-bold mb-1",children:v}),m.jsx("p",{className:`text-2xl font-mono ${C}`,children:A})]});return m.jsxs("div",{className:"max-w-4xl mx-auto space-y-8 pb-20 animate-fade-in",children:[m.jsxs("div",{className:"grid grid-cols-3 gap-4 mb-8",children:[m.jsxs("button",{onClick:t,className:"bg-slate-800 hover:bg-slate-700 border border-slate-600 hover:border-termina-accent text-white py-3 rounded-lg transition-all flex flex-col items-center justify-center gap-1 group",children:[m.jsx("span",{className:"text-xl",children:""}),m.jsx("span",{className:"text-xs font-bold",children:"Save"})]}),m.jsxs("button",{onClick:()=>o.current?.click(),className:"bg-slate-800 hover:bg-slate-700 border border-slate-600 hover:border-termina-accent text-white py-3 rounded-lg transition-all flex flex-col items-center justify-center gap-1 group",children:[m.jsx("span",{className:"text-xl",children:""}),m.jsx("span",{className:"text-xs font-bold",children:"Load"}),m.jsx("input",{type:"file",ref:o,onChange:v=>{v.target.files?.[0]&&(i(v.target.files[0]),v.target.value="")},className:"hidden",accept:".json"})]}),m.jsxs("button",{onClick:r,className:"bg-slate-800 hover:bg-red-900/30 border border-slate-600 hover:border-red-500 text-white py-3 rounded-lg transition-all flex flex-col items-center justify-center gap-1 group",children:[m.jsx("span",{className:"text-xl",children:""}),m.jsx("span",{className:"text-xs font-bold group-hover:text-red-400",children:"Reset"})]})]}),m.jsx("div",{className:"flex border-b border-slate-700",children:["Campaign","Cycle","Day"].map(v=>m.jsx("button",{onClick:()=>d(v),className:`px-8 py-3 font-serif font-bold text-lg transition-colors border-b-2 ${c===v?"border-termina-accent text-termina-accent bg-slate-800/30 rounded-t-lg":"border-transparent text-slate-500 hover:text-slate-300"}`,children:v},v))}),c==="Campaign"&&m.jsxs("div",{className:"space-y-6 animate-slide-in-right",children:[m.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:[k("Total Play Time",f(g.time)),k("Cycles Endured",g.cycles),k("Total XP Earned",g.xp.toLocaleString(),"text-termina-accent"),k("Distance Travelled",`${p(g.distance)} mi`),k("Quests Completed",g.questCount),k("Items Collected",g.items)]}),m.jsxs("div",{className:"bg-slate-900 border border-slate-700 rounded-xl p-6",children:[m.jsx("h3",{className:"text-xl font-serif text-termina-gold border-b border-slate-700 pb-2 mb-4",children:"Quest Log"}),e.questLog.length>0?m.jsx("div",{className:"space-y-2 max-h-96 overflow-y-auto custom-scrollbar",children:[...e.questLog].reverse().map((v,A)=>{const C=a.find(T=>T.id===v.questId);return m.jsxs("div",{className:"flex justify-between items-center bg-slate-800/50 p-3 rounded border border-slate-700/50",children:[m.jsxs("div",{children:[m.jsxs("span",{className:"text-xs font-bold bg-slate-700 px-2 py-0.5 rounded mr-2 text-slate-300",children:["Cycle ",v.cycle]}),m.jsx("span",{className:"font-bold text-slate-200",children:C?.title||"Unknown Quest"})]}),m.jsx("span",{className:"text-xs text-slate-500 font-mono",children:v.timeString})]},A)})}):m.jsx("p",{className:"text-slate-500 italic text-center py-8",children:"No quests recorded in history."})]})]}),c==="Cycle"&&m.jsxs("div",{className:"space-y-6 animate-slide-in-right",children:[m.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[k("Cycle Distance",`${p(w.distance)} mi`),k("Cycle XP",w.xp.toLocaleString(),"text-termina-accent"),k("Items Found",w.items),k("Quests Done",w.questCount)]}),m.jsxs("div",{className:"bg-slate-900 border border-slate-700 rounded-xl p-6",children:[m.jsx("h3",{className:"text-xl font-serif text-termina-gold border-b border-slate-700 pb-2 mb-4",children:"Current Cycle Progress"}),w.quests.length>0?m.jsx("div",{className:"grid gap-3",children:w.quests.map(v=>m.jsxs("div",{className:"bg-slate-800/80 p-4 rounded border border-green-900/50 flex justify-between items-center",children:[m.jsxs("div",{children:[m.jsxs("span",{className:"text-xs font-bold text-slate-400 uppercase mr-2",children:["Quest ",v.questNumber]}),m.jsx("span",{className:"font-bold text-green-400",children:v.title})]}),m.jsx("span",{className:"text-xl",children:""})]},v.id))}):m.jsx("p",{className:"text-slate-500 italic text-center py-8",children:"No quests fully completed in this cycle yet."})]})]}),c==="Day"&&m.jsxs("div",{className:"space-y-6 animate-slide-in-right",children:[m.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[k("Distance Today",`${p(x.distance)} mi`),k("XP Earned Today",x.xp.toLocaleString(),"text-termina-accent")]}),m.jsxs("div",{className:"bg-slate-900 border border-slate-700 rounded-xl p-6",children:[m.jsx("h3",{className:"text-xl font-serif text-termina-gold border-b border-slate-700 pb-2 mb-4",children:"Steps Completed Today"}),x.steps.length>0?m.jsx("div",{className:"space-y-2",children:x.steps.map((v,A)=>m.jsxs("div",{className:"flex justify-between items-center bg-slate-800/30 p-3 rounded border border-slate-700/50",children:[m.jsxs("div",{children:[m.jsx("div",{className:"text-xs text-slate-500 mb-0.5",children:v.questTitle}),m.jsx("div",{className:"font-medium text-slate-200",children:v.title})]}),m.jsxs("span",{className:"text-xs font-bold bg-slate-900 text-termina-gold px-2 py-1 rounded",children:["+",v.xpReward," XP"]})]},A))}):m.jsx("p",{className:"text-slate-500 italic text-center py-8",children:"No steps completed since dawn."})]})]})]})},tb=({isOpen:h,onClose:e,globalState:t,setGlobalState:i,addNotification:r,onAddDistance:a})=>{const o=N=>{i(I=>{let G=I.totalMinutes+N,F=Math.floor(G/1440)+1;F>3&&(F=3);let B=G%1440;return{...I,currentDay:F,timeOfDayMinutes:B,totalMinutes:G}}),r(`Added ${N} minutes to clock.`,"info")},[c,d]=L.useState(0),[f,p]=L.useState(!1),g=L.useRef(null),w=L.useRef(0);L.useEffect(()=>(f?(w.current=Date.now(),g.current=window.setInterval(()=>{const N=Date.now(),I=N-w.current;d(G=>G+I),w.current=N},100)):g.current&&clearInterval(g.current),()=>{g.current&&clearInterval(g.current)}),[f]);const x=()=>{const N=Math.ceil(c/6e4);N>0&&(o(N),d(0),p(!1))},k=N=>{const I=Math.floor(N/1e3),G=Math.floor(I/60),F=I%60;return`${G.toString().padStart(2,"0")}:${F.toString().padStart(2,"0")}`},[v,A]=L.useState(1),[C,T]=L.useState("normal"),R=()=>{const N=v*5280;let I=0;switch(C){case"slow":I=N/200;break;case"normal":I=N/300;break;case"fast":I=N/400;break}return Math.ceil(I)},E=()=>{const N=R();o(N),a&&a(v)},_=R(),M=_>=60?`${Math.floor(_/60)}h ${_%60}m`:`${_} min`;return m.jsxs("div",{className:`fixed top-20 left-0 bottom-0 z-40 bg-slate-900 border-r-2 border-termina-accent shadow-2xl transition-all duration-300 ease-in-out flex flex-col overflow-hidden ${h?"w-full md:w-80 translate-x-0":"w-0 -translate-x-full opacity-0"}`,children:[m.jsxs("div",{className:"p-4 bg-slate-900 border-b border-slate-700 flex justify-between items-center shrink-0 min-w-0",children:[m.jsx("h3",{className:"font-serif font-bold text-termina-gold text-lg truncate",children:"Time Calculator"}),m.jsx("button",{onClick:e,className:"text-slate-500 hover:text-white shrink-0 ml-2",children:m.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:m.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),m.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-8 w-full",children:[m.jsxs("section",{children:[m.jsx("h4",{className:"text-xs font-bold text-slate-500 uppercase tracking-widest mb-3 border-b border-slate-700 pb-1",children:"Quick Advance"}),m.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[[5,15,30].map(N=>m.jsxs("button",{onClick:()=>o(N),className:"bg-slate-800 hover:bg-slate-700 text-slate-200 py-2 rounded text-xs font-bold border border-slate-600 transition-colors",children:["+",N,"m"]},N)),m.jsx("button",{onClick:()=>o(60),className:"bg-slate-800 hover:bg-slate-700 text-slate-200 py-2 rounded text-xs font-bold border border-slate-600 transition-colors",children:"+1 Hr"}),m.jsx("button",{onClick:()=>o(360),className:"bg-slate-800 hover:bg-slate-700 text-slate-200 py-2 rounded text-xs font-bold border border-slate-600 transition-colors",children:"+6 Hrs"})]})]}),m.jsxs("section",{children:[m.jsx("h4",{className:"text-xs font-bold text-slate-500 uppercase tracking-widest mb-3 border-b border-slate-700 pb-1",children:"Resting"}),m.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[m.jsxs("button",{onClick:()=>o(60),className:"bg-purple-900/30 hover:bg-purple-900/50 text-purple-200 py-3 rounded border border-purple-700/50 transition-colors flex flex-col items-center",children:[m.jsx("span",{className:"text-sm font-bold",children:"Short Rest"}),m.jsx("span",{className:"text-[10px] opacity-70",children:"+1 Hour"})]}),m.jsxs("button",{onClick:()=>o(480),className:"bg-purple-900/30 hover:bg-purple-900/50 text-purple-200 py-3 rounded border border-purple-700/50 transition-colors flex flex-col items-center",children:[m.jsx("span",{className:"text-sm font-bold",children:"Long Rest"}),m.jsx("span",{className:"text-[10px] opacity-70",children:"+8 Hours"})]})]})]}),m.jsxs("section",{children:[m.jsx("h4",{className:"text-xs font-bold text-slate-500 uppercase tracking-widest mb-3 border-b border-slate-700 pb-1",children:"Activity Timer"}),m.jsxs("div",{className:"bg-slate-800 rounded-lg p-4 text-center border border-slate-700",children:[m.jsx("div",{className:"text-4xl font-mono text-termina-gold mb-4 tracking-wider",children:k(c)}),m.jsxs("div",{className:"flex justify-center gap-2 mb-4",children:[f?m.jsx("button",{onClick:()=>p(!1),className:"bg-red-700 hover:bg-red-600 text-white px-4 py-1 rounded text-xs font-bold uppercase tracking-wider transition-colors",children:"Stop"}):m.jsx("button",{onClick:()=>p(!0),className:"bg-green-700 hover:bg-green-600 text-white px-4 py-1 rounded text-xs font-bold uppercase tracking-wider transition-colors",children:"Start"}),m.jsx("button",{onClick:()=>{p(!1),d(0)},className:"bg-slate-700 hover:bg-slate-600 text-slate-300 px-4 py-1 rounded text-xs font-bold uppercase tracking-wider transition-colors",children:"Reset"})]}),m.jsx("button",{onClick:x,disabled:c<6e4,className:"w-full bg-slate-700 hover:bg-termina-accent hover:text-black text-slate-300 py-2 rounded text-xs font-bold uppercase tracking-widest transition-colors disabled:opacity-50 disabled:cursor-not-allowed",children:"Add to Clock"})]})]}),m.jsxs("section",{children:[m.jsx("h4",{className:"text-xs font-bold text-slate-500 uppercase tracking-widest mb-3 border-b border-slate-700 pb-1",children:"Travel Calculator"}),m.jsxs("div",{className:"bg-slate-800 rounded-lg p-4 border border-slate-700 space-y-4",children:[m.jsxs("div",{children:[m.jsxs("div",{className:"flex justify-between text-xs text-slate-400 mb-1",children:[m.jsx("span",{children:"Distance"}),m.jsxs("span",{className:"text-white font-mono",children:[v," miles"]})]}),m.jsx("input",{type:"range",min:"0.1",max:"10",step:"0.1",value:v,onChange:N=>A(parseFloat(N.target.value)),className:"w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer accent-termina-accent"})]}),m.jsxs("div",{children:[m.jsx("p",{className:"text-xs text-slate-400 mb-2",children:"Pace"}),m.jsx("div",{className:"flex rounded bg-slate-900/50 p-1 gap-1",children:["slow","normal","fast"].map(N=>m.jsxs("button",{onClick:()=>T(N),className:`flex-1 py-1 text-[10px] font-bold uppercase rounded transition-colors ${C===N?"bg-slate-600 text-white shadow-sm":"text-slate-500 hover:text-slate-300"}`,children:[N," (",N==="slow"?200:N==="normal"?300:400,")"]},N))})]}),m.jsxs("div",{className:"pt-2 border-t border-slate-700/50",children:[m.jsxs("div",{className:"flex justify-between items-center mb-3",children:[m.jsx("span",{className:"text-xs text-slate-400",children:"Est. Time"}),m.jsx("span",{className:"text-lg font-mono text-termina-gold",children:M})]}),m.jsx("button",{onClick:E,className:"w-full bg-slate-700 hover:bg-termina-accent hover:text-black text-slate-300 py-2 rounded text-xs font-bold uppercase tracking-widest transition-colors",children:"Travel"})]})]})]})]})]})},nb=({character:h,isOpen:e,onClose:t,onSave:i,onReset:r,allQuests:a})=>{const[o,c]=L.useState(""),[d,f]=L.useState(q.ClockTown),[p,g]=L.useState(""),[w,x]=L.useState(""),[k,v]=L.useState(""),[A,C]=L.useState(""),[T,R]=L.useState([]),[E,_]=L.useState("All"),[M,N]=L.useState("06:00"),[I,G]=L.useState("18:00"),[F,B]=L.useState(""),[X,oe]=L.useState(""),[le,z]=L.useState(""),[K,Q]=L.useState("none"),[V,ce]=L.useState(""),[re,j]=L.useState(null);if(L.useEffect(()=>{h?(c(h.name),f(h.locationRegion),g(h.locationSpecific),x(h.description),v(h.defaultActivity||""),C(h.defaultLocation||""),R(h.scheduleEvents||[])):(c(""),f(q.ClockTown),g(""),x(""),v("Resting"),C(""),R([])),j(null)},[h,e]),!e)return null;const $=()=>{j(null);const[te,xe]=M.split(":").map(Number),[ye,_e]=I.split(":").map(Number);if((E===1||E==="All")&&te<6){j("Cannot schedule events before 6:00 AM on the First Day.");return}const J=te<6?te+24:te;if((ye<6?ye+24:ye)*60+_e<=J*60+xe){j("End time must be after start time.");return}const Ve={day:E,start:M,end:I,title:F||"Activity",description:X,location:le||p};K!=="none"&&V&&(Ve.condition={type:K,stepId:V}),R(ft=>[...ft,Ve].sort((ee,fe)=>ee.start.localeCompare(fe.start))),B(""),oe(""),Q("none")},se=te=>{R(xe=>xe.filter((ye,_e)=>_e!==te))},ue=()=>{if(!o){j("Name is required.");return}const te={id:h?h.id:`custom-char-${Date.now()}`,name:o,locationRegion:d,locationSpecific:p,description:w,schedule:"Custom Schedule",defaultActivity:k,defaultLocation:A||p,scheduleEvents:T,pages:"",quests:[],connections:[],wikiLink:"",icon:h?.icon||"/icons/Mask of Truth.png",isCustom:h?h.isCustom:!0,isEdited:!0};i(te,!h),t()};return m.jsx("div",{className:"fixed inset-0 bg-black/90 z-[100] flex items-center justify-center p-4 backdrop-blur-sm animate-fade-in",onClick:t,children:m.jsxs("div",{className:"bg-slate-900 border border-termina-accent rounded-xl w-full max-w-4xl max-h-[90vh] flex flex-col overflow-hidden shadow-2xl",onClick:te=>te.stopPropagation(),children:[m.jsxs("div",{className:"p-4 border-b border-slate-700 bg-slate-800 flex justify-between items-center",children:[m.jsx("h3",{className:"text-xl font-bold text-white",children:h?`Edit ${h.name}`:"Create New Character"}),m.jsx("button",{onClick:t,className:"text-slate-400 hover:text-white",children:""})]}),m.jsxs("div",{className:"flex-1 overflow-y-auto p-6 grid grid-cols-1 md:grid-cols-2 gap-6",children:[m.jsxs("div",{className:"space-y-4",children:[m.jsxs("div",{children:[m.jsx("label",{className:"block text-xs uppercase text-slate-400 font-bold mb-1",children:"Name"}),m.jsx("input",{className:"w-full bg-slate-950 border border-slate-700 rounded p-2 text-white focus:border-termina-accent outline-none",value:o,onChange:te=>c(te.target.value),disabled:h&&!h.isCustom}),h&&!h.isCustom&&m.jsx("p",{className:"text-[10px] text-slate-500",children:"Standard character names cannot be changed."})]}),m.jsxs("div",{children:[m.jsx("label",{className:"block text-xs uppercase text-slate-400 font-bold mb-1",children:"Region"}),m.jsx("select",{className:"w-full bg-slate-950 border border-slate-700 rounded p-2 text-white",value:d,onChange:te=>f(te.target.value),children:Object.values(q).map(te=>m.jsx("option",{value:te,children:te},te))})]}),m.jsxs("div",{children:[m.jsx("label",{className:"block text-xs uppercase text-slate-400 font-bold mb-1",children:"Specific Location"}),m.jsx("input",{className:"w-full bg-slate-950 border border-slate-700 rounded p-2 text-white",value:p,onChange:te=>g(te.target.value),placeholder:"e.g. Stock Pot Inn"})]}),m.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[m.jsxs("div",{children:[m.jsx("label",{className:"block text-xs uppercase text-slate-400 font-bold mb-1",children:"Downtime Activity"}),m.jsx("input",{className:"w-full bg-slate-950 border border-slate-700 rounded p-2 text-white",value:k,onChange:te=>v(te.target.value),placeholder:"e.g. Sleeping"})]}),m.jsxs("div",{children:[m.jsx("label",{className:"block text-xs uppercase text-slate-400 font-bold mb-1",children:"Downtime Location"}),m.jsx("input",{className:"w-full bg-slate-950 border border-slate-700 rounded p-2 text-white",value:A,onChange:te=>C(te.target.value),placeholder:"Optional (Defaults to loc)"})]})]}),m.jsxs("div",{children:[m.jsx("label",{className:"block text-xs uppercase text-slate-400 font-bold mb-1",children:"Description"}),m.jsx("textarea",{className:"w-full bg-slate-950 border border-slate-700 rounded p-2 text-white h-24 resize-none",value:w,onChange:te=>x(te.target.value)})]})]}),m.jsxs("div",{className:"space-y-4 flex flex-col h-full",children:[m.jsxs("div",{className:"flex justify-between items-center",children:[m.jsx("h4",{className:"font-bold text-termina-gold uppercase text-sm",children:"Schedule"}),h&&!h.isCustom&&h.isEdited&&r&&m.jsx("button",{onClick:()=>{confirm("Reset schedule to default?")&&r(h.id)},className:"text-xs text-red-400 hover:underline",children:"Reset Defaults"})]}),m.jsx("p",{className:"text-[10px] text-slate-400 italic",children:"Events added here override downtime. Gaps are filled by Downtime Activity."}),m.jsxs("div",{className:"bg-slate-800/50 p-4 rounded border border-slate-700 space-y-3",children:[re&&m.jsx("div",{className:"text-red-400 text-xs bg-red-900/20 p-2 rounded border border-red-900",children:re}),m.jsxs("div",{className:"grid grid-cols-3 gap-2",children:[m.jsxs("select",{className:"bg-slate-900 border border-slate-600 rounded p-1 text-xs text-white",value:E,onChange:te=>_(te.target.value),children:[m.jsx("option",{value:"All",children:"All Days"}),m.jsx("option",{value:"1",children:"Day 1"}),m.jsx("option",{value:"2",children:"Day 2"}),m.jsx("option",{value:"3",children:"Day 3"})]}),m.jsxs("div",{className:"relative",children:[m.jsx("input",{type:"time",className:"w-full bg-slate-900 border border-slate-600 rounded p-1 text-xs text-white",value:M,onChange:te=>N(te.target.value)}),m.jsx("span",{className:"text-[9px] text-slate-400 absolute right-0 -bottom-3",children:an(M)})]}),m.jsxs("div",{className:"relative",children:[m.jsx("input",{type:"time",className:"w-full bg-slate-900 border border-slate-600 rounded p-1 text-xs text-white",value:I,onChange:te=>G(te.target.value)}),m.jsx("span",{className:"text-[9px] text-slate-400 absolute right-0 -bottom-3",children:an(I)})]})]}),m.jsx("input",{className:"w-full bg-slate-900 border border-slate-600 rounded p-2 text-sm text-white mt-2",placeholder:"Event Title (e.g. Eating Lunch)",value:F,onChange:te=>B(te.target.value)}),m.jsx("input",{className:"w-full bg-slate-900 border border-slate-600 rounded p-2 text-sm text-white",placeholder:"Location override (optional)",value:le,onChange:te=>z(te.target.value)}),m.jsxs("div",{className:"flex gap-2",children:[m.jsxs("select",{className:"bg-slate-900 border border-slate-600 rounded p-1 text-xs text-white flex-1",value:K,onChange:te=>Q(te.target.value),children:[m.jsx("option",{value:"none",children:"No Condition"}),m.jsx("option",{value:"requires_step",children:"If Step Complete"}),m.jsx("option",{value:"requires_step_not",children:"If Step NOT Complete"})]}),K!=="none"&&m.jsxs("select",{className:"bg-slate-900 border border-slate-600 rounded p-1 text-xs text-white flex-1",value:V,onChange:te=>ce(te.target.value),children:[m.jsx("option",{value:"",children:"Select Step..."}),a.flatMap(te=>te.steps.map((xe,ye)=>m.jsxs("option",{value:xe.id,children:["Q",te.questNumber,"-",ye+1]},xe.id)))]})]}),m.jsx("button",{onClick:$,className:"w-full bg-slate-700 hover:bg-green-700 text-white font-bold py-1.5 rounded text-xs transition-colors border border-slate-600 hover:border-green-500",children:"+ Add Event"})]}),m.jsxs("div",{className:"flex-1 overflow-y-auto space-y-2 min-h-[150px] bg-black/20 rounded p-2 border border-slate-800/50",children:[T.length===0&&m.jsx("p",{className:"text-slate-500 text-center italic text-xs pt-4",children:"No schedule events."}),T.map((te,xe)=>m.jsxs("div",{className:"bg-slate-800 p-2 rounded border border-slate-700 flex justify-between items-start group",children:[m.jsxs("div",{children:[m.jsxs("div",{className:"flex items-center gap-2",children:[m.jsx("span",{className:"text-[10px] font-bold bg-blue-900/30 text-blue-300 px-1 rounded",children:te.day==="All"?"Daily":`Day ${te.day}`}),m.jsxs("span",{className:"text-[10px] font-mono text-slate-400",children:[an(te.start)," - ",an(te.end)]})]}),m.jsx("div",{className:"font-bold text-slate-200 text-xs",children:te.title}),m.jsx("div",{className:"text-[10px] text-slate-500",children:te.location})]}),m.jsx("button",{onClick:()=>se(xe),className:"text-slate-600 hover:text-red-400 opacity-0 group-hover:opacity-100 transition-opacity",children:""})]},xe))]})]})]}),m.jsxs("div",{className:"p-4 bg-slate-900 border-t border-slate-800 flex justify-end gap-3",children:[m.jsx("button",{onClick:t,className:"px-4 py-2 text-slate-400 hover:text-white transition-colors",children:"Cancel"}),m.jsx("button",{onClick:ue,className:"px-6 py-2 bg-termina-accent hover:bg-white text-black font-bold rounded shadow-lg transition-all transform hover:scale-105",children:"Save Character"})]})]})})},ib=({isOpen:h,onClose:e,onSave:t,allCharacters:i})=>{const[r,a]=L.useState(""),[o,c]=L.useState(q.ClockTown),[d,f]=L.useState(""),[p,g]=L.useState("08:00"),[w,x]=L.useState("20:00"),[k,v]=L.useState(""),[A,C]=L.useState([]),[T,R]=L.useState(""),[E,_]=L.useState("");if(!h)return null;const M=()=>{T&&E&&(C([...A,{characterId:T,role:E}]),R(""),_(""))},N=()=>{if(!r)return;const I={id:`custom-shop-${Date.now()}`,name:r,region:o,location:d,openingTime:p,closingTime:w,description:k,relatedCharacters:A};t(I),e()};return m.jsx("div",{className:"fixed inset-0 bg-black/90 z-[100] flex items-center justify-center p-4 backdrop-blur-sm animate-fade-in",onClick:e,children:m.jsxs("div",{className:"bg-slate-900 border border-emerald-500/50 rounded-xl w-full max-w-2xl p-6 shadow-2xl",onClick:I=>I.stopPropagation(),children:[m.jsx("h3",{className:"text-xl font-bold text-emerald-400 mb-4",children:"Open New Business"}),m.jsxs("div",{className:"space-y-4",children:[m.jsx("input",{className:"w-full bg-slate-950 border border-slate-700 rounded p-2 text-white focus:border-emerald-500 outline-none",placeholder:"Business Name",value:r,onChange:I=>a(I.target.value)}),m.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[m.jsx("select",{className:"w-full bg-slate-950 border border-slate-700 rounded p-2 text-white",value:o,onChange:I=>c(I.target.value),children:Object.values(q).map(I=>m.jsx("option",{value:I,children:I},I))}),m.jsx("input",{className:"w-full bg-slate-950 border border-slate-700 rounded p-2 text-white",placeholder:"Location",value:d,onChange:I=>f(I.target.value)})]}),m.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[m.jsxs("div",{children:[m.jsx("label",{className:"text-xs text-slate-500 uppercase font-bold",children:"Opens"}),m.jsx("input",{type:"time",className:"w-full bg-slate-950 border border-slate-700 rounded p-2 text-white",value:p,onChange:I=>g(I.target.value)})]}),m.jsxs("div",{children:[m.jsx("label",{className:"text-xs text-slate-500 uppercase font-bold",children:"Closes"}),m.jsx("input",{type:"time",className:"w-full bg-slate-950 border border-slate-700 rounded p-2 text-white",value:w,onChange:I=>x(I.target.value)})]})]}),m.jsx("textarea",{className:"w-full bg-slate-950 border border-slate-700 rounded p-2 text-white h-24 resize-none",placeholder:"Description...",value:k,onChange:I=>v(I.target.value)}),m.jsxs("div",{className:"bg-slate-800/50 p-3 rounded border border-slate-700",children:[m.jsx("label",{className:"text-xs text-slate-400 font-bold uppercase",children:"Staff & Associations"}),m.jsxs("div",{className:"flex gap-2 mt-2 mb-2",children:[m.jsxs("select",{className:"bg-slate-900 text-white text-xs p-2 rounded border border-slate-600 flex-1",value:T,onChange:I=>R(I.target.value),children:[m.jsx("option",{value:"",children:"Select Character..."}),i.map(I=>m.jsx("option",{value:I.id,children:I.name},I.id))]}),m.jsx("input",{className:"bg-slate-900 text-white text-xs p-2 rounded border border-slate-600 w-1/3",placeholder:"Role",value:E,onChange:I=>_(I.target.value)}),m.jsx("button",{onClick:M,className:"bg-emerald-700 text-white px-3 rounded font-bold hover:bg-emerald-600",children:"+"})]}),m.jsx("div",{className:"space-y-1",children:A.map((I,G)=>{const F=i.find(B=>B.id===I.characterId);return m.jsxs("div",{className:"flex justify-between bg-slate-800 px-2 py-1 rounded text-xs border border-slate-700",children:[m.jsxs("span",{className:"text-white",children:[F?.name," ",m.jsxs("span",{className:"text-slate-400",children:["(",I.role,")"]})]}),m.jsx("button",{onClick:()=>C(B=>B.filter((X,oe)=>oe!==G)),className:"text-red-400 hover:text-red-200",children:""})]},G)})})]}),m.jsxs("div",{className:"flex justify-end gap-3 mt-4",children:[m.jsx("button",{onClick:e,className:"px-4 py-2 text-slate-400 hover:text-white",children:"Cancel"}),m.jsx("button",{onClick:N,className:"px-6 py-2 bg-emerald-600 hover:bg-emerald-500 text-white font-bold rounded shadow-lg",children:"Create Shop"})]})]})]})})},sb=({quest:h,isOpen:e,onClose:t,onSave:i,allCharacters:r,allQuests:a})=>{const[o,c]=L.useState(""),[d,f]=L.useState(q.ClockTown),[p,g]=L.useState(""),[w,x]=L.useState(""),[k,v]=L.useState([]),[A,C]=L.useState(null),[T,R]=L.useState(""),[E,_]=L.useState(""),[M,N]=L.useState(""),[I,G]=L.useState(""),[F,B]=L.useState([]),[X,oe]=L.useState("All"),[le,z]=L.useState(""),[K,Q]=L.useState(""),[V,ce]=L.useState(""),[re,j]=L.useState(100),[$,se]=L.useState("");L.useEffect(()=>{h?(c(h.title),f(h.region),g(h.description),x(h.prerequisiteQuestId||""),v(h.steps)):(c(""),f(q.ClockTown),g(""),x(""),v([])),ue()},[h,e]);const ue=()=>{C(null),R(""),_(""),N(""),G(""),B([]),oe("All"),z(""),Q(""),ce(""),j(100),se("")},te=J=>{const me=k[J];C(J),R(me.title),_(me.description),N(me.location),G(me.characterId||""),B(me.secondaryCharacterIds||[]),oe(me.days?"All":me.day||"All"),z(me.time||""),Q(me.endTime||""),ce(me.prerequisiteStepId||""),j(me.xpReward),se(me.itemRewards?.[0]?.name||"")},xe=()=>{if(!T)return;const J={id:A!==null?k[A].id:`custom-step-${Date.now()}-${k.length}`,title:T,description:E,location:M,characterId:I||void 0,secondaryCharacterIds:F.length>0?F:void 0,xpReward:re,day:X==="All"?void 0:X,days:X==="All"?[1,2,3]:void 0,time:le||void 0,endTime:K||void 0,prerequisiteStepId:V||void 0,itemRewards:$?[{name:$,type:"Item"}]:void 0};if(A!==null){const me=[...k];me[A]=J,v(me)}else v([...k,J]);ue()},ye=()=>{if(!o)return;let J=h?h.questNumber:67;if(!h){const Ve=a.filter(ft=>ft.isCustom);Ve.length>0&&(J=Math.max(...Ve.map(ee=>ee.questNumber))+1)}const me={id:h?h.id:`custom-quest-${Date.now()}`,questNumber:J,isCustom:!0,title:o,region:d,description:p,steps:k,rewards:[],prerequisiteQuestId:w||void 0};i(me),t()},_e=J=>{F.includes(J)?B(F.filter(me=>me!==J)):F.length>=1?B([...F,J]):B([...F,J])};return e?m.jsx("div",{className:"fixed inset-0 bg-black/90 z-[100] flex items-center justify-center p-4 backdrop-blur-sm animate-fade-in",onClick:t,children:m.jsxs("div",{className:"bg-slate-900 border border-blue-500/50 rounded-xl w-full max-w-5xl max-h-[95vh] flex flex-col shadow-2xl",onClick:J=>J.stopPropagation(),children:[m.jsxs("div",{className:"p-4 border-b border-slate-700 bg-slate-800 flex justify-between items-center",children:[m.jsx("h3",{className:"text-xl font-bold text-blue-300",children:h?"Edit Quest":"Create New Quest"}),m.jsx("button",{onClick:t,className:"text-slate-400 hover:text-white",children:""})]}),m.jsxs("div",{className:"flex-1 overflow-y-auto p-6 grid grid-cols-1 lg:grid-cols-2 gap-8",children:[m.jsxs("div",{className:"space-y-5",children:[m.jsx("h4",{className:"font-bold text-white uppercase text-sm border-b border-slate-700 pb-2",children:"General Info"}),m.jsx("input",{className:"w-full bg-slate-950 border border-slate-700 rounded p-2 text-white focus:border-blue-500 outline-none",placeholder:"Quest Title",value:o,onChange:J=>c(J.target.value)}),m.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[m.jsx("select",{className:"w-full bg-slate-950 border border-slate-700 rounded p-2 text-white",value:d,onChange:J=>f(J.target.value),children:Object.values(q).map(J=>m.jsx("option",{value:J,children:J},J))}),m.jsxs("select",{className:"w-full bg-slate-950 border border-slate-700 rounded p-2 text-white text-xs",value:w,onChange:J=>x(J.target.value),children:[m.jsx("option",{value:"",children:"-- No Prereq Quest --"}),a.filter(J=>J.id!==h?.id).map(J=>m.jsxs("option",{value:J.id,children:["Q",J.questNumber,": ",J.title]},J.id))]})]}),m.jsx("textarea",{className:"w-full bg-slate-950 border border-slate-700 rounded p-2 text-white h-32 resize-none",placeholder:"Quest Description / Overview...",value:p,onChange:J=>g(J.target.value)}),m.jsxs("div",{className:"bg-slate-800 p-4 rounded border border-slate-700 min-h-[200px]",children:[m.jsxs("h4",{className:"font-bold text-slate-400 uppercase text-xs mb-3",children:["Steps (",k.length,")"]}),m.jsxs("div",{className:"space-y-2",children:[k.map((J,me)=>m.jsxs("div",{className:"flex justify-between items-center bg-slate-700 p-2 rounded cursor-pointer hover:bg-slate-600 transition-colors border border-transparent hover:border-blue-400",onClick:()=>te(me),children:[m.jsxs("div",{className:"text-sm text-white font-medium truncate pr-2",children:[me+1,". ",J.title]}),m.jsx("button",{onClick:Ve=>{Ve.stopPropagation(),v(k.filter((ft,ee)=>ee!==me)),A===me&&ue()},className:"text-red-400 hover:text-red-200 px-2",children:""})]},me)),k.length===0&&m.jsx("p",{className:"text-slate-500 text-sm italic",children:"No steps added yet."})]}),m.jsx("button",{onClick:ue,className:"mt-4 text-xs text-blue-400 hover:text-blue-300 underline",children:"+ Add New Step"})]})]}),m.jsxs("div",{className:"bg-slate-950/50 p-5 rounded-lg border border-slate-700 flex flex-col",children:[m.jsx("h4",{className:"font-bold text-blue-400 uppercase text-sm mb-4 border-b border-slate-700 pb-2",children:A!==null?`Editing Step ${A+1}`:"Add New Step"}),m.jsxs("div",{className:"space-y-4 flex-1",children:[m.jsx("input",{className:"w-full bg-slate-900 border border-slate-600 rounded p-2 text-sm text-white",placeholder:"Step Title",value:T,onChange:J=>R(J.target.value)}),m.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[m.jsx("input",{className:"bg-slate-900 border border-slate-600 rounded p-2 text-sm text-white",placeholder:"Location",value:M,onChange:J=>N(J.target.value)}),m.jsx("input",{className:"bg-slate-900 border border-slate-600 rounded p-2 text-sm text-white",placeholder:"Reward Item (Optional)",value:$,onChange:J=>se(J.target.value)})]}),m.jsx("textarea",{className:"w-full bg-slate-900 border border-slate-600 rounded p-2 text-sm text-white h-24 resize-none",placeholder:"Step Details...",value:E,onChange:J=>_(J.target.value)}),m.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[m.jsxs("div",{children:[m.jsx("label",{className:"text-[10px] text-slate-400 block mb-1",children:"Primary NPC"}),m.jsxs("select",{className:"w-full bg-slate-900 border border-slate-600 rounded p-2 text-xs text-white",value:I,onChange:J=>G(J.target.value),children:[m.jsx("option",{value:"",children:"-- Related NPC --"}),r.map(J=>m.jsx("option",{value:J.id,children:J.name},J.id))]})]}),m.jsxs("div",{children:[m.jsx("label",{className:"text-[10px] text-slate-400 block mb-1",children:"Prereq Step"}),m.jsxs("select",{className:"w-full bg-slate-900 border border-slate-600 rounded p-2 text-xs text-white",value:V,onChange:J=>ce(J.target.value),children:[m.jsx("option",{value:"",children:"-- Prereq Step --"}),k.map((J,me)=>m.jsxs("option",{value:J.id,children:["Current Step ",me+1]},J.id))]})]})]}),m.jsxs("div",{className:"bg-slate-900 border border-slate-600 rounded p-2",children:[m.jsx("label",{className:"text-[10px] text-slate-400 block mb-1",children:"Additional NPCs (If step involves multiple)"}),m.jsx("div",{className:"flex flex-wrap gap-1 max-h-20 overflow-y-auto",children:r.map(J=>{if(J.id===I)return null;const me=F.includes(J.id);return m.jsx("button",{onClick:()=>_e(J.id),className:`text-[10px] px-2 py-0.5 rounded border transition-colors ${me?"bg-blue-600 border-blue-400 text-white":"bg-slate-800 border-slate-600 text-slate-400"}`,children:J.name},J.id)})})]}),m.jsxs("div",{className:"grid grid-cols-3 gap-2 p-3 bg-slate-900 rounded border border-slate-700",children:[m.jsxs("select",{className:"bg-slate-800 border border-slate-600 rounded p-1 text-xs text-white col-span-3 mb-2",value:X,onChange:J=>oe(J.target.value),children:[m.jsx("option",{value:"All",children:"Any Day / Multi-day"}),m.jsx("option",{value:"1",children:"Day 1 Only"}),m.jsx("option",{value:"2",children:"Day 2 Only"}),m.jsx("option",{value:"3",children:"Day 3 Only"})]}),m.jsxs("div",{className:"col-span-3 flex gap-2",children:[m.jsxs("div",{className:"flex-1",children:[m.jsx("label",{className:"text-[9px] text-slate-400 block",children:"Start Time"}),m.jsx("input",{type:"time",className:"w-full bg-slate-800 border border-slate-600 rounded p-1 text-xs text-white",value:le,onChange:J=>z(J.target.value)})]}),m.jsxs("div",{className:"flex-1",children:[m.jsx("label",{className:"text-[9px] text-slate-400 block",children:"End Time"}),m.jsx("input",{type:"time",className:"w-full bg-slate-800 border border-slate-600 rounded p-1 text-xs text-white",value:K,onChange:J=>Q(J.target.value)})]})]})]})]}),m.jsxs("div",{className:"mt-4 flex justify-end gap-2",children:[A!==null&&m.jsx("button",{onClick:ue,className:"text-xs text-slate-400 underline",children:"Cancel Edit"}),m.jsx("button",{onClick:xe,className:"bg-blue-600 hover:bg-blue-500 text-white px-4 py-2 rounded font-bold text-sm transition-colors",children:A!==null?"Update Step":"Add Step"})]})]})]}),m.jsxs("div",{className:"p-4 bg-slate-900 border-t border-slate-800 flex justify-end gap-3",children:[m.jsx("button",{onClick:t,className:"px-4 py-2 text-slate-400 hover:text-white",children:"Cancel"}),m.jsx("button",{onClick:ye,className:"px-6 py-2 bg-blue-600 hover:bg-blue-500 text-white font-bold rounded shadow-lg",children:"Save Quest"})]})]})}):null},rb=()=>{const[h,e]=L.useState("characters"),[t,i]=L.useState("All"),[r,a]=L.useState(""),[o,c]=L.useState(null),[d,f]=L.useState(null),[p,g]=L.useState(null),[w,x]=L.useState([]),[k,v]=L.useState(!1),[A,C]=L.useState(window.innerWidth>=1024),[T,R]=L.useState({characters:[],editedSchedules:{},quests:[],customShops:[]}),[E,_]=L.useState({currentDay:1,timeOfDayMinutes:0,totalMinutes:Gc,completedSteps:[],cycleDistance:0,dayDistance:0,dayXp:0,dayCompletedSteps:[]}),[M,N]=L.useState({totalPlayTimeSeconds:0,cyclesCompleted:0,stepCompletionCounts:{},purchasedItems:[],questLog:[],totalDistanceTravelled:0}),[I,G]=L.useState(!1),[F,B]=L.useState(1),[X,oe]=L.useState(null),[le,z]=L.useState(null),[K,Q]=L.useState(800),[V,ce]=L.useState(!1),[re,j]=L.useState(null),[$,se]=L.useState(""),[ue,te]=L.useState(!1),[xe,ye]=L.useState(!1),[_e,J]=L.useState(void 0),[me,Ve]=L.useState(!1),[ft,ee]=L.useState(!1),[fe,pe]=L.useState(void 0),[Ce,De]=L.useState(!1),[Je,Ke]=L.useState(!1);L.useEffect(()=>{(async()=>{const he=await window.electronStore.get("lastPdfPath");oe(he||"/public/Majora's Mask Adventure Book.pdf");const qe=await window.electronStore.get("globalState");qe&&_(qe);const Ze=await window.electronStore.get("gameHistory");Ze&&N(Ze);const ln=await window.electronStore.get("customContent");ln&&R(ln)})()},[]),L.useEffect(()=>{const Z=async()=>{await window.electronStore.set("globalState",E),await window.electronStore.set("gameHistory",M),await window.electronStore.set("customContent",T)};return window.addEventListener("beforeunload",Z),()=>{window.removeEventListener("beforeunload",Z)}},[E,M,T]),L.useEffect(()=>{const Z=()=>C(window.innerWidth>=1024);return window.addEventListener("resize",Z),()=>window.removeEventListener("resize",Z)},[]),L.useEffect(()=>{let Z;return k&&(Z=setInterval(()=>{N(he=>({...he,totalPlayTimeSeconds:he.totalPlayTimeSeconds+1}))},1e3)),()=>{Z&&clearInterval(Z)}},[k]);const[vt,Xe]=L.useState(null),[rt,$t]=L.useState(!1);L.useEffect(()=>{k&&(E.totalMinutes===1440&&E.currentDay===1?(Xe({show:!0,day:2}),v(!1)):E.totalMinutes===2880&&E.currentDay===2?(Xe({show:!0,day:3}),v(!1)):E.totalMinutes>=4320&&!rt&&($t(!0),v(!1)))},[E.totalMinutes,E.currentDay,k,rt]);const gt=L.useMemo(()=>[...li.map(he=>T.editedSchedules[he.id]?{...he,scheduleEvents:T.editedSchedules[he.id],isEdited:!0}:he),...T.characters],[T.editedSchedules,T.characters]),pt=L.useMemo(()=>[...cs,...T.quests],[T.quests]),Xn=L.useMemo(()=>op(lp,gt,pt,T.customShops),[gt,pt,T.customShops]),Vt=Z=>{_(he=>({...he,currentDay:Z,timeOfDayMinutes:0,totalMinutes:(Z-1)*1440,dayDistance:0,dayXp:0,dayCompletedSteps:[]})),Xe(null),v(!0),Ge(`Dawn of the ${Z===2?"Second":"Final"} Day`,"info")},on=()=>{if(E.currentDay===3)_(Z=>({...Z,timeOfDayMinutes:1440,totalMinutes:4320}));else{const Z=E.currentDay+1;Xe({show:!0,day:Z})}},Ge=(Z,he,Fe)=>{const qe=Math.random().toString(36).substring(2,9);x(Ze=>[...Ze,{id:qe,message:Z,type:he,action:Fe}])},Tn=Z=>{x(he=>he.filter(Fe=>Fe.id!==Z))},Qn=(Z,he)=>{const Fe=pt.find(Ze=>Ze.id===Z);if(!Fe)return;const qe=Fe.steps.find(Ze=>Ze.id===he);qe&&_(Ze=>{const ln=Ze.completedSteps.includes(he);let gi=[...Ze.completedSteps],zi=[...Ze.dayCompletedSteps],ys=Ze.dayXp;if(ln)gi=gi.filter(Kt=>Kt!==he),zi=zi.filter(Kt=>Kt!==he),Ze.dayCompletedSteps.includes(he)&&(ys=Math.max(0,ys-qe.xpReward));else{gi.push(he),zi.push(he),ys+=qe.xpReward,Ge(`Step Complete: ${qe.title}`,"info"),qe.curiosityShopUnlock&&Ge(`${qe.curiosityShopUnlock.itemName} available in Shop!`,"shop");const Kt=Xn.filter(jn=>jn.condition?.type==="requires_step"&&jn.condition.stepId===he);if(Kt.length>0){const jn=Kt[0];Ge(`Timeline Updated: "${jn.title}" unlocked on Day ${jn.day}.`,"timeline",()=>{Gi("timeline",jn.id)})}}if(Fe.steps.every(Kt=>gi.includes(Kt.id))&&!ln){const Kt=M.cyclesCompleted+1;if(!M.questLog.some(yi=>yi.questId===Z&&yi.cycle===Kt)){const yi=Ze.timeOfDayMinutes+360,tl=Math.floor(yi/60)%24,nl=yi%60,at=`${tl}:${nl.toString().padStart(2,"0")}`,il={questId:Z,cycle:Kt,day:Ze.currentDay,timeString:`Day ${Ze.currentDay}, ${an(at)}`,timestamp:Ze.totalMinutes};N(ws=>({...ws,questLog:[...ws.questLog,il]})),Ge(`Quest Completed: ${Fe.title}`,"info")}}return{...Ze,completedSteps:gi,dayCompletedSteps:zi,dayXp:ys}})},Jo=Z=>{_(he=>({...he,cycleDistance:he.cycleDistance+Z,dayDistance:he.dayDistance+Z})),N(he=>({...he,totalDistanceTravelled:he.totalDistanceTravelled+Z}))},ha=(Z,he)=>{he?(R(Fe=>({...Fe,characters:[...Fe.characters,Z]})),Ge("Character Created!","info")):(Z.isCustom?R(Fe=>({...Fe,characters:Fe.characters.map(qe=>qe.id===Z.id?Z:qe)})):R(Fe=>({...Fe,editedSchedules:{...Fe.editedSchedules,[Z.id]:Z.scheduleEvents}})),Ge("Character Schedule Updated!","timeline"))},ua=Z=>{R(he=>{const Fe={...he.editedSchedules};return delete Fe[Z],{...he,editedSchedules:Fe}}),Ge("Character Schedule Reset to Default.","info")},Zo=Z=>{R(he=>({...he,customShops:[...he.customShops,Z]})),Ge("Custom Shop Added!","shop")},ir=Z=>{R(he=>{const Fe=he.quests.some(qe=>qe.id===Z.id);return{...he,quests:Fe?he.quests.map(qe=>qe.id===Z.id?Z:qe):[...he.quests,Z]}}),Ge(Z.isCustom?"Custom Quest Updated!":"Custom Quest Created!","info")},sr=Z=>{pe(Z),ee(!0)},ms=()=>{N(Z=>{const he={...Z.stepCompletionCounts};return E.completedSteps.forEach(Fe=>{he[Fe]=(he[Fe]||0)+1}),{...Z,cyclesCompleted:Z.cyclesCompleted+1,stepCompletionCounts:he}}),_({currentDay:1,timeOfDayMinutes:0,totalMinutes:Gc,completedSteps:[],cycleDistance:0,dayDistance:0,dayXp:0,dayCompletedSteps:[]}),$t(!1),Xe(null),Ke(!1),v(!0),Ge(`Cycle ${M.cyclesCompleted+2} Begun. Dawn of the First Day.`,"info")},rr=()=>{De(!0)},ar=()=>{_({currentDay:1,timeOfDayMinutes:0,totalMinutes:Gc,completedSteps:[],cycleDistance:0,dayDistance:0,dayXp:0,dayCompletedSteps:[]}),N({totalPlayTimeSeconds:0,cyclesCompleted:0,stepCompletionCounts:{},purchasedItems:[],questLog:[],totalDistanceTravelled:0}),R({characters:[],editedSchedules:{},quests:[],customShops:[]}),$t(!1),Xe(null),v(!1),De(!1),Ge("New Game Started. Notebook and Editor Data cleared.","info")},hi=()=>{const Z={version:3,timestamp:Date.now(),state:E,history:M,customContent:T},he=new Blob([JSON.stringify(Z,null,2)],{type:"application/json"}),Fe=URL.createObjectURL(he),qe=document.createElement("a");qe.href=Fe,qe.download=`termina-save-cycle${M.cyclesCompleted}.json`,document.body.appendChild(qe),qe.click(),document.body.removeChild(qe),URL.revokeObjectURL(Fe),Ge("Notebook Saved.","info")},ui=Z=>{const he=new FileReader;he.onload=Fe=>{try{const qe=JSON.parse(Fe.target?.result);qe.state&&qe.history?(_(Ze=>({...Ze,...qe.state})),N(Ze=>({...Ze,...qe.history})),qe.customContent&&R(qe.customContent),Ge("Notebook Loaded.","info")):alert("Invalid save file format.")}catch{alert("Failed to parse save file.")}},he.readAsText(Z)},Wi=Z=>{const he=typeof Z=="string"?parseInt(Z,10):Z;isNaN(he)||(B(he),G(!0),ce(!1))},fa=(Z,he)=>{j(Z),se(he||"Wiki"),ce(!0),G(!1)},pa=async Z=>{oe(Z),Z&&await window.electronStore.set("lastPdfPath",Z)},ma=L.useMemo(()=>gt.filter(Z=>{const he=t==="All"||Z.locationRegion===t,Fe=Z.name.toLowerCase().includes(r.toLowerCase())||Z.description.toLowerCase().includes(r.toLowerCase());return he&&Fe}),[t,r,gt]),ga=["All",...Object.values(q).filter(Z=>Z!==q.World)],fi=Z=>{const he=gt.find(Fe=>Fe.id===Z);he&&c(he)},ya=Z=>{J(Z),ye(!0)},Hi=(Z,he)=>{f(he)},Gi=(Z,he)=>{e(Z),Z==="timeline"&&he&&f(he),Z==="questlines"&&he&&g(he)},pi=d?Xn.find(Z=>Z.id===d):null,mi=h==="timeline"?"max-w-[98%] mx-auto":"max-w-7xl mx-auto",gs=A?{marginLeft:ue?"320px":"0",marginRight:I||V?`${K}px`:"0",transition:"margin 300ms cubic-bezier(0.4, 0, 0.2, 1)"}:{};return m.jsxs("div",{className:"min-h-screen flex flex-col bg-termina-dark text-termina-light font-sans relative overflow-x-hidden",children:[m.jsx(m0,{notifications:w,removeNotification:Tn}),m.jsx(c0,{globalState:E,setGlobalState:_,onCycleReset:()=>Ke(!0),isTrackerMode:k,setIsTrackerMode:v,onSkipDay:on}),vt&&m.jsx("div",{className:"fixed inset-0 bg-black/95 z-[100] flex items-center justify-center animate-fade-in p-8",children:m.jsxs("div",{className:"text-center space-y-8",children:[m.jsxs("h1",{className:"text-5xl md:text-7xl font-serif font-bold text-white tracking-widest drop-shadow-[0_0_15px_rgba(255,255,255,0.5)]",children:["Dawn of the ",vt.day===2?"Second":"Final"," Day"]}),m.jsxs("p",{className:"text-2xl text-slate-400 font-mono",children:["- ",vt.day===2?"48":"24"," Hours Remain -"]}),m.jsxs("button",{onClick:()=>Vt(vt.day),className:"mt-8 px-8 py-3 bg-white text-black font-bold text-xl rounded hover:scale-105 transition-transform",children:["Begin Day ",vt.day]})]})}),rt&&m.jsx("div",{className:"fixed inset-0 bg-black/90 z-[100] flex items-center justify-center p-4 animate-fade-in",children:m.jsxs("div",{className:"bg-red-950/20 border-2 border-red-500 rounded-xl max-w-lg w-full p-8 text-center shadow-[0_0_50px_rgba(239,68,68,0.5)]",children:[m.jsx("h1",{className:"text-4xl font-bold font-serif text-red-500 mb-4 tracking-widest uppercase",children:"Dawn of a New Day"}),m.jsxs("p",{className:"text-xl text-red-200 mb-8 leading-relaxed",children:["You've met with a terrible fate, haven't you? ",m.jsx("br",{}),"The moon has fallen. The cycle must restart."]}),m.jsx("div",{className:"flex gap-4 justify-center",children:m.jsx("button",{onClick:ms,className:"bg-red-600 hover:bg-red-500 text-black font-bold text-lg px-8 py-3 rounded-lg shadow-lg transition-transform hover:scale-105",children:"Reset Cycle"})})]})}),Je&&m.jsx("div",{className:"fixed inset-0 bg-black/90 z-[100] flex items-center justify-center p-4 animate-fade-in",onClick:()=>Ke(!1),children:m.jsxs("div",{className:"bg-slate-900 border-2 border-termina-accent rounded-xl max-w-md w-full p-6 text-center shadow-[0_0_50px_rgba(216,180,254,0.3)]",onClick:Z=>Z.stopPropagation(),children:[m.jsx("h2",{className:"text-2xl font-bold font-serif text-termina-accent mb-4 uppercase tracking-widest",children:" Reset Cycle?"}),m.jsxs("p",{className:"text-slate-300 mb-8",children:["Return to the Dawn of the First Day?",m.jsx("br",{}),m.jsxs("span",{className:"text-sm text-slate-500",children:["Current progress will be saved to history. Note that ",m.jsx("strong",{children:"in-progress quests"})," will be restarted."]})]}),m.jsxs("div",{className:"flex gap-4 justify-center",children:[m.jsx("button",{onClick:()=>Ke(!1),className:"px-6 py-2 bg-slate-800 text-slate-300 hover:bg-slate-700 font-bold rounded border border-slate-600 transition-colors",children:"Cancel"}),m.jsx("button",{onClick:ms,className:"px-6 py-2 bg-termina-accent hover:bg-white text-black font-bold rounded shadow-lg transition-colors",children:"Yes, Play Song of Time"})]})]})}),Ce&&m.jsx("div",{className:"fixed inset-0 bg-black/90 z-[100] flex items-center justify-center p-4 animate-fade-in",onClick:()=>De(!1),children:m.jsxs("div",{className:"bg-slate-900 border-2 border-red-500 rounded-xl max-w-md w-full p-6 text-center shadow-[0_0_50px_rgba(239,68,68,0.3)]",onClick:Z=>Z.stopPropagation(),children:[m.jsx("h2",{className:"text-2xl font-bold font-serif text-red-500 mb-4 uppercase tracking-widest",children:" Reset Notebook?"}),m.jsxs("p",{className:"text-slate-300 mb-8",children:["Are you sure? This will wipe ",m.jsx("strong",{children:"ALL"})," history, collected items, progress, and custom editor content. This action cannot be undone."]}),m.jsxs("div",{className:"flex gap-4 justify-center",children:[m.jsx("button",{onClick:()=>De(!1),className:"px-6 py-2 bg-slate-800 text-slate-300 hover:bg-slate-700 font-bold rounded border border-slate-600 transition-colors",children:"Cancel"}),m.jsx("button",{onClick:ar,className:"px-6 py-2 bg-red-600 hover:bg-red-500 text-white font-bold rounded shadow-lg border border-red-400 transition-colors",children:"Yes, Wipe Data"})]})]})}),m.jsxs("div",{className:"flex-1 flex flex-col pt-20",style:gs,children:[m.jsx("header",{className:"bg-slate-900 border-b border-purple-900 p-4 shadow-lg sticky top-20 z-20",children:m.jsxs("div",{className:`${mi} flex flex-col md:flex-row justify-between items-center gap-4 transition-all duration-300`,children:[m.jsxs("nav",{className:"flex gap-2 bg-slate-800/50 p-1 rounded-lg overflow-x-auto max-w-full scrollbar-hide",children:[m.jsx("style",{children:`
                .scrollbar-hide::-webkit-scrollbar {
                    display: none;
                }
                .scrollbar-hide {
                    -ms-overflow-style: none;
                    scrollbar-width: none;
                }
              `}),["characters","questlines","activities","timeline","shop","tracker"].map(Z=>m.jsx("button",{onClick:()=>{e(Z),f(null),g(null)},className:`px-6 py-2 rounded-md text-sm font-bold transition-all uppercase tracking-wide whitespace-nowrap ${h===Z?"bg-termina-accent text-black shadow-[0_0_10px_rgba(216,180,254,0.5)]":"text-slate-400 hover:text-white hover:bg-slate-700"}`,children:Z==="shop"?"Curiosity Shop":Z==="activities"?"Activities":Z==="tracker"?"Notebook":Z.charAt(0).toUpperCase()+Z.slice(1)},Z))]}),m.jsxs("div",{className:"flex items-center gap-4 w-full md:w-auto",children:[m.jsx("button",{onClick:()=>{te(!ue),ce(!1)},className:`px-3 py-2 rounded border border-slate-600 text-xs uppercase font-bold tracking-wider transition-colors ${ue?"bg-termina-accent text-black":"bg-slate-800 text-slate-400 hover:text-white"}`,children:"Time Calc"}),m.jsx("button",{onClick:()=>{G(!I),ce(!1)},className:`px-3 py-2 rounded border border-slate-600 text-xs uppercase font-bold tracking-wider transition-colors ${I?"bg-termina-accent text-black":"bg-slate-800 text-slate-400 hover:text-white"}`,children:I?"Close PDF":"Open Book"})]})]})}),m.jsxs("main",{className:`flex-1 w-full p-6 ${mi} transition-all duration-300`,children:[h==="characters"&&m.jsxs(m.Fragment,{children:[m.jsxs("div",{className:"flex flex-col md:flex-row justify-center items-center gap-4 mb-6",children:[m.jsxs("div",{className:"flex gap-2",children:[m.jsxs("button",{onClick:()=>{J(void 0),ye(!0)},className:"bg-blue-600 hover:bg-blue-500 text-white px-3 py-2 rounded font-bold text-xs shadow-lg transition-colors flex items-center gap-2 uppercase tracking-wide",children:[m.jsx("span",{children:"+"})," Create Character"]}),m.jsxs("button",{onClick:()=>Ve(!0),className:"bg-emerald-600 hover:bg-emerald-500 text-white px-3 py-2 rounded font-bold text-xs shadow-lg transition-colors flex items-center gap-2 uppercase tracking-wide",children:[m.jsx("span",{children:"+"})," Create Shop"]})]}),m.jsxs("div",{className:"relative w-full md:w-96",children:[m.jsx("input",{type:"text",placeholder:"Search characters...",value:r,onChange:Z=>a(Z.target.value),className:"bg-slate-900 border border-slate-700 rounded-lg px-4 py-2 text-slate-100 focus:outline-none focus:border-termina-accent w-full placeholder-slate-600 text-sm shadow-inner"}),m.jsx("span",{className:"absolute right-3 top-2 text-slate-600 text-sm",children:""})]})]}),m.jsx("div",{className:"flex flex-wrap gap-2 mb-8 justify-center md:justify-start",children:ga.map(Z=>m.jsx("button",{onClick:()=>i(Z),className:`px-4 py-2 rounded-full text-xs font-bold uppercase tracking-wider transition-all ${t===Z?"bg-termina-accent text-black shadow-[0_0_15px_rgba(216,180,254,0.4)]":"bg-slate-800 text-slate-400 hover:bg-slate-700 hover:text-white border border-slate-700"}`,children:Z},Z))}),m.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:ma.map(Z=>m.jsxs("div",{className:"relative group",children:[m.jsx(r0,{character:Z,onClick:he=>fi(he.id),allQuests:pt}),m.jsx("button",{onClick:he=>{he.stopPropagation(),ya(Z)},className:"absolute top-3 right-3 z-10 bg-slate-900/80 text-slate-400 p-1.5 rounded-full hover:text-white hover:bg-blue-600 transition-colors opacity-0 group-hover:opacity-100 border border-slate-600",title:"Edit Character",children:""})]},Z.id))})]}),h==="questlines"&&m.jsx(m.Fragment,{children:m.jsx(o0,{onCharacterClick:fi,globalState:E,setGlobalState:_,onToggleStep:Qn,addNotification:Ge,onOpenPdf:Wi,onNavigate:Gi,gameHistory:M,highlightedQuestId:p,allQuests:pt,onCreateQuest:()=>{pe(void 0),ee(!0)},onEditQuest:sr})}),h==="activities"&&m.jsx(f0,{globalState:E,setGlobalState:_,selectedRegion:t,setSelectedRegion:i,onToggleStep:Qn,onCharacterClick:fi,onNavigate:Gi,addNotification:Ge,onOpenPdf:Wi,gameHistory:M,allQuests:pt,timelineEvents:Xn,allCharacters:gt}),h==="timeline"&&m.jsxs("div",{className:"h-[calc(100vh-14rem)] flex flex-row gap-4 relative",children:[pi&&m.jsx("div",{className:"w-[400px] h-full bg-slate-900 border-r border-slate-700 shrink-0 animate-fade-in flex flex-col",children:m.jsx(p0,{event:pi,globalState:E,setGlobalState:_,onToggleStep:Qn,onCharacterClick:fi,onClose:()=>f(null),addNotification:Ge,onOpenPdf:Wi,allCharacters:gt,customShops:T.customShops,allQuests:pt})}),m.jsx("div",{className:"flex-1 overflow-hidden transition-all duration-300",children:m.jsx(l0,{onEventClick:Hi,globalState:E,selectedEventId:d,events:Xn,allQuests:pt,allCharacters:gt})})]}),h==="shop"&&m.jsx(h0,{globalState:E,gameHistory:M,setGameHistory:N,addNotification:Ge,onOpenWiki:fa}),h==="tracker"&&m.jsx(eb,{globalState:E,gameHistory:M,onSave:hi,onLoad:ui,onNewGame:rr,allQuests:pt})]}),m.jsx("footer",{className:"bg-slate-900 border-t border-slate-800 p-6 text-center text-slate-500 text-xs uppercase tracking-widest mt-auto",children:m.jsx("p",{children:"Data derived from Majora's Mask D&D Module. Assets  Nintendo."})})]}),m.jsx(a0,{character:o,onClose:()=>c(null),onOpenPdf:Wi}),m.jsx(nb,{isOpen:xe,onClose:()=>ye(!1),character:_e,onSave:ha,onReset:ua,allQuests:pt}),m.jsx(ib,{isOpen:me,onClose:()=>Ve(!1),onSave:Zo,allCharacters:gt}),m.jsx(sb,{isOpen:ft,onClose:()=>ee(!1),quest:fe,onSave:ir,allCharacters:gt,allQuests:pt}),m.jsx(Jw,{isOpen:I,onClose:()=>G(!1),pageNumber:F,onPageChange:B,pdfUrl:X,onFilePathChange:pa,numPages:le,setNumPages:z,onWidthChange:Q}),m.jsx(Zw,{isOpen:V,onClose:()=>ce(!1),url:re,title:$}),m.jsx(tb,{isOpen:ue,onClose:()=>te(!1),globalState:E,setGlobalState:_,addNotification:Ge,onAddDistance:Jo})]})},am=document.getElementById("root");if(!am)throw new Error("Could not find root element to mount to");const ab=i0.createRoot(am);ab.render(m.jsx(Xg.StrictMode,{children:m.jsx(rb,{})}));
